<!doctype html>
<html
 data-issue-url="https://github.com/w3c/webdriver/"
 data-issue-param-milestone="Level 1">
<meta charset=utf-8>
<title>WebDriver</title>

<script src=https://www.w3.org/Tools/respec/respec-w3c-common async class=remove></script>
<script class=remove>
var respecConfig = {
  specStatus: "ED",
  shortName: "webdriver",
  subtitle:  "Living Document",
  // publishDate: "2009-08-06",
  // copyrightStart: "2005"
  // previousPublishDate: "1977-03-15",
  // previousMaturity: "WD",
  // lcEnd: "2009-08-05",

  edDraftURI: "https://w3c.github.io/webdriver/webdriver-spec.html",
  editors: [
    {
      name: "Simon Stewart", url: "http://www.rocketpoweredjetpants.com/",
      company: "", companyURL: "",
      w3cid: "50228"
    },
    {
      name: "David Burns", url: "http://www.theautomatedtester.co.uk/",
      company: "Mozilla", companyURL: "https://www.mozilla.org",
      w3cid: "50184"
    }
  ],
  otherLinks: [{
    key: "Participate",
    data: [
      {value: "GitHub w3c/webdriver", href: "https://github.com/w3c/webdriver"},
      {value: "Open bugs", href: "https://www.w3.org/Bugs/Public/showdependencytree.cgi?id=20860&hide_resolved=1"},
      {value: "#webdriver on irc.w3.org", href: "irc://irc.w3.org/"},
    ]
  }],

  wg: "Browser Testing and Tools Working Group",
  wgURI: "https://www.w3.org/testing/browser/",
  wgPublicList: "public-browser-tools-testing",
  wgPatentURI: "https://www.w3.org/2004/01/pp-impl/49799/status",
  noIDLSorting: true,
};
</script>
<script src=selectionchange.js></script>
<script>selectionchange.start()</script>
<script src=issue.js></script>

<section id=abstract>
<p>WebDriver is a remote control interface
 that enables introspection and control of user agents.
 It provides a platform- and language-neutral wire protocol
 as a way for out-of-process programs
 to remotely instruct the behaviour of web browsers.

<p>Provided is a set of interfaces
 to discover and manipulate DOM elements in web documents
 and to control the behaviour of a user agent.
 It is primarily intended to allow web authors to write tests
 that automate a user agent from a separate controlling process,
 but may also be used in such a way as to allow in-browser scripts
 to control a — possibly separate — browser.

<p>The standard forms part of the
 <a href=http://www.w3.org/testing/Activity>Web Testing Activity</a>
 that authors a larger set of tools commonly used for testing.
</section>

<!-- ReSpec complains if removed completely -->
<section id=sotd></section>

<section>
<h2>Conformance</h2>

<p>All diagrams, examples, and notes in this specification are non-normative,
 as are all sections explicitly marked non-normative.
 Everything else in this specification is normative.

<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHOULD”,
 “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
 in the normative parts of this document are to be interpreted as described in [[!RFC2119]].
 The key word “OPTIONALLY” in the normative parts of this document
 is to be interpreted with the same normative meaning as “MAY” and “OPTIONAL”.

<p>Conformance requirements phrased as algorithms
 or specific steps may be implemented in any manner,
 so long as the end result is equivalent.

<p>The standard defines four broad conformance classes:

<dl>
 <dt><dfn data-lt="local end|local ends|local">Local End</dfn>
 <dd><p>The local end represents the client side of the protocol,
  which is usually in the form of language-specific libraries
  providing an API on top of the WebDriver <a href=#protocol>protocol</a>.
  This specification does not place any restrictions on the details of those libraries
  above the level of the wire protocol.

  <p class=issue>Define the requirements on the local end somewhere.

 <dt><dfn data-lt="remote end|remote ends|remote">Remote End</dfn>
 <dd>The remote end hosts the server side of the <a href=#protocol>protocol</a>.
  Defining the behaviour of a remote end in response to the WebDriver protocol
  forms the largest part of this specification.

 <dt><dfn data-lt="intermediary node|intermediary nodes">Intermediary Node</dfn>
 <dd>Intermediary nodes are those that act as proxies,
  implementing both the client and server sides of the <a href=#protocol>protocol</a>.
  Intermediary nodes must be black-box indistinguishable from a <a>remote end</a>
  from the point of view of <a>local end</a>,
  and so are bound by the requirements on a <a>remote end</a> in terms of the wire protocol.
  However they are not expected to implement <a>remote end steps</a> directly.

 <dt><dfn>Endpoint Node</dfn>
 <dd>An endpoint node is the final <a>remote end</a>
  in a chain of nodes that is not an <a>intermediary node</a>.
  The endpoint node is implemented by a user agent or a similar program.
  An endpoint node must be, like <a>intermediary nodes</a>,
  indistinguishable from a <a>remote end</a>.
</dl>

<section>
<h3>Dependencies</h3>

<p>This specification relies on several other underlying specifications.

<!--
 Each item in the list begins with a comment
 with term described using the characters [a-zA-Z].
 This is so that the list items can be piped through sort(1)
 to automatically sort each list alphabetically.
-->

<dl>
 <dt>DOM
 <dd><p>The following terms are defined in the Document Object Model specification: [[!DOM]]
  <ul>
   <!-- Attribute --> <li><dfn><a href=https://dom.spec.whatwg.org/#concept-attribute>Attribute</a></dfn>
   <!-- context object --><li><dfn><a href="https://dom.spec.whatwg.org/#context-object">context object</a></dfn>
   <!-- comapreDocumentPosition --> <li><dfn><a href=https://dom.spec.whatwg.org/#dom-node-comparedocumentposition>compareDocumentPosition</a></dfn>
   <!-- Document element --> <li><dfn><a href=https://dom.spec.whatwg.org/#document-element>Document element</a></dfn>
   <!-- Document --> <li><dfn><a href=https://dom.spec.whatwg.org/#concept-document>Document</a></dfn>
   <!-- DOCUMENT_POSITION_DISCONNECTED --> <li><dfn><a href=https://dom.spec.whatwg.org/#dom-node-document_position_disconnected>DOCUMENT_POSITION_DISCONNECTED</a></dfn> (1)
   <!-- Document type --> <li><dfn><a href=https://dom.spec.whatwg.org/#concept-document-type>Document type</a></dfn>
   <!-- Document URL --> <li><dfn><a href=https://dom.spec.whatwg.org/#concept-document-url>Document URL</a></dfn>
   <!-- Element --> <li><dfn data-lt=elements><a href=https://dom.spec.whatwg.org/#concept-element>Element</a></dfn>
   <!-- Equals --> <li><dfn><a href=https://dom.spec.whatwg.org/#concept-node-equals>Equals</a></dfn>
   <!-- Event --> <li><dfn><a href=https://dom.spec.whatwg.org/#event>Event</a></dfn>
   <!-- Get an attribute by name --> <li><dfn data-lt="getting an attribute by name"><a href=https://dom.spec.whatwg.org/#concept-element-attributes-get-by-name>Get an attribute by name</a></dfn>
   <!-- getAttribute --> <li><dfn><a href=https://dom.spec.whatwg.org/#dom-element-getattribute>getAttribute</a></dfn>
   <!-- hasAttribute --> <li><dfn data-lt="has the attribute"><a href=https://dom.spec.whatwg.org/#dom-element-hasattribute>hasAttribute</a></dfn>
   <!-- HTMLCollection --><li><dfn><a href="https://dom.spec.whatwg.org/#htmlcollection"><code>HTMLCollection</code></a></dfn>
   <!-- isTrusted --> <li><dfn data-lt='is trusted'><a href="http://dom.spec.whatwg.org/#dom-event-istrusted">isTrusted</a></dfn>
   <!-- Node --> <li><dfn><a href=https://dom.spec.whatwg.org/#concept-node>Node</a></dfn>
   <!-- NodeList --> <li><dfn><a href=https://dom.spec.whatwg.org/#nodelist><code>NodeList</code></a></dfn>
   <!-- Node length --> <li><dfn><a href="https://dom.spec.whatwg.org/#concept-node-length">Node Length</a></dfn>
   <!-- ownerDocument --> <li><dfn><a href=https://dom.spec.whatwg.org/#dom-node-ownerdocument>ownerDocument</a></dfn>
   <!-- querySelector --> <li><dfn><a href="https://dom.spec.whatwg.org/#dom-parentnode-queryselector"><code>querySelector</code></a></dfn>
   <!-- querySelectorAll --> <li><dfn><a href="https://dom.spec.whatwg.org/#dom-parentnode-queryselectorall"><code>querySelectorAll</code></a></dfn>
   <!-- tagName --> <li><dfn><a href=https://dom.spec.whatwg.org/#dom-element-tagname>tagName</a></dfn>
   <!-- Text content --> <li><dfn><a href=https://dom.spec.whatwg.org/#dom-node-textcontent>Text content</a></dfn>
   <!-- Text node --> <li><dfn><a href=https://dom.spec.whatwg.org/#text><code>Text</code> node</a></dfn>
  </ul>

 <dd><p>The following attributes are defined in
  the DOM Parsing and Serialisation specification: [[!DOM-PARSING]]
  <ul>
   <!-- innerHTML IDL Attribute--> <li><dfn><a href=https://w3c.github.io/DOM-Parsing/#widl-Element-innerHTML><code>innerHTML</code> IDL attribute</a></dfn>
   <!-- outerHTML IDL Attribute--> <li><dfn><a href=https://w3c.github.io/DOM-Parsing/#widl-Element-outerHTML><code>outerHTML</code> IDL attribute</a></dfn>
   <!-- serializeToString --> <li><dfn data-lt="serialising to string"><a href=https://w3c.github.io/DOM-Parsing/#widl-XMLSerializer-serializeToString-DOMString-Node-root><code>serializeToString</code></a></dfn>
  </ul>

 <dd><p>The following attributes are defined
  in the UI Events specification: [[!UI-EVENTS]]
  <ul>
   <!-- Activation trigger --> <li><dfn><a href=https://w3c.github.io/uievents/#glossary-activation-trigger>Activation trigger</a></dfn>
   <!-- Keyboard Event --> <li><dfn><a href=https://w3c.github.io/uievents/#interface-KeyboardEvent>Keyboard event</a></dfn>
   <!-- Keyboard event order --> <li><dfn><a href=https://w3c.github.io/uievents/#events-keyboard-event-order>Keyboard event order</a></dfn>
   <!-- keyDown event --> <li><dfn data-lt="keyDown-Event"><a href=https://w3c.github.io/uievents/#event-type-keydown>keyDown event</a></dfn>
   <!-- keyPress event --> <li><dfn data-lt="keyPress-Event"><a href=https://w3c.github.io/uievents/#event-type-keypress>keyPress event</a></dfn>
   <!-- keyUp event --> <li><dfn data-lt="keyUp-Event"><a href=https://w3c.github.io/uievents/#event-type-keyup>keyUp event</a></dfn>
   <!-- mouseDown event --> <li><dfn><a href=https://w3c.github.io/uievents/#event-type-mousedown>mouseDown event</a></dfn>
   <!-- Mouse event --> <li><dfn><a href=https://w3c.github.io/uievents/#interface-MouseEvent>Mouse event</a></dfn>
   <!-- Mouse event order --> <li><dfn><a href=https://w3c.github.io/uievents/#events-mouse-event-order>Mouse event order</a></dfn>
   <!-- mouseUp event --> <li><dfn><a href=https://w3c.github.io/uievents/#event-type-mousedown>mouseUp event</a></dfn>
  </ul>

 <dd><p>The following attributes are defined
  in the UI Events Code specification: [[!UIEVENTS-CODE]]
  <ul>
   <li><dfn data-lt="keyboard event code"><a href=https://www.w3.org/TR/uievents-code/#code-value-tables>Keyboard event code tables</a></dfn>
  </ul>

 <dd><p>The following attributes are defined
  in the UI Events Code specification: [[!UIEVENTS-KEY]]
  <ul>
   <li><dfn data-lt="modifier key"><a href=https://www.w3.org/TR/uievents-key/#keys-modifier>Keyboard modifier keys</a></dfn>
  </ul>

 <dt>ECMAScript
 <dd><p>The following terms are defined in the ECMAScript Language Specification: [[!ECMA-262]]
  <ul>
   <!-- Create a function object --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-13.2>Create a function object</a></dfn>
   <!-- Directive prologue --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-14.1>Directive prologue</a></dfn>
   <!-- Early error --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-16>Early error</a></dfn>
   <!-- FunctionBody --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-13>FunctionBody</a></dfn>
   <!-- Function --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-4.3.24>Function</a></dfn>
   <!-- Global environment --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-10.2.3>Global environment</a></dfn>
   <!-- Own property --> <li><dfn data-lt="own properties"><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-4.3.30>Own property</a></dfn>
   <!-- parseFloat --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-15.1.2.3>parseFloat</a></dfn>
   <!-- Use strict directive --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-14.1>Use strict directive</a></dfn>
  </ul>

 <dd>This specification also presumes that you are able to call
  some of the internal methods from the ECMAScript Language Specification:
  <ul>
   <!-- Call --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-13.2.1>[[\Call]]</a></dfn>
   <!-- Class --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-8.6.2>[[\Class]]</a></dfn>
   <!-- GetOwnProperty --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-8.12.1>[[\GetOwnProperty]]</a></dfn>
   <!-- GetProperty --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-8.12.2>[[\GetProperty]]</a></dfn>
   <!-- Index of --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-15.5.4.7>Index of</a></dfn>
   <!-- Substring --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-15.5.4.15>Substring</a></dfn>
  </ul>

 <dd>The ECMAScript Language Specification also defines the following
  types, values, and operations that are used throughout this
  specification:
  <ul>
   <!-- Array --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-11.1.4>Array</a></dfn>
   <!-- Boolean type --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-4.3.14>Boolean</a></dfn> type
   <!-- List --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-8.8>List</a></dfn>
   <!-- null --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-4.3.11>Null</a></dfn>
   <!-- Number --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-4.3.19>Number</a></dfn>
   <!-- Object --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-4.2.1>Object</a></dfn>
   <!-- String --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-4.3.18>String</a></dfn>
   <!-- undefined --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-4.3.9>Undefined</a></dfn>
   <!-- ToInteger --> <li><dfn><a href=http://www.ecma-international.org/ecma-262/6.0/#sec-tointeger>ToInteger</a></dfn>
  </ul>

 <dt>Fetch
 <dd><p>The following terms are defined in the WHATWG Fetch specification: [[!FETCH]]
  <ul>
   <!-- Body --> <li><dfn><a href=https://fetch.spec.whatwg.org/#concept-request-body>Body</a></dfn>
   <!-- Method --> <li><dfn><a href=https://fetch.spec.whatwg.org/#concept-request-method>Method</a></dfn>
   <!-- Response --> <li><dfn><a href=https://fetch.spec.whatwg.org/#concept-response>Response</a></dfn>
   <!-- Request --> <li><dfn><a href=https://fetch.spec.whatwg.org/#concept-request>Request</a></dfn>
   <!-- Status --> <li><dfn><a href=https://fetch.spec.whatwg.org/#concept-response-status>HTTP Status</a></dfn>
   <!-- Status message --> <li><dfn><a href=https://fetch.spec.whatwg.org/#concept-response-status-message>Status message</a></dfn>
   <!-- URL --> <li><dfn><a href=https://fetch.spec.whatwg.org/#concept-request-url>URL</a></dfn>
  </ul>

 <dt>HTML
 <dd><p>The following terms are defined in the HTML specification: [[!HTML]]
  <ul>
   <!-- 2D context creation algorithm --> <li><dfn><a href=https://html.spec.whatwg.org/#2d-context-creation-algorithm>2D context creation algorithm</a></dfn>
   <!-- A browsing context is discarded --> <li><dfn data-lt=discarded><a href=https://html.spec.whatwg.org/#a-browsing-context-is-discarded>A browsing context is discarded</a></dfn>
   <!-- Active document --> <li><dfn><a href=https://html.spec.whatwg.org/#active-document>Active document</a></dfn>
   <!-- Active element --> <li><dfn>Active element</dfn> being the <a href=https://html.spec.whatwg.org/#dom-document-activeelement><code>activeElement</code></a> attribute on <a href=https://html.spec.whatwg.org/#document><code>Document</code></a>
   <!-- A serialization of the bitmap as a file --> <li><dfn data-lt="a serialisation of the canvas element’s bitmap as a file"><a href=https://html.spec.whatwg.org/#a-serialisation-of-the-bitmap-as-a-file>A serialisation of the bitmap as a file</a></dfn>
   <!-- Associated window --> <li><dfn><a href=https://html.spec.whatwg.org/#concept-document-window>Associated window</a></dfn>
   <!-- Boolean attribute --> <li><dfn><a href=https://html.spec.whatwg.org/#boolean-attribute>Boolean attribute</a></dfn>
   <!-- Browsing context --> <li><dfn data-lt="browsing contexts"><a href=https://html.spec.whatwg.org/#browsing-context>Browsing context</a></dfn>
   <!-- Button --> <li><dfn><a href="https://html.spec.whatwg.org/#button-state-%28type=button%29">Button</a></dfn> state
   <!-- Buttons --> <li><dfn><a href=https://html.spec.whatwg.org/#concept-button>Buttons</a></dfn>
   <!-- Canvas context mode --> <li><dfn><a href=https://html.spec.whatwg.org/#concept-canvas-context-mode>Canvas context mode</a></dfn>
   <!-- Change event --> <li><dfn><a href=https://html.spec.whatwg.org/#event-change>Change</a></dfn> event
   <!-- Checkbox --> <li><dfn><a href="https://html.spec.whatwg.org/#checkbox-state-%28type=checkbox%29">Checkbox</a></dfn> state
   <!-- Checkedness --> <li><dfn><a href=https://html.spec.whatwg.org/#concept-fe-checked>Checkedness</a></dfn>
   <!-- Child browsing context --> <li><dfn><a href=https://html.spec.whatwg.org/#child-browsing-context>Child browsing context</a></dfn>
   <!-- Close a browsing context --> <li><dfn data-lt="close|closes"><a href=https://html.spec.whatwg.org/#close-a-browsing-context>Close a browsing context</a></dfn>
   <!-- Code entry-point --> <li><dfn><a href=https://html.spec.whatwg.org/#code-entry-point>Code entry-point</a></dfn>
   <!-- Cookie-averse Document object --> <li><dfn><a href=https://html.spec.whatwg.org/#cookie-averse-document-object>Cookie-averse <code>Document</code> object</a></dfn>
   <!-- Current entry --> <li><dfn><a href=https://html.spec.whatwg.org/#current-entry>Current entry</a></dfn>
   <!-- Determine the value of an indexed property --> <li><dfn data-lt="determining the value of an indexed property"><a href=https://html.spec.whatwg.org/#dom-window-item>Determine the value of an indexed property</a></dfn> of a <a><code>Window</code></a> object
   <!-- Disabled --> <li><dfn><a href=https://html.spec.whatwg.org/#concept-fe-disabled>Disabled</a></dfn>
   <!-- Document address --> <li><dfn data-lt=address><a href=https://dom.spec.whatwg.org/#concept-document-url>Document address</a></dfn>
   <!-- Document title --> <li><dfn data-lt=title><a href=https://html.spec.whatwg.org/#document.title>Document title</a></dfn>
   <!-- Enumerated attribute --> <li><dfn><a href=https://html.spec.whatwg.org/#enumerated-attribute>Enumerated attribute</a></dfn>
   <!-- Environment settings object --> <li><dfn><a href=https://html.spec.whatwg.org/#environment-settings-object>Environment settings object</a></dfn>
   <!-- Event loop --> <li><dfn><a href=https://html.spec.whatwg.org/#event-loop>Event loop</a></dfn>
   <!-- File --> <li><dfn><a href="https://html.spec.whatwg.org/#file-upload-state-%28type=file%29">File</a></dfn> state
   <!-- Focusing steps --> <li><dfn><a href="https://html.spec.whatwg.org/#focusing-steps">Focusing steps</a></dfn>
   <!-- Getting innerText --> <li><dfn><a href=http://rocallahan.github.io/innerText-spec/index.html#setting-innertext>Getting <code>innerText</code></a></dfn>
   <!-- Hidden --> <li><dfn><a href="https://html.spec.whatwg.org/#hidden-state-%28type=hidden%29">Hidden</a></dfn> state
   <!-- Image Button --> <li><dfn><a href="https://html.spec.whatwg.org/#image-button-state-%28type=image%29">Image Button</a></dfn> state
   <!-- Input type file selected --> <li><dfn><a href="https://html.spec.whatwg.org/#concept-input-type-file-selected">Selected Files</a></dfn>
   <!-- Joint session history --> <li><dfn><a href=https://html.spec.whatwg.org/#joint-session-history>Joint session history</a></dfn>
   <!-- Missing value default state --> <li><dfn><a href=https://html.spec.whatwg.org/#missing-value-default>Missing value default state</a></dfn>
   <!-- Navigate --> <li><dfn><a href=https://html.spec.whatwg.org/#navigate>Navigate</a></dfn>
   <!-- Nested browsing context --> <li><dfn><a href=https://html.spec.whatwg.org/#nested-browsing-context>Nested browsing context</a></dfn>
   <!-- Origin-clean --> <li><dfn><a href=https://html.spec.whatwg.org/#concept-canvas-origin-clean>Origin-clean</a></dfn>
   <!-- Parent browsing context --> <li><dfn><a href=https://html.spec.whatwg.org/#parent-browsing-context>Parent browsing context</a></dfn>
   <!-- Pause --> <li><dfn data-lt=unpaused><a href=https://html.spec.whatwg.org/#pause>HTML Pause</a></dfn>
   <!-- Prompt to unload a document --> <li><dfn data-lt="prompt to unload a document|prompting to unload"><a href=https://html.spec.whatwg.org/#prompt-to-unload-a-document>Prompt to unload a document</a></dfn>
   <!-- Radio button --> <li><dfn><a href="https://html.spec.whatwg.org/#radio-button-state-%28type=radio%29">Radio Button</a></dfn> state
   <!-- Replacement enabled --> <li><dfn><a href=https://html.spec.whatwg.org/#replacement-enabled>Replacement enabled</a></dfn>
   <!-- Reset Button --> <li><dfn><a href="https://html.spec.whatwg.org/#reset-button-state-%28type=reset%29">Reset Button</a></dfn> state
   <!-- Script execution environment --> <li><dfn><a href=https://html.spec.whatwg.org/#script-execution-environment>Script execution environment</a></dfn>
   <!-- Script --> <li><dfn><a href=https://html.spec.whatwg.org/#concept-script>Script</a></dfn>
   <!-- Selectedness --> <li><dfn><a href=https://html.spec.whatwg.org/#concept-option-selectedness>Selectedness</a></dfn>
   <!-- setSelectionRange --> <li><dfn data-lt="set selection range"><a href=https://html.spec.whatwg.org/#dom-textarea/input-setselectionrange><code>setSelectionRange</code></a></dfn>
   <!-- Settings object --> <li><dfn><a href=https://html.spec.whatwg.org/#settings-object>Settings object</a></dfn>
   <!-- Simple dialogues --> <li><dfn data-lt="simple dialogue"><a href=https://html.spec.whatwg.org/#simple-dialogs>Simple dialogues</a></dfn>
   <!-- Strip leading and trailing white space --><li><dfn data-lt="stripping leading and trailing whitespace"><a href="https://html.spec.whatwg.org/#strip-leading-and-trailing-whitespace">Strip leading and trailing whitespace</a></dfn>
   <!-- Submit Button --> <li><dfn><a href="https://html.spec.whatwg.org/#submit-button-state-%28type=submit%29">Submit Button</a></dfn> state
   <!-- Submittable elements --> <li><dfn data-lt="submittable element"><a href=https://html.spec.whatwg.org/#category-submit>Submittable elements</a></dfn>
   <!-- Top-level browsing context --> <li><dfn data-lt="top-level browsing context|top-level browsing contexts"><a href=https://html.spec.whatwg.org/#top-level-browsing-context>Top-level browsing context</a></dfn>
   <!-- Traverse the history by a delta --> <li><dfn><a href=https://html.spec.whatwg.org/#traverse-the-history-by-a-delta>Traverse the history by a delta</a></dfn>
   <!-- Traverse the history --> <li><dfn data-lt="traverse the history|traversing the history"><a href=https://html.spec.whatwg.org/#traverse-the-history>Traverse the history</a></dfn>
   <!-- Tree order --> <li><dfn><a href=https://html.spec.whatwg.org/#tree-order>Tree order</a></dfn>
   <!-- User prompt --> <li><dfn data-lt="user prompts"><a href=https://html.spec.whatwg.org/#user-prompts>User prompt</a></dfn>
   <!-- Value attribute --><li><dfn><a href=https://html.spec.whatwg.org/#dom-input-value><code>value</code> attribute</a></dfn>
   <!-- Value --> <li><dfn><a href=https://html.spec.whatwg.org/#concept-fe-value>Value</a></dfn>
  </ul>

 <dd><p>The HTML specification also defines a number of elements
  which this specification has special-cased behaviour for:
  <ul>
   <!-- a element --> <li><a href=https://html.spec.whatwg.org/#the-a-element><dfn data-lt="a elements"><code>a</code> element</dfn></a>
   <!-- frame element --> <li><a href=https://html.spec.whatwg.org/#frame><dfn><code>frame</code></dfn> element</a>
   <!-- iframe element --> <li><a href=https://html.spec.whatwg.org/#the-iframe-element><dfn><code>iframe</code></dfn> element</a>
   <!-- canvas element --> <li><dfn><a href=https://html.spec.whatwg.org/#the-canvas-element><code>canvas</code> element</a></dfn>
   <!-- HTML Element --> <li><dfn><a href="https://html.spec.whatwg.org/#the-html-element"><code>html</code> element</a></dfn>
   <!-- input element --> <li><a href=https://html.spec.whatwg.org/#the-input-element><dfn data-lt="input elements|input"><code>input</code> element</dfn></a>
   <!-- option element --> <li><a href=https://html.spec.whatwg.org/#the-option-element><dfn><code>option</code></dfn> element</a>
   <!-- textarea element --> <li><a href=https://html.spec.whatwg.org/#the-textarea-element><dfn><code>textarea</code> element</dfn></a>
  </ul>

 <dd><p>The following types are also defined in the HTML specification,
  and referenced here:
  <ul>
   <!-- Canvas height atribute --> <li><dfn><a href=https://html.spec.whatwg.org/#attr-canvas-height><code>canvas</code>’s height attribute</a></dfn>
   <!-- Canvas width attribute --> <li><dfn><a href=https://html.spec.whatwg.org/#attr-canvas-width><code>canvas</code>’ width attribute</a></dfn>
   <!-- Window object --> <li><dfn><a href=https://html.spec.whatwg.org/#the-window-object><code>Window</code></a></dfn> object
   <!-- WindowProxy exotic object --> <li><dfn><a href=https://html.spec.whatwg.org/#windowproxy><code>WindowProxy</code></a></dfn> exotic object
   <!-- readOnly attribute --> <li><dfn><a href=https://html.spec.whatwg.org/#the-readonly-attribute><code>readOnly</code> attribute</a></dfn>
   <!-- showModalDialog --> <li><dfn><a href=https://html.spec.whatwg.org/#dom-showmodaldialog><code>showModalDialog()</code></a></dfn>
   <!-- type attribute --> <li><dfn><a href=https://html.spec.whatwg.org/#attr-input-type><code>type</code> attribute</a></dfn>
   <!-- window confirm --> <li><dfn>window.<a href=https://html.spec.whatwg.org/#dom-confirm><code>confirm</code></a></dfn>
   <!-- window.alert --> <li><dfn>window.<a href=https://html.spec.whatwg.org/#dom-alert><code>alert</code></a></dfn>
   <!-- window.print --> <li><dfn>window.<a href=https://html.spec.whatwg.org/#dom-print><code>print</code></a></dfn>
   <!-- window.prompt --> <li><dfn>window.<a href=https://html.spec.whatwg.org/#dom-prompt><code>prompt</code></a></dfn>
  </ul>

 <dd><p>The HTML Editing APIs specification defines the following terms: [[!EDITING]]
  <ul>
   <!-- Content Editable --> <li><dfn><a href=https://w3c.github.io/editing/contentEditable.html>Content editable</a></dfn></li>
  </ul>

 <dd><p>The following events are also defined in the HTML specification:
  <ul>
   <!-- beforeunload --> <li><dfn><a href=https://html.spec.whatwg.org/#event-beforeunload><code>beforeunload</code></a></dfn>
  </ul>

 <dd><p>The “data” URL scheme specification defines the following terms: [[!RFC2397]]
  <ul>
   <!-- data: url --> <li><dfn><a href=https://tools.ietf.org/html/rfc2397#section-2><code>data:</code> URL</a></dfn>
  </ul>

 <dt>HTTP and related specifications
 <dd><p>To be <dfn>HTTP compliant</dfn>,
  it is supposed that the implementation supports the relevant subsets of
  [[!RFC7230]], [[!RFC7231]], [[!RFC7232]], [[!RFC7234]], and [[!RFC7235]].

 <dd><p>The following terms are defined in the Cookie specification: [[!RFC6265]]
  <ul>
   <!-- Compute cookie-string --> <li><dfn><a href=https://tools.ietf.org/html/rfc6265#section-5.4>Compute <code>cookie-string</code></a></dfn>
   <!-- Cookie --> <li><dfn data-lt=cookies><a href=https://tools.ietf.org/html/rfc6265#section-5.3>Cookie</a></dfn>
   <!-- Cookie store --> <li><dfn><a href=https://tools.ietf.org/html/rfc6265#section-5.3>Cookie store</a></dfn>
   <!-- Receives a cookie --> <li><dfn data-lt="receiving a cookie"><a href=https://tools.ietf.org/html/rfc6265#section-5.3>Receives a cookie</a></dfn>
  </ul>

 <dd><p>The following terms are defined in
  the Hypertext Transfer Protocol (HTTP) Status Code Registry:
  <ul>
   <!-- Status code registry --> <li><dfn><a href=http://www.iana.org/assignments/http-status-codes/http-status-codes.xhtml>Status code registry</a></dfn>
  </ul>

 <dd>The following terms are defined in
  the Netscape Navigator Proxy Auto-Config File Format:
  <ul>
   <!-- Proxy autoconfiguration --> <li><dfn><a href=https://web.archive.org/web/20070602031929/http://wp.netscape.com/eng/mozilla/2.0/relnotes/demo/proxy-live.html>Proxy autoconfiguration</a></dfn>
  </ul>

  <dd><p>The specification uses
   <dfn data-lt="uri templates|uri template">URI Templates</dfn>. [[!URI-TEMPLATE]]

 <dt>Styling
 <dd>The following terms are defined in
  the CSS Values and Units Module Level 3 specification: [[!CSS3-VALUES]]
  <ul>
   <!-- CSS reference pixels --> <li><dfn><a href=http://www.w3.org/TR/css3-values/#reference-pixel>CSS reference pixels</a></dfn>
  </ul>

 <dd>The following properties are defined in
  the CSS Basic Box Model Level 3 specification: [[!CSS3-BOX]]
   <ul>
    <!-- Visibility property --> <li>The <dfn><a href=https://drafts.csswg.org/css-box/#visibility><code>visibility</code></a></dfn> property
   </ul>

 <dd>The following terms are defined in
  the CSS Device Adaptation Module Level 1 specification: [[!CSS-DEVICE-ADAPT]]
   <ul>
    <!-- Initial viewport --><li><dfn data-lt=viewport><a href=https://drafts.csswg.org/css-device-adapt/#initial-viewport>Initial viewport</a></dfn>,
     sometimes here referred to as the <i>viewport</i>.
   </ul>

 <dd>The following properties are defined in
  the CSS Display Module Level 3 specification: [[!CSS3-DISPLAY]]
  <ul>
   <!-- Display property --> <li>The <dfn><a href=https://drafts.csswg.org/css-display/#the-display-properties><code>display</code></a></dfn> property
  </ul>

 <dd>The following terms are defined in
  the Geometry Interfaces Module Level 1 specification: [[!GEOMETRY-1]]
  <ul>
   <!-- DOMRect --> <li><a href="https://www.w3.org/TR/geometry-1/#dom-domrect"><dfn><code>DOMRect</code></dfn></a>
   <!-- Rectangle --> <li><dfn data-lt="bounding rectangle"><a href=https://drafts.fxtf.org/geometry/#rectangle>Rectangle</a></dfn>
   <!-- Rectangle height dimension --> <li><dfn data-lt="height dimension"><a href=https://drafts.fxtf.org/geometry/#rectangle-height-dimension>Rectangle height dimension</a></dfn>
   <!-- Rectangle width dimension --> <li><dfn data-lt="width dimension"><a href=https://drafts.fxtf.org/geometry/#rectangle-width-dimension>Rectangle width dimension</a></dfn>
   <!-- Rectangle x coordinate --> <li><dfn data-lt="x coordinate"><a href=https://drafts.fxtf.org/geometry/#rectangle-x-coordinate>Rectangle x coordinate</a></dfn>
   <!-- Rectangle y coordinate --> <li><dfn data-lt="y coordinate"><a href=https://drafts.fxtf.org/geometry/#rectangle-y-coordinate>Rectangle y coordinate</a></dfn>
  </ul>

 <dd>The following terms are defined in
  the CSS Cascading and Inheritance Level 4 specification: [[!CSS-CASCADE-4]]
  <ul>
   <!-- Computed Value --> <li><dfn><a href=https://drafts.csswg.org/css-cascade-4/#computed-value>Computed value</a></dfn>
  </ul>

 <dd>The following terms are defined in the CSS Object Model: [[!CSSOM]]:
  <ul>
   <!-- Resolved value --> <li><dfn><a href=https://drafts.csswg.org/cssom/#resolved-value>Resolved value</a></dfn>
  </ul>

 <dd>The following functions are defined in
  the CSSOM View Module: [[!CSSOM-VIEW]]:
  <ul>
   <!-- elementsFromPoint --> <li><dfn>Elements from point</dfn> as <a href=https://drafts.csswg.org/cssom-view/#dom-document-elementsfrompoint>elementsFromPoint()</a>
   <!-- getClientRects --> <li><dfn><a href=http://www.w3.org/TR/cssom-view/#dom-range-getclientrects>getClientRects</a></dfn>
   <!-- innerHeight --> <li><dfn><a href=https://drafts.csswg.org/cssom-view/#dom-window-innerheight>innerHeight</a></dfn>
   <!-- innerWidth --> <li><dfn><a href=https://drafts.csswg.org/cssom-view/#dom-window-innerwidth>innerWidth</a></dfn>
   <!-- moveTo --> <li><dfn><a href=https://drafts.csswg.org/cssom-view/#dom-window-moveto>moveTo(x, y)</a></dfn>
   <!-- offsetLeft --> <li><dfn><a href=https://drafts.csswg.org/cssom-view/#dom-htmlelement-offsetleft>offsetLeft</a></dfn>
   <!-- offsetParent --> <li><dfn><a href=https://drafts.csswg.org/cssom-view/#dom-htmlelement-offsetparent>offsetParent</a></dfn>
   <!-- offsetTop --> <li><dfn><a href=https://drafts.csswg.org/cssom-view/#dom-htmlelement-offsettop>offsetTop</a></dfn>
   <!-- screenX --> <li><dfn><a href=https://drafts.csswg.org/cssom-view/#dom-window-screenx>screenX</a></dfn>
   <!-- screenY --> <li><dfn><a href=https://drafts.csswg.org/cssom-view/#dom-window-screeny>screenY</a></dfn>
   <!-- scrollIntoView --> <li><dfn><a href=https://drafts.csswg.org/cssom-view/#dom-element-scrollintoview>scrollIntoView()</a></dfn>
  </ul>

 <dt>URLs
 <dd>The following terms are defined in the WHATWG URL standard: [[!URL]]
  <ul>
   <!-- Absolute URL --> <li><dfn><a href=https://url.spec.whatwg.org/#syntax-url-absolute>Absolute URL</a></dfn>
   <!-- Absolute URL with fragment --> <li><dfn><a href=https://url.spec.whatwg.org/#syntax-url-absolute-with-fragment>Absolute URL with fragment</a></dfn>
   <!-- Domain --><li><dfn><a href="https://url.spec.whatwg.org/#concept-domain">Domain</a></dfn>
   <!-- Path-absolute URL --> <li><dfn><a href=https://url.spec.whatwg.org/#syntax-url-path-absolute>Path-absolute URL</a></dfn>
   <!-- Path --> <li><dfn><a href=https://url.spec.whatwg.org/#concept-url-path>Path</a></dfn>
   <!-- URL serialiser --> <li><dfn><a href=https://url.spec.whatwg.org/#concept-url-serializer>URL serialiser</a></dfn>
  </ul>

 <dt>Web IDL
 <dd><p>The IDL fragments in this specification
  must be interpreted as required for conforming IDL fragments,
  as described in the Web IDL specification. [[!WEBIDL]]
  <ul>
   <!-- DOMException --> <li><a href="https://heycam.github.io/webidl/#dfn-DOMException"><dfn><code>DOMException</code></dfn></a>
   <!-- Sequence --> <li><a href="https://heycam.github.io/webidl/#idl-sequence"><dfn>Sequence</dfn></a>
   <!-- Supported property indices --> <li><dfn data-lt="supported property index"><a href=http://heycam.github.io/webidl/#dfn-supported-property-indices>Supported property indices</a></dfn>
   <!-- SyntaxError --> <li><dfn><a href="https://heycam.github.io/webidl/#syntaxerror"><code>SyntaxError</code></a></dfn></li>

  </ul>

  <dt>XPATH
  <dd><p>The following terms are defined in the Document Object Model XPath standard [[!XPATH]]
    <ul>
      <!-- evaluate --><li><a href="https://www.w3.org/TR/DOM-Level-3-XPath/xpath.html#XPathEvaluator-evaluate"><dfn><code>evaluate</code></dfn></a>
      <!-- XPathException --><li><a href="https://www.w3.org/TR/DOM-Level-3-XPath/xpath.html#XPathException"><dfn><code>XPathException</code></dfn></a>
    </ul>
</dl>
</section> <!-- /Dependencies -->
</section> <!-- /Conformance -->

<section>
<h2>Terminology</h2>

<p>In equations, all numbers are integers,
 addition is represented by “+”,
 subtraction is represented by “−”,
 and bitwise OR by “|”.
 The characters “(” and “)” are used to provide logical grouping in these contexts.

<p>The shorthand
 <dfn>min</dfn>(<var>value</var>, <var>value</var>[, <var>value</var>])
 returns the smallest item of two or more values.
 Conversely, the shorthand
 <dfn>max</dfn>(<var>value</var>, <var>value</var>[, <var>value</var>])
 returns the largest item of two or more values.

<p>An <dfn>ASCII string</dfn> is a string
 in the range U+0000 to U+007F, inclusive.

<p>A <dfn data-lt=uuid>Universally Unique IDentifier (UUID)</dfn> is
 a 128 bits long URN that requires no central registration process. [[!RFC4122]].
 <dfn>Generating a UUID</dfn> means Creating a
 <a>UUID</a> From Truly Random or Pseudo-Random Numbers [[!RFC4122]],
 and serializing it as appropriate for the callee.

<p>The <dfn data-lt="Unix timestamp">Unix Epoch</dfn>
 is a value that approximates the number of seconds
 that have elapsed since the Epoch,
 as described by The Open Group Base Specifications Issue 7
 <a href=http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap04.html#tag_04_15>section 4.15</a> (IEEE Std 1003.1).

 <p> An <dfn>Integer</dfn> is a <a>Number</a> that is unchanged under
 the <a>ToInteger</a> operation.

<p>The <dfn>initial value</dfn> of a javascript property is the value
  defined by the platform for that property i.e. the value it would
  have in the absence of any shadowing by content script.

</section> <!-- /Terminology -->

<section>
<h2>Interface</h2>

<pre class=idl>partial interface Navigator {
  readonly attribute boolean webdriver;
};</pre>

<p>The <code>webdriver</code> IDL attribute
 of the <code><a>Navigator</a></code> interface must return
 the value of the <dfn>webdriver-active flag</dfn>, which is initially false.

<p>This property allows websites to determine
 that the user agent is under control by WebDriver,
 and can be used to help mitigate
 <a href=https://en.wikipedia.org/wiki/Denial-of-service_attack>denial-of-service attacks</a>.
</section>

<section>
<h2>Protocol</h2>

<p>WebDriver <a>remote ends</a> must provide
 an <a>HTTP compliant</a> wire protocol
 where the <a>endpoints</a> map to different <a>commands</a>.

<p>As this standard only defines the <a>remote end</a> protocol,
 it puts no demands to how <a>local ends</a> should be implemented.
 <a>Local ends</a> are only expected to be compatible to the extent
 that they can speak the <a>remote end</a>’s protocol;
 no requirements are made upon their exposed user-facing API.

<section>
<h3>Algorithms</h3>

<p>Various parts of this specification are written in terms of step-by-step algorithms.
 The details of these algorithms do not have any normative significance;
 implementations are free to adopt any implementation strategy
 that produces equivalent output to the specification.
 In particular algorithms in this document are optimised
 for readability rather than performance.

<p>Where algorithms that return values are fallible,
 they are written in terms of returning either
 <dfn>success</dfn> or <dfn>error</dfn>.
 A <a>success</a> value has an associated <var>data</var> field
 which encapsulates the value returned,
 whereas an <a>error</a> response has an associated <a>error code</a>.

<p>When calling a fallible algorithm, the construct
  "Let <var>result</var> be the result of <dfn>trying</dfn> to
  call <var>algorithm</var>" is equivalent to "Let <var>temp</var> be
  the result of calling <var>algorithm</var>. If <var>temp</var> is
  an <a>error</a> return <var>temp</var>, otherwise
  let <var>result</var> be <var>temp</var>'s <a>data</a>.

<p>The result of <dfn data-lt="getting properties">getting a property</dfn>
 with <var>name</var> from an <a>Object</a> is defined as
 the result of calling the <a>[[\GetOwnProperty]]</a>
 internal method of with property name <var>name</var>.
</section> <!-- /Algorithms -->

<section>
<h3>Commands</h3>

<p>The WebDriver protocol is organised into <a>commands</a>.
 Each HTTP request with a method and template defined in this specification
 represents a single <dfn data-lt="command|commands">command</dfn>
 and therefore each command produces a single HTTP response.
 In response to a <a>command</a>,
 a <a>remote end</a> will run a series of actions against the remote browser.

<p>Each <a>command</a> defined in this specification
 has an associated list of <dfn>remote end steps</dfn>.
 This provides the sequence of actions that a <a>remote end</a> takes
 when it receives a particular command.
</section>

<section>
<h3>Processing Model</h3>

<p>The <a>remote end</a> acts as a HTTP server reading requests
 from the client and writing responses, typically over TCP socket.
 For the purposes of this specification we model the data transmission
 between a particular <a>local end</a> and <a>remote end</a> with a <dfn>connection</dfn>
 to which the <a>remote end</a> may <dfn>write bytes</dfn> and <dfn>read bytes</dfn>.
 However the exact details of how this <a>connection</a> works
 and how it is established are out of scope.

<p>After such a <a>connection</a> has been established,
 a remote end MUST run the following steps:</p>

<p class=issue>Should mention what happens if it can’t be decoded as HTTP.
 Note that <a href=https://fetch.spec.whatwg.org/>Fetch</a> isn’t quite right
 because it doesn’t specify how to construct a request from network data, or serialize a response.

<ol>
 <li><p><a>Read bytes</a> from the connection
  until a complete HTTP request can be constructed from the data.
  Let <var>request</var> be a <a>request</a>
  constructed from the received data,
  according to the requirements of [[!RFC7230]].

 <li><p>Let <var>request match</var> be the result of the algorithm
  to <a>match a request</a> with <var>request</var>’s
  <a>method</a> and <a>URL</a> as arguments.

 <li><p>If <var>request match</var> is of type <a>error</a>,
  <a>send an error</a> with <var>request match</var>’s <a>error code</a>
  and jump to step 1.

  <p>Otherwise, let <var>command</var> and <var>url variables</var>
   be <var>request match</var>’s data.

 <li><p>Let <var>session id</var> be the corresponding variable
  from <var>url variables</var>.

 <li><p>If <var>command</var> is not <a>New Session</a>:

  <ol>
   <li><p>If <var>session id</var> is not equal to the <a data-lt="session id">ID</a>
    of any session in the list of <a>active sessions</a>,
    <a>send an error</a> with <a>error code</a> <a>invalid session id</a>,
    then jump to step 1 in this overall algorithm.

    <p>Otherwise, let the <a>current session</a> be
     the <a>session</a> with <a data-lt="session id">ID</a> <var>session id</var>.
  </ol>

 <li><p>If <var>request</var>’s <a>method</a> is POST:

  <ol>
   <li><p>Let <var>parse result</var> be the result of
    <a>parsing as JSON</a> with <var>request</var>’s
    <a>body</a> as the argument.

   <li><p>If <var>parse result</var> is an <a>error</a> or if it is a <a>success</a>
    but its associated data is not an <a>Object</a>,
    <a>send an error</a> with <a>error code</a> <a>invalid argument</a>
    and jump back to step 1 in this overall algorithm.

    <p>Otherwise, let <var>parameters</var> be <var>parse result</var>’s data.
  </ol>

  <p>Otherwise, let <var>parameters</var> be null.</p>

 <li><p>Let <var>response result</var> be the return value
  obtained by running the <a>remote end steps</a> for <var>command</var>
  with <var>url variables</var> as arguments.

 <li><p>If <var>response result</var> is an <a>error</a>,
  <a>send an error</a> with <a>error code</a>
  equal to <var>response result</var>’s <a>error code</a>
  and jump back to step 1 in this overall algorithm.

  <p>Otherwise, if <var>response result</var> is a <a>success</a>,
   let <var>response data</var> be <var>response result</var>’s data.

 <li><p><a>Send a response</a> with status 200 and <var>response data</var>.

 <li><p>Jump to step 1.
</ol>

<p>When required to <dfn>send an error</dfn>,
 with <var>error code</var>,
 a <a>remote end</a> must run the following steps:</p>

<ol>
 <li><p>Let <var>http status</var> and <var>name</var>
  be the <a>error response data</a> for <var>error code</var>.

 <li><p>Let <var>message</var> be an implementation-defined string
  containing a human-readable description of the reason for the error.

 <li><p>Let <var>stacktrace</var> be an implementation-defined string
  containing a stack trace report of the active stack frames
  at the time when the error occurred.

 <li><p class=issue>Really need a better way to construct JSON literals.

  <p>Let <var>data</var> be a new JSON Object
  initialised with the following properties:

  <dl>
   <dt>"<code>error</code>"
   <dd>Value of <var>name</var>.

   <dt>"<code>message</code>"
   <dd>Value of <var>message</var>.

   <dt>"<code>stacktrace</code>"
   <dd>Value of <var>stacktrace</var>.
  </dl>

 <li><p><a>Send a response</a> with <var>status</var>
  and <var>data</var> as arguments.
</ol>

<p>When required to <dfn>send a response</dfn>,
 with arguments <var>status</var> and <var>data</var>,
 a <a>remote end</a> must run the following steps:

<ol>
 <li><p>Let <var>response</var> be a new <a>response</a>.

 <li><p>Set <var>response</var>’s <a>HTTP status</a> to <var>status</var>,
  and <a>status message</a> to the string corresponding
  to the description of <var>status</var> in the <a>status code registry</a>.

 <li><p>If <var>data</var> is not null, let <var>response</var>’s
  <a>body</a> be the result of <a>serializing as JSON</a>
  with <var>data</var> as the argument.

 <li><p>Let <var>response bytes</var> be the byte sequence resulting
  from serializing <var>response</var> according to the rules in [[!RFC7230]].

 <li><p><a data-lt="write bytes">Write</a> <var>response bytes</var>
  to the <a>connection</a>.
</ol>
</section> <!-- /Processing Model -->

<section>
<h3>Routing Requests</h3>

<p><dfn data-lt="routing requests">Request routing</dfn>
 is the process of going from a HTTP request
 to the <a data-lt="remote end steps">series of steps</a> needed
 to implement the <a>command</a> represented by that request.

<p>A <a>remote end</a> has an associated <dfn>URL prefix</dfn>,
 which is used as a prefix on all WebDriver-defined URLs on that remote end.
 This must either be <a>undefined</a> or an <a>path-absolute URL</a>.

<aside class=example>
 <p>For example a <a>remote end</a> wishing
  to run alongside other services on <code>example.com</code>
  might set its <a>URL prefix</a> to <code>/wd</code>
  so that a <a>new session</a> <a>command</a> would be invoked
  by sending a POST request to <code>/wd/session</code>,
  rather than <code>/session</code>.
</aside>

<p>In order to <dfn>match a request</dfn> given
 a <a><var>method</var></a> and <a><var>URL</var></a>,
 the following steps must be taken:

<ol>
 <li><p>Let <var>endpoints</var> be a list
  containing each row in the <a>table of endpoints</a>.

 <li><p>Remove each entry from <var>endpoints</var>
  for which the concatenation of the <a>URL prefix</a>
  and the entry’s <var>URI template</var>
  does not match <var>URL</var>’s <a>path</a>.

 <li><p>If there are no entries in <var>endpoints</var>,
  return <a>error</a> with <a>error code</a> <a>unknown command</a>.

 <li><p>Remove each entry in <var>endpoints</var>
  for which the <i>method</i> column
  is not an exact case-sensitive match for <var>method</var>.

 <li><p>If there are no entries in <var>endpoints</var>,
  return <a>error</a> with <a>error code</a> <a>unknown method</a>.

 <li><p>There is now exactly one entry in <var>endpoints</var>;
  let <var>entry</var> be this entry.

 <li><p>Let <var>parameters</var> be the result of extracting the variables
  from <var>URL</var> using <var>entry</var>’s <var>URI template</var>.

 <li><p>Let <var>command</var> be <var>entry</var>’s <a>command</a>.

 <li><p>Return <a>success</a> with data
  <var>command</var> and <var>parameters</var>.
</ol>
</section> <!-- /Routing Requests -->

<section>
<h3>List of Endpoints</h3>

<p>The following <dfn data-lt=endpoints>table of endpoints</dfn> lists
 the <a>method</a> and <a>URI template</a>
 for each <a>endpoint node</a> <a>command</a>.

<table class=simple>
 <tr>
  <th>Method</th>
  <th>URI Template</th>
  <th>Command</th>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session</td>
  <td><a>New Session</a></td>
 </tr>

 <tr>
  <td>DELETE</td>
  <td>/session/{<var>session id</var>}</td>
  <td><a>Delete Session</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/status</td>
  <td><a>Status</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/url</td>
  <td><a>Go</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/url</td>
  <td><a>Get Current URL</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/back</td>
  <td><a>Back</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/forward</td>
  <td><a>Forward</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/refresh</td>
  <td><a>Refresh</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/title</td>
  <td><a>Get Title</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/window</td>
  <td><a>Get Window Handle</a></td>
 </tr>

 <tr>
  <td>DELETE</td>
  <td>/session/{<var>session id</var>}/window</td>
  <td><a>Close Window</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/window</td>
  <td><a>Switch To Window</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/window/handles</td>
  <td><a>Get Window Handles</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/window/fullscreen</td>
  <td><a>Fullscreen Window</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/window/maximize</td>
  <td><a>Maximize Window</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/window/size</td>
  <td><a>Set Window Size</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/window/position</td>
  <td><a>Get Window Position</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/window/position</td>
  <td><a>Set Window Position</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/window/size</td>
  <td><a>Get Window Size</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/frame</td>
  <td><a>Switch To Frame</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/frame/parent</td>
  <td><a>Switch To Parent Frame</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/element</td>
  <td><a>Find Element</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/element/{element id}/element</td>
  <td><a>Find Element From Element</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/elements</td>
  <td><a>Find Elements</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/element/{element id}/elements</td>
  <td><a>Find Elements From Element</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/active</td>
  <td><a>Get Active Element</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/selected</td>
  <td><a>Is Element Selected</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/attribute/{<var>name</var>}</td>
  <td><a>Get Element Attribute</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/property/{<var>name</var>}</td>
  <td><a>Get Element Property</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/css/{<var>property name</var>}</td>
  <td><a>Get Element CSS Value</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/text</td>
  <td><a>Get Element Text</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/name</td>
  <td><a>Get Element Tag Name</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/rect</td>
  <td><a>Get Element Rect</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/enabled</td>
  <td><a>Is Element Enabled</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/source</td>
  <td><a>Get Page Source</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/execute/sync</td>
  <td><a>Execute Script</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/execute/async</td>
  <td><a>Execute Async Script</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/cookie</td>
  <td><a>Get All Cookies</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/cookie/{<var>name</var>}</td>
  <td><a>Get Named Cookie</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/cookie</td>
  <td><a>Add Cookie</a></td>
 </tr>

 <tr>
  <td>DELETE</td>
  <td>/session/{<var>session id</var>}/cookie/{<var>name</var>}</td>
  <td><a>Delete Cookie</a></td>
 </tr>

 <tr>
  <td>DELETE</td>
  <td>/session/{<var>session id</var>)/cookie</td>
  <td><a>Delete All Cookies</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/timeouts</td>
  <td><a>Set Timeouts</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/actions</td>
  <td><a>Perform Actions</a></td>
 </tr>

 <tr>
  <td>DELETE</td>
  <td>/session/{<var>session id</var>}/actions</td>
  <td><a>Releasing Actions</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/click</td>
  <td><a>Element Click</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/clear</td>
  <td><a>Element Clear</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/value</td>
  <td><a>Element Send Keys</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/alert/dismiss</td>
  <td><a>Dismiss Alert</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/alert/accept</td>
  <td><a>Accept Alert</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/alert/text</td>
  <td><a>Get Alert Text</a></td>
 </tr>

 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/alert/text</td>
  <td><a>Send Alert Text</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/screenshot</td>
  <td><a>Take Screenshot</a></td>
 </tr>

 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/screenshot</td>
  <td><a>Take Element Screenshot</a></td>
 </tr>
</table>
</section> <!-- /List of Endpoints -->

<section>
<h3>Handling Errors</h3>

<p>Errors are represented in the WebDriver protocol
 with a HTTP response with a HTTP status in the 4xx or 5xx range,
 and a JSON body containing details of the error.
 This JSON body has three fields:
 <code>error</code>, containing a string indicating the error type;
 <code>message</code>, containing an implementation-defined string
 with a human readable description of the kind of error that occurred;
 and <code>stacktrace</code>, containing an implementation-defined string
 with a stack trace report of the active stack frames at the time when the error occurred.

<aside class=example>
 <p>A <code>DELETE</code> request to <code>/session/1234</code>,
 where <code>1234</code> is not the <a>session id</a> of a <a>current session</a>
 would return an HTTP response with the status 404 and a body of the form:

 <pre class=highlight>{
  "error": "invalid session id",
  "message": "No active session with ID 1234",
  "stacktrace": ""
}</pre>
</aside>

<p>The following table lists each <dfn>error code</dfn>,
 its associated HTTP status,
 JSON <code>error</code> code,
 and a non-normative description of the error.
 The <dfn>error response data</dfn> for a particular <a>error code</a>
 is the values of the <i>HTTP Status</i>
 and <i>JSON Error Code</i> columns for the row corresponding to that <a>error code</a>.

<table class=simple>
 <tr>
  <th>Error Code
  <th>HTTP Status
  <th>JSON Error Code
  <th>Description
 </tr>

 <tr>
  <td><dfn>element not selectable</dfn>
  <td>400
  <td><code>element not selectable</code>
  <td>An attempt was made to select an element that cannot be selected.
 </tr>

 <tr>
  <td><dfn>element not interactable</dfn>
  <td>400
  <td><code>element not interactable</code>
  <td>An element <a>command</a> could not be completed
   because the element is not
   <a data-lt="pointer interactable">pointer</a>- or
   <a data-lt="keyboard interactable">keyboard</a> <a>interactable</a>.
 </tr>

 <tr>
  <td><dfn>invalid argument</dfn>
  <td>400
  <td><code>invalid argument</code>
  <td>The arguments passed to a <a>command</a>
   are either invalid or malformed.
 </tr>

 <tr>
  <td><dfn>invalid cookie domain</dfn>
  <td>400
  <td><code>invalid cookie domain</code>
  <td>An illegal attempt was made to set a cookie
   under a different domain than the current page.
 </tr>

 <tr>
  <td><dfn>invalid coordinates</dfn>
  <td>400
  <td><code>invalid coordinates</code>
  <td>The coordinates provided to an interactions operation are invalid.
 </tr>

 <tr>
  <td><dfn>invalid element state</dfn>
  <td>400
  <td><code>invalid element state</code>
  <td>An element <a>command</a> could not be completed
   because the element is in an invalid state,
   e.g. attempting to click an element
   that is no longer attached to the <a>document</a>.
 </tr>

 <tr>
  <td><dfn>invalid selector</dfn>
  <td>400
  <td><code>invalid selector</code>
  <td>Argument was an invalid selector.
 </tr>

 <tr>
  <td><dfn>invalid session id</dfn>
  <td>404
  <td><code>invalid session id</code>
  <td>Occurs if the given <a>session id</a> is not in the list of <a>active sessions</a>,
   meaning the <a>session</a> either does not exist or that it’s not active.
 </tr>

 <tr>
  <td><dfn>javascript error</dfn>
  <td>500
  <td><code>javascript error</code>
  <td>An error occurred while executing JavaScript supplied by the user.
 </tr>

 <tr>
  <td><dfn>move target out of bounds</dfn>
  <td>500
  <td><code>move target out of bounds</code>
  <td>The target for mouse interaction is not in the browser’s viewport
   and cannot be brought into that viewport.
 </tr>

 <tr>
  <td><dfn>no such alert</dfn>
  <td>400
  <td><code>no such alert</code>
  <td>An attempt was made to operate on a modal dialog
   when one was not open.
 </tr>

 <tr>
  <td><dfn>no such cookie</dfn>
  <td>404
  <td><code>no such cookie</code>
  <td>No cookie matching the given path name
   was found amongst the <a>associated cookies</a>
   of the <a>current browsing context</a>’s <a>active document</a>.
 </tr>

 <tr>
  <td><dfn>no such element</dfn>
  <td>404
  <td><code>no such element</code>
  <td>An element could not be located on the page
   using the given search parameters.
 </tr>

 <tr>
  <td><dfn>no such frame</dfn>
  <td>400
  <td><code>no such frame</code>
  <td>A request to switch to a frame
   could not be satisfied because the frame could not be found.
 </tr>

 <tr>
  <td><dfn>no such window</dfn>
  <td>400
  <td><code>no such window</code>
  <td>A request to switch to a window
   could not be satisfied because the window could not be found.
 </tr>

 <tr>
  <td><dfn>script timeout</dfn>
  <td>408
  <td><code>script timeout</code>
  <td>A script did not complete before its timeout expired.
 </tr>

 <tr>
  <td><dfn>session not created</dfn>
  <td>500
  <td><code>session not created</code>
  <td>A new <a>session</a> could not be created.
 </tr>

 <tr>
  <td><dfn>stale element reference</dfn>
  <td>400
  <td><code>stale element reference</code>
  <td>An element <a>command</a> failed because
   the referenced <a>element</a> is no longer attached to the DOM.
 </tr>

 <tr>
  <td><dfn>timeout</dfn>
  <td>408
  <td><code>timeout</code>
  <td>An operation did not complete before its timeout expired.
 </tr>

 <tr>
  <td><dfn>unable to set cookie</dfn>
  <td>500
  <td><code>unable to set cookie</code>
  <td>A request to set a cookie’s value could not be satisfied.
 </tr>

 <tr>
  <td><dfn>unable to capture screen</dfn>
  <td>500
  <td><code>unable to capture screen</code>
  <td>A screen capture was made impossible.
 </tr>

 <tr>
  <td><dfn>unexpected alert open</dfn>
  <td>500
  <td><code>unexpected alert open</code>
  <td>A modal dialog was open, blocking this operation.
 </tr>

 <tr>
  <td><dfn>unknown command</dfn>
  <td>404
  <td><code>unknown command</code>
  <td>A <a>command</a> could not be executed
   because the <a>remote end</a> is not aware of it.
 </tr>

 <tr>
  <td><dfn>unknown error</dfn>
  <td>500
  <td><code>unknown error</code>
  <td>An unknown error occurred in the <a>remote end</a>
   while processing the <a>command</a>.
 </tr>

 <tr>
  <td><dfn>unknown method</dfn>
  <td>405
  <td><code>unknown method</code>
  <td>The requested <a>command</a> matched a known URL
   but did not match an method for that URL.
 </tr>

 <tr>
  <td><dfn>unsupported operation</dfn>
  <td>500
  <td><code>unsupported operation</code>
  <td>Indicates that a <a>command</a> that should have
   executed properly cannot be supported for some reason.
 </tr>
</table>
</section> <!-- /Handling Errors -->

<section>
<h2>Protocol Extensions</h2>

<p>The protocol is designed to allow extension to meet vendor-specific needs.
 Commands that are specific to a user agent
 are called <dfn data-lt="extension commands|extension command">extension commands</dfn>
 and behave no differently than other <a>commands</a>;
 each has a dedicated HTTP endpoint and a set of <a>remote end steps</a>.

<p>Each <a>extension command</a> has an associated
 <dfn>extension command name</dfn>
 that is a lowercased <a>ASCII string</a>,
 and which should bear some resemblance to what the command performs.
 The name is used to form an <a>extension command</a>’s
 <a data-lt="extension command URL">URL</a>.

<p>The <a>extension command</a>’s <dfn>extension command URL</dfn>
 is a <a>URL</a> composed of the <a>extension command prefix</a>,
 followed by "<code>/</code>",
 and the <a>extension command</a>’s <a data-lt="extension command name">name</a>.
 The <a>extension command URL</a>,
 along with the HTTP method and <a>extension command</a>,
 is added to the <a>table of endpoints</a>
 and thus follows the same rules for <a>request routing</a>
 as that of other built-in <a>commands</a>.

<aside class=example>
 <p>This might lead to a URL of the form
  <code>/session/5d376174-36f0-11e5-9b9a-6bdf200a3f7f/<var>ms</var>/<var>edge</var>/<var>context</var></code>,
  where <var>ms/edge</var> is an <a>extension command prefix</a>
  based on the vendor prefix associated with Microsoft,
  and <var>context</var> the <a>extension command name</a>
  that, in the context of Edge, allows a <a>local end</a>
  to switch between browser-specific contexts.
  Requesting this URL will call the <a>extension command</a>’s
  <a>remote end steps</a>.
</aside>

<p>An <dfn>extension command prefix</dfn>
 is a lowercased <a>ASCII string</a> that forms a <a>URL</a> path element,
 separating <a>extension commands</a> from other <a>commands</a>
 in order to avoid potential resource conflicts with other implementations.
 It is suggested that vendors use their vendor prefixes
 without additional characters as outlined in [[CSS21]],
 notably in <a href=http://www.w3.org/TR/CSS21/syndata.html#vendor-keywords>section 4.1.2.2 on <i>vendor keywords</i></a>,
 as the name for this path element,
 and include a vendor-chosen UA identifier.

<p><a>Remote ends</a> may also introduce
 <dfn data-lt="extension capability">extension capabilities</dfn>
 that are extra <a>capabilities</a>
 used to provide configuration or fulfill other vendor-specific needs.
 Extension capabilities’ key
 must contain a "<code>:</code>" (colon) character,
 denoting an implementation specific namespace.
 The value can be arbitrary <a>JSON</a> types.

<p>As with <a>extension commands</a>,
 it is suggested that the key used to denote
 the <a>extension capability</a> namespace
 is based on the <a href=http://www.w3.org/TR/CSS21/syndata.html#vendor-keywords>vendor keywords</a>
 listed in [[!CSS21]]
 and preceeds the first "<code>:</code>" character in the string.

<aside class=example>
 <p><a>Extension capabilities</a> are typically used
  to provide UA or <a>intermediary node</a> specific configuration
  that is not handled by the <a>table of capabilities</a>.

 <p>An example <a>new session</a> request body
  might look like this:

 <pre>{
	"alwaysMatch": {
		// a cloud provider’s authentication token
		"sauce:token": "b448b871-a526-4634-aefc-26df6eede519",

		// an <a>intermediary node</a>’s access details
		"intermediary:login": {
			"username": "maja",
			"password": "donut"
		}
	},
	"firstMatch": {
		// browser specific configuration
		"moz:firefoxOptions": {
			"binary": "/usr/bin/firefox",
			"args": ["--no-remote"],
			"prefs": {
				"dom.ipc.processCount": "8"
			},
			"log": {
				"level": "trace",
				"file": "/tmp/geckodriver.log"
			}
		}
	}
}</pre>
</aside>

</section> <!-- /Protocol Extensions -->
</section> <!-- /The WebDriver Protocol -->

<section>
<h2>Capabilities</h2>

<p>WebDriver <dfn>capabilities</dfn> allow the <a>local end</a>
 to specify what features it desires or requires the <a>remote end</a> to fulfill
 to be able to create a <a>new session</a>.

<p>The following table provides an overview
 of recognised capabilities, and their usage and effect:

<table class=simple>
 <tr>
  <th>Capability
  <th>Key
  <th>Value Type
  <th>Description
 </tr>

 <tr>
  <td><dfn>Browser name</dfn>
  <td>"<code>browserName</code>"
  <td>string
  <td>Identifies the user agent.
 </tr>

 <tr>
  <td><dfn>Browser version</dfn>
  <td>"<code>browserVersion</code>"
  <td>string
  <td>Identifies the version of the user agent.
 </tr>

 <tr>
  <td><dfn>Platform name</dfn>
  <td>"<code>platformName</code>"
  <td>string
  <td>Identifies the system or operating system
   of the <a>endpoint node</a>.
 </tr>

 <tr>
  <td><dfn>Platform version</dfn>
  <td>"<code>platformVersion</code>"
  <td>string
  <td>Identifies the system version of the <a>endpoint node</a>.
 </tr>

 <tr>
  <td><dfn>Accept SSL certificates</dfn>
  <td>"<code>acceptSslCerts</code>"
  <td>boolean
  <td>Indicates that untrusted and self-signed SSL certificates
   are trusted implicitly on <a data-lt=go>navigation</a>
   for the duration of the session.
 </tr>
</table>

<p>Implementations are free to use the <a>capabilities</a> dictionary
 passed in the request to create a <a>new session</a>
 to provide additional feature requests
 from any of the <a>remote ends</a>, including the <a>endpoint node</a>.
 Likewise the <a>remote end</a> may supply additional entries
 on the <a>capabilities</a> object returned
 from creating a <a>new session</a>.

<aside class=example>
 <p>Capabilities may for example be used
  to provide a serialised profile for a <a>remote end</a> to use
  during startup of the user agent binary.

 <p>A fictive example of this:

 <pre><code>capabilities := {}
profile := serialise_profile("/path/to/profile")
capabilities["profile"] = profile
session := new_session(capabilities)</code></pre>
</aside>

<p>When <dfn>processing capabilities</dfn> with argument <var>parameters</var>
 a <a>remote end</a> must run the following steps:

<ol>
 <li><p>Let <var>server capabilities</var> be a JSON Object
  with the following entries:

  <dl>
   <dt>"<code>browserName</code>"
   <dd>Lowercase name of the user agent

   <dt>"<code>browserVersion</code>"
   <dd>Version of the user agent

   <dt>"<code>platformName</code>"
   <dd>Lowercase name of the platform

   <dt>"<code>platformVersion</code>"
   <dd>Version of the platform

   <dt>"<code>acceptSslCerts</code>"
   <dd>False
  </dl>

 <li><p>Let <var>required capabilities</var> be the result of <a>getting a property</a>
  named <code>requiredCapabilities</code> from <var>capabilities</var>.

 <li>If <var>required capabilities</var> is not a JSON Object,
  set the value to an empty JSON Object.

 <li><p>Let <var>desired capabilities</var> be the result of <a>getting a property</a>
  named <code>desiredCapabilities</code> from <var>capabilities</var>.

 <li>If <var>desired capabilities</var> is not a JSON Object,
  set the value to an empty JSON Object.

 <li><p>Let <var>length</var> be the length of <var>required capabilities</var>.

 <li><p>Let <var>k</var> be 0.

 <li><p>While <var>k</var> &lt; <var>length</var>:

  <ol>
   <li><p>Let <var>capability</var> be the entry
    in <var>required capabilities</var> at index <var>k</var>.

   <li><p>If the name of the <var>capability</var> is among
    the names of entries in <var>desired capabilities</var>,
    remove the corresponding entry from <var>desired capabilities</var>.

   <li>Increase <var>k</var> by 1.
  </ol>

 <li><p>Let <var>unmet capabilities</var> be an empty JSON List.

 <li><p>Let <var>unprocessed capabilities</var> be a JSON Object
  that contains all entries from <var>required capabilities</var>
  and all entries from <var>desired capabilities</var>.

 <li><p>Let <var>j</var> be 0.

 <li><p>Let <var>capabilities length</var> be
  the length of <var>unprocessed capabilities</var>.

 <li><p>While <var>j</var> &lt; <var>capabilities length</var>:

  <ol>
   <li><p>Let <var>unprocessed capability</var> be the entry at index <var>j</var>
    in <var>unprocessed capabilities</var>.

   <li><p>If during the steps below the <var>unprocessed capability</var>
    equals an entry in <var>required capabilities</var>
    and name of <var>unprocessed capability</var> entry among the names
    of entries in <var>server capabilities</var>
    and the values do not match do the following:

    <ol>
     <li><p>Append a string containing the property name
      and the differences between the values.
    </ol>

   <li><p>Let <var>browser name</var> be the result of <a>getting a property</a>
    named <code>browserName</code> from <var>unprocessed capability</var>.
    If <var>browser name</var> is <a>undefined</a> move to the next step.

   <li><p>Let <var>browser version</var> be the result of <a>getting a property</a>
    named <code>browserVersion</code> from <var>unprocessed capability</var>.
    If <var>browser version</var> is <a>undefined</a> move to the next step.

   <li><p>Let <var>platform name</var> be the result of <a>getting a property</a>
    named <code>platformName</code> from <var>unprocessed capability</var>.
    If <var>platform name</var> is <a>undefined</a> move to the next step.

   <li><p>Let <var>platform version</var> be the result of <a>getting a property</a>
    named <code>platformVersion</code> from <var>unprocessed capability</var>.
    If <var>platform version</var> is <a>undefined</a> move to the next step.

   <li><p>Let <var>insecure ssl</var> be the result of <a>getting a property</a>
    named <code>acceptSslCerts</code> from <var>unprocessed capability</var>.

    <p>If <var>insecure ssl</var> is defined,
     unset the <a>active session</a>’s <a>secure SSL</a> state.
     Otherwise move to the next step.

   <li><p>Let <var>proxy</var> be the result of <a>getting a property</a>
    named <code>proxy</code> from <var>unprocessed capability</var>.
    If <var>proxy</var> is <a>undefined</a> move to the next step.
    If <var>proxy</var> is defined and not a map,
    append a string saying that a JSON Object is required,
    else call <a>set the proxy</a> passing in <var>proxy</var>.

   <li><p>Let <var>page load strategy</var> be the result of <a>getting a property</a>
    named <code>pageLoadStrategy</code> from <var>unprocessed capability</var>.
    If <var>page load strategy</var> is <a>undefined</a>,
    then set the entry <code>pageLoadStrategy</code>
    in <var>server capabilities</var> to <a>normal</a>.
  </ol>

 <li><p>If the length of <var>unmet capabilities</var> is not equal to 0,
  return <a>session not created</a> with data <var>unmet capabilities</var>.

 <li><p>Return <var>server capabilities</var>.
</ol>

<p>To <dfn>set the proxy</dfn> from a JSON Object <var>proxy</var>:

<ol>
 <li><p>Let <var>proxy type</var> be the result of
  <a>getting a property</a> named <code>proxyType</code> from <var>proxy</var>.

 <li><p>Switch on <var>proxy type</var>:

  <dl class=switch>
   <dt>"<code>pac</code>"
   <dd>Let <var>proxy autoconfiguration url</var> be the result of <a>getting a
    property</a> named <code>proxyAutoconfigUrl</code> from <var>proxy</var>.

    <p>If the implementation supports <a>proxy autoconfiguration</a>
    and <var>proxy autoconfiguration url</var> is defined, set the
    implementation’s autoproxy configuration URL to <var>proxy autoconfiguration
    url</var>.

    <p>Otherwise return an <a>error</a>
     with <a>error code</a> <a>invalid argument</a>.

   <dt>"<code>noproxy</code>"
   <dd><p>Set the proxy to No Proxy using implementation defined steps.
    If this can not be set during this process return <a>error</a>.

   <dt>"<code>autodetect</code>"
   <dd><p>Set the proxy to Auto-Detect proxy setting from the network
    using implementation defined steps.
    If this can not be set during this process return <a>error</a>.

   <dt>"<code>system</code>"
   <dd><p>Set the proxy to use system proxy settings using implementation defined steps.
    If this can not be set during this process return <a>error</a>.

   <dt>"<code>manual</code>"
   <dd>
    <ol>
     <li><p>Let <var>ftp proxy</var> be the result of <a>getting a property</a>
      named <code>ftpProxy</code> from <var>proxy</var>.

     <li><p>Let <var>ftp proxy port</var> be the result of <a>getting a property</a>
      named <code>ftpProxyPort</code> from <var>proxy</var>.

     <li><p>Let <var>http proxy</var> be the result of <a>getting a property</a>
      named <code>httpProxy</code> from <var>proxy</var>.

     <li><p>Let <var>http proxy port</var> be the result of <a>getting a property</a>
      named <code>httpProxyPort</code> from <var>proxy</var>.

     <li><p>Let <var>ssl proxy</var> be the result of <a>getting a property</a>
      named <code>sslProxy</code> from <var>proxy</var>.

     <li><p>Let <var>ssl proxy port</var> be the result of <a>getting a property</a>
      named <code>sslProxyPort</code> from <var>proxy</var>.

     <li><p>Let <var>socks proxy</var> be the result of <a>getting a property</a>
      named <code>socksProxy</code> from <var>proxy</var>.

     <li><p>Let <var>socks proxy port</var> be the result of <a>getting a property</a>
      named <code>socksProxyPort</code> from <var>proxy</var>.

     <li><p>If <var>socks proxy</var> and <var>socks proxy port</var> is defined:

      <ol>
        <li><p>Let <var>socks version</var> be the result of <a>getting a property</a>
         named <code>socksVersion</code> from <var>proxy</var>.

        <li><p>Let <var>socks username</var> be the result of <a>getting a property</a>
         named <code>socksUsername</code> from <var>proxy</var>.

        <li><p>Let <var>socks password</var> be the result of <a>getting a property</a>
         named <code>socksPassword</code> from <var>proxy</var>.
      </ol>

     <li><p>Follow implementation defined steps to set the proxy
      using defined variables from previous steps.
      If there are items that can not be set during this process return <a>error</a>.
    </ol>

   <dt>Otherwise
   <dd><p>Return <a>error</a> with <a>error code</a> <a>invalid argument</a>.
  </dl>
</ol>
</section> <!-- /Capabilities -->

<section>
<h2>Sessions</h2>

<p>A <a>session</a> is equivalent to a single instantiation of a particular user agent,
 including all its child browsers.
 WebDriver gives each <a>session</a> a unique <a>session ID</a>
 that can be used to differentiate one session from another,
 allowing multiple user agents to be controlled from a single HTTP server,
 and allowing sessions to be routed via a multiplexer
 (known as an <a>intermediary node</a>).

<p>A <a>session</a> is started when
 a <a>New Session</a> is invoked.
 It is an <a>error</a> to send any commands before starting a session,
 or to continue to send commands after
 the <a>session</a> has been closed.
 Maintaining session continuity between requests to
 the <a>remote end</a> requires passing a <a>session ID</a>.

<p>A WebDriver <dfn data-lt="session|sessions">session</dfn> represents
 the connection between a <a>local end</a> and a specific <a>remote end</a>.
 A <a>remote end</a> that is not an <a>intermediary node</a>
 has at most one <a>active session</a> at a given time.

<p>The <a>session</a> is set up at the invocation of a <a>New Session</a>,
 and torn down at some later point;
 either explicitly by invoking <a>Delete Session</a>,
 or implicitly when <a>Close Window</a> is called
 at the last remaining <a>top-level browsing context</a>.

<p>A <a>remote end</a> has an associated list of
 <dfn data-lt="active sessions|active session">active sessions</dfn>,
 which is a list of all <a>sessions</a> that are currently started.

<p>Requests, except <a>New Session</a> requests,
 have an associated <dfn>current session</dfn>,
 which is the <a>session</a> in which that request's command will run.

<p>A <a>remote end</a> has an associated
 <dfn>maximum active sessions</dfn> (an integer)
 that defines the number of <a>active sessions</a>
 that are supported.
 This may be “unlimited” for <a>intermediary nodes</a>,
 but must be exactly one for a <a>remote end</a> that is an <a>endpoint node</a>.

<p>A <a>session</a> has an associated <dfn>session ID</dfn>
 (a <a>UUID</a>) used to uniquely identify this session.  Unless
 stated otherwise it is null.

<p>A <a>session</a> has an associated <dfn>current browsing context</dfn>,
 which is the <a>browsing context</a> against which <a>commands</a> will run.

<p>A <a>session</a> has an associated
 <dfn>current top-level browsing context</dfn>, which is the <a>current browsing
 context</a> if it itself is a <a>top-level browsing context</a>, and otherwise
 is the <a>top-level browsing context</a> of the <a>current browsing
 context</a>.

<p>A <a>session</a> has an associated <dfn>session script timeout</dfn>
 that specifies a time to wait for scripts to run.
 Unless stated otherwise it is 30,000 milliseconds.

<p>A <a>session</a> has an associated <dfn>session page load timeout</dfn>
 that specifies a time to wait for the page loading to complete.
 Unless stated otherwise it is 300,000 milliseconds.

<p>A <a>session</a> has an associated <dfn>session implicit wait timeout</dfn>
 that specifies a time to wait for the <a>implicit element location strategy</a>
 when <a href=#element-retrieval>retreiving elements</a>.
 Unless stated otherwise it is zero milliseconds.

<p>A <a>session</a> has an associated <dfn>page loading strategy</dfn>,
 which is one of <i>none</i>, <i>normal</i>, and <i>eager</i>.
 Unless stated otherwise, it is <i>normal</i>.

<p>A <a>session</a> has an associated <dfn>secure SSL</dfn> state
 that indicates whether untrusted or self-signed SSL certificates
 should be trusted for the duration of the WebDriver session.
 If it is unset, this indicates that certificate- or SSL errors
 that occur upon <a data-lt=go>navigation</a> should be suppressed.
 The state can be unset by providing
 an "<code>acceptSslCerts</code>" <a>capability</a> with the value true.
 Unless stated otherwise, it is set.

<p>A <a>session</a> has an associated <a>user prompt handler</a>.

<p>A <a>session</a> has an associated <a>input state</a>.

<p>A <a>session</a> has an associated <a>input cancel list</a>.

<p>When asked to <dfn>close the session</dfn>,
 a <a>remote end</a> must take the following steps:

<ol>
 <li><p>Set the <a>webdriver-active flag</a> to false.

 <li><p><a>Close</a> any <a>top-level browsing contexts</a>
  associated with the <a>session</a>,
  without <a>prompting to unload</a>.

 <li><p>Remove the <a>current session</a> from <a>active sessions</a>.

 <li><p>Perform any implementation-specific cleanup steps.
</ol>

<p>Closing a <a>session</a> might cause the associated browser process to be killed.
 It is assumed that any implementation-specific cleanup steps
 are performed <em>after</em> the response has been sent back to the client
 so that the <a>connection</a> is not prematurely closed.

<section>
<h3>New Session</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session</td>
 </tr>
</table>

<p>The <dfn>New Session</dfn> <a>command</a>
 creates a new WebDriver <a>session</a> with the <a>endpoint node</a>.
 If the <a>maximum active sessions</a> has been reached,
 that is if the <a>endpoint node</a> already has a <a>current session</a>,
 there is a problem processing the given <a>capabilities</a>,
 or the provisioning of a <a>remote end</a> is impossible,
 a <a>session not created</a> <a>error</a> is returned.

<p>If the <a>remote end</a> is an <a>intermediary node</a>,
 they are allowed to freely use the <a>capabilities</a> data
 e.g. to select a specific browser to test based on
 a combination of the <a data-lt="required-capabilities">required</a>
 and <a>desired capabilities</a>.
 Typically the <a>New Session</a> response from the <a>endpoint node</a>
 selected in this process will then be relayed directly to the <a>local end</a>,
 as outlined in step 1 of the <a>remote end steps</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>remote end</a> is an <a>intermediary node</a>,
  take implementation-defined steps that either result in
  returning an <a>error</a> with <a>error code</a> <a>session not created</a>,
  or in returning a <a>success</a> with data
  that is isomorphic to that returned by <a>remote ends</a>
  according to the rest of this algorithm.

 <li><p>If the <a>maximum active sessions</a> is equal to
  the length of the list of <a>active sessions</a>,
  return <a>error</a> with <a>error code</a> <a>session not created</a>.

 <li><p>If there is a <a>current user prompt</a>,
  return <a>error</a> with <a>error code</a> <a>session not created</a>.

 <li><p>Let <var>capabilities</var> be the result of <a>getting a property</a>
  named "<code>capabilities</code>" from the <var>parameters</var> argument.

 <li><p>Let <var>capabilities result</var> be the result of <a>processing capabilities</a>
  with <var>capabilities</var> as an argument.

 <li><p>If <var>capabilities result</var> is an <a>error</a>,
  return <a>error</a> with <a>error code</a> <a>session not created</a>.

 <li><p>Let <var>capabilities</var> be <var>capabilities result</var>’s data.

 <li><p>Let <var>session id</var> be the result of <a>generating a UUID</a>.

 <li><p>Let <var>session</var> be a new <a>session</a>
  with the <a>session ID</a> of <var>session id</var>.

 <li><p>Set the <a>current session</a> to <var>session</var>.

 <li><p>Append <var>session</var> to <a>active sessions</a>.

 <li><p>Let <var>body</var> be a JSON Object initialised with:

  <dl>
   <dt>"<code>sessionId</code>"
   <dd>The value of <var>session id</var>.

   <dt>"<code>capabilities</code>"
   <dd>The value of <var>capabilities result</var>.
  </dl>

 <li><p>Initialise the following if not set while <a>processing capabilities</a>:

  <ol>
   <li><p>Set the <a>current session</a>’s <a>session script timeout</a> to 30,000 milliseconds.
   <lI><p>Set the <a>current session</a>’s <a>session page load timeout</a> to 300,000 milliseconds.
   <li><p>Set the <a>current session</a>’s <a>session implicit wait timeout</a> to 0 (zero) milliseconds.
   <li><p>Set the <a>current session</a>’s <a>page loading strategy</a> to <a>normal</a>.
   <li><p>Set the <a>webdriver-active flag</a> to true.</p>
   <li><p>Set the <a>input state</a> to an empty map.</p>
   <li><p>Set the <a>input cancel list</a> to an empty <a>List</a>.</p>
  </ol>

 <li><p>Return <a>success</a> with data <var>body</var>.
</ol>
</section>

<section>
<h3>Delete Session</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>DELETE</td>
  <td>/session/{<var>session id</var>}</td>
 </tr>
</table>

<p>The <dfn>Delete Session</dfn> <a>command</a> <a>closes</a>
 any <a>top-level browsing contexts</a> associated with the <a>current session</a>,
 terminates the <a>connection</a>,
 and finally <a data-lt="close the session">closes</a> the <a>current session</a>.

<p>The <a>remote end steps</a> are:

<ol>
  <li><p><a>Close the session</a>.
  <li><p>Return <a>success</a> with data null.
</ol>
</section> <!-- /Delete Session -->

<section>
<h3>Status</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>STATUS</td>
  <td>/status</td>
 </tr>
</table>

<p>The <dfn>Status</dfn> <a>command</a> returns information about
  whether a remote end is in a state in which it can create a new
  session. This is represented by the <code>ready</code> property of the
  response body, which has a value of <code>false</code> if attempting
  to create a session at the current time would fail. A value
  of <code>true</code> does not guarantee a new session request would
  succeed.

<p>The <a>remote end steps</a> are:</p>

<ol>
  <li><p>Let <var>body</var> be a new JSON <a>Object</a>.</li>

  <li><p>Let <var>ready</var> be a boolean which is <code>false</code>
  if the node is known to be in a state in which attempting to create
  a <a>New Session</a> would fail, otherwise let it
  be <code>true</code>. For an endpoint node <var>ready</var> must
  be <code>false</code> when the <a>maximum active sessions</a> is
  equal to the length of the list of <a>active sessions</a> or there
  is an <a>active user prompt</a>, but there may be further
  implementation-specific scenarios in which the value
  is <code>false</code>.</li>

  <li><p>Let <var>message</var> be an implementation-defined string
  explaining the value given to <var>ready</var>.</li>

  <li><p><a>Set a property</a> of <var>body</var> with
  name <code>"ready"</code> and value <var>body</var>.

  <li><p><a>Set a property</a> of <var>body</var> with
  name <code>"message"</code> and value <var>message</var>.

  <li><p>Return <a>success</a> with data <var>body</var>.

</ol>
</section>

<section>
<h3>Set Timeouts</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/timeouts</td>
 </tr>
</table>

<p>The <dfn>Set Timeouts</dfn> command sets timeouts
 associated with the <a>current session</a>.
 The timeouts that can be controlled are
 listed in the <a>table of session timeouts</a> below.

<p>The following <dfn>table of session timeouts</dfn>
 enumerates the different timeout types that may be set.
 The keywords given in the first column
 maps to the timeout type given in the second.

<table class=simple>
 <tr>
  <th>Keyword
  <th>Type
  <th>Brief description
 </tr>

 <tr>
  <td>"<code>script</code>"
  <td><a>session script timeout</a>
  <td>Determines when to interrupt a script that is being
   <a href=#executing-script>evaluated</a>.
 </tr>

 <tr>
  <td>"<code>page load</code>"
  <td><a>session page load timeout</a>
  <td>Provides the timeout limit used to interrupt
  <a data-lt=navigate>navigation</a> of the <a>browsing context</a>.
 </tr>

 <tr>
  <td>"<code>implicit</code>"
  <td><a>session implicit wait timeout</a>
  <td>Gives the timeout of when to abort
   <a href=#element-retrieval>locating an element</a>.
 </tr>
</table>

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If <var>parameters</var> is not a JSON Object,
  return <a>error</a> with <a>error code</a> <a>invalid argument</a>.

 <li><p>For each <var>key</var> and <var>value</var>
  of <var>parameters</var>’s <a>own properties</a>:

  <ol>
   <li><p>Find the <var>timeout type</var> from the <a>table of session timeouts</a>
    by looking it up by its keyword <var>key</var>.

    <p>If no keyword matches <var>key</var>,
     return <a>error</a> with <a>error code</a> <a>invalid argument</a>.

   <li><p>If <var>value</var> is not an integer,
    or it is less than 0 or greater than 2<sup>64</sup> – 1,
    return <a>error</a> with <a>error code</a> <a>invalid argument</a>.

   <li><p>Set <var>timeout type</var>’s <var>value</var>.
  </ol>

 <li><p>Return <a>success</a> with data null.
</ol>
</section> <!-- /Set Timeout -->
</section> <!-- /Sessions -->

<section>
<h2>Navigation</h2>
<p>The <a>commands</a> in this section allow navigation of
 the <a>current top-level browsing context</a> to new URLs
 and introspection of the document currently loaded in this <a>browsing context</a>.

<p>For commands that cause a new document to load,
 the point at which the <a>command</a> returns
 is determined by the session’s <a>page load strategy</a>.
 A value of <code>normal</code> causes the command
 to return after the <code>load</code> event fires on the new page,
 a value of <code>eager</code> causes it to return
 after <code>DOMContentLoaded</code> fires,
 and a value of <code>none</code> causes it to return immediately.

<p>Navigation actions are also affected by the value of
 the <a>session page load timeout</a>,
 which determines the maximum time that commands will block
 before returning with a <a>timeout</a> <a>error</a>.

<section>
<h3>Go</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td id=post-url>/session/{<var>session id</var>}/url</td>
 </tr>
</table>

<p>The <dfn>Go</dfn> <a>command</a> is used
 to cause the user agent to <a>navigate</a>
 the <a>current top-level browsing context</a> a new location.

<p>If the <a>session</a> is not in a <a>secure SSL</a> state,
 no certificate errors that would normally
 cause the user agent to abort and show a security warning
 are to be hinder navigation to the requested address.

<aside class=example>
 <p>To navigate the <a>current top-level browsing context</a>
  of the <a>session</a> with ID <i>1</i> to <code>https://example.com</code>,
  the <a>local end</a> would POST to <i>/session/1/url</i> with the body:

 <pre class=highlight>{"url": "https://example.com"}</pre>
</aside>

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>If the <code>url</code> property
  is missing from the <var>parameters</var> argument
  or it is not a string,
  return <a>error</a> with <a>error code</a> <a>invalid argument</a>.

 <li><p>Let <var>url</var> be the result of
  <a>getting a property</a> named <code>url</code>
  from the <var>parameters</var> argument.

 <li><p>If <var>url</var> is not an <a>absolute URL</a>
  or an <a>absolute URL with fragment</a>,
  return <a>error</a> with <a>error code</a> <a>invalid argument</a>. [[!URL]]

 <li><p>Let <var>url</var> be the result of
  <a>getting a property</a> named <code>url</code>
  from the <var>parameters</var> argument.

 <li><p><a>Navigate</a> the <a>current top-level browsing context</a> to <var>url</var>.

  <p>If this navigation’s HTTP request
   results in a HTTP 401 response,
   the <a>remote end</a> must proceed with the steps below,
   irrespective of how the authentication challenge is handled.

  <p>If this navigation’s HTTP request
   results in a TLS client certificate negotiation
   and the certificate is found to not be valid
   and the <a>active session</a>’s <a>secure SSL</a> state is disabled,
   take implementation specific steps to ensure
   the navigation is not aborted
   and that the untrusted- or invalid SSL certificate error
   that would normally occur under these circumstances, are suppressed.

 <li><p>If the <a>current session</a>’s <a>page loading strategy</a>
  is <a>none</a> jump to the next step in this overall set of steps.

  <p>Otherwise:

  <ol>
   <li><p>Let <var>readiness target</var> be "<code>interactive</code>"
    if the <a>current session</a>’s <a>page loading strategy</a> is <a>eager</a>,
    or "<code>complete</code>" if it is <a>normal</a>.

   <li><p>Wait for the <a>current document readiness</a> to reach <var>readiness target</var>,
    or for the <a>session page load timeout</a> milliseconds to pass,
    whichever occurs sooner.

   <li><p>If the previous step completed by the <a>load timeout</a> being reached,
    and the browser is not currently displaying an alert,
    <!-- perhaps? Not sure if this is what the spec is trying to say -->
    return <a>error</a> with <a>error code</a> <a>timeout</a>.
  </ol>

 <li><p>Set the <a>current browsing context</a>
  to the <a>current top-level browsing context</a>.

 <li><p>Return <a>success</a> with data null.
</ol>

<div class=issue>
 <p>Figure out if next paragraph is actually required:

 <blockquote>
  <p>When a page contains a META tag with the "http-equiv" attribute set to "refresh",
   a response MUST be returned if the timeout is greater than 1 second
   and the other criteria for determining whether a page is loaded are met.
   When the refresh period is 1 second or less
   and the page loading strategy is "normal" or "conservative"
   implementations MUST wait for the refresh to complete before responding.
 </blockquote>
</div>

</section> <!-- /Go -->

<section>
<h3>Get Current URL</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/url</td>
 </tr>
</table>

<p>The <dfn>Get Current URL</dfn> <a>command</a>
 returns the URL of the <a>current top-level browsing context</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>Let <var>url</var> be the <a data-lt="url serialiser">serialisation</a>
  of the <a>current top-level browsing context</a>’s
  <a>active document</a>’s <a>document URL</a>.

 <li><p>Let <var>body</var> be a JSON Object
  with the "<code>value</code>" property set to <var>url</var>.

 <li><p>Return <a>success</a> with data <var>body</var>.</p></li>
</ol>
</section>

<section>
<h3>Back</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/back</td>
 </tr>
</table>

<p>The <dfn>Back</dfn> <a>command</a>
 causes the browser to traverse one step backward
 in the <a>joint session history</a>
 of the <a>current top-level browsing context</a>.
 This is equivalent to pressing
 the back button in the browser chrome
 or calling <code>window.history.back</code>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p><a>Traverse the history by a delta</a> –1
  for the <a>current browsing context</a>.

 <li><p>If the task queued by that algorithm aborted before
  <a>traversing the history</a>, return <a>success</a> with data null.

 <li><p>Otherwise, wait until the <a>current entry</a>
  in the session history has changed,
  or for the <a>session page load timeout</a> milliseconds to pass,
  whichever occurs sooner.

  <p class=issue>This doesn’t actually wait for the page to load
   if traversing the session history kicks off a navigation.

 <li><p>If the previous step completed by the <a>session page load timeout</a> being reached,
   and the browser is not currently displaying an alert,
   return <a>error</a> with <a>error code</a> <a>timeout</a>.

 <li><p>Return <a>success</a> with data null.
</ol>
</section> <!-- /Back -->

<section>
<h3>Forward</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/forward</td>
 </tr>
</table>

<p>The <dfn>Forward</dfn> <a>command</a>
 causes the browser to traverse one step forwards
 in the joint session history of the <a>current top-level browsing context</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p><a>Traverse the history by a delta</a> 1
  for the <a>current browsing context</a>.

 <li><p>If the task queued by that algorithm aborted before
  <a>traversing the history</a>,
  return <a>success</a> with data null.

 <li><p>Otherwise, wait until the <a>current entry</a>
  in the session history has changed,
  or for the <a>session page load timeout</a> milliseconds to pass,
  whichever occurs sooner.

  <p class=issue>This doesn't actually wait for the page to load
   if traversing the session history kicks off a navigation.

 <li><p>If the previous step completed by the <a>session page load timeout</a> being reached,
   and the browser is not currently displaying an alert,
   return <a>error</a> with <a>error code</a> <a>timeout</a>.

 <li><p>Return <a>success</a> with data null.
</ol>
</section> <!-- /Forward -->

<section>
<h3>Refresh</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/refresh</td>
 </tr>
</table>

<p>The <dfn>Refresh</dfn> <a>command</a>
 causes the browser to reload the page in in <a>current top-level browsing context</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p class=issue>Not sure if this needs to consider the reload override flag.

  <p><a>Navigate</a> the <a>current top-level browsing context</a>
   to the same resource as its <a>active document</a>,
   with <a>replacement enabled</a>.
 </li>

 <li><p>If the <a>current session</a>’s <a>page load strategy</a> is <a>none</a>,
  jump to the next step in this overall set of steps.

  <p>Otherwise:

  <ol>
   <li><p>Let <var>readiness target</var> be "<code>interactive</code>"
    if the <a>current session</a>’s <a>page load strategy</a> is <a>eager</a>,
    or "<code>complete</code>" if it is <a>normal</a>.

   <li><p>Wait for the <a>current document readiness</a> to reach <var>readiness target</var>,
    or for the <a>session page load timeout</a> milliseconds to pass,
    whichever occurs sooner.

   <li><p>If the previous step completed by the <a>load timeout</a> being reached,
     and the browser is not currently displaying an alert,
     return <a>error</a> with <a>error code</a> <a>timeout</a>.
  </ol>

 <li><p>Return <a>success</a> with data null.
</ol>
</section> <!-- /Refresh -->

<section>
<h3>Get Title</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/title</td>
 </tr>
</table>

<p>The <dfn>Get Title</dfn> command returns the <a>document title</a>
 of the <a>current top-level browsing context</a>,
 equivalent to calling <code>document.title</code>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>Let <var>title</var> be the <a>initial value</a> of
 the <a>title</a> IDL attribute of the <a>current top-level browsing
 context</a>'s <a>active document</a>.

 <li><p>Let <var>body</var> be a new JSON Object.

 <li><p>Set the property "<code>value</code>" of <var>body</var>
  to the value of <var>title</var>.

 <li><p>Return <a>success</a> with data <var>body</var>.
</ol>
</section> <!-- /Get Title -->
</section> <!-- /Navigation -->

<section>
<h2>Command Contexts</h2>

<p>Many WebDriver <a>commands</a> happen in the context of either
 the <a>current browsing context</a> or <a>current top-level browsing context</a>.
 The <a>current top-level browsing context</a> is represented in the protocol
 by its associated <a>window handle</a>.
 A <a>top-level browsing context</a> is selected
 using the <a>Switch To Window</a> command.
 Once this is done, a specific browsing context can be selected
 using the <a>Switch to Frame</a> command.

<p class=note>The use of the term “window” to
 refer to a <a>top-level browsing context</a>
 is legacy and doesn’t correspond with either
 the operating system notion of a “window”
 or the DOM <a><code>Window</code></a> object.

<p>The <a>top-level browsing context</a> is said
 to be <dfn>no longer open</dfn> if it has been <a>discarded</a>.

<p>Each <a>browsing context</a> has an associated
 <dfn data-lt="window handle|window handles">window handle</dfn> (string)
 uniquely identifying it.
 It must not be "<code>current</code>".

<p>The <dfn>web window identifier</dfn>
 is the string constant "<code>window-fcc6-11e5-b4f8-330a88ab9d7f</code>".

<p>The <dfn>web frame identifier</dfn>
 is the string constant "<code>frame-075b-4da1-b6ba-e579c2d3230a</code>".

<p>The <dfn>JSON serialisation of the <code>WindowProxy</code> object</dfn>
 is the JSON Object obtained by applying the following algorithm
 to the given <a><code>WindowProxy</code> object</a> <var>window</var>:

<ol>
 <li><p>Let <var>identifier</var> be the <a>web window identifier</a>
  if the associated <a>browsing context</a> of <var>window</var>
  is a <a>top-level browsing context</a>.

  <p>Otherwise let it be the <a>web frame identifier</a>.

 <li><p>Return a JSON Object initialised with the following properties:

  <dl>
   <dt><var>identifier</var>
   <dd><p>Associated <a>window handle</a>
    of the <var>window</var>’s <a>browsing context</a>.
  </dl>
</ol>

<p class=note>In accordance with
 the <a href=http://www.w3.org/TR/html5/editing.html#focus>focus</a>
 section of the [[!HTML]] specification,
 commands are unaffected by whether
 the operating system window has focus or not.

<section>
<h3>Get Window Handle</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/window</td>
 </tr>
</table>

<p>The <dfn>Get Window Handle</dfn> command returns
 the <a>window handle</a> for the <a>current top-level browsing context</a>.
 It can be used as an argument to <a>Switch To Window</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p>Let <var>body</var> be a new JSON Object.

 <li><p>Set the property "<code>value</code>" on <var>body</var>
  to the value of the <a>window handle</a> associated with
  the <a>current top-level browsing context</a>.

 <li>Return <a>success</a> with data <var>body</var>.
</ol>
</section> <!-- /Get Window Handle -->

<section>
<h3>Close Window</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>DELETE</td>
  <td>/session/{<var>session id</var>}/window</td>
 </tr>
</table>

<p>The <a>remote end steps</a> for the <dfn>Close Window</dfn> <a>command</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p class=issue>This can prompt unload,
  in which case the operation really failed.

  <p><a>Close</a> the <a>current top-level browsing context</a>.

 <li><p>If there are no more open <a>top-level browsing contexts</a>,
  then <a>close the session</a>.

 <li>Return the result of running the <a>remote end steps</a>
  for the <a>Get Window Handles</a> <a>command</a>.
</ol>
</section> <!-- /Close Window -->

<section>
<h3>Switch To Window</h3>

<table class="simple jsoncommand">
  <tr>
    <th>HTTP Method</th>
    <th>Path Template</th>
  </tr>
  <tr>
    <td>POST</td>
    <td>/session/{<var>session id</var>}/window</td>
  </tr>
</table>

<p>The <dfn>Switch To Window</dfn> <a>command</a>
 is used to select the <a>current top-level browsing context</a>
 for the current <a>session</a>,
 i.e. the one that will be used for processing <a>commands</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If there is an <a>active user prompt</a>,
  that due to the uniqueness of the user agent
  prevents the focussing of another <a>top-level browsing context</a>,
  return <a>error</a> with <a>error code</a> <a>unsupported operation</a>.

 <li><p>Let <var>handle</var> be the result of
  <a>getting a property</a> named "<code>handle</code>"
  from the <var>parameters</var> argument.

 <li><p>If <var>handle</var> is equal to the associated <a>window handle</a>
  for some <a>top-level browsing context</a> in the <a>current session</a>,
  set the <a>session</a>’s <a>current browsing context</a>
  to that browsing context, and return <a>success</a> with data null.

  <p>Otherwise, return <a>error</a> with <a>error code</a> <a>no such window</a>.
</ol>
</section> <!-- /Switch To Window -->

<section>
<h3>Get Window Handles</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/window/handles</td>
 </tr>
</table>

<p>The <dfn>Get Window Handles</dfn> <a>command</a>
 returns a list of <a>window handles</a>
 for every open <a>top-level browsing context</a>.
 The order in which the window handles are returned is arbitrary.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>Let <var>handles</var> be a JSON List.

 <li><p>For each <a>top-level browsing context</a> in the <a>remote end</a>,
  push the associated <a>window handle</a> onto <var>handles</var>.

 <li><p>Let <var>body</var> be a JSON object
  with the property "<code>value</code>" set to <var>handles</var>.

 <li>Return <a>success</a> with data <var>body</var>.
</ol>

<aside class=example>
 <p>In order to determine whether or not a particular interaction
  with the browser opens a new window,
  one can obtain the set of window handles before the interaction is performed
  and compare it with the set after the action is performed.
</aside>
</section> <!-- /Get Window Handles -->

<section>
<h3>Switch To Frame</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/frame</td>
 </tr>
</table>

<p>The <dfn>Switch To Frame</dfn> command is used to select
 the <a>current top-level browsing context</a> or a <a>child browsing context</a>
 of the <a>current browsing context</a> to use as the <a>current browsing context</a>
 for subsequent <a>commands</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>Let <var>id</var> be the result of
  <a>getting a property</a> named "<code>id</code>"
  from the <var>parameters</var> argument.

 <li><p>Run the substeps of the first matching condition:

  <dl class=switch>
   <dt><var>id</var> is null
   <dd>
    <ol>
     <li><p>Set the <a>current browsing context</a> to
      the <a>current top-level browsing context</a>.
    </ol>

   <dt><var>id</var> is a <code>Number</code> object
   <dd>
    <ol>
     <li><p>If <var>id</var> is less than 0 or greater than 2<sup>16</sup> – 1,
      return <a>error</a> with <a>error code</a> <a>no such frame</a>.

     <li><p>Let <var>window</var> be the <a>associated window</a>
      of the <a>current browsing context</a>’s <a>active document</a>.

     <li><p>If <var>id</var> is not
      a <a>supported property index</a> of <var>window</var>,
      return <a>error</a> with <a>error code</a> <a>no such frame</a>.

     <li><p>Let <var>child window</var> be
      the <a><code>WindowProxy</code></a> object
      obtained by <a>determining the value of an indexed property</a>
      of <var>window</var> with index <var>id</var>.

     <li><p>Set the <a>current browsing context</a> to
      <var>new window</var>’s browsing context.</li>
    </ol>

   <dt><var>id</var> <a>represents a web element</a>
   <dd>
    <ol>
     <li><p>Let <var>element result</var> be the result of
      <a>getting a known element</a> by
      <a>UUID</a> reference <var>id</var>.

     <li><p>If <var>element result</var> is a <a>success</a>,
      let <var>element</var> be <var>element result</var>’s data.

      <p>Otherwise, return <var>element result</var>.

     <li><p>If <var>element</var> <a>is stale</a>,
      return <a>error</a> with <a>error code</a> <a>stale element reference</a>.

     <li><p>If <var>element</var> is not a <a><code>frame</code></a>
      or <a><code>iframe</code></a> element,
      return <a>error</a> with <a>error code</a> <a>no such frame</a>.

     <li><p>Set the <a>current browsing context</a> to element’s
      <a>nested browsing context</a>.
    </ol>

  <dt>Otherwise</dt>
  <dd>
   <ol>
    <li><p>Return <a>error</a> with <a>error code</a> <a>no such frame</a>.
   </ol>
 </dl>

 <li><p>Return <a>success</a> with data null.
</ol>

<p class=note>WebDriver is not bound by the same origin policy,
 so it is always possible to switch into child browsing contexts,
 even if they are different origin to the current browsing context.
</section> <!-- /Switch To Frame -->

<section>
<h3>Switch To Parent Frame</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/frame/parent</td>
 </tr>
</table>

<p>The <dfn>Switch to Parent Frame</dfn> <a>command</a>
 sets the <a>current browsing context</a> for future <a>commands</a>
 to the parent of the <a>current browsing context</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>If the <a>current browsing context</a> is not equal to
  the <a>current top-level browsing context</a>,
  set the <a>current browsing context</a> to
  the <a>parent browsing context</a> of the <a>current browsing context</a>.

 <li><p>Return <a>success</a> with data null.
</ol>
</section> <!-- /Switch To Parent Frame -->

<section>
<h2>Resizing and Positioning Windows</h2>

<p>WebDriver provides <a>commands</a>
 for interacting with the operating system window
 containing the <a>current top-level browsing context</a>.
 Because different operating system’s window managers provide different abilities,
 not all of the commands in this section can be supported by all <a>remote ends</a>.
 Where a <a>command</a> is not supported,
 an <a>unsupported operation</a> <a>error</a> is returned.

<p>A <a>top-level browsing context</a>’s <dfn>window size</dfn>
 are the outer dimensions, including any browser chrome
 externally drawn window decorations in <a>CSS reference pixels</a>
 of the operating system window corresponding to it.
 Its <a>JSON representation</a> is the following:

<dl>
 <dt>"<code>width</code>"
 <dd>Width of the <a>top-level browsing context</a>’s outer dimensions,
  including any browser chrome and externally drawn window decorations
  in <a>CSS reference pixels</a>.

 <dt>"<code>height</code>"
 <dd>Height of the <a>top-level browsing context</a>’s outer dimensions,
  including any browser chrome and externally drawn window decorations
  in <a>CSS reference pixels</a>.
</dl>

<p class=note>In some user agents the operating system’s
 window dimensions including decorations,
 are provided by the proprietary <code>window.outerWidth</code>
 and <code>window.outerHeight</code> [[!DOM]] properties.

<p>A <a>top-level browsing context</a>’s <dfn>window position</dfn>
 is defined as a dictionary of the <a>screenX</a> and <a>screenY</a> attributes
 on the <a><code>WindowProxy</code></a> it corresponds to.
 Its <a>JSON representation</a> is the following:

<dl>
 <dt>"<code>x</code>"
 <dd><a>screenX</a> attribute of the <a><code>WindowProxy</code></a>
  for the <a>current top-level browsing context</a>.

 <dt>"<code>y</code>"
 <dd><a>screenY</a> attribute of the <a><code>WindowProxy</code></a>
  for the <a>current top-level browsing context</a>.
</dl>

<section>
<h3>Get Window Size</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{sessionId}/window/size</td>
 </tr>
</table>

<p>The <dfn>Get Window Size</dfn> <a>command</a>
 returns the size of the operating system window corresponding
 to the <a>current top-level browsing context</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
   return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>Return <a>success</a> with the <a>JSON serialisation</a>
  of the <a>current top-level browsing context</a>’s <a>window size</a>.
</ol>
</section> <!-- /Get Window Size -->

<section>
<h3>Set Window Size</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/window/size</td>
 </tr>
</table>

<p>The <dfn>Set Window Size</dfn> <a>command</a>
 alters the size of the operating system window
 corresponding to the <a>current top-level browsing context</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>If the <a>remote end</a> does not support
  the <a>Set Window Size</a> <a>command</a> for
  the <a>current top-level browsing context</a> for any reason,
  return <a>error</a> with <a>error code</a> <a>unsupported operation</a>.

 <li><p>If the properties <code>width</code> or <code>height</code>
  are missing from the <var>parameters</var> argument,
  or they are not integers, or less than 0 or greater than 2<sup>64</sup> – 1,
  return <a>error</a> with <a>error code</a> <a>invalid argument</a>.

 <li><p>Let <var>width</var> be the result of
  <a>getting a property</a> named <code>width</code>
  from the <var>parameters</var> argument.

 <li><p>Let <var>height</var> be the result of
  <a>getting a property</a> named <code>height</code>
  from the <var>parameters</var> argument.

 <li><p>Set the width, in <a>CSS reference pixels</a>,
  of the operating system window containing
  the <a>current top-level browsing context</a>,
  including any browser chrome and externally drawn window decorations
  to a value that is as close as possible to <var>width</var>.

 <li><p>Set the height, in <a>CSS reference pixels</a>,
  of the operating system window containing
  the <a>current top-level browsing context</a>,
  including any browser chrome and externally drawn window decorations
  to a value that is as close as possible to <var>height</var>.

 <li><p>Return <a>success</a> with the <a>JSON serialisation</a>
  of the <a>current top-level browsing context</a>’s <a>window size</a>.
</ol>

<aside class=note>
 <p>The specification does not guarantee
  that the resulting window size will exactly match that which was requested.
  In particular the implementation is expected to clamp values
  that are larger than the physical screen dimensions,
  or smaller than the minimum window size.

 <p>Particular implementations may have other limitations
 such as not being able to resize in single-pixel increments.
</aside>
</section> <!-- /Set Window Size -->

<section>
<h3>Get Window Position</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/window/position</td>
 </tr>
</table>

<p>The <dfn>Get Window Position</dfn> <a>command</a>
 returns the position on the screen
 of the operating system window
 corresponding to the <a>current top-level browsing context</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>If the <a>remote end</a> does not support
  the <a>Get Window Position</a> <a>command</a> for
  the <a>current top-level browsing context</a> for any reason,
  return <a>error</a> with <a>error code</a> <a>unsupported operation</a>.

 <li><p>Return <a>success</a> with the <a>JSON serialisation</a>
  of the <a>current top-level browsing context</a>’s <a>window position</a>.
</ol>
</section> <!-- /Get Window Position -->

<section>
<h3>Set Window Position</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/window/position</td>
 </tr>
</table>

<p>The <dfn>Set Window Position</dfn> <a>command</a>
 sets the position on the screen
 of the operating system window
 corresponding to the <a>current top-level browsing context</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>If the <a>remote end</a> does not support
  the <a>Set Window Position</a> <a>command</a> for
  the <a>current top-level browsing context</a> for any reason,
  return <a>error</a> with <a>error code</a> <a>unsupported operation</a>.

 <li><p>If the <code>x</code> or <code>y</code> properties
  are missing from the <var>parameters</var> argument,
  or they are not integers,
  or less than 0 or greater than 2<sup>64</sup> – 1,
  return <a>error</a> with <a>error code</a> <a>invalid argument</a>.

 <li><p>Let <var>x</var> be the result of <a>getting a property</a>
  named <code>y</code> from the <var>parameters</var> argument.

 <li><p>Let <var>y</var> be the result of <a>getting a property</a>
  named <code>x</code> from the <var>parameters</var> argument.

 <li><p>Run the implementation-specific steps
  to set the position of the operating system level window
  containing the <a>current top-level browsing context</a>
  to the position given by the <var>x</var> and <var>y</var> coordinates.

 <div class=note>
  <p>Note that this step is similar
   to calling the <a>moveTo(x, y)</a> method
   on the <a><code>WindowProxy</code></a> object
   associated with the <a>current top-level browsing context</a>,
   but without the <a href=https://developer.mozilla.org/en-US/docs/Web/API/Window/moveTo>security restrictions</a> that you

  <ol type=a>
   <li>cannot move a window or tab
    that was not created by <code>window.open</code>.
   <li>cannot move a window or tab
    when it is in a window with more than one tab.
  </ol>
 </div>

 <li>Return <a>success</a> with the <a>JSON serialisation</a>
  of the <a>current top-level browsing context</a>’s <a>window position</a>.
</ol>
</section> <!-- /Set Window Position -->

<section>
<h3>Maximize Window</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/window/maximize</td>
 </tr>
</table>

<p>The <dfn>Maximize Window</dfn> command
 invokes the window manager-specific “maximize” operation, if any,
 on the window containing the <a>current top-level browsing context</a>.
 This typically increases the window to the maximum available size
 without going full-screen.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>If the <a>remote end</a> does not support
  the <a>Maximize Window</a> command
  for the <a>current top-level browsing context</a> for any reason,
  return <a>error</a> with <a>error code</a> <a>unsupported operation</a>.

 <li><p>Run the implementation-specific steps
  to increase the dimensions of the operating system level window
  containing the <a>current top-level browsing context</a>
  to the maximum available size allowed by the window manager.

 <li><p>Return <a>success</a>
  with the following JSON Object:

  <dl>
   <dt>"<code>width</code>"
   <dd><a>Current top-level browsing context</a>’s
    <a>window dimension</a> width.

   <dt>"<code>height</code>"
   <dd><a>Current top-level browsing context</a>’s
    <a>window dimension</a> height.
  </dl>
</ol>
</section> <!-- /Maximize Window -->

<section>
<h3>Fullscreen Window</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/window/fullscreen</td>
 </tr>
</table>

<p>The <dfn>Fullscreen Window</dfn> command
 invokes the window manager-specific “full screen” operation, if any,
 on the window containing the <a>current top-level browsing context</a>.
 This typically increases the window to the size of the physical display
 and can hide browser UI elements such as toolbars.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>If the <a>remote end</a> does not support
  the <a>Fullscreen Window</a> command
  for the <a>current top-level browsing context</a> for any reason,
  return <a>error</a> with <a>error code</a> <a>unsupported operation</a>.

 <li><p>Run the implementation-specific steps,
   which should have the effect of making the dimensions of
   the window containing the <a>current top-level browsing context</a>
   as close as possible to the dimensions of the display containing the window,
   and may hide browser-provided UI such as toolbars.

 <li><p>Return <a>success</a>
  with the following JSON Object:

  <dl>
   <dt>"<code>width</code>"
   <dd><a>Current top-level browsing context</a>’s
    <a>window dimension</a> width.

   <dt>"<code>height</code>"
   <dd><a>Current top-level browsing context</a>’s
    <a>window dimension</a> height.
  </dl>
</ol>
</section> <!-- /Fullscreen Window -->

</section> <!-- /Switch To Window -->
</section> <!-- /Command Contexts -->

<section>
<h2>Elements</h2>

<p>A <dfn data-lt="web elements">web element</dfn>
 is an abstraction used to identify an <a>element</a>
 when it is transported across the <a href=#protocol>protocol</a>,
 between <a>remote</a>- and <a>local</a> ends.

<p>The <dfn>web element identifier</dfn> is a constant
 with the string "<code>element-6066-11e4-a52e-4f735466cecf</code>".

<p>Each <a>element</a> has an associated <dfn>web element reference</dfn> (a <a>UUID</a>)
 that uniquely identifies the element across all <a>browsing contexts</a>.
 The <a>web element reference</a> for every <a>element</a>
 representing the same <a>element</a> is the same.

<p>An ECMAScript <a>Object</a> <dfn>represents a web element</dfn>
 if it has a <a>web element identifier</a> <a>own property</a>
 holding a <a>UUID</a> value.

<p>Each <a>browsing context</a> has an associated list of
 <dfn data-lt="known elements|known element">known elements</dfn>.
 When the <a>browsing context</a> is <a>discarded</a>,
 the list of <a>known elements</a> is discarded along with it.

<p>To <dfn data-lt="get a known element|getting a known element">get a known element</dfn>
 by a <a>UUID</a> <var>reference</var>,
 return <a>success</a> with the <a>known element</a>
 which <a>web element reference</a> matches <var>reference</var>.
 If there are none, return <a>error</a>
 with <a>error code</a> <a>no such element</a>.

<p>To <dfn data-lt="create a web element reference|create an element">create a web element reference</dfn>
 for an <a><var>element</var></a>:

<ol>
 <li><p>For each <var>known element</var>
  of the <a>current browsing context</a>’s <a>known elements</a>:

  <ol>
   <li><p>If <var>known element</var> <a>equals</a> <var>element</var>,
    return <a>success</a> with <var>known element</var>’s <a>web element reference</a>.
  </ol>

 <li><p>Let <var>new reference</var> be the result of <a>generating a UUID</a>.

 <li><p>Set <var>element</var>’s <a>web element reference</a>
  to <var>new reference</var>.

 <li><p>Append <var>element</var> to
  the <a>known elements</a> of the <a>current browsing context</a>.

 <li><p>Return <a>success</a> with data
  <var>element</var>’s <a>web element reference</a>.
</ol>

<p>The <dfn>JSON serialisation of an element</dfn>
 is a JSON Object where the <a>web element identifier</a> key
 is mapped to the <a>element</a>’s <a>web element reference</a>.

<p>When required to <dfn>deserialise a web element</dfn>
 by a JSON Object <var>object</var> that <a>represents a web element</a>:

<ol>
 <li><p>If <var>object</var> has no <a>own property</a> <a>web element identifier</a>,
  return <a>error</a> with <a>error code</a> <a>invalid argument</a>.

 <li><p>Let <var>reference</var> be the result of
  <a data-lt="getting a property">getting</a>
  the <a>web element identifier</a> property
  from <var>object</var>.

 <li><p>Let <var>element result</var> be the result of
  <a>getting a known element</a> by
  <a>UUID</a> <var>reference</var>.

 <li><p>If <var>element result</var> is a <a>success</a>,
  let <var>element</var> be <var>element result</var>’s data.

  <p>Otherwise, return <var>element result</var>.

 <li><p>Return <a>success</a> with data <var>element</var>.
</ol>

<p>A <a>stale element</a> is a reference to a <a>node</a>
 that has been disconnected from the <a>current browsing context</a>’s DOM.
 To determine if an <var>element</var> <dfn data-lt="is stale|stale element">is stale</dfn>,
 run the following substeps:

<ol>
 <li><p>Let <var>document</var> be
  the <a>current browsing context</a>’s <a>document element</a>.

 <li><p>If <var>element</var> is <a>not in the same tree</a> as <var>document</var>,
  return true.

 <li><p>Otherwise return false.
</ol>

<p>An <a>element</a> is
 <dfn data-lt="scroll into view|scrolls into view">scrolled into view</dfn>
 by calling <a>scrollIntoView()</a>.

<p>An <a>element</a> is considered <dfn>editable</dfn>
 if it is either an <a><code>input</code> element</a>
 whose <a><code>type</code> attribute</a> is not in the
 <a>Button</a>,
 <a>Hidden</a>,
 <a>Image Button</a>,
 <a>Reset Button</a>,
 or <a>Submit Button</a> states,
 or a <a><code>textarea</code> element</a>,
 or is <a>content editable</a>.

<p>An <a>element</a> is said to have <dfn>pointer events disabled</dfn>
 if the <a>resolved value</a> of its "<code>pointer-events</code>" style property
 is "<code>none</code>".

<p>An <a>element</a> is to be considered <dfn>read only</dfn>
 if it is an <a><code>input</code> element</a>
 whose <a><code>readOnly</code> attribute</a> is set.

<section>
<h3>Element Interactability</h3>

<p>In order to determine if an element
 can be interacted with using pointer actions,
 WebDriver performs hit-testing to find
 if the interaction will be able to reach the requested element.

<p>An <dfn data-lt=interactable>interactable element</dfn>
 is an <a>element</a> which is either
 <a>pointer-interactable</a> or <a>keyboard-interactable</a>.

<p>A <dfn data-lt="pointer-interactable">pointer-interactable element</dfn>
 is defined to be the first non-transparent <a>element</a>,
 defined by the paint order found at the centre point
 of its rectangle that is inside the <a>viewport</a>,
 excluding the size of any rendered scrollbars.

<p>An <a>element</a>’s <dfn>in-view centre point</dfn>
 is the centre point of the area
 of the first <a data-lt="getClientRects">DOM client rectangle</a>
 that is inside the <a>viewport</a>.
 It can be calculated this way:

<ol>
 <li><p>Let <var>rectangle</var> be
  the first element of the <a><code>DOMRect</code></a> sequence
  returned by calling <a>getClientRects</a> on <var><a>element</a></var>.

 <!--
  no need to care for scroll bars here
  because elementsFromPoint takes care of it

  this is the same as

    rect.width - (rect.right - innerWidth)
    rect.height - (rect.bottom - innerHeight)
 -->
 <li><p>Let <var>visible width</var> be the <var>rectangle</var>’s
  (<a>max</a>(<a>x coordinate</a>, <a>x coordinate</a> + <a>width dimension</a>)).

 <li><p>Let <var>visible height</var> be the <var>rectangle</var>’s
  (<a>max</a>(<a>y coordinate</a>, <a>y coordinate</a> + <a>height dimension</a>)).

 <li>Let <var>vertical centre offset</var> be
  (<var>visible width</var> / 2.0).

 <li>Let <var>horizontal centre offset</var> be
  (<var>visible height</var> / 2.0).

 <li>Let <var>centre point</var> be a pair
  of the <var>rectangle</var>’s (<a>x coordinate</a> + <var>horizontal centre offset</var>)
  and (<a>y coordinate</a> + <var>vertical centre offset</var>).

 <li>Return <var>centre point</var>.
</ol>

<p>In order to produce a <dfn>pointer-interactable elements tree</dfn>
 from an <var><a>element</a></var>:

<ol>
 <li><p>If <var>element</var> is <a>not in the same tree</a>
  as the <a>current browsing context</a>’s <a>active document</a>,
  return an empty sequence.

 <li><p>Let <var>centre point</var> be
  the <a>in-view centre point</a> of <var>element</var>.

 <li><p>Return the <a>elements from point</a>
  given the coordinates <var>centre point</var>.
</ol>

<p>To <dfn>get the first pointer-interactable element</dfn>
 given a <a>pointer-interactable elements tree</a>,
 return with <a>success</a> the first <a>element</a>
 which style property <code>opacity</code>
 has the <a>computed value</a> of "1";
 otherwise return an <a>error</a>.
</section> <!-- /Element Interactability -->

<section>
<h3>Get Active Element</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/active</td>
 </tr>
</table>

<p><dfn>Get Active Element</dfn> returns
 the <a href=https://html.spec.whatwg.org/#dom-document-activeelement>active element</a>
 of the <a>current browsing context</a>’s
 <a href=https://dom.spec.whatwg.org/#concept-element>document element</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>Let <var>active element</var> be the <a>active element</a>
  of the <a>current browsing context</a>’s <a>document element</a>.

 <li><p>Let <var>active web element</var>
  be the <a data-lt="JSON serialisation of an element">JSON serialisation</a>
  of <var>active element</var>.

 <li><p>Return <a>success</a> with data <var>active web element</var>.
</ol>
</section> <!-- /Get Active Element -->
</section> <!-- /Elements -->

<section>
<h2>Element Retrieval</h2>

<p>The <a>Find Element</a>,
 <a>Find Elements</a>,
 <a>Find Element From Element</a>,
 and <a>Find Elements From Element</a> <a>commands</a>
 allow lookup of individual elements and collections of elements.
 Element retrieval searches are performed
 using pre-order traversal of the document’s nodes
 that match the provided selector’s expression.
 Elements are <a data-lt="JSON serialisation of an element">serialised</a>
 and returned as <a>web elements</a>.

<p>When required to <dfn>find</dfn> with arguments
 <var>all</var>, <var>start node</var>, <var>using</var> and <var>value</var>,
 a <a>remote end</a> must run the following steps:

<ol>
 <li><p>Let <var>location strategy</var> be equal to <var>using</var>.

 <li><p>Let <var>selector</var> be equal to <var>value</var>.

 <li><p>Let <var>result</var> be an empty JSON List.

 <li><p>Let <var>elements returned</var> be the result
  of the relevant <a href=#element-location-strategies>element location strategy</a>
  call with arguments <var>all</var>, <var>start node</var>, .

 <li><p>If <var>elements returned</var> is an empty <a>NodeList</a>, match on <var>all</var>:

  <dl class=switch>
   <dt>true
   <dd>Return <a>success</a> with empty JSON List.

   <dt>false
   <dd>Return <a>error</a> <a>no such element</a>.

   <dt><a><code>DOMException</code></a>
   <dt><a><code>SyntaxError</code></a>

   <dt><a><code>XPathException</code></a>
   <dd>Return <a>error</a> <a>invalid selector</a>.
  </dl>

 <li><p>Let <var>result</var> be an empty JSON List.

 <li><p>For each <var>element</var> in <var>elements returned</var>:

  <ul>
   <li><p>Append to <var>result</var>
    the <a data-lt="JSON serialisation of an element">JSON serialisation</a>
    of the <var>element</var>.
  </ul>

 <li><p>Return <var>result</var>.
</ol>

<section>
<h3>Locator Strategies</h3>

<p>An <dfn data-lt=strategy>element location strategy</dfn>
 is an <a>enumerated attribute</a>
 deciding what technique should be used
 to search for elements in the <a>current browsing context</a>.
 The following table lists the keywords and states defined for this attribute:

<table class=simple>
 <tr>
  <th>State
  <th>Keyword
 </tr>

 <tr>
  <td><a>CSS selector</a>
  <td>"<code>css selector</code>"
 </tr>

 <tr>
  <td><a>Link text selector</a>
  <td>"<code>link text</code>"
 </tr>

 <tr>
  <td><a>Partial link text selector</a>
  <td>"<code>partial link text</code>"
 </tr>

 <tr>
  <td><a>XPath selector</a>
  <td>"<code>xpath</code>"
 </tr>
</table>

<section>
<h4>CSS Selectors</h4>

<p>To find a <a>web element</a> with
 the <dfn>CSS Selector</dfn> <a>strategy</a>
 the following steps need to be completed:

<ol>
 <li><p>Match on <var>all</var>:

  <dl class=switch>
   <dt>true
   <dd>Let <var>elements</var> be the result
    of calling <a>querySelectorAll</a> with <var>selector</var>
    with the <a>context object</a> equal to the <var>start node</var>.

   <dt>false
   <dd>Let <var>elements</var> be the result
    of calling <a>querySelector</a> with the <a>context object</a>
    equal to the <var>start node</var>.
  </dl>

 <li><p>Return <var>elements</var>.
</ol>
</section> <!-- /CSS Selectors -->

<section>
<h4>Link Text</h4>

<p>To find a <a>web element</a>
 with the <dfn data-lt="link text selector">Link Text</dfn> <a>strategy</a>
 the following steps need to be completed:

<ol>
 <li><p>Let <var>elements</var> be the result of calling <a>querySelectorAll</a>,
  with argument <a><code>a</code> elements</a>,
  with the <a>context object</a> equal to the <var>start node</var>.

 <li><p>Let <var>result</var> be an empty <a>NodeList</a>.

 <li><p>For each <var>element</var> in <var>elements</var>:

  <ol>
   <li><p>Let <var>rendered text</var> be
    the result of <a>getting <code>innerText</code></a>
    of <var>element</var>.

   <li><p>Let <var>trimmed text</var> be the result of
    <a>stripping leading and trailing whitespace</a>
    from <var>rendered text</var>.

   <li><p>If <var>trimmed text</var> equals <var>selector</var>,
    append <var>element</var> to <var>result</var>.
  </ol>

 <li><p>Return <var>result</var>.
</ol>
</section> <!-- /Link Text -->

<section>
<h4>Partial Link Text</h4>

<p>The <dfn data-lt="partial link text selector">Partial link text</dfn> <a>strategy</a>
 is very similar to the <a>Link Text</a> <a>strategy</a>,
 but rather than matching the entire string,
 only a substring needs to match.
 That is, return all <a><code>a</code> elements</a>
 with rendered text that contains the selector expression.

<p>To find a <a>web element</a>
 with the <a>Partial Link Text</a> <a>strategy</a>
 the following steps need to be completed:

<ol>
 <li><p>Let <var>elements</var> be the result of calling <a>querySelectorAll</a>,
  with argument <a><code>a</code> elements</a>,
  with the <a>context object</a> equal to the <var>start node</var>.

 <li><p>Let <var>result</var> be an empty <a>NodeList</a>.

 <li><p>For each <var>element</var> in <var>elements</var>:

  <ol>
   <li><p>Let <var>rendered text</var> be the result
    of <a>getting <code>innerText</code></a> of <var>element</var>.

   <li><p>If <var>rendered text</var> contains <var>selector</var>,
    append <var>element</var> to <var>result</var>.
  </ol>

 <li><p>Return <var>result</var>.
</ol>
</section> <!-- /Partial Link Text -->

<section>
<h4>XPath</h4>

<p>To find a <a>web element</a> with
 the <dfn>XPath Selector</dfn> <a>strategy</a>
 the following steps need to be completed:

<ol>
 <li><p>Return the result of calling <a><code>evaluate</code></a>,
  with arguments <var>selector</var>, <a>context object</a>
  equal to the <var>start node</var>.
</ol>
</section> <!-- /XPath -->
</section> <!-- /Locator Strategies -->

<section>
<h3>Find Element</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/element</td>
 </tr>
</table>

<p>The <dfn>Find Element</dfn> <a>command</a> is used
  to find an element in the <a>current browsing context</a> that can be used for
  future <a>commands</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>Let <var>all</var> be equal to false.

 <li><p>Let <var>start node </var> be <a><code>html</code> element</a>.

 <li><p>Let <var>location strategy</var> be the result of <a>getting a property</a> called "<code>using</code>".

 <li><p>Let <var>selector</var> be the result of <a>getting a property</a> called "<code>value</code>".

 <li>Return the result of <a>Find</a> with <var>all</var>, <var>start node</var>,
   <var>location strategy</var>, and <var>selector</var>.
</ol>
</section> <!-- /Find Element -->

<section>
<h3>Find Elements</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/elements</td>
 </tr>
</table>

<p>The <dfn>Find Elements</dfn> <a>command</a>
 is used to find an elements in the <a>current browsing context</a>
 that can be used for future <a>commands</a>.

<ol>
 <li><p>Let <var>all</var> be equal to true.

 <li><p>Let <var>start node </var> be <a><code>html</code> element</a>.

 <li><p>Let <var>location strategy</var> be the result
  of <a>getting a property</a> called "<code>using</code>".

 <li><p>Let <var>selector</var> be the result
  of <a>getting a property</a> called "<code>value</code>".

 <li>Return the result of <a>Find</a> with
  <var>all</var>, <var>start node</var>,
  <var>location strategy</var>, and <var>selector</var>.
</ol>
</section> <!-- /Find Elements -->

<section>
<h3>Find Element From Element</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/element</td>
 </tr>
</table>

<p>The <dfn>Find Element From Element</dfn> <a>command</a>
 is used to find an element from a <a>web element</a>
 in the <a>current browsing context</a>
 that can be used for future <a>commands</a>.

<ol>
 <li><p>Let <var>all</var> be equal to false.

 <li><p>Let <var>start node </var> be the result of
  <a>getting a known element</a> by <a>UUID</a> <var>reference</var>.

 <li><p>Let <var>location strategy</var> be the result
  of <a>getting a property</a> called "<code>using</code>".

 <li><p>Let <var>selector</var> be the result
  of <a>getting a property</a> called "<code>value</code>".

 <li>Return the result of <a>Find</a> with
  <var>all</var>, <var>start node</var>,
  <var>location strategy</var>, and <var>selector</var>.
</ol>
</section> <!-- /Find Element From Element -->

<section>
<h3>Find Elements From Element</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/elements</td>
 </tr>
</table>

<p>The <dfn>Find Elements From Element</dfn> <a>command</a>
 is used to find elements from a <a>web element</a>
 in the <a>current browsing context</a>
 that can be used for future <a>commands</a>.

<ol>
 <li><p>Let <var>all</var> be equal to true.

 <li><p>Let <var>start node </var> be the result
  of <a>getting a known element</a> by <a>UUID</a> <var>reference</var>.

 <li><p>Let <var>location strategy</var> be the result
  of <a>getting a property</a> called "<code>using</code>".

 <li><p>Let <var>selector</var> be the result
  of <a>getting a property</a> called "<code>value</code>".

 <li>Return the result of <a>Find</a> with
  <var>all</var>, <var>start node</var>,
  <var>location strategy</var>, and <var>selector</var>.
</ol>
</section> <!-- /Find Elements From Element -->

</section> <!-- /Element Retrieval -->


<section>
<h2>Element State</h2>

<p>To <dfn>calculate the absolute position</dfn> of <a><var>element</var></a>:

<ol>
 <li><p>Let <var>x</var> and <var>y</var> both be 0.

 <li><p>While <var>element</var>’s <a>offsetParent</a> is not null:

  <ol>
   <li><p>Set <var>x</var> to (<var>x</var> +
    <var>element</var>’s <a>offsetLeft</a>).

   <li><p>Set <var>y</var> to (<var>y</var> +
    <var>element</var>’s <a>offsetTop</a>).

   <li><p>Set <var>element</var> to <var>element</var>’s <a>offsetParent</a>.
  </ol>

 <li><p>Return a pair of (<var>x</var>, <var>y</var>).
</ol>

<p>When a <a>node</a> is said to be <dfn>not in the same tree</dfn>
 as another <a>node</a>, <var>other</var>,
 the following steps must be taken:

<ol>
 <li><p>If the <a>node</a>’s <a>ownerDocument</a> attribute
  is not <var>other</var>, return true.

 <li><p>If the result of calling the <a>node</a>’s
  <a>compareDocumentPosition</a> with <var>other</var> as argument
  is <a>DOCUMENT_POSITION_DISCONNECTED</a> (1),
  return true.

 <li><p>Return false.
</ol>

<section>
<h3>Is Element Selected</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/selected</td>
 </tr>
</table>

<p><dfn>Is Element Selected</dfn> determines
 if the referenced <a>element</a> is selected or not.
 This operation only makes sense on <a data-lt="input element"><code>input</code> elements</a>
 of the <a>Checkbox</a>- and <a>Radio Button</a> states,
 or <a><code>option</code></a> elements.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>Let <var>element result</var> be the result of
  <a>getting a known element</a> by
  <a>UUID</a> reference <var>element id</var>.

 <li><p>If <var>element result</var> is a <a>success</a>,
  let <var>element</var> be <var>element result</var>’s data.

  <p>Otherwise, return <var>element result</var>.

 <li><p>If <a>element</a> <a>is stale</a>,
  return <a>error</a> with <a>error code</a> <a>stale element reference</a>.

 <li><p>Let <var>selected</var> be the value
  corresponding to the first matching statement:

  <dl class=switch>
   <dt><var>element</var> is an <a><code>input</code></a>
    with a <a><code>type</code> attribute</a>
    in the <a>Checkbox</a>- or <a>Radio Button</a> state
   <dd><p>The result of <var>element</var>’s <a>checkedness</a>.

   <dt><var>element</var> is
    an <a><code>option</code></a> element
   <dd><p>The result of <var>element</var>’s <a>selectedness</a>.

   <dt>Otherwise
   <dd>False.
  </dl>

 <li><p>Let <var>body</var> be a JSON Object
  with the "<code>value</code>" member set to <var>selected</var>.

 <li><p>Return <a>success</a> with data <var>body</var>.
</ol>
</section> <!-- /Is Element Selected -->

<section>
<h3>Get Element Attribute</h3>

<table class="simple jsoncommand">
  <tr>
    <th>HTTP Method</th>
    <th>Path Template</th>
  </tr>
  <tr>
    <td>GET</td>
    <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/attribute/{<var>name</var>}</td>
  </tr>
</table>

<p>The <dfn>Get Element Attribute</dfn> <a>command</a>
 will return the <a>attribute</a> of a <a>web element</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>Let <var>element result</var> be the result of
  <a>getting a known element</a> by
  <a>UUID</a> reference <var>element id</var>.

 <li><p>If <var>element result</var> is a <a>success</a>,
  let <var>element</var> be <var>element result</var>’s data.

  <p>Otherwise, return <var>element result</var>.

 <li><p>If <a>element</a> <a>is stale</a>,
  return <a>error</a> with <a>error code</a> <a>stale element reference</a>.

 <li><p>If <var>name</var> is <a>undefined</a>,
  return <a>error</a> with <a>error code</a> <a>invalid argument</a>.

  <li>Let <var>result</var> be the result of the first appropriate step below:

   <dl class=switch>
    <dt>If <var>name</var> is a <a>boolean attribute</a>
    <dd><p>"<code>true</code>" (string)
     if the <a>element</a> <a>has the attribute</a>,
     otherwise null.

    <dt>Otherwise
    <dd><p>The result of <a>getting an attribute by name</a>
     <var>name</var>.
   </dl>

  <li><p>Let <var>body</var> be a JSON Object
   with the "<code>value</code>" member set to <var>result</var>.

  <li><p>Return <a>success</a> with data <var>body</var>.
</ol>

<p class=note>Please note that the behaviour of this command
 deviates from the behaviour of <a>getAttribute</a> in [[DOM]],
 which in the case of a set <a>boolean attribute</a>
 would return an empty string.
 The reason this command returns true as a string
 is because this evaluates to true in most dynamically typed programming languages,
 but still preserves the expected type information.
</section> <!-- /Get Element Attribute -->

<section>
<h3>Get Element Property</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/property/{<var>name</var>}</td>
 </tr>
</table>

<p>The <dfn>Get Element property</dfn> <a>command</a>
 will return the result of <a>getting a property</a> of a <a>element</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>Let <var>element result</var> be the result of
  <a>getting a known element</a> by
  <a>UUID</a> reference <var>element id</var>.

 <li><p>If <var>element result</var> is a <a>success</a>,
  let <var>element</var> be <var>element result</var>’s data.

  <p>Otherwise, return <var>element result</var>.

 <li><p>If <var>element</var> <a>is stale</a>,
  return <a>error</a> with <a>error code</a> <a>stale element reference</a>.

 <li><p>Let <var>property</var> be the result of calling
  the <a>[[\GetProperty]]</a> internal method
  of <var>element</var> with property name <var>name</var>.

 <li><p>Let <var>result</var> be the value of
  <var>property</var> if not <a>undefined</a>, or null.

 <li><p>Let <var>body</var> be a JSON Object
  with the "<code>value</code>" property set to <var>result</var>.

 <li><p>Return <a>success</a> with data <var>body</var>.
</ol>
</section> <!-- /Get Element Property -->

<section>
<h3>Get Element CSS Value</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/css/{<var>property name</var>}</td>
 </tr>
</table>

<p>The <dfn>Get Element CSS Value</dfn> <a>command</a>
 retrieves the <a>computed value</a>
 of the given CSS property of the given <a>web element</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>Let <var>element result</var> be the result of
  <a>getting a known element</a> by
  <a>UUID</a> parameter <var>element id</var>.

 <li><p>If <var>element result</var> is a <a>success</a>,
  let <var>element</var> be <var>element result</var>’s data.

  <p>Otherwise, return <var>element result</var>.

 <li><p>If <var>element</var> <a>is stale</a>,
  return <a>error</a> with <a>error code</a> <a>stale element reference</a>.

 <li><p>Let <var>computed value</var> be
  the <a>computed value</a> of parameter <var>property name</var>
  from <var>element</var>’s style declarations if the <a>current browsing context</a>’s
   <a>document</a> <a data-lt="document type">type</a> is not "<code>xml</code>",
   else let it be "".

 <li><p>Let <var>body</var> be a JSON Object with
  the "<code>value</code>" member set to <var>computed value</var>.

 <li>Return <a>success</a> with data <var>body</var>.
</ol>
</section> <!-- /Get CSS Value -->

<section>
<h3>Get Element Text</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/text</td>
 </tr>
</table>

<p>The <dfn>Get Element Text</dfn> <a>command</a>
 intends to return an element’s text “as rendered”.
 This is equivalent to calling <code>element.innerText</code>.
 An element’s rendered text is also used
 for locating <a><code>a</code> elements</a> by their
 <a>link text</a> and <a>partial link text</a>.

<p class=note>For historical reasons,
 all user agents appear to have implemented
 different sets of heuristics
 for approximating what is considered rendered text.
 WebDriver relies on the unofficial draft of
 the <a href=http://rocallahan.github.io/innerText-spec/index.html><code>innerText</code> specification</a>,
 but please be aware that there may be
 compliance issues between different user agents
 for this command.
 It is expected that <code>innerText</code>
 will <a href=https://github.com/whatwg/html/issues/465>land soon in HTML</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>Let <var>element result</var> be the result of
  <a>getting a known element</a> by
  <a>UUID</a> parameter <var>element id</var>.

 <li><p>If <var>element result</var> is a <a>success</a>,
  let <var>element</var> be <var>element result</var>’s data.

  <p>Otherwise, return <var>element result</var>.

 <li><p>If <var>element</var> <a>is stale</a>,
  return <a>error</a> with <a>error code</a> <a>stale element reference</a>.

 <li><p>Let <var>rendered text</var> be
  the result of <a>getting <code>innerText</code></a>
  of <var>element</var>.

 <li><p>Let <var>body</var> be a JSON Object
  with the "<code>value</code>" property
  set to <var>rendered text</var>.

 <li><p>Return <a>success</a> with data <var>body</var>.
</ol>
</section> <!-- /Get Element Text -->

<section>
<h3>Get Element Tag Name</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/name</td>
 </tr>
</table>

<p>The <dfn>Get Element Tag Name</dfn> command
 returns the qualified tag name name of the given <a>web element</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>Let <var>element result</var> be the result of
  <a>getting a known element</a> by
  <a>UUID</a> reference parameter <var>element id</var>.

 <li><p>If <var>element result</var> is an <a>error</a>,
  return <var>element result</var>.

 <li><p>Let <var>element</var> be <var>element result</var>’s data.

 <li><p>If <var>element</var> <a>is stale</a>,
  return <a>error</a> with <a>error code</a> <a>stale element reference</a>.

 <li><p>Let <var>qualified name</var> be the result of getting
  <var>element</var>’s <a>tagName</a> content <a>attribute</a>.

 <li><p>Let <var>body</var> be a JSON Object
  with the "<code>value</code>" member set to <var>qualified name</var>.

 <li><p>Return <a>success</a> with data <var>body</var>.
</ol>
</section> <!-- /Get Element Tag Name -->

<section>
<h3>Get Element Rect</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/rect</td>
 </tr>
</table>

<p>The <dfn>Get Element Rect</dfn> command returns
 the dimensions and coordinates of the given <a>web element</a>.
 The returned value is a dictionary with the following members:

<dl>
 <dt><dfn data-lt=elementrect-x>x</dfn>
 <dd>X axis position of the top-left corner of the <a>web element</a>
  relative to the <a>current browsing context</a>’s
  <a>document element</a> in <a>CSS reference pixels</a>.

 <dt><dfn data-lt=elementrect-y>y</dfn>
 <dd>Y axis position of the top-left corner of the <a>web element</a>
  relative to the <a>current browsing context</a>’s
  <a>document element</a> in <a>CSS reference pixels</a>.

 <dt><dfn data-lt=elementrect-height>height</dfn>
 <dd>Height of the <a>web element</a>’s
  <a>bounding rectangle</a> in <a>CSS reference pixels</a>.

 <dt><dfn data-lt=elementrect-width>width</dfn>
 <dd>Width of the <a>web element</a>’s
  <a>bounding rectangle</a> in <a>CSS reference pixels</a>.
</dl>

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>Let <var>element result</var> be the result of
  <a>getting a known element</a> by
  <a>UUID</a> reference parameter <var>element id</var>.

 <li><p>If <var>element result</var> is an <a>error</a>,
  return <var>element result</var>.

 <li><p>Let <var>element</var> be <var>element result</var>’s data.

 <li><p>If the <var>element</var> <a>is stale</a>,
  return <a>error</a> with <a>error code</a> <a>stale element reference</a>.

 <li><p><a>Calculate the absolute position</a> of <var>element</var>
  and let it be <var>coordinates</var>.

 <li><p>Let <var>rect</var> be <var>element</var>’s
  <a>bounding rectangle</a>.

 <li><p>Let <var>body</var> be a new JSON Object initialised with:

  <dl>
   <dt>"<code>x</code>"
   <dd>The first value of <var>coordinates</var>.

   <dt>"<code>y</code>"
   <dd>The second value of <var>coordinates</var>.

   <dt>"<code>width</code>"
   <dd>Value of <var>rect</var>’s <a>width dimension</a>.

   <dt>"<code>height</code>"
   <dd>Value of <var>rect</var>’s <a>height dimension</a>.
  </dl>

 <li><p>Return <a>success</a> with data <var>body</var>.
</ol>
</section> <!-- /Get Element Rect -->

<section>
<h3>Is Element Enabled</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/enabled</td>
 </tr>
</table>

<p><dfn>Is Element Enabled</dfn> determines
 if the referenced <a>element</a> is enabled or not.
 This operation only makes sense on form controls.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>Let <var>element result</var> be the result of
  <a>getting a known element</a> by
  <a>UUID</a> reference <var>element id</var>.

 <li><p>If <var>element result</var> is a <a>success</a>,
  let <var>element</var> be <var>element result</var>’s data.

  <p>Otherwise, return <var>element result</var>.

 <li><p>If <a>element</a> <a>is stale</a>,
  return <a>error</a> with <a>error code</a> <a>stale element reference</a>.

 <li><p>Let <var>enabled</var> be a boolean initially set to true
  if the <a>current browsing context</a>’s
  <a>document</a> <a data-lt="document type">type</a>
  is not "<code>xml</code>".

  <p>Otherwise, let <var>enabled</var> to false
   and jump to the last step of this algorithm.

 <li><p>Set <var>enabled</var> to false if a form control is <a>disabled</a>.

 <li><p>Let <var>body</var> be a JSON object
  with the "<code>value</code>" member set to <var>enabled</var>.

 <li><p>Return <a>success</a> with data <var>body</var>.
</ol>
</section> <!-- /Is Element Enabled -->
</section> <!-- /Element State -->

<section>
<h2>Element Interaction</h2>

<p>The element interaction <a>commands</a>
 provide a high-level instruction set for manipulating form controls.
 Unlike the <a>Actions</a> interface,
 they will implicitly <a data-lt="scroll into view">scroll elements into view</a>
 and check that it is an <a>interactable element</a>.

<section>
<h3>Element Click</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/click</td>
 </tr>
</table>

<p>The <dfn>Element Click</dfn> <a>command</a>
 <a>scrolls into view</a> the <a>element</a>
 and clicks the <a>in-view centre point</a>.
 If the element is not <a>pointer-interactable</a>,
 an <a>element not interactable</a> <a>error</a> is returned.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p>Let <var>element result</var> be the result of <a>getting a known element</a>
  by <a>UUID</a> reference <var>element id</var>.

 <lI><p>Let <var>element</var> be <var>element result</var>’s data
  if it is a <a>success</a>.
  Otherwise return <var>element result</var>.

 <li><p><a>Scroll into view</a> the <var>element</var>.

 <li><p>If <var>element</var> is not <a>pointer-interactable</a>,
  return <a>error</a> with <a>error code</a> <a>element not interactable</a>.

 <li><p>Let <var>coordinates</var> be the
  <a>in-view centre point</a> of <a>element</a>.

 <li><p class=issue>Run interaction steps on coordinate.

 <li><p>Return <a>success</a> with data null.
</ol>
</section> <!-- /Element Click -->

<section>
<h3>Element Clear</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/clear</td>
 </tr>
</table>

<p>The <dfn>Element Clear</dfn> <a>command</a>
 <a>scrolls into view</a> a <a>submittable element</a> excluding <a>buttons</a>
 or <a>editable</a> <a>element</a>,
 and then attempts to clear its <a>value</a>, <a>checkedness</a>, or <a>text content</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p>Let <var>element result</var> be the result of <a>getting a known element</a>
  by <a>UUID</a> reference <var>element id</var>.

 <lI><p>Let <var>element</var> be <var>element result</var>’s data
  if it is a <a>success</a>.
  Otherwise return <var>element result</var>.

 <li><p>If <var>element</var> is not <a>interactable</a>,
  return <a>error</a> with <a>error code</a> <a>element not interactable</a>.

 <li><p>If <var>element</var> is <a>disabled</a>, non-<a>editable</a>,
  <a>read only</a>, or has <a>pointer events disabled</a>,
  return <a>error</a> with <a>error code</a> <a>invalid element state</a>.

 <li><p><a>Scroll into view</a> the <var>element</var>.

 <li><p>If <var>element</var> is <a>editable</a>,
  set its <a><code>innerHTML</code> IDL attribute</a> to an empty string.

  <p>Otherwise:

  <ol>
   <li>Match on <var>element</var>’s <a><code>type</code> attribute</a>:

  <dl class=switch>
   <dt><a>Checkbox</a> state
   <dt><a>Radio Button</a> state
   <dd><p>Set the <a>checkedness</a> to false.

   <dt>Otherwise
   <dd><p>Set the <a>value</a> to an empty string.
  </dl>
   <li><p><a>Fire</a> a <a>change</a> <a>event</a>.
  </ol>

 <li><p>Return <a>success</a> with data null.
</ol>
</section> <!-- /Element Clear -->

<section>
<h3>Element Send Keys</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/value</td>
 </tr>
</table>

<p>The <dfn>Element Send Keys</dfn> <a>command</a>
 <a>scrolls into view</a> the form control <a>element</a>
 and then sends the provided keys to the element.
 In case the <a>element</a> is not <a>keyboard interactable</a>,
 an <a>element not interactable</a> <a>error</a> is returned.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

<li><p><a>Handle any user prompts</a>, and return its value if it is an <a>error</a>.

 <li><p>Let <var>element result</var> be the result of <a>getting a known element</a>
  by <a>UUID</a> reference <var>element id</var>.

 <li><p>Let <var>element</var> be <var>element result</var>’s data
  if it is a <a>success</a>.
  Otherwise return <var>element result</var>.

 <li><p>If <var>element</var> is not <a>keyboard interactable</a>,
  return <a>error</a> with <a>error code</a> <a>element not inteactable</a>.

 <li><p><a>Scroll into view</a> the <var>element</var>.

 <li><p>Let <var>current text length</var> be the <a>Node Length</a>.

 <li><p>Set the text insertion caret using <a>set selection range</a>
   with using <var>current text length</var> as the 2 parameters passed in.

 <li><p>Run the <a>focusing steps</a> for the <a>element</a>.

 <li><p>Let <var>character array</var> be the result of <a>getting a property</a>
    <code>text</code> from the <var>parameters</var> argument.

 <li><p>If <var>element</var> is an <a><code>input</code></a> whose
   <a><code>type</code> attribute</a> is <a>File</a>:
   <ol>
     <li><p>Let <var>text</var> be the result of
      joining together each element in <var>character array</var> to a string.

     <li><p>Complete implementation specific steps equivalent to setting the
       <a>selected files</a> on the <a><code>input</code></a>.

     <li><p class=issue>Need to handle <code>&lt;input type=file multiple&gt;</code>

     <li><p>Jump to the last step in this overall set of steps.
   </ol>

  <li><p>Let <var>i</var> be 0.

  <li><p>Let <var>length</var> be the length of <var>character array</var>.

  <li><p>While <var>i</var> &lt; <var>length</var>:

    <ol>
      <li><p>Let <var>char</var> be the entry in <var>character array</var> at
        index <var>i</var>.

      <li><p>Let <var>key to type</var> be the result of <a>processing keys</a>
        with argument <var>key</var>.

      <li><p>If the <var>key to type</var> is a <a>modifier key</a> then set the relevant
        attribute on <a>Keyboard Event</a> to true for the rest of this loop.

      <li><p>Generate <a data-lt=keyDown-Event>keyDown</a> <a>Keyboard Event</a>
        with the relevant <a>keyboard event code</a> for <var>key to type</var>
        against <var>active element</var>.

      <li><p>Generate <a data-lt=keyPress-Event>keyPress</a> <a>Keyboard Event</a>
        with the relevant <a>keyboard event code</a> for <var>key to type</var>
        against <var>active element</var>.

      <li><p>Generate <a data-lt=keyUp-Event>keyUp</a> <a>Keyboard Event</a>
        with the relevant <a>keyboard event code</a> for <var>key to type</var>
        against <var>active element</var>.
    </ol>

 <li><p>Return <a>success</a> with data null.
</ol>
</section> <!-- Element Send Keys -->
</section> <!-- /Element Interaction -->

<section>
<h2>Document Handling</h2>
<section>
<h3>Getting Page Source</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/source</td>
 </tr>
</table>

<p>The <dfn>Get Page Source</dfn> <a>command</a> returns a string serialisation of the DOM
  of the <a>current browsing context</a> <a>active document</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a> and return its value if it is an <a>error</a>.

 <li><p>Let <var>source</var> be the result returned from the
   <a><code>outerHTML</code> IDL Attribute</a> of the <a>Document Element</a> of
   the <a>current browsing context</a> <a>active document</a>.

 <li><p>If <var>source</var> is <a>null</a>:
   <p>Let <var>source</var> be the result of <a>serialising to string</a>
     the the <a>current browsing context</a> <a>active document</a>.

 <li><p>Return <a>success</a> with data <var>source</var>.
</ol>

</section> <!-- /Get Page Source -->
<section>
<h3>Executing Script</h3>

<aside class=issue>
 <p>Open questions: What happens if a user's JS triggers a modal dialog?
  Blocking seems like a reasonable idea,
  but there is an assumption that WebDriver is not threadsafe.
</aside>

<p>When required to <dfn>JSON deserialise</dfn>
 with argument <var>value</var>,
 and optional argument <var>seen</var>,
 a <a>remote end</a> must run the following steps:

<ol>
 <li><p>If <var>seen</var> was not provided,
  let <var>seen</var> be an empty set.

 <li><p>Jump to the first appropriate step below:

  <dl>
   <dt>If <var>value</var> is <code>null</code>,
    or has type <a>Boolean</a>,
    <a>Number</a>
    or <a>String</a>:
   <dd><p>Return <a>success</a> with data <var>value</var>.

   <dt>If <var>value</var> is an <a>Object</a>
    that <a>represents a web element</a>:
   <dd><p>Return the <a data-lt="deserialise a web element">deserialised</a>
    <a>web element</a> from <var>value</var>.

   <dt>If <var>value</var> if <var>value</var> is an <a>Array</a> object
    or an <a>Object</a> object:
   <dd><p>Return the result of running the <a>clone an object</a> algorithm
    with arguments <var>value</var> and <var>seen</var>,
    and the <a>JSON deserialise</a> algorithm as the clone algorithm.

   <dt>Otherwise:</dt>
   <dd><p>Return <a>error</a> with <a>error code</a> <a>javascript error</a>.
  </dl>
 </li>
</ol>

<p>When required to make a <dfn>JSON clone</dfn> with argument <var>value</var>,
 a <a>remote end</a> must run the following steps:

<ol>
 <li><p>Let <var>seen</var> be an empty set.

 <li><p>Return the result of calling the <a>internal JSON clone algorithm</a>
  with arguments <var>value</var> and <var>seen</var>.
</ol>

<p>When required to run the <dfn>internal JSON clone algorithm</dfn>
 with arguments <var>value</var> and <var>seen</var>,
 a <a>remote end</a> must return the value
 of the first matching statement, matching on <var>value</var>:

<dl class=switch>
 <dt><a>undefined</a>
 <dt><a>null</a>
 <dd><p><a>Success</a> with data null.

 <dt>type <a>Boolean</a>
 <dt>type <a>Number</a>
 <dt>type <a>String</a>
 <dd><p><a>Success</a> with data <var>value</var>.

 <dt>instance of <a>element</a>
 <dd><p>If the <a>element</a> <a>is stale</a>,
  return <a>error</a> with <a>error code</a> <a>stale element reference</a>.

  <p>Otherwise, return <a>success</a>
   with the <a data-lt="JSON serialisation of an element">JSON serialisation</a>
   of the <a>web element</a> <var>value</var>.

 <dt>a <a><code>WindowProxy</code></a> object
 <dd><p>If the associated <a>browsing context</a>
  of the <a><code>WindowProxy</code></a> object
  in <var>value</var> has been <a>discarded</a>,
  return <a>error</a> with <a>error code</a> <a>stale element reference</a>.

  <p>Otherwise return <a>success</a>
   with the <a data-lt="JSON serialisation of the WindowProxy object">JSON serialisation</a>
   of <var>value</var>.

 <dt>instance of <a>NodeList</a>
 <dt>instance of <a>HTMLCollection</a>
 <dt>instance of <a>Array</a>
 <dt>instance of <a>Object</a>
 <dd>
  <ol>
   <li><p>If <var>value</var> is in <var>seen</var>,
    return <a>error</a> with <a>error code</a> <a>javascript error</a>.

   <li><p>Add <var>value</var> to <var>seen</var>.

   <li><p>Produce the value of running the <a>clone an object</a> algorithm
    with arguments <var>value</var> and <var>seen</var>,
    and the <a>internal JSON clone algorithm</a> as the <a>clone algorithm</a>.
  </ol>
 </dd>

 <dt>Otherwise</dt>
 <dd><p><a>Error</a> with <a>error code</a> <a>javascript error</a>.
</dl>

<p>When required to <dfn>clone an object</dfn>
 with arguments <var>value</var> and <var>seen</var>
 and <a><var>clone algorithm</var></a>,
 run the following steps:

<ol>
 <li><p>Let <var>result</var> be the value of the first matching statement,
  switching on <var>value</var>:

  <dl class=switch>
   <dt>instance of <code>NodeList</code>
   <dt>instance of <code>HTMLCollection</code>
   <dt>instance of <code>Array</code>
   <dd><p>A new <code>Array</code> object,
    which <code>length</code> property
    has the result of <a>getting a property</a> named "<code>length</code>"
    from <var>value</var>.

   <dt>Otherwise
   <dd><p>A new <a>Object</a> object.
  </dl>

 <li><p>For each enumerable <a>own property</a>
  in <var>value</var>, run the following substeps:

  <ol>
   <li><p>Let <var>name</var> be the name of the property.

   <li><p>Let <var>source property value</var> be the result of
    <a>getting a property</a> named <var>name</var> from <var>value</var>.
    If doing so causes script to be run, and that script throws an exception,
    return <a>error</a> with <a>error code</a> <a>javascript error</a>.

   <li><p>Let <var>cloned property result</var> be the result of
    calling the <var>clone algorithm</var> with arguments
    <var>source property value</var> and <var>seen</var>.

   <li><p>If <var>cloned property result</var> is a <a>success</a>,
    <a>set a property</a> of <a>result</a> with
    name <var>name</var> and value equal to <var>cloned property result</var>’s data.

   <li><p>Otherwise, return <var>cloned property result</var>.
  </ol>
</ol>

<p>The steps for <dfn>extracting the script arguments from a request</dfn> are:

<ol>
 <li><p>If the <a>current browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p>Let <var>script</var> be the result of
  <a>getting a property</a> named <code>script</code>
  from the parameters argument.

 <li><p>If <var>script</var> is not a <a>String</a>,
  return <a>error</a> with <a>error code</a> <a>invalid argument</a>.

 <li><p>Let <var>args</var> be the result of
  <a>getting a property</a> named <code>args</code>
  from the parameters argument.

 <li><p>If <var>args</var> is not an <a>Object</a>
  or its <a>[[\Class]]</a> internal property
  is not <a>Array</a> or <a>Object</a>,
  return <a>error</a> with <a>error code</a> <a>invalid argument</a>.

 <li><p>Let <var>arguments</var> be a <a>List</a>
  consisting of a <a>json deserialization</a> of each item
  in <var>args</var> with the order preserved.

 <li><p>Return <a>success</a> with data <var>script</var>
  and <var>arguments</var>.
</ol>

<p>The rules to <dfn>execute a function body</dfn> are as follows.
 The algorithm will return <a>success</a>
 with the <a data-lt="clone an object">JSON representation</a>
 of the function’s return value,
 or an <a>error</a> if the evaluation of the function
 results in a JavaScript exception being thrown
 or at any point during its execution
 an <a data-lt="missing value default state">unhandled</a> <a>user prompt</a> appears.

<p>If at any point during the algorithm a <a>user prompt</a> appears,
 the <a>user prompt handler</a> must be invoked.
 If its return value is an <a>error</a>,
 it must immediately return with that error
 and abort all subsequent substeps of this algorithm.

<ol>
 <li><p>Let <var>window</var> be the <a>associated window</a>
  of the <a>current browsing context</a>’s <a>active document</a>.

 <li><p>Let <var>environment settings</var> be
  the <a>environment settings object</a> for <var>window</var>.

 <li><p>Let <var>script environment</var> be
  the <a>script execution environment</a>
  for JavaScript obtained from <var>environment settings</var>.

 <li><p>If <var>body</var> is not parsable as a <a>FunctionBody</a>
  or if parsing detects an <a>early error</a>,
  return <a>error</a> with <a>error code</a> <a>javascript error</a>.

 <li><p>If <var>body</var> begins with a <a>directive prologue</a>
  that contains a <a>use strict directive</a>
  then let <var>strict</var> be true,
  otherwise let <var>strict</var> be false.

 <li><p>Using the <a>script execution environment</a> <var>script environment</var>,
  let <var>function</var> be the result of
  calling <a>create a function object</a> with parameter list of
  an empty <a>List</a>,
  body <var>body</var>,
  scope of the <a>global environment</a>,
  and strict flag <var>strict</var>.

 <li><p>Let <var>script</var> be a new <a>script</a>.

 <li><p>Let <var>script</var>’s <a>code entry-point</a>
  be <var>function</var>.

 <li><p>Let script’s <a>settings object</a> object
  be <var>script settings</var>.

 <!-- the stuff from here on down is quite dubious -->
 <!-- this incumbent scripts stuff is in webidl but the references don't
    lead anywhere -->
 <!-- li><p><a href="">Push <var>script</var> onto <a>the stack of
       incumbent scripts</a>.</li-->

 <li><p>Invoke the <a>[[\Call]]</a> internal method of <var>function</var>,
  providing <var>window</var> as the this value
  and <var>parameters</var> as the argument values.
  If doing so does not produce an exception,
  let <var>result</var> be <a>success</a> with data set
  to the return value from this function call.
  Otherwise let <var>result</var> be <a>error</a>
  with <a>error code</a> <a>javascript error</a>.

 <!-- li><p><a href="">Pop <var>script</var> from <a>the stack of
       incumbent scripts</a>.</p></li -->

 <li><p>If <var>result</var> is an <a>error</a>, return result.

 <li><p>Otherwise let <var>json data</var> be a <a>JSON clone</a>
  of <var>result</var>’s data.

 <li><p>Return <a>success</a> with data <var>json data</var>.
</ol>

<section>
<h3>Execute Script</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/execute/sync</td>
 </tr>
</table>

<p>The <dfn>Execute Script</dfn> <a>command</a>
 executes a JavaScript function in the context of the <a>current browsing context</a>
 and returns the return value of the function.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a>, and return its value if it is an <a>error</a>.

 <li><p>Let <var>script arguments</var> be the result of
  <a>extracting the script arguments from a request</a>
  with argument <var>parameters</var>.

 <li><p>If <var>script arguments</var> is an <a>error</a>,
  return <var>script arguments</var>.

 <li><p>Let <var>body</var> and <var>arguments</var>
  be <var>script arguments</var>’ data.

 <li><p>Let <var>result</var> be the result of calling <a>execute a function body</a>,
  with arguments <var>body</var> and <var>arguments</var>.

 <li><p>If <var>result</var> is an <a>error</a>, return result.

  <p>Otherwise let <var>value</var> be <var>result</var>’s data.

 <li><p>Let <var>body</var> be a new JSON Object.

 <li><p><a>Set the property</a> "<code>value</code>" of <var>body</var>
  to <var>value</var>.

 <li><p>Return <a>success</a> with data <var>body</var>.
</ol>
</section> <!-- /Execute Script -->

<section>
<h3>Execute Async Script</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/execute/async</td>
 </tr>
</table>

<p>The <dfn>Execute Async Script</dfn> <a>command</a>
 causes JavaScript to execute as an anonymous function.
 Unlike the <a>Execute Script</a> <a>command</a>,
 the result of the function is ignored.
 Instead an additional argument is provided as the final argument to the function.
 This is a function that, when called, returns its first argument as the response.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a>, and return its value if it is an <a>error</a>.

 <li><p>Let <var>script arguments</var> be the result
  of <a>extracting the script arguments from a request</a>
  with argument <var>parameters</var>.

 <li><p>If <var>script arguments</var> is an <a>error</a>,
  return <var>script arguments</var>.

 <li><p>Let <var>body</var> and <var>arguments</var>
  be <var>script arguments</var>’ data.

 <li><p class=issue>This next step might not quite set up all the right machinery.

  <p>Let <var>webdriver callback result</var> be
   a flag which can have three values:
   <code>unset</code>, <code>expired</code>, or <code>set</code>,
   with the <code>set</code> value having associated data.
   Initially it is in the <code>unset</code> state.

 <li><p>Let <var>callback</var> be a <a>function</a>
  whose <a>[[\Call]]</a> internal method runs
  the <a>execute async script callback</a> algorithm
  initialized with argument <var>webdriver callback result</var>.

 <li><p>Append <var>callback</var> to <var>arguments</var>.

 <li><p>Let <var>result</var> be the result of calling <a>execute a function body</a>
  with arguments <var>body</var> and <var>arguments</var>.

 <li><p>If <var>result</var> is an <a>error</a>, return <var>result</var>.

 <li><p>Wait for <var>webdriver callback result</var> to enter the <code>set</code> state,
  or for <a>session script timeout</a> milliseconds to expire,
  whichever happens sooner.

 <li><p>If the previous step completed due the <a>session script timeout</a> being reached,
  set <var>webdriver callback result</var> to <code>expired</code>
  and return <a>error</a> with <a>error code</a> <a>script timeout</a>.

 <li><p>Otherwise, let <var>result</var> be <var>webdriver callback result</var>’s data.

 <li><p>If <var>result</var> is an <a>error</a>, return <var>result</var>.

 <li><p>Let <var>value</var> be <var>result</var>’s data.

 <li><p>Let <var>body</var> be a new JSON Object.

 <li><p>Set the property <code>value</code> of <var>body</var>
  to <var>value</var>.

 <li><p>Return <a>success</a> with data <var>body</var>.
</ol>

<p>The <dfn>execute async script callback</dfn> algorithm
 is initialized with a single argument <var>webdriver callback state</var>.
 It defines a <a>function</a> with a single optional argument <var>result</var>.
 When this function is called, the following steps are run:

<ol>
 <li><p>If <var>webdriver callback state</var> is not in the <code>unset</code> state,
  return <code><a>undefined</a></code>.


 <li><p>If <var>result</var> is not present,
  let <var>result</var> be <code>null</code>.

 <li><p>Let <var>json result</var> be a <a>JSON clone</a>
  of <var>result</var>.

 <li><p>Set the <var>webdriver callback state</var>
  to <code>set</code> with data <var>json result</var>.

 <li><p>Return <code><a>undefined</a></code>.
</ol>
</section> <!-- /Execute Async Script -->
</section> <!-- /Executing Script -->
</section> <!-- /Document Handling -->
<section>
<h2>Cookies</h2>

<p>This section describes the interaction with <a>cookies</a>
 as described in [[!RFC6265]].

<p>A <a>cookie</a> is described in [[!RFC6265]]
 by a name-value pair holding the cookie’s data,
 followed by zero or more attribute-value pairs describing its characteristics.

<p>The following <dfn>table for cookie conversion</dfn>
 defines the cookie concepts relevant to WebDriver,
 how these are referred to in [[!RFC6265]],
 what keys they map to in a <a>serialised cookie</a>,
 as well as the attribute-value keys needed
 when constructing a list of arguments for <a>creating a cookie</a>.

<p>For informational purposes,
 the table includes a legend of whether the field is optional
 in the <a>serialised cookie</a> structure provided to <a>Add Cookie</a>,
 and a brief non-normative description of the field
 and the expected input type of its associated value.

<table class=simple>
 <tr>
  <th>Concept
  <th>RFC 6265 Field
  <th>JSON Key
  <th>Attribute Key
  <th>Optional
  <th>Description
 </tr>

 <tr>
  <td><dfn>Cookie name</dfn>
  <td><code>name</code>
  <td>"<code>name</code>"
  <td>
  <td>
  <td>The name of the cookie.
 </tr>

 <tr>
  <td><dfn>Cookie value</dfn>
  <td><code>value</code>
  <td>"<code>value</code>"
  <td>
  <td>
  <td>The cookie value.
 </tr>

 <tr>
  <td><dfn>Cookie path</dfn>
  <td><code>path</code>
  <td>"<code>path</code>"
  <td>"<code>Path</code>"
  <td>✓
  <td>The cookie path.
   Defaults to "<code>/</code>"
   if omitted when <a>adding a cookie</a>.
 </tr>

 <tr>
  <td><dfn>Cookie domain</dfn>
  <td><code>domain</code>
  <td>"<code>domain</code>"
  <td>"<code>Domain</code>"
  <td>✓
  <td>The domain the cookie is visible to.
   Defaults to the <a>current browsing context</a>’s
   <a>document</a>’s <a>URL</a> <a>domain</a>
   if omitted when <a>adding a cookie</a>.
 </tr>

 <tr>
  <td><dfn>Cookie secure only</dfn>
  <td><code>secure-only-flag</code>
  <td>"<code>secure</code>"
  <td>"<code>Secure</code>"
  <td>✓
  <td>Whether the cookie is a secure cookie.
   Defaults to false if omitted when <a>adding a cookie</a>.
 </tr>

 <tr>
  <td><dfn>Cookie HTTP only</dfn>
  <td><code>http-only-flag</code>
  <td>"<code>httpOnly</code>"
  <td>"<code>HttpOnly</code>"
  <td>✓
  <td>Whether the cookie is an HTTP only cookie.
   Defaults to false if omitted when <a>adding a cookie</a>.
 </tr>

 <tr>
  <td><dfn>Cookie expiry time</dfn>
  <td><code>expiry-time</code>
  <td>"<code>expiry</code>"
  <td>"<code>Max-Age</code>"
  <td>✓
  <td>When the cookie expires,
   specified in seconds since <a>Unix Epoch</a>.
   Defaults to 20 years into the future
   if omitted when <a>adding a cookie</a>.
 </tr>
</table>

<p>A <dfn>serialised cookie</dfn> is a JSON Object structure
 where a <a>cookie</a>’s [[!RFC6265]] fields
 listed in the <a>table for cookie conversion</a>
 is mapped using the <i>JSON Key</i>
 and the associated field’s value from the <a>cookie store</a>.
 The optional fields may be omitted.

<p>To get <dfn data-lt="associated cookies">all associated cookies</dfn> to a <a>document</a>,
 the user agent must return the enumerated set of <a>cookies</a>
 that meet the requirements set out in the first step of the algorithm in [[RFC6265]] to
 <a>compute <code>cookie-string</code></a> for an ‘HTTP API’,
 from the <a>cookie store</a> of the given <a>document</a>’s <a>address</a>.

<p>When the <a>remote end</a> is instructed
 to <dfn data-lt="creating a cookie">create a cookie</dfn>,
 this is synonymous to carrying out the steps described in [[!RFC6265]]
 <a href=https://tools.ietf.org/html/rfc6265#section-5.3>section 5.3</a>,
 under <a>receiving a cookie</a>,
 except the user agent may not ignore the received cookie in its entirety
 (disregard step 1).

<p>To <dfn>delete cookies</dfn> given an optional filter argument
 <var>name</var> that is a string:

<ol>
 <li><p>For each <a>cookie</a> among <a>all associated cookies</a> of
  the <a>current browsing context</a>’s <a>active document</a>, if:

  <dl class=switch>
   <dt><var>name</var> is <a>undefined</a>
   <dt><var>name</var> is equal to <a>cookie name</a>
   <dd><p>Set the <a>cookie expiry time</a>
    to a <a>Unix timestamp</a> in the past.
  </dl>
</ol>

<section>
<h3>Get All Cookies</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/cookie</td>
 </tr>
</table>

<p>The <dfn>Get All Cookies</dfn> <a>command</a>
 returns all <a>cookies</a> associated with the <a>address</a>
 of the <a>current browsing context</a>’s <a>active document</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a>, and return its value if it is an <a>error</a>.

 <li><p>Let <var>cookies</var> be a JSON List
  containing <a>all associated cookies</a>
  of the <a>current browsing context</a>’s <a>active document</a>.

 <li><p>Return <a>success</a> with data <var>cookies</var>.
</ol>
</section> <!-- /Get All Cookies -->

<section>
<h3>Get Named Cookie</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/cookie/{<var>path</var>}</td>
 </tr>
</table>

<p>The <dfn>Get Named Cookie</dfn> <a>command</a>
 returns the <a>cookie</a> with the requested path
 from the <a>associated cookies</a> in the <a>cookie store</a>
 of the <a>current browsing context</a>’s <a>active document</a>.
 If no cookie is found,
 a <a>no such cookie</a> <a>error</a> is returned.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a>, and return its value if it is an <a>error</a>.

 <li><p>If the <var>path</var> matches a <a>cookie</a>’s <a>cookie name</a>
  amongst <a>all associated cookies</a>
  of the <a>current browsing context</a>’s <a>active document</a>,
  return <a>success</a> with the <a>serialised cookie</a> as data.

  <p>Otherwise, return <a>error</a>
   with <a>error code</a> <a>no such cookie</a>.
</ol>
</section> <!-- /Get Named Cookie -->

<section>
<h3>Add Cookie</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/cookie</td>
 </tr>
</table>

<p>The <dfn data-lt="adding a cookie">Add Cookie</dfn> <a>command</a>
 adds a single <a>cookie</a> to the <a>cookie store</a>
 associated with the <a>active document</a>’s <a>address</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a>, and return its value if it is an <a>error</a>.

 <li><p>If the <a>current browsing context</a>’s <a>document element</a>
  is a <a>cookie-averse <code>Document</code> object</a>,
  return <a>error</a> with <a>error code</a> <a>invalid cookie domain</a>.

 <li><p>Let <var>data</var> be the result of <a>getting a property</a>
  named <code>cookie</code> from the <var>parameters</var> argument.

 <li><p>If <var>data</var> is not a JSON Object
  with all the required (non-optional) JSON keys
  listed in the <a>table for cookie conversion</a>,
  return <a>error</a> with <a>error code</a> <a>invalid argument</a>.

 <li><p>If <a>cookie name</a> or <a>cookie value</a> is null,
  <a>cookie domain</a> is not equal to
  the <a>current browsing context</a>’s <a>active document</a>’s <a>domain</a>,
  <a>cookie secure only</a> or <a>cookie HTTP only</a> are not boolean types,
  or <a>cookie expiry time</a> is not an integer type,
  or it less than 0 or greater than 2<sup>64</sup> – 1,
  return <a>error</a> with <a>error code</a> <a>invalid argument</a>.

 <li><p><a>Create a cookie</a> in
  the <a>cookie store</a> associated with
  the <a>active document</a>’s <a>address</a>
  using <a>cookie name</a> <var>name</var>,
  <a>cookie value</a> <var>value</var>,
  and an attribute-value list of the following <a>properties</a>
  from <var>data</var>:

  <dl>
   <dt><a>Cookie path</a>
   <dd><p>The value if the entry exists, otherwise "<code>/</code>".

   <dt><a>Cookie domain</a>
   <dd><p>The value if the entry exists,
    otherwise the <a>current browsing context</a>’s
    <a>active document</a>’s <a>domain</a>.

   <dt><a>Cookie secure only</a>
   <dd><p>The value if the entry exists, otherwise false.

   <dt><a>Cookie HTTP only</a>
   <dd><p>The value if the entry exists, otherwise false.

   <dt><a>Cookie expiry time</a>
   <dd><p>The value if the entry exists,
    otherwise a <a>Unix timestamp</a> 20 years into the future from now.
  </dl>

  <p>If there is an <a>error</a> during this step,
   return <a>error</a> with <a>error code</a> <a>unable to set cookie</a>.


 <li><p>Return <a>success</a> with data null.
</ol>
</section> <!-- /Add Cookie -->

<section>
<h3>Delete Cookie</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>DELETE</td>
  <td>/session/{<var>session id</var>}/cookie/{<var>name</var>}</td>
  </tr>
</table>

<p>The <dfn>Delete Cookie</dfn> <a>command</a>
 allows you to delete either a single cookie by parameter <var>name</var>,
 or all the cookies associated with
 the <a>active document</a>’s <a>address</a>
 if <var>name</var> is <a>undefined</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a>, and return its value if it is an <a>error</a>.

 <li><p><a>Delete cookies</a> using
  the <var>name</var> parameter as the filter argument.

 <li><p>Return <a>success</a> with data null.
</ol>
</section> <!-- /Delete Cookie -->

<section>
<h3>Delete All Cookies</h3>

<table class=simple>
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>DELETE</td>
  <td>/session/{<var>session id</var>}/cookie
 </tr>
</table>

<p>The <dfn>Delete All Cookies</dfn> <a>command</a>
 allows deletion of all cookies associated with
 the <a>active document</a>’s <a>address</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p><a>Handle any user prompts</a>, and return its value if it is an <a>error</a>.

 <li><p><a>Delete cookies</a>, giving no filtering argument.

 <li><p>Return <a>success</a> with data null.
</ol>
</section> <!-- /Delete All Cookies -->
</section> <!-- /Cookies -->

<section><!-- Actions -->
  <h2>Actions</h2>

  <section><!-- Introduction -->
    <h2>Introduction</h2>
    <p><i>This section is non-normative</i>

    <p>The Actions API provides a low-level interface for providing
      virtualised device input to the web browser. Conecputally, the
      actions API divides time into a series
      of <a href="#dfn-tick">ticks</a>.  The local end sends a series
      of actions which correspond to the change in state, if any, of
      each input device during each tick. <!-- TODO: expand these
      examples --> For example, pressing a key is represented by
      an action chain consisting of a single key input device and two
      ticks, the first containing a keyDown action, and the second a
      keyUp action, whereas a pinch-zoom input is represented by an
      action chain consisting of a three ticks and two pointer input
      devices of type touch, each performing a sequence of actions
      pointerDown, followed by pointerMove, and then pointerUp.


<!-- TODO: move this note -->
<!-- p class='note'>
  An <a>activation trigger</a> generated by the WebDriver API User need to be
  indistinguishable from those generated by a real user interacting with the
  browser. In particular, the dispatched events will have the
  <a>isTrusted</a> attribute set to true. The most robust way to dispatch
  these events is by creating them in the browser implementation itself.
  Sending OS-specific input messages to the browser's window has the
  disadvantage that the browser being automated may not be properly isolated
  from a user accidentally modifying input source state; use of an OS-level
  accessibility API has the disadvantage that the browser's window must be
  focused, and as a result, multiple WebDriver instances cannot run in parallel.-->

  <aside class="example">
    Imagine we have two fingers acting on a touchscreen.
    One finger will press down on element1 at the same moment that another finger presses down on element2.
    Once these actions are done, the first finger will wait 5 seconds while the other finger moves to element3.
    Then both fingers release from the touchscreen.

    <p>When the <a>remote end</a> receives this,
     it will look at each input source's action lists.
     It will dispatch the first action of each source together,
     then the second actions together, and lastly, the final actions together.

    <p>The diagram below displays when each action gets executed.
     "Source 1" is the first finger, and "source 2" is the second.

    <p><img src=graphics/note1actions.svg alt="">

    <p>There is no limit to the number of input sources,
     and there is no restriction regarding the length of each input's action list.
     Meaning, there is no requirement that all action lists have to be the same length.
     It is possible for one input source's action list
     may have more actions than another.

     In this case, the action list for the first finger contains 2 actions
     (<code><a>pointerDown</a></code>, <code><a>pointerUp</a></code>),
     and the action list for the second finger contains 3
     (<code><a>pointerDown</a></code>, <code><a>pointerMove</a></code>, <code><a>pointerUp</a></code>).

     <p>And the execution of each action will be done as follows:

     <p><img src=graphics/note4actions.svg alt="">

     <p>Specific timing for the actions can also be expressed.
      The <code><a>pause</a></code> action can be used to either a) indicate
      a specific amount of time an input source must wait, or b)
      can be used to signify that the current input source must wait
      until all other actions in the tick are completed.
      For the former case, the current tick being executed must wait
      for the longest pause to complete.
      For example, in this diagram:

     <p><img src=graphics/note2actions.svg alt="">

     <p>The remote end will dispatch the <code><a>pointerDown</a></code> action in the first tick.
      In the second tick, since source 1 declares a <code><a>pause</a></code> of 5 seconds,
      the remote end will dispatch the <code><a>pointerUp</a></code> event for source 2,
      and will wait 5 seconds before moving on to executing the third tick.

     <p>In the event that one tick contains multiple <code><a>pause</a></code> durations,
      the remote end will wait the maximum duration
      before moving on to executing the next tick.

     <p>As noted before, <code><a>pause</a></code> can be used to signify inaction during a tick.
      If <code><a>pause</a></code> is declared without a time period,
      then the input source will not have any actions executed in the containing tick.
      As an example:

     <p><img src=graphics/note3actions.svg alt="">

     <p>During tick 2, source 1 will have its pointerMove action dispatched,
      while source 2 will do nothing.
  </aside>

  <p>

  </section> <!-- /Introduction -->

  <section> <!-- Terminology -->
    <h2>Terminology</h2>

    <p>An <dfn>input source</dfn> is a virtual device providing input
      events. Each input source has an associated <dfn>input id</dfn>,
      which is a string that identifies the particular device, and
      a <dfn>source type</dfn> which determines the kind of input the
      device can provide. As with real devices, virtual devices are
      stateful; this state is recorded in an input device state object
      associated with each device.

    <p>A <dfn>null input source</dfn> is an <a>input source</a> that
      is not associated with a specific physical device. Null input
      sources support the following actions:
      <table class=simple>
        <tr>
          <th>Action
          <th>Non-normative Description
        </tr>
        <tr>
          <td><dfn>pause</dfn></td>
          <td>Used with an integer argument to specify the duration of
          a <a>tick</a>, or as a placeholder to indicate that
          an <a>input source</a> does nothing during a particular
          tick.</td>
        </tr>
      </table>

    <p>A <dfn>key input source</dfn> is a <a>input source</a> that is
      associated with a keyboard-type device. A key input source
      supports the same <a>pause</a> action as a <a>null input
      source</a> plus the following actions:

      <table class=simple>
        <tr>
          <th>Action
          <th>Non-normative Description
        </tr>
        <tr>
          <td><dfn>keyDown</dfn></td>
          <td>Used to indicate that a particular key should be held down.</td>
        </tr>
        <tr>
          <td><dfn>keyUp</dfn></td>
          <td>Used to indicate that a depressed key should be released.</td>
        </tr>
      </table>

    <p>A <dfn>pointer input source</dfn> is an <a>input source</a>
      that is associated with a pointer-type input device. Such an
      input source has an associated subtype specifying exactly which
      kind of pointing device it is associated with. A pointer input
      source supports the same <a>pause</a> action as a <a>null input
      source</a> plus the following actions:

      <table class=simple>
        <tr>
          <th>Action
          <th>Non-normative Description
        </tr>
        <tr>
          <td><dfn>pointerDown</dfn></td>
          <td>Used to indicate that a pointer should be depressed in
          some way e.g. by holding a button down (for a mouse) or by
          coming into contact with the active surface (for a touch or
          pen device).</td>
        </tr>
        <tr>
          <td><dfn>pointerUp</dfn></td>
          <td>Used to indicate that a pointer should be released in
          some way e.g. by releasing a mouse button or moving a pen
          or touch device away from the active surface.</td>
        </tr>
        <tr>
          <td><a>pointerMove</a></td>
          <td>Used to indicate a location on the screen that a
          pointer should move to, either in its active (pressed) or
          inactive state.</td>
        </tr>
        <tr>
          <td><dfn>pointerCancel</dfn></td>
          <td>Used to cancel a pointer action.</td>
        </tr>
      </table>

    <p>A <dfn>tick</dfn> is the basic unit of time over which actions
      can be performed. During a tick, each input source has an assigned
      action — possibly a noop <a>pause</a> action — which may
      result in changes to the user agent internal state and eventually
      cause DOM events to be fired at the page. The next tick begins
      after the user agent has had a chance to process all DOM events
      generated in the current tick.

    <p><dfn data-lt="asynchronously wait|asynchronous waits">Waiting
      asynchronously</dfn> means waiting for something to occur whilst
      allowing the browser to continue processing
      the <a href="https://html.spec.whatwg.org/#event-loop">event
      loop</a>.

    <p>At the lowest level, the behaviour of actions is intended to
    mimic the remote end's behaviour with an actual input device as
    closely as possible, and the implementation strategy may involve
    e.g. injecting synthesized events into a browser event
    loop. Therefore the steps to dispatch an action will inevitably
    end up in implementation-specific territory. However there are
    certain content observable effects that must be consistent across
    implementations. To accomodate this, the specification requires
    that remote ends <dfn id="perform-actions">perform
    implementation-specific action dispatch steps</dfn>, along with a
    list of events and their properties. This list is not
    comprehensive; in particular the default action of the input
    source may cause additional events to be generated depending on
    the implementation and the state of the browser (e.g. input events
    relating to key actions when the focus is on an editable element,
    scroll events, etc.).

      <!-- todo: define generating DOM events from an input somewhere -->
  </section> <!-- /Terminology -->

  <!-- TODO: define input source -->
  <section><!-- Input State -->
    <h2>Input State</h2>

    <aside class="note">
      <p>The objects and properties defined in this section are
      spec-internal constructs and do not correspond to Javascript
      objects. For convenience the same terminology is used for their
      manipulation.
    </aside>

    <p>Each <a>session</a> has an associated <dfn>input state</dfn>
    object. This is a map between <a>input id</a> and the device
    state for that <a>input source</a>, with one entry for each
    active <a>input source</a>.

    <p>Each <a>session</a> also has an associated <dfn>input cancel
    list</dfn>, which is a list of actions. This list is used to
    manage dispatching events when resetting the state of the <a>input
    source</a>s. For simplicity the algorithms described here only
    append actions to the list and rely on the fact that the reset
    operations are idempotent.

    <p>A <a>null input source</a> has a corresponding <dfn>null input
    state</dfn> object. This is always an empty object.

    <p>A <a>key input source</a> has a corresponding <dfn>key input
    state</dfn> object. This is an object with a
    property, <code>pressed</code>, which is a set of strings
    representing currently pressed keys and
    properties <code>alt</code>, <code>shift</code>, <code>ctrl</code>,
    and <code>meta</code>, which are <a>Boolean</a>s.

    <p>When required to <dfn>create a new key input state
    object</dfn>, an implementation must return a <a>key input
    state</a> object with the <code>pressed</code> property set to the
    empty set
    and <code>alt</code>, <code>shift</code>, <code>ctrl</code>,
    and <code>meta</code> all set to <code>false</code>.

    <p>A <a>pointer input source</a> has a corresponding <dfn>pointer
    input state</dfn> object. This consists of a <code>subtype</code>
    property, which has the possible
    values <code>"mouse"</code>, <code>"pen"</code>,
    and <code>"touch"</code>, a <code>primary</code> property which is
    a boolean, a <code>pressed</code> property which is a set of
    unsigned integers, an <code>x</code> property which is an unsigned
    integer, and a <code>y</code> property which is an unsigned
    integer.

    <p>When required to <dfn>create a new pointer input state</dfn>
    object with arguments <var>subtype</var> and <var>primary</var> an
    implementation must return a <a>pointer input state</a> object
    with <code>subtype</code> set
    to <var>subtype</var>, <code>primary</code> set
    to <var>primary</var>, <code>pressed</code> set to an empty set
    and both <code>x</code> and <code>y</code> set to <code>0</code>.

    <p>The <dfn>corresponding input state type</dfn> for a
    label <var>action type</var> is given by the following table:

      <table class=simple>
        <thead>
          <tr>
            <th><var>action type</var>
            <th>Corresponding input state type
        </thead>
        <tr>
          <td><code>"none"</code>
          <td><a>null input state</a>
        </tr>
        <tr>
          <td><code>"key"</code>
          <td><a>key input state</a></td>
        </tr>
        <tr>
          <td><code>"pointer"</code>
          <td><a>pointer input state</a></td>
        </tr>
      </table>

  </section><!-- /Input State -->
  <section> <!-- Processing Actions Requests -->
    <h2>Processing Actions Requests</h2>

    <p>The algorithm for <a data-lt="extract an action
    chain">extracting an action chain from a request</a> takes the
    JSON object representing an action chain, validates the input, and
    returns a data structure that is the transpose of the input JSON,
    such that the actions to be performed in a single tick are grouped
    together.

    <p>When required to <dfn>extract an action chain</dfn> with
    argument <var>parameters</var>, a <a>remote end</a> must run the
    following steps:

      <ol>
        <li><p>If the <a>current browsing context</a> is <a>no longer open</a>,
            return <a>error</a> with <a>error code</a> <a>no such window</a>.</li>

        <li><p>Let <var>actions</var> be the result of getting a
            property from <var>parameters</var> named <code>actions</code>.</li>

        <li><p>If <var>actions</var> is <a>undefined</a> or
            is not an <a>Array</a>, return <a>error</a> with <a>error
            code</a> <a>invalid argument</a>.</li>

        <!-- TODO: not sure if reusing the ES definition of List works here-->
        <li><p>Let <var>actions by tick</var> be an
        empty <a>List</a>.</li>

        <li><p>For each value <var>action sequence</var> corresponding
        to an indexed property in <var>actions</var>:

          <ol>
            <li><p>Let <var>input source actions</var> be the result
                  of <a>trying</a> to <a>process a input source action
                  sequence</a> with argument <var>action sequence</var>.</li>

            <li><p>For each <var>action</var> in <var>input source actions</var>:

                <ol>
                  <li><p>Let <var>i</var> be the zero-based index
                      of <var>action</var> in <var>input source
                      actions</var>.</li>

                  <li><p>If the length of <var>actions by tick</var>
                  is less than <var>i + 1</var>, append a
                  new <a>List</a> to <var>actions by tick</var>.</li>

                  <li><p>Append <var>action</var> to the <a>List</a>
                  at index <var>i</var> in <var>actions by
                  tick</var>.</li>

                </ol></li>
        </ol></li>

        <li><p>Return <a>success</a> with data <var>actions by
        tick</var>.</li>
      </ol>

    <p>When required to <dfn>process a input source action sequence</dfn>, with
      argument <var>action sequence</var>, a <a>remote end</a> must run the
      following steps:

      <ol>
        <li><p>Let <var>type</var> be the result of <a>getting a property</a>
        named <code>type</code> from <var>actions sequence</var>.</li>

        <li><p>If <var>type</var> is
            not <code>"key"</code>, <code>"pointer"</code>,
            or <code>"none"</code>, return an <a>error</a> with
            <a>error code</a> <a>invalid argument</a>.</li>

        <li><p>Let <var>id</var> be the result of <a>getting a
        property</a> named <code>id</code> from <var>actions
        sequence</var>.</li>

        <!-- TODO: consider picking the current input of the right
        type if one exists -->
        <li><p>If <var>id</var> is <a>undefined</a>
            let <var>id</var> be a new <a>UUID</a>. Otherwise
            if <var>id</var> is not a <a>String</a> return <a>error</a>
            with <a>error code</a> <a>invalid argument</a>.</li>

        <li><p>Let <var>action items</var> be the result
            of <a>gettting a property</a> named <code>actions</code>
            from <var>action sequence</var>.</li>

        <li><p>If <var>action items</var> is not an <a>Array</a>,
            return <a>error</a> with <a>error code</a> <a>invalid argument</a>.</li>

        <li><p>If <var>type</var> is equal to <code>"pointer"</code>,
            let <var>parameters data</var> be the result of getting a
            property named <var>parameters</var>
            from <var>action</var>. Then let <var>parameters</var> be
            the result of <a>trying</a> to <a>process pointer
            parameters</a> with argument <var>parameters
            data</var>.</li>

        <li><p>If the <a>current session</a>'s <a>input state</a>
            already has an entry corresponding to <a>input
            id</a> <var>id</var> and that entry has a type different
            to the <a>corresponding input state type</a>
            for <var>type</var>, then return <a>error</a> with
            <a>error code</a> <a>invalid argument</a>.</li>

        <li><p>Let <var>actions</var> be a new list.</li>

        <li><p>For each <var>action item</var> in <var>action
        items</var>:
            <ol>
              <li><p>If <var>action item</var> is not an <a>Object</a>
                  return <a>error</a> with <a>error
                  code</a> <a>invalid argument</a>.</li>

              <li><p>If <var>type</var> is <code>"none"</code>
                let <var>action</var> be the result of <a>trying</a>
                to <a>process a null action</a> with
                parameters <var>id</var>, and <var>action item</var>.</li>

              <li><p>Otherwise, if <var>type</var> is <code>"key"</code>
                let <var>action</var> be the result of <a>trying</a>
                to <a>process a key action</a> with
                parameters <var>id</var>, and <var>action item</var>.</li>

              <li><p>Otherwise, if <var>type</var>
                is <code>"pointer"</code> let <var>action</var> be the
                result of <a>trying</a> to <a>process a pointer
                action</a> with parameters <var>id</var>, <var>parameters</var>,
                and <var>action item</var>.</li>

              <li><p>Append <var>action</var> to <var>actions</var>.</li>
            </ol>
        </li>

        <li><p>Return <a>success</a> with data <var>actions</var>.

      </ol>

    <p>The <dfn>default pointer parameters</dfn> consist of an object
    with property <code>pointerType</code> set to <code>mouse</code>
    and <code>primary</code> set to <code>true</code>.

    <p>When required to <dfn>process pointer parameters</dfn> with
    argument <var>parameters data</var>, a <a>remote end</a> must perform the
    following steps:</p>

    <ol>
      <li><p>Let <var>parameters</var> be the <a>default pointer
            parameters</a>.</li>

      <li><p>If <var>parameters data</var> is <a>undefined</a>,
            return <a>success</a> with data <var>parameters</var>.</li>

      <li><p>If <var>parameters data</var> is not an <a>Object</a>
          return <a>error</a> with <a>error code</a> <a>invalid argument</a>.</li>

      <li><p>Let <var>pointer type</var> be the result of <a>getting
            a property</a> named <code>pointerType</code>
          from <var>parameters data</var>.</li>

      <li><p>If <var>pointer type</var> is not <a>undefined</a>:
          <ol>
            <li><p>If <var>pointer type</var> does not have one of the
                values <code>"mouse"</code>, <code>"pen"</code>,
                or <code>"touch"</code> return <a>error</a> with
                <a>error code</a> <a>invalid argument</a>.</li>

            <li><p>Set the <code>pointerType</code> property
            of <var>parameters</var> to <var>pointer type</var>.</li>
          </ol>
      </li>

      <li><p>Let <var>primary</var> be the result of getting a
      property named <code>primary</code> from <var>parameters
      data</var>.</li>

      <li><p>If <var>primary</var> is not <a>undefined</a>:
          <ol>
            <li><p>If <var>primary</var> is not a <a>Boolean</a>
                return <a>error</a> with <a>error code</a> <a>invalid
                argument</a>.</li>

            <li><p>Set the <code>primary</code> property
            of <var>parameters</var> to <var>primary</var>.</li>
          </ol>
      </li>

      <li><p>Return <a>success</a> with data <var>primary</var>.</li>

    </ol>

    <p>A <dfn>action object</dfn> constructed with
      arguments <var>id</var>, <var>type</var>, and <var>subtype</var>
      is an object with property <code>id</code> set to <var>id</var>,
      <code>type</code> set to <var>type</var>
      and <code>subtype</code> set to <var>subtype</var>. Specific
      action objects have further properties added by other algorithms
      in this specification.

    <p>When required to <dfn>process a null action</dfn> with
    arguments <var>id</var> and <var>action item</var>, a <a>remote end</a>
    must perform the following steps:</p>

    <ol>
      <li><p>Let <var>subtype</var> be the result of getting a property
          named <code>type</code> from <var>action item</var>.</li>

      <li><p>If <var>subtype</var> is not <code>"pause"</code>
          return <a>error</a> with <a>error code</a> <a>invalid argument</a>.</li>

      <li><p>Let <var>action</var> be an <a>action object</a>
          constructed with arguments <var>id</var>,
          <code>"none"</code>, and <var>subtype</var>.</li>

      <li><p>Let <var>result</var> be the result of <a>trying</a>
          to <a>process a pause action</a> with arguments <var>action
          item</var>, and <var>action object</var>.</li>

      <li><p>Return <var>result</var>.</li>

    </ol>

    <p>When required to <dfn>process a key action</dfn> with
    arguments <var>id</var> and <var>action item</var>, a <a>remote end</a>
    must perform the following steps:</p>

    <ol>
      <li><p>Let <var>subtype</var> be the result of getting a property
          named <code>type</code> from <var>action item</var>.</li>

      <li><p>If <var>subtype</var> is not one of the
          values <code>"keyUp"</code>, <code>"keyDown"</code>,
          or <code>"pause"</code>, return an <a>error</a> with
          <a>error code</a> <a>invalid argument</a>.</li>

      <li><p>Let <var>action</var> be an <a>action object</a>
          constructed with arguments <var>id</var>,
          <code>"key"</code>, and <var>subtype</var>.</li>

      <li><p>If <var>subtype</var> is <code>"pause"</code>;
          let <var>result</var> be the result of <a>trying</a> to
          <a>process a pause action</a> with arguments <var>action
          item</var>, and <var>action object</var>, and
          return <var>result</var>.</li>

      <li><p>Let <var>key</var> be the result of getting a property
      named <code>value</code> from <var>action item</var>.</li>

      <li><p>If <var>key</var> is not a <a>String</a> containing a
          single unicode codepoint <span class="issue">or grapheme
          cluster?</span> return <a>error</a> with <a>error
          code</a> <a>invalid argument</a>.</li>

      <li><p>Set the <code>value</code> property on <var>action</var>
      to <var>key</var>.</li>

      <li><p>Return success with data <var>action</var>.</li>

    </ol>

    <p>When required to <dfn>process a pointer action</dfn> with
    arguments <var>id</var>, <var>parameters</var>, and <var>action
    item</var>, a <a>remote end</a> must perform the following steps:</p>

    <ol>
      <li><p>Let <var>subtype</var> be the result of getting a property
          named <code>type</code> from <var>action item</var>.</li>

      <li><p>If <var>subtype</var> is not one of the
          values <code>pause</code>, <code>"pointerUp"</code>,
          <code>"pointerDown"</code>, <code>"pointerMove"</code>,
          or <code>"pointerCancel"</code> return an <a>error</a> with
          <a>error code</a> <a>invalid argument</a>.</li>

      <li><p>If the <a>current session</a>'s <a>input state</a>
          already has an entry corresponding to <a>input
          id</a> <var>id</var> and that entry has
          a <code>subtype</code> property with value different
          to <var>subtype</var> return <a>error</a> with
          <a>error code</a> <a>invalid argument</a>.</li>

      <li><p>Let <var>action</var> be an <a>action object</a>
          constructed with arguments <var>id</var>,
          <code>"pointer"</code>, and <var>subtype</var>.</li>

      <li><p>If <var>subtype</var> is <code>"pause"</code>;
          let <var>result</var> be the result of <a>trying</a> to
          <a>process a pause action</a> with arguments <var>action
          item</var>, and <var>action object</var>, and
          return <var>result</var>.</li>

      <li><p>Set the <code>pointerType</code> property
          of <var>action</var> equal to the <code>pointerType</code>
          property of <var>parameters</var>.</li>

      <li><p>Set the <code>primary</code> property
          of <var>action</var> equal to the <code>primary</code>
          property of <var>parameters</var>.</li>

      <li><p>If <var>subtype</var> is <code>"pointerUp"</code>
            or <code>"pointerDown"</code>, <a>process a pointer up or
            pointer down action</a> with arguments <var>action
            item</var>, and <var>action</var>. If doing so results in
            an <a>error</a>, return that error.</li>

      <li><p>If <var>subtype</var>
            is <code>"pointerMove"</code> <a>process a pointer move
            action</a> with arguments <var>action item</var>,
            and <var>action</var>. If doing so results in an <a>error</a>,
            return that error</li>

      <li><p>Return <a>success</a> with data <var>action</var>.</li>

    </ol>

    <p>When required to <dfn>process a pause action</dfn> with
      arguments <var>action item</var>, and <var>action</var>, a <a>remote
      end</a> must run the following steps:</p>

    <ol>
      <li><p>Let <var>duration</var> be the result of getting a
          property named <code>duration</code> from <var>action
            item</var>.</li>

      <li><p>If <var>duration</var> is not an <a>Integer</a> greater
          than or equal to 0 return <a>error</a> with <a>error
          code</a> <a>invalid argument</a>.</li>

      <li><p>Set the <code>duration</code> property
          of <var>action</var> to <var>duration</var>.</li>

      <li><p>Return success with data null</li>
    </ol>

    <p>When required to <dfn>process a pointer up or pointer down
        action</dfn> with arguments <var>action item</var>,
        and <var>action</var>, a <a>remote end</a> must run the following
        steps:</p>

    <ol>
      <li><p>Let <var>button</var> be the result of getting a
          property named <code>button</code> from <var>action
            item</var>.</li>

      <li><p>If <var>button</var> is not an <a>Integer</a> greater
          than or equal to 0 return <a>error</a> with <a>error
          code</a> <a>invalid argument</a>.</li>

      <li><p>Set the <code>button</code> property
          of <var>action</var> to <var>button</var>.</li>

      <li><p>Return success with data null</li>
    </ol>

    <p>When required to <dfn>process a pointer move action</dfn> with
      arguments <var>action item</var>, and <var>action</var>, a <a>remote
      end</a> must run the following steps:</p>

    <ol>
      <li><p>Let <var>duration</var> be the result of getting a
          property named <code>duration</code> from <var>action
          item</var>.</li>

      <li><p>If <var>duration</var> is not an <a>Integer</a> greater
          than or equal to 0 return <a>error</a> with <a>error
          code</a> <a>invalid argument</a>.</li>

      <li><p>Set the <code>duration</code> property
          of <var>action</var> to <var>duration</var>.</li>

      <li><p>Let <var>element</var> be the result of getting a
          property named <code>element</code> from <var>action
            item</var>.</li>

      <li><p>If <var>element</var> is not <a>undefined</a>
          and <var>element</var> does is not an <a>Object</a>
          that <a>represents a web element</a>, return <a>error</a> with
          <a>error code</a> <a>invalid argument</a>.</li>

      <li><p>Set the <code>element</code> property
          of <var>action</var> to <var>element</var>.</li>

      <li><p>Let <var>x</var> be the result of getting a
          property named <code>x</code> from <var>action
            item</var>.</li>

      <li><p>If <var>x</var> is not <a>undefined</a> or is not
          an <a>Integer</a> greater than or equal to 0,
          return <a>error</a> with
          <a>error code</a> <a>invalid argument</a>.</li>

      <li><p>Set the <code>x</code> property
          of <var>action</var> to <var>x</var>.</li>

      <li><p>Let <var>y</var> be the result of getting a
          property named <code>y</code> from <var>action
            item</var>.</li>

      <li><p>If <var>y</var> is not <a>undefined</a> or is not
          an <a>Integer</a> greater than or equal to 0,
          return <a>error</a> with
          <a>error code</a> <a>invalid argument</a>.</li>

      <li><p>Set the <code>y</code> property
          of <var>action</var> to <var>y</var>.</li>

      <li><p>Return success with data null.</li>
    </ol>
  </section><!-- /Processing Actions Requests -->

  <section> <!-- Dispatching Actions -->
    <h2>Dispatching Actions</h2>
    <p>The algorithm to <a>dispatch actions</a> takes a list of
    actions grouped by <a>tick</a>, and then causes each action to be
    run at the appropriate point in the sequence.

    <p>When asked to <dfn>dispatch actions</dfn> with
    argument <var>actions by tick</var>, a <a>remote end</a> must run the
    following steps:</p>

    <ol>
      <li><p>For each item <var>tick actions</var> in <var>actions by
      tick</var>:
          <ol>
            <li><p>Let <var>tick duration</var> be the result
            of <a>computing the tick duration</a> with
            argument <var>tick actions</var>.</li>

            <li><p><a>Dispatch tick actions</a> with
            arguments <var>tick actions</var> and <var>tick
            duration</var>. If this results in an <a>error</a> return
            that error.</li>

            <li><p>Wait until the following conditions are all met:

                <ul>
                  <li><p>There are no pending <a>asynchronous
                  waits</a> arising from the last invocation of
                  the <a>dispatch tick actions</a> steps.</li>

                  <li><p>The user agent event loop has spun enough
                   times to process the DOM events generated by the
                   last invocation of the <a>dispatch tick
                   actions</a> steps.</li>

                  <li><p>At least <var>tick duration</var>
                      milliseconds have passed.</li>
                </ul>
            </li>
          </ol>
      </li>

      <li><p>Return success with data null.</li>
    </ol>

    <p>When required to
      <dfn data-lt="computing the tick duration">compute the tick
        duration</dfn> with argument <var>tick actions</var>,
        a <a>remote end</a> must take the following steps:</p>

    <ol>
      <li><p>Let <var>max duration</var> be 0.</li>

      <li><p>For each <var>action object</var> in <var>tick actions</var>:
          <ol>
            <li><p>let <var>duration</var> be <a>undefined</a>.</li>

            <li><p>If <var>action object</var> has <code>type</code>
                property set to <code>"none"</code>
                and <code>subtype</code> property set
                to <code>"pause"</code> or <var>action object</var>
                has <code>type</code> property set
                to <code>"pointer"</code> and <code>subtype</code>
                property set to <code>"pointerMove"</code>,
                let <var>duration</var> be equal to
                the <code>duration</code> property of <var>action
                object</var>.</li>

            <li><p>If <var>duration</var> is not <a>undefined</a>, and
                <var>duration</var> is greater than <var>max
                duration</var> let <var>max duration</var> be equal to
                duration.</li>
          </ol>
      </li>

      <li><p>Return <var>max duration</var>.</li>

    </ol>

    <p>When required to <dfn>dispatch tick actions</dfn> with
    arguments <var>tick actions</var> and <var>tick duration</var>,
    a <a>remote end</a> must run the following steps:</p>

    <ol>
      <li><p>For each <var>action object</var> in <var>tick actions</var>:
          <ol>

            <li><p>Let <var>source id</var> be equal to the value
                of <var>action object</var>'s <code>id</code>
                property.</li>

            <li><p>Let <var>source type</var> be equal to the value
                of <var>action object</var>'s <code>type</code>
                property.</li>

            <!-- TODO: this next bit doesn't really link to the right
            point in the spec for creating objects of the right type -->

            <li><p>If the <a>current session</a>'s <a>input
                state</a> doesn't have a property corresponding
                to <var>source id</var>, then let the property
                corresponding to <var>source id</var> be a new
                object of the <a>corresponding input state type</a>
                for <var>source type</var>.

            <li><p>Let <var>device state</var> be the device state
                corresponding to <var>source id</var> in
                the <a>current session</a>'s <a>input state</a>
                object.</li>

            <li><p>Let <var>algorithm</var> be the algorithm in the
                right hand column of the table below such that the
                value in the first column matches <var>source
                type</var> and the value in the second column
                matches <var>action
                object</var>'s <code>subtype</code> property.</p>

              <table class=simple>
                <tr>
                  <td><code>"none"</code>
                  <td><code>"pause"</code>
                  <td><a>Dispatch a pause action</a>
                </tr>
                <tr>
                  <td><code>"key"</code>
                  <td><code>"pause"</code>
                  <td><a>Dispatch a pause action</a>
                </tr>
                <tr>
                  <td><code>"key"</code>
                  <td><code>"keyDown"</code>
                  <td><a>Dispatch a keyDown action</a>
                </tr>
                <tr>
                  <td><code>"key"</code>
                  <td><code>"keyUp"</code>
                  <td><a>Dispatch a keyUp action</a>
                </tr>
                <tr>
                  <td><code>"pointer"</code>
                  <td><code>"pause"</code>
                  <td><a>Dispatch a pause action</a>
                </tr>
                <tr>
                  <td><code>"pointer"</code>
                  <td><code>"pointerDown"</code>
                  <td><a>Dispatch a pointerDown action</a>
                </tr>
                <tr>
                  <td><code>"pointer"</code>
                  <td><code>"pointerUp"</code>
                  <td><a>Dispatch a pointerUp action</a>
                </tr>
                <tr>
                  <td><code>"pointer"</code>
                  <td><code>"pointerMove"</code>
                  <td><a>Dispatch a pointerMove action</a>
                </tr>
                <tr>
                  <td><code>"pointer"</code>
                  <td><code>"pointerCancel"</code>
                  <td><a>Dispatch a pointerCancel action</a>
                </tr>
              </table>
            </li>
          </ol>

          <li><p>Return the result of running <var>algorithm</var>
              with arguments <var>source id</var>, <var>action
              object</var>, <var>device state</var> and <var>tick
              duration</var></li>

    </ol>

    <section> <!-- General Actions -->
      <h2>General Actions</h2>
      <p>When required to <dfn>dispatch a pause action</dfn> with
        arguments <var>source id</var>, <var>action
        object</var>, <var>input state</var> and <var>tick
        duration</var> a <a>remote end</a> must run the following
        steps:</p>

      <ol>
        <li><p>Return <a>success</a> with data null.</li>
      </ol>
    </section> <!-- /General Actions -->

    <section> <!-- Keyboard Actions -->
      <h2>Keyboard Actions</h2>

      <p>The <dfn>normalised key value</dfn> for a raw
        key <var>key</var> is, if <var>key</var> appears in the table
        below, the string value in the second column on the row
        containing <var>key</var>'s unicode codepoint in the first
        column, otherwise it is <var>key</var>.

        <table class=simple>
          <tr>
            <th><var>key</var>'s codepoint
            <th>Normalised key value
          </tr>
          <tr><td><code>\uE000</code></td><td><code>"Unidentified"</code></td></tr>
          <tr><td><code>\uE001</code></td><td><code>"Cancel"</code></td></tr>
          <tr><td><code>\uE002</code></td><td><code>"Help"</code></td></tr>
          <tr><td><code>\uE003</code></td><td><code>"Backspace"</code></td></tr>
          <tr><td><code>\uE004</code></td><td><code>"Tab"</code></td></tr>
          <tr><td><code>\uE005</code></td><td><code>"Clear"</code></td></tr>
          <tr><td><code>\uE006</code></td><td><code>"Return"</code></td></tr>
          <tr><td><code>\uE007</code></td><td><code>"Enter"</code></td></tr>
          <tr><td><code>\uE008</code></td><td><code>"Shift"</code></td></tr>
          <tr><td><code>\uE009</code></td><td><code>"Control"</code></td></tr>
          <tr><td><code>\uE00A</code></td><td><code>"Alt"</code></td></tr>
          <tr><td><code>\uE00B</code></td><td><code>"Pause"</code></td></tr>
          <tr><td><code>\uE00C</code></td><td><code>"Escape"</code></td></tr>
          <tr><td><code>\uE00D</code></td><td><code>" "</code></td></tr>
          <tr><td><code>\uE00E</code></td><td><code>"PageUp"</code></td></tr>
          <tr><td><code>\uE00F</code></td><td><code>"PageDown"</code></td></tr>
          <tr><td><code>\uE010</code></td><td><code>"End"</code></td></tr>
          <tr><td><code>\uE011</code></td><td><code>"Home"</code></td></tr>
          <tr><td><code>\uE012</code></td><td><code>"ArrowLeft"</code></td></tr>
          <tr><td><code>\uE013</code></td><td><code>"ArrowUp"</code></td></tr>
          <tr><td><code>\uE014</code></td><td><code>"ArrowRight"</code></td></tr>
          <tr><td><code>\uE015</code></td><td><code>"ArrowDown"</code></td></tr>
          <tr><td><code>\uE016</code></td><td><code>"Insert"</code></td></tr>
          <tr><td><code>\uE017</code></td><td><code>"Delete"</code></td></tr>
          <tr><td><code>\uE018</code></td><td><code>";"</code></td></tr>
          <tr><td><code>\uE019</code></td><td><code>"="</code></td></tr>
          <tr><td><code>\uE01A</code></td><td><code>"0"</code></td></tr>
          <tr><td><code>\uE01B</code></td><td><code>"1"</code></td></tr>
          <tr><td><code>\uE01C</code></td><td><code>"2"</code></td></tr>
          <tr><td><code>\uE01D</code></td><td><code>"3"</code></td></tr>
          <tr><td><code>\uE01E</code></td><td><code>"4"</code></td></tr>
          <tr><td><code>\uE01F</code></td><td><code>"5"</code></td></tr>
          <tr><td><code>\uE020</code></td><td><code>"6"</code></td></tr>
          <tr><td><code>\uE021</code></td><td><code>"7"</code></td></tr>
          <tr><td><code>\uE022</code></td><td><code>"8"</code></td></tr>
          <tr><td><code>\uE023</code></td><td><code>"9"</code></td></tr>
          <tr><td><code>\uE024</code></td><td><code>"*"</code></td></tr>
          <tr><td><code>\uE025</code></td><td><code>"+"</code></td></tr>
          <tr><td><code>\uE026</code></td><td><code>","</code></td></tr>
          <tr><td><code>\uE027</code></td><td><code>"-"</code></td></tr>
          <tr><td><code>\uE028</code></td><td><code>"."</code></td></tr>
          <tr><td><code>\uE029</code></td><td><code>"/"</code></td></tr>
          <tr><td><code>\uE031</code></td><td><code>"F1"</code></td></tr>
          <tr><td><code>\uE032</code></td><td><code>"F2"</code></td></tr>
          <tr><td><code>\uE033</code></td><td><code>"F3"</code></td></tr>
          <tr><td><code>\uE034</code></td><td><code>"F4"</code></td></tr>
          <tr><td><code>\uE035</code></td><td><code>"F5"</code></td></tr>
          <tr><td><code>\uE036</code></td><td><code>"F6"</code></td></tr>
          <tr><td><code>\uE037</code></td><td><code>"F7"</code></td></tr>
          <tr><td><code>\uE038</code></td><td><code>"F8"</code></td></tr>
          <tr><td><code>\uE039</code></td><td><code>"F9"</code></td></tr>
          <tr><td><code>\uE03A</code></td><td><code>"F10"</code></td></tr>
          <tr><td><code>\uE03B</code></td><td><code>"F11"</code></td></tr>
          <tr><td><code>\uE03C</code></td><td><code>"F12"</code></td></tr>
          <tr><td><code>\uE03D</code></td><td><code>"Meta"</code></td></tr>
          <tr><td><code>\uE040</code></td><td><code>"ZenkakuHankaku"</code></td></tr>
          <!-- Right position variants -->
          <tr><td><code>\uE050</code></td><td><code>"Shift"</code></td></tr>
          <tr><td><code>\uE051</code></td><td><code>"Control"</code></td></tr>
          <tr><td><code>\uE052</code></td><td><code>"Alt"</code></td></tr>
          <tr><td><code>\uE053</code></td><td><code>"Meta"</code></td></tr>
          <!-- Numpad Variants -->
          <tr><td><code>\uE054</code></td><td><code>"PageUp"</code></td></tr>
          <tr><td><code>\uE055</code></td><td><code>"PageDown"</code></td></tr>
          <tr><td><code>\uE056</code></td><td><code>"End"</code></td></tr>
          <tr><td><code>\uE057</code></td><td><code>"Home"</code></td></tr>
          <tr><td><code>\uE058</code></td><td><code>"ArrowLeft"</code></td></tr>
          <tr><td><code>\uE059</code></td><td><code>"ArrowUp"</code></td></tr>
          <tr><td><code>\uE05A</code></td><td><code>"ArrowRight"</code></td></tr>
          <tr><td><code>\uE05B</code></td><td><code>"ArrowDown"</code></td></tr>
          <tr><td><code>\uE05C</code></td><td><code>"Insert"</code></td></tr>
          <tr><td><code>\uE05D</code></td><td><code>"Delete"</code></td></tr>
        </table>

      <p>The <dfn>code</dfn> for <var>key</var> is the value in the
      last column of the following table on the row with <var>key</var> in
      either the first or second column, if any such row exists,
      otherwise it is <code>undefined</code>.

        <!-- TODO This should perhaps return undefined when the shift
        key doesn't match the requirement for producing the character?
        -->

        <table class=simple>
          <tr>
            <th>Key
            <th>Alternate Key
            <th>code
          </tr>
          <tr><td><code>"`"</code></td><td><code>"~"</code></td><td><code>"Backquote"</code></td></tr>
          <tr><td><code>"\"</code></td><td><code>"|"</code></td><td><code>"Backslash"</code></td></tr>
          <tr><td><code>"\uE003"</code></td><td><code></code></td><td><code>"Backspace"</code></td></tr>
          <tr><td><code>"["</code></td><td><code>"{"</code></td><td><code>"BracketLeft"</code></td></tr>
          <tr><td><code>"}"</code></td><td><code>"]"</code></td><td><code>"BracketRight"</code></td></tr>
          <tr><td><code>","</code></td><td><code>"&lt;"</code></td><td><code>"Comma"</code></td></tr>
          <tr><td><code>"0"</code></td><td><code>")"</code></td><td><code>"Digit0"</code></td></tr>
          <tr><td><code>"1"</code></td><td><code>"!"</code></td><td><code>"Digit1"</code></td></tr>
          <tr><td><code>"2"</code></td><td><code>"@"</code></td><td><code>"Digit2"</code></td></tr>
          <tr><td><code>"3"</code></td><td><code>"#"</code></td><td><code>"Digit3"</code></td></tr>
          <tr><td><code>"4"</code></td><td><code>"$"</code></td><td><code>"Digit4"</code></td></tr>
          <tr><td><code>"5"</code></td><td><code>"%"</code></td><td><code>"Digit5"</code></td></tr>
          <tr><td><code>"6"</code></td><td><code>"^"</code></td><td><code>"Digit6"</code></td></tr>
          <tr><td><code>"7"</code></td><td><code>"&amp;"</code></td><td><code>"Digit7"</code></td></tr>
          <tr><td><code>"8"</code></td><td><code>"*"</code></td><td><code>"Digit8"</code></td></tr>
          <tr><td><code>"9"</code></td><td><code>"("</code></td><td><code>"Digit9"</code></td></tr>
          <tr><td><code>"="</code></td><td><code>"+"</code></td><td><code>"Equal"</code></td></tr>
          <tr><td><code>"&lt;"</code></td><td><code>"&gt;"</code></td><td><code>"IntlBackslash"</code></td></tr>
          <tr><td><code>"a"</code></td><td><code>"A"</code></td><td><code>"KeyA"</code></td></tr>
          <tr><td><code>"b"</code></td><td><code>"B"</code></td><td><code>"KeyB"</code></td></tr>
          <tr><td><code>"c"</code></td><td><code>"C"</code></td><td><code>"KeyC"</code></td></tr>
          <tr><td><code>"d"</code></td><td><code>"D"</code></td><td><code>"KeyD"</code></td></tr>
          <tr><td><code>"e"</code></td><td><code>"E"</code></td><td><code>"KeyE"</code></td></tr>
          <tr><td><code>"f"</code></td><td><code>"F"</code></td><td><code>"KeyF"</code></td></tr>
          <tr><td><code>"g"</code></td><td><code>"G"</code></td><td><code>"KeyG"</code></td></tr>
          <tr><td><code>"h"</code></td><td><code>"H"</code></td><td><code>"KeyH"</code></td></tr>
          <tr><td><code>"i"</code></td><td><code>"I"</code></td><td><code>"KeyI"</code></td></tr>
          <tr><td><code>"j"</code></td><td><code>"J"</code></td><td><code>"KeyJ"</code></td></tr>
          <tr><td><code>"k"</code></td><td><code>"K"</code></td><td><code>"KeyK"</code></td></tr>
          <tr><td><code>"l"</code></td><td><code>"L"</code></td><td><code>"KeyL"</code></td></tr>
          <tr><td><code>"m"</code></td><td><code>"M"</code></td><td><code>"KeyM"</code></td></tr>
          <tr><td><code>"n"</code></td><td><code>"N"</code></td><td><code>"KeyN"</code></td></tr>
          <tr><td><code>"o"</code></td><td><code>"O"</code></td><td><code>"KeyO"</code></td></tr>
          <tr><td><code>"p"</code></td><td><code>"P"</code></td><td><code>"KeyP"</code></td></tr>
          <tr><td><code>"q"</code></td><td><code>"Q"</code></td><td><code>"KeyQ"</code></td></tr>
          <tr><td><code>"r"</code></td><td><code>"R"</code></td><td><code>"KeyR"</code></td></tr>
          <tr><td><code>"s"</code></td><td><code>"S"</code></td><td><code>"KeyS"</code></td></tr>
          <tr><td><code>"t"</code></td><td><code>"T"</code></td><td><code>"KeyT"</code></td></tr>
          <tr><td><code>"u"</code></td><td><code>"U"</code></td><td><code>"KeyU"</code></td></tr>
          <tr><td><code>"v"</code></td><td><code>"V"</code></td><td><code>"KeyV"</code></td></tr>
          <tr><td><code>"w"</code></td><td><code>"W"</code></td><td><code>"KeyW"</code></td></tr>
          <tr><td><code>"x"</code></td><td><code>"X"</code></td><td><code>"KeyX"</code></td></tr>
          <tr><td><code>"y"</code></td><td><code>"Y"</code></td><td><code>"KeyY"</code></td></tr>
          <tr><td><code>"z"</code></td><td><code>"Z"</code></td><td><code>"KeyZ"</code></td></tr>
          <tr><td><code>"-"</code></td><td><code>"_"</code></td><td><code>"Minus"</code></td></tr>
          <tr><td><code>"."</code></td><td><code>">"</code></td><td><code>"Period"</code></td></tr>
          <tr><td><code>"'"</code></td><td><code>"&quot;"</code></td><td><code>"Quote"</code></td></tr>
          <tr><td><code>";"</code></td><td><code>":"</code></td><td><code>"Semicolon"</code></td></tr>
          <tr><td><code>"/"</code></td><td><code>"?"</code></td><td><code>"Slash"</code></td></tr>
          <tr><td><code>"\uE00A"</code></td><td><code></code></td><td><code>"AltLeft"</code></td></tr>
          <tr><td><code>"\uE052"</code></td><td><code></code></td><td><code>"AltRight"</code></td></tr>
          <tr><td><code>"\uE009"</code></td><td><code></code></td><td><code>"ControlLeft"</code></td></tr>
          <tr><td><code>"\uE051"</code></td><td><code></code></td><td><code>"ControlRight"</code></td></tr>
          <tr><td><code>"\uE006"</code></td><td><code></code></td><td><code>"Enter"</code></td></tr>
          <tr><td><code>"\uE03D"</code></td><td><code></code></td><td><code>"OSLeft"</code></td></tr>
          <tr><td><code>"\uE053"</code></td><td><code></code></td><td><code>"OSRight"</code></td></tr>
          <tr><td><code>"\uE008"</code></td><td><code></code></td><td><code>"ShiftLeft"</code></td></tr>
          <tr><td><code>"\uE050"</code></td><td><code></code></td><td><code>"ShiftRight"</code></td></tr>
          <tr><td><code>" "</code></td><td><code>"\uE00D"</code></td><td><code>"Space"</code></td></tr>
          <tr><td><code>"\uE004"</code></td><td><code></code></td><td><code>"Tab"</code></td></tr>
          <tr><td><code>"\uE017"</code></td><td><code></code></td><td><code>"Delete"</code></td></tr>
          <tr><td><code>"\uE010"</code></td><td><code></code></td><td><code>"End"</code></td></tr>
          <tr><td><code>"\uE002"</code></td><td><code></code></td><td><code>"Help"</code></td></tr>
          <tr><td><code>"\uE011"</code></td><td><code></code></td><td><code>"Home"</code></td></tr>
          <tr><td><code>"\uE016"</code></td><td><code></code></td><td><code>"Insert"</code></td></tr>
          <tr><td><code>"\uE01E"</code></td><td><code></code></td><td><code>"PageDown"</code></td></tr>
          <tr><td><code>"\uE01F"</code></td><td><code></code></td><td><code>"PageUp"</code></td></tr>
          <tr><td><code>"\uE015"</code></td><td><code></code></td><td><code>"ArrowDown"</code></td></tr>
          <tr><td><code>"\uE012"</code></td><td><code></code></td><td><code>"ArrowLeft"</code></td></tr>
          <tr><td><code>"\uE014"</code></td><td><code></code></td><td><code>"ArrowRight"</code></td></tr>
          <tr><td><code>"\uE013"</code></td><td><code></code></td><td><code>"ArrowUp"</code></td></tr>
          <tr><td><code>"\uE00C"</code></td><td><code></code></td><td><code>"Escape"</code></td></tr>
          <tr><td><code>"\uE031"</code></td><td><code></code></td><td><code>"F1"</code></td></tr>
          <tr><td><code>"\uE032"</code></td><td><code></code></td><td><code>"F2"</code></td></tr>
          <tr><td><code>"\uE033"</code></td><td><code></code></td><td><code>"F3"</code></td></tr>
          <tr><td><code>"\uE034"</code></td><td><code></code></td><td><code>"F4"</code></td></tr>
          <tr><td><code>"\uE035"</code></td><td><code></code></td><td><code>"F5"</code></td></tr>
          <tr><td><code>"\uE036"</code></td><td><code></code></td><td><code>"F6"</code></td></tr>
          <tr><td><code>"\uE037"</code></td><td><code></code></td><td><code>"F7"</code></td></tr>
          <tr><td><code>"\uE038"</code></td><td><code></code></td><td><code>"F8"</code></td></tr>
          <tr><td><code>"\uE039"</code></td><td><code></code></td><td><code>"F9"</code></td></tr>
          <tr><td><code>"\uE03A"</code></td><td><code></code></td><td><code>"F10"</code></td></tr>
          <tr><td><code>"\uE03B"</code></td><td><code></code></td><td><code>"F11"</code></td></tr>
          <tr><td><code>"\uE03C"</code></td><td><code></code></td><td><code>"F12"</code></td></tr>
          <tr><td><code>"\uE01A"</code></td><td><code>"\uE05C"</code></td><td><code>"Numpad0"</code></td></tr>
          <tr><td><code>"\uE01B"</code></td><td><code>"\uE056"</code></td><td><code>"Numpad1"</code></td></tr>
          <tr><td><code>"\uE01C"</code></td><td><code>"\uE05B"</code></td><td><code>"Numpad2"</code></td></tr>
          <tr><td><code>"\uE01D"</code></td><td><code>"\uE055"</code></td><td><code>"Numpad3"</code></td></tr>
          <tr><td><code>"\uE01E"</code></td><td><code>"\uE058"</code></td><td><code>"Numpad4"</code></td></tr>
          <tr><td><code>"\uE01F"</code></td><td><code></code></td><td><code>"Numpad5"</code></td></tr>
          <tr><td><code>"\uE020"</code></td><td><code>"\uE05A"</code></td><td><code>"Numpad6"</code></td></tr>
          <tr><td><code>"\uE021"</code></td><td><code>"\uE057"</code></td><td><code>"Numpad7"</code></td></tr>
          <tr><td><code>"\uE022"</code></td><td><code>"\uE059"</code></td><td><code>"Numpad8"</code></td></tr>
          <tr><td><code>"\uE023"</code></td><td><code>"\uE054"</code></td><td><code>"Numpad9"</code></td></tr>
          <tr><td><code>"\uE024"</code></td><td><code></code></td><td><code>"NumpadAdd"</code></td></tr>
          <tr><td><code>"\uE026"</code></td><td><code></code></td><td><code>"NumpadComma"</code></td></tr>
          <tr><td><code>"\uE028"</code></td><td><code>"\uE05D"</code></td><td><code>"NumpadDecimal"</code></td></tr>
          <tr><td><code>"\uE029"</code></td><td><code></code></td><td><code>"NumpadDivide"</code></td></tr>
          <tr><td><code>"\uE007"</code></td><td><code></code></td><td><code>"NumpadEnter"</code></td></tr>
          <tr><td><code>"\uE024"</code></td><td><code></code></td><td><code>"NumpadMultiply"</code></td></tr>
          <tr><td><code>"\uE026"</code></td><td><code></code></td><td><code>"NumpadSubtract"</code></td></tr>
        </table>

      <p>The <dfn>key location</dfn> for <var>key</var> is the value
        in the last column in the table below on the row
        with <var>key</var> appears in the first column, if such a
        row exists, otherwise it is <code>0</code>.

        <table class=simple>
          <tr>
            <th><var>key</var>'s codepoint
            <th>Location
            <th>Description
          </tr>
          <tr><td><code>\uE007</code></td><td>Enter</td><td><code>1</code></td></tr>
          <tr><td><code>\uE008</code></td><td>Left Shift</td><td><code>1</code></td></tr>
          <tr><td><code>\uE009</code></td><td>Left Control</td><td><code>1</code></td></tr>
          <tr><td><code>\uE00A</code></td><td>Left Alt</td><td><code>1</code></td></tr>
          <tr><td><code>\uE01A</code></td><td>Numpad 0</td><td><code>3</code></td></tr>
          <tr><td><code>\uE01B</code></td><td>Numpad 1</td><td><code>3</code></td></tr>
          <tr><td><code>\uE01C</code></td><td>Numpad 2</td><td><code>3</code></td></tr>
          <tr><td><code>\uE01D</code></td><td>Numpad 3</td><td><code>3</code></td></tr>
          <tr><td><code>\uE01E</code></td><td>Numpad 4</td><td><code>3</code></td></tr>
          <tr><td><code>\uE01F</code></td><td>Numpad 5</td><td><code>3</code></td></tr>
          <tr><td><code>\uE020</code></td><td>Numpad 6</td><td><code>3</code></td></tr>
          <tr><td><code>\uE021</code></td><td>Numpad 7</td><td><code>3</code></td></tr>
          <tr><td><code>\uE022</code></td><td>Numpad 8</td><td><code>3</code></td></tr>
          <tr><td><code>\uE023</code></td><td>Numpad 9</td><td><code>3</code></td></tr>
          <tr><td><code>\uE024</code></td><td>Numpad *</td><td><code>3</code></td></tr>
          <tr><td><code>\uE025</code></td><td>Numpad +</td><td><code>3</code></td></tr>
          <tr><td><code>\uE026</code></td><td>Numpad ,</td><td><code>3</code></td></tr>
          <tr><td><code>\uE027</code></td><td>Numpad -</td><td><code>3</code></td></tr>
          <tr><td><code>\uE028</code></td><td>Numpad .</td><td><code>3</code></td></tr>
          <tr><td><code>\uE029</code></td><td>Numpad /</td><td><code>3</code></td></tr>
          <tr><td><code>\uE03D</code></td><td>Left Meta</td><td><code>1</code></td></tr>
          <!-- Right position variants -->
          <tr><td><code>\uE050</code></td><td>Right Shift</td><td><code>2</code></td></tr>
          <tr><td><code>\uE051</code></td><td>Right Control</td><td><code>2</code></td></tr>
          <tr><td><code>\uE052</code></td><td>Right
              Alt</td><td><code>2</code></td></tr>
          <tr><td><code>\uE053</code></td><td>Right Meta</td><td><code>2</code></td></tr>
          <!-- Numpad Variants -->
          <tr><td><code>\uE054</code></td><td>Numpad
              PageUp<td><code>3</code></td></tr>
          <tr><td><code>\uE055</code></td><td>Numpad
              PageDown<td><code>3</code></td></tr>
          <tr><td><code>\uE056</code></td><td>Numpad
              End<td><code>3</code></td></tr>
          <tr><td><code>\uE057</code></td><td>Numpad
              Home<td><code>3</code></td></tr>
          <tr><td><code>\uE058</code></td><td>Numpad
              ArrowLeft<td><code>3</code></td></tr>
          <tr><td><code>\uE059</code></td><td>Numpad
              ArrowUp<td><code>3</code></td></tr>
          <tr><td><code>\uE05A</code></td><td>Numpad
              ArrowRight<td><code>3</code></td></tr>
          <tr><td><code>\uE05B</code></td><td>Numpad
              ArrowDown<td><code>3</code></td></tr>
          <tr><td><code>\uE05C</code></td><td>Numpad
              Insert<td><code>3</code></td></tr>
          <tr><td><code>\uE05D</code></td><td>Numpad
              Delete<td><code>3</code></td></tr>
        </table>

      <p>When required to <dfn>dispatch a keyDown action</dfn> with
        arguments <var>source id</var>, <var>action
        object</var>, <var>input state</var> and <var>tick
        duration</var> a <a>remote end</a> must run the following
        steps:</p>

      <ol>
        <li><p>Let <var>raw key</var> be equal to <var>action
              object</var>'s <code>value</code> property.</li>

        <li><p>Let <var>key</var> be equal to the <a>normalised key
        value</a> for <var>raw key</var>.</li>

        <li><p>If the <var>input state</var>'s <code>pressed</code>
            property contains <var>key</var>, let <var>repeat</var>
            be true, otherwise let <var>repeat</var> be false.</li>

        <li><p>Let <var>code</var> be the <a>code</a>
            for <var>raw key</var>.</li>

        <li><p>Let <var>location</var> be the <a>key location</a>
            for <var>raw key</var>.</li>

        <li><p>Let <var>charCode</var>, <var>keyCode</var>
            and <var>which</var> be the implementation-specific values of
            the <code>charCode</code>, <code>keyCode</code>
            and <code>which</code> properties appropriate for a key with
            key <var>key</var> and location <var>location</var> on a 102
            key US keyboard, following the guidelines in [[!UI-EVENTS]].</li>

        <li><p>If <var>key</var> is <code>"Alt"</code>,
            let <var>device state's</var> <code>alt</code> property
            be true.</li>

        <li><p>If <var>key</var> is <code>"Shift"</code>,
            let <var>device state's</var> <code>shift</code> property
            be true.</li>

        <li><p>If <var>key</var> is <code>"Control"</code>,
            let <var>device state's</var> <code>ctrl</code> property
            be true.</li>

        <li><p>If <var>key</var> is <code>"Meta"</code>,
            let <var>device state's</var> <code>meta</code> property
            be true.</li>

        <li><p>Add <var>key</var> to the set corresponding
            to <var>input state</var>'s <code>pressed</code> property.</li>

        <li><p>Append a copy of <var>action object</var> with
        the <var>subtype</var> property changed to <var>keyUp</var>
        to <a>current session</a>'s <a>input cancel list</a>.</li>

        <li><p><a href="perform-actions">Perform
        implementation-specific action dispatch steps</a> equivalent
        to pressing a key on the keyboard in accordance with the
        requirements of [[!UI-EVENTS]], and producing at least the
        following events with the specified properties:
            <ul>
              <li><a href="https://w3c.github.io/uievents/#keydown"><code>keyDown</code></a>
              with properties:
                  <table class=simple>
                    <tr>
                      <th>Attribute</th>
                      <th>Value</th>
                    </tr>
                    <tr><td><code>key</code><td><var>key</var>
                    <tr><td><code>code</code><td><var>code</var>
                    <tr><td><code>location</code><td><var>location</var>
                    <tr><td><code>altKey</code><td><var>device
                    state</var>'s <code>alt</code> property
                    <tr><td><code>shiftKey</code><td><var>device
                    state</var>'s <code>shift</code> property
                    <tr><td><code>ctrlKey</code><td><var>device
                    state</var>'s <code>ctrl</code> property
                    <tr><td><code>metaKey</code><td><var>device
                    state</var>'s <code>meta</code> property
                    <tr><td><code>repeat</code><td><var>repeat</var>
                    <tr><td><code>isComposing</code><td><var>false</var>
                    <tr><td><code>charCode</code><td><var>charCode</var>
                    <tr><td><code>keyCode</code><td><var>keyCode</var>
                    <tr><td><code>which</code><td><var>which</var>
                  </table>
              </li>
              <li><a href="https://w3c.github.io/uievents/#keypress"><code>keyPress</code></a>,
              with properties:
                  <table class=simple>
                    <tr>
                      <th>Attribute</th>
                      <th>Value</th>
                    </tr>
                    <tr><td><code>key</code><td><var>key</var>
                    <tr><td><code>code</code><td><var>code</var>
                    <tr><td><code>location</code><td><var>location</var>
                    <tr><td><code>altKey</code><td><var>device
                    state</var>'s <code>alt</code> property
                    <tr><td><code>shiftKey</code><td><var>device
                    state</var>'s <code>shift</code> property
                    <tr><td><code>ctrlKey</code><td><var>device
                    state</var>'s <code>ctrl</code> property
                    <tr><td><code>metaKey</code><td><var>device
                    state</var>'s <code>meta</code> property
                    <tr><td><code>repeat</code><td><var>repeat</var>
                    <tr><td><code>isComposing</code><td><var>false</var>
                    <tr><td><code>charCode</code><td><var>charCode</var>
                    <tr><td><code>keyCode</code><td><var>keyCode</var>
                    <tr><td><code>which</code><td><var>which</var>
                  </table>
              </li>
            </ul>
        </li>

        <li><p>Return <a>success</a> with data null.</li>
      </ol>

      <aside class=note>
        <p>A single <a>keyDown</a> action produces a single key input,
        irrespective of how long the key is held down; there is no
        implicit key repetition.
      </aside>

      <p>When required to <dfn>dispatch a keyUp action</dfn> with
        arguments <var>source id</var>, <var>action
        object</var>, <var>input state</var> and <var>tick
        duration</var> a <a>remote end</a> must run the following
        steps:</p>

      <ol>
        <li><p>Let <var>raw key</var> be equal to <var>action
              object</var>'s <code>value</code> property.</li>

        <li><p>Let <var>key</var> be equal to the <a>normalised key
              value</a> for <var>raw key</var>.</li>

        <li><p>If the <var>input state</var>'s <code>pressed</code>
            property does not contain <var>key</var>, return.</li>

        <li><p>Let <var>code</var> be the <a>code</a>
            for <var>raw key</var>.</li>

        <li><p>Let <var>location</var> be the <a>key location</a>
            for <var>raw key</var>.</li>

        <li><p>Let <var>charCode</var>, <var>keyCode</var>
            and <var>which</var> be the implementation-specific values
            of the <code>charCode</code>, <code>keyCode</code>
            and <code>which</code> properties appropriate for a key
            with key <var>key</var> and location <var>location</var>
            on a 102 key US keyboard, following the guidelines in
            [[!UI-EVENTS]].</li>

        <li><p>If <var>key</var> is <code>"Alt"</code>,
            let <var>device state's</var> <code>alt</code> property
            be true.</li>

        <li><p>If <var>key</var> is <code>"Shift"</code>,
            let <var>device state's</var> <code>shift</code> property
            be false.</li>

        <li><p>If <var>key</var> is <code>"Control"</code>,
            let <var>device state's</var> <code>ctrl</code> property
            be false.</li>

        <li><p>If <var>key</var> is <code>"Meta"</code>,
            let <var>device state's</var> <code>meta</code> property
            be false.</li>

        <li><p><a href="perform-actions">Perform
            implementation-specific action dispatch steps</a>
            equivalent to pressing a key on the keyboard in accordance
            with the requirements of [[!UI-EVENTS]], and producing at
            least the following events with the specified properties:
            <ul>
              <li><a href="https://w3c.github.io/uievents/#keyup"><code>keyup</code></a>,
                with properties:
                  <table class=simple>
                    <tr>
                      <th>Attribute</th>
                      <th>Value</th>
                    </tr>
                    <tr><td><code>key</code><td><var>key</var></tr>
                    <tr><td><code>code</code><td><var>code</var></tr>
                    <tr><td><code>location</code><td><var>location</var></tr>
                    <tr><td><code>altKey</code><td><var>device
                          state</var>'s <code>alt</code> property</tr>
                    <tr><td><code>shiftKey</code><td><var>device
                          state</var>'s <code>shift</code> property</tr>
                    <tr><td><code>ctrlKey</code><td><var>device
                          state</var>'s <code>ctrl</code> property</tr>
                    <tr><td><code>metaKey</code><td><var>device
                          state</var>'s <code>meta</code> property</tr>
                    <tr><td><code>repeat</code><td><var>repeat</var></tr>
                    <tr><td><code>isComposing</code><td><var>false</var></tr>
                    <tr><td><code>charCode</code><td><var>charCode</var></tr>
                    <tr><td><code>keyCode</code><td><var>keyCode</var></tr>
                    <tr><td><code>which</code><td><var>which</var></tr>
                  </table>
              </li>
            </ul>
        </li>
        <li><p>Return <a>success</a> with data null.</li>
      </ol>

    </section>

    <section> <!-- Pointer Actions -->
      <h2>Pointer Actions</h2>

      <p>When required to <dfn data-lt="key-state">get a global key
        state</dfn> with argument <var>key</var>, a remote end must
        run the following steps:
        <ol>
          <li>Let <var>input state</var> be the <a>current
              session</a>'s <a>input state</a> object.

          <li>For each <var>device input state</var> that is a value
            of the <var>input state</var> map:

            <ol>
              <li>If <var>device input state</var> is a <a>key input
              state</a> object, and its <code>pressed</code> property
                contains <var>key</var> return true.
            </ol>
          </li>

          <li><p>Return false.</li>
        </ol>

      <p>When required to <dfn>dispatch a pointerDown action</dfn>
        with arguments <var>source id</var>, <var>action
        object</var>, <var>input state</var> and <var>tick
        duration</var> a <a>remote end</a> must run the following
        steps:</p>

      <ol>
        <li><p>Let <var>pointerType</var> be equal to <var>action
        object</var>'s <code>pointerType</code> property.</li>

        <li><p>Let <var>button</var> be equal to <var>action
              object</var>'s <code>button</code> property.</li>

        <li><p>If the <var>input state</var>'s <code>pressed</code>
            property contains <var>button</var> return <a>success</a>
            with data null.</li>

        <li><p>Let <var>primary</var> be equal to <a>action object</a>'s
            <code>primary</code> property.</li>

        <li><p>Let <var>x</var> be equal to <var>input state</var>'s
            <code>x</code> property.</li>

        <li><p>Let <var>y</var> be equal to <var>input state</var>'s
            <code>y</code> property.</li>

        <li><p>Add <var>button</var> to the set corresponding
            to <var>input state</var>'s <code>pressed</code>
            property, and let <var>buttons</var> be the resulting
            value of that property.</li>

        <li><p>Append a copy of <var>action object</var> with
        the <var>subtype</var> property changed to <var>pointerUp</var>
        to the <a>current session</a>'s <a>input cancel list</a>.</li>

        <li><p><a href="perform-actions">Perform
            implementation-specific action dispatch steps</a>
            equivalent to pressing the button
            numbered <var>button</var> on the pointer with
            ID <var>source id</var>, having type
            type <var>pointerType</var> at viewport x
            coordinate <var>x</var>, viewport y
            coordinate <var>y</var>, with buttons <var>buttons</var>
            depressed, in accordance with the requirements of
            [[!UI-EVENTS]] and [[!POINTER-EVENTS]], with
            <var>primary</var> determining whether the pointer is
            regarded as a primary pointer and thus generates legacy
            mouse events. Type specific properties for the pointer
            that are not exposed through the webdriver API must be set
            to the default value specified for hardware that doesn't
            support that property.</li>

        <!-- TODO: add some events that should be emitted? This is a
        bit complicated in this case because e.g. pointerDown is only
        emitted if there were no previous buttons held down -->

        <li><p>Return <a>success</a> with data null.</li>
      </ol>

      <p>When required to <dfn>dispatch a pointerUp action</dfn> with
        arguments <var>source id</var>, <var>action
        object</var>, <var>input state</var> and <var>tick
        duration</var> a <a>remote end</a> must run the following
        steps:</p>

      <ol>
        <li><p>Let <var>pointerType</var> be equal to <var>action
              object</var>'s <code>pointerType</code> property.</li>

        <li><p>Let <var>button</var> be equal to <var>action
              object</var>'s <code>button</code> property.</li>

        <li><p>If the <var>input state</var>'s <code>pressed</code>
            property does not contain <var>button</var>
            return <a>success</a> with data null.</li>

        <li><p>Let <var>primary</var> be equal to <a>action object</a>'s
            <code>primary</code> property.</li>

        <li><p>Let <var>x</var> be equal to <a>action object</a>'s
            <code>x</code> property.</li>

        <li><p>Let <var>y</var> be equal to <a>action object</a>'s
            <code>y</code> property.</li>

        <li><p>Let <var>alt</var> be the result of <a>getting a
        global key pressed state</a> with
        argument <code>"Alt"</code>.</li>

        <li><p>If <var>key</var> is <code>"Shift"</code>,
            let <var>device state's</var> <code>shift</code> property
            be true.</li>

        <li><p>If <var>key</var> is <code>"Control"</code>,
            let <var>device state's</var> <code>ctrl</code> property
            be true.</li>

        <li><p>If <var>key</var> is <code>"Meta"</code>,
            let <var>device state's</var> <code>meta</code> property
            be true.</li>
        <li><p>Remove <var>button</var> from the set corresponding
            to <var>input state</var>'s <code>pressed</code>
            property, and let <var>buttons</var> be the resulting
            value of that property.</li>

        <li><p><a href="perform-actions">Perform
            implementation-specific action dispatch steps</a>
            equivalent to releasing the button
            numbered <var>button</var> on the pointer of
            ID <var>source id</var> having type
            type <var>pointerType</var> at viewport x
            coordinate <var>x</var>, viewport y
            coordinate <var>y</var>, with buttons <var>buttons</var>
            depressed, in accordance with the requirements of
            [[!UI-EVENTS]] and [[!POINTER-EVENTS]], with
            <var>primary</var> determining whether the pointer is
            regarded as a primary pointer and thus generates legacy
            mouse events. Type specific properties for the pointer
            that are not exposed through the webdriver API must be set
            to the default value specified for hardware that doesn't
            support that property.</li>

        <!-- TODO: add some events that should be emitted? This is a
        bit complicated in this case because e.g. pointerDown is only
        emitted if there were no previous buttons held down -->

        <li><p>Return <a>success</a> with data null.</li>
      </ol>

      <p>When required to <dfn>dispatch a pointerMove action</dfn>
        with arguments <var>source id</var>, <var>action
        object</var>, <var>input state</var> and <var>tick
        duration</var> a <a>remote end</a> must run the following
        steps:</p>

      <ol>
        <li><p>Let <var>x</var> be equal to the <code>x</code>
            property of <var>action object</var>.</li>

        <li><p>Let <var>y</var> be equal to the <code>y</code>
            property of <var>action object</var>.</li>

        <li><p>Let <var>start x</var> be equal to the <code>x</code>
            property of <var>input state</var>.</li>

        <li><p>Let <var>start y</var> be equal to the <code>y</code>
            property of <var>input state</var>.</li>

        <li><p>Let <var>element id</var> be equal to
            the <code>element</code> property of <var>action
            object</var>.</li>

        <li><p>If <var>element id</var> is not undefined:

            <ol>
              <li><p>Let <var>element</var> be equal to the result
                  of <a>trying</a> to <var>get a known element</var> with
                  argument <var>element</var>.</li>

              <li><p>If <var>x</var> is undefined, let <var>x</var>
                  equal <var>element</var>'s <a>horizontal
                  midpoint</a>.</li>

              <li><p>If <var>y</var> is undefined, let <var>y</var>
                  equal <var>element</var>'s <a>vertical
                  midpoint</a>.</li>
            </ol>
        </li>

        <li><p>Let <var>duration</var> be equal to <var>action
            object</var>'s <code>duration</code> property if it is
            not <code>undefined</code>, or <var>tick duration</var>
            otherwise.</li>

        <li><p>If <var>duration</var> is greater than 0 and inside any
            implementation-defined bounds, <a>asynchronously wait</a>
            for an implementation defined amount of time to pass.

            <aside><p>This wait allows the implementation to model the
            overall pointer move as a series of small movements
            occuring at an implementation defined rate (e.g. one
            movement per vsync).</p></aside>


        <li><p><a>Perform a pointer move</a> with
              arguments <var>source id</var>, <var>input
              state</var>, <var>duration</var>, <var>start
              x</var>, <var>start
              y</var>, <var>x</var>, <var>y</var>.</li>

      </ol>

      <p>When required to <dfn>perform a pointer move</dfn> with
        arguments <var>source id</var>, <var>input
        state</var>, <var>duration</var>,
        <var>start x</var>, <var>start y</var>, <var>target x</var>
        and <var>target y</var>, an implementation must run the
        following steps:

        <ol>

          <li><p>Let <var>subtype</var> equal the <code>subtype</code>
          property of <var>input state</var>.

          <li><p>Let <var>time delta</var> be the time since the
              beginning of the current tick, measured in milliseconds on a
              monotonic clock.</li>

          <li><p>Let <var>duration ratio</var> be the ratio
              of <var>time deta</var> and <var>duration</var>,
              if <var>duration</var> is greater than 0, or 1
              otherwise.</li>

          <li><p>If <var>duration ratio</var> is 1, or close enough to
              1 that the implementation will not further subdivide the move
              action, let <var>last</var> be true. Otherwise
              let <var>last</var> be <code>false</code>.</li>

          <li><p>If <var>last</var> is true, let <var>x</var>
              equal <var>target x</var> and <var>y</var>
              equal <var>target y</var>.

              <p>Otherwise let <var>x</var> equal an approximation
              to <var>duration ratio</var> &times; (<var>target
              x</var> - <var>start x</var>) + <var>start x</var>,
              and <var>y</var> equal an approximation to <var>duration
              ratio</var> &times; (<var>target y</var> - <var>start
              y</var>) + <var>start y</var>.</li>

          <li><p>Let <var>current x</var> equal the <code>x</code>
              property of <var>input state</var>.</li>

          <li><p>Let <var>current y</var> equal the <code>y</code>
              property of <var>input state</var>.</li>

          <li><p>If <var>x</var> is not equal to <var>current x</var>
              or <var>y</var> is not equal to <var>current y</var>, run
              the following steps:</p>

            <ol>
              <li><p>Let <var>buttons</var> be equal to input
                  state's <code>buttons</code> property.</li>

              <li><p><a data-lt="perform-actions">Perform
                    implementation-specific action dispatch steps</a>
                    equivalent to moving the pointer with
                    ID <var>source id</var> having
                    type <var>pointerType</var> from viewport x
                    coordinate <var>current x</var>, viewport y
                    coordinate <var>y</var> to viewport x
                    coordinate <var>x</var> and viewport y
                    coordinate <var>y</var>, with
                    buttons <var>buttons</var> depressed, in
                    accordance with the requirements of [[!UI-EVENTS]]
                    and [[!POINTER-EVENTS]], with <var>primary</var>
                    determining whether the pointer is regarded as a
                    primary pointer and thus generates legacy mouse
                    events. Type specific properties for the pointer
                    that are not exposed through the WebDriver API
                    must be set to the default value specified for
                    hardware that doesn't support that property. In
                    the case where the <var>pointerType</var>
                    is <code>"pen"</code> or <code>"touch"</code>,
                    and <var>buttons</var> is empty, this may be a
                    no-op. For a pointer of type <code>"mouse"</code>,
                    this will always produce events including at least
                    a <code>pointerMove</code> event.</li>

              <li><p>Let <var>input state</var>'s <code>x</code>
                  property equal <var>x</var> and <code>y</code> property
                  equal <var>y</var>.</li>
            </ol>
          </li>

          <li><p>If <var>last</var> is true, return.

        <li><p><a>Asynchronously wait</a> for an implementation
        defined amount of time to pass.

        <aside><p>This wait allows the implementation to model the
            overall pointer move as a series of small movements
            occuring at an implementation defined rate (e.g. one
            movement per vsync).</p></aside>


        <li><p><a>Perform a pointer move</a> with
            arguments <var>source id</var>, <var>input
            state</var>, <var>duration</var>, <var>start
            x</var>, <var>start y</var>, <var>target
            x</var>, <var>target y</var>.</li>

        </ol>

      <p>When required to <dfn>dispatch a pointerCancel action</dfn>
        with arguments <var>source id</var>, <var>action
        object</var>, <var>input state</var> and <var>tick
        duration</var> a <a>remote end</a> must run the following
        steps:</p>

      <ol>
        <li><p><a data-lt="perform-actions">Perform
              implementation-specific action dispatch steps</a>
            equivalent to cancelling the any action of the
            pointer with ID <var>source id</var> having
            type <var>pointerType</var>, in accordance with
            the requirements of [[!UI-EVENTS]] and
            [[!POINTER-EVENTS]].</li>
      </ol>
    </section> <!-- /Pointer Actions -->
  </section> <!-- /Dispatching Actions -->

  <section> <!-- Perform Actions -->
    <h2>Perform Actions</h2>
    <p><table class="simple jsoncommand">
        <tr>
          <th>HTTP Method</th>
          <th>Path Template</th>
        </tr>
        <tr>
          <td>POST</td>
          <td>/session/{<var>session id</var>}/actions</td>
        </tr>
      </table>

      <section> <!-- Payload Format -->
        <h2>Payload Format</h2>
        <p><i>This section is non-normative.</i>
          <!-- TODO -->
      </section> <!-- /Payload Format -->
      <section> <!-- Remote End Steps -->
        <h2>Remote End Steps</h2>
        <p>The <a>remote end steps</a> are:</p>

        <ol>
          <li><p>If the <a>current top-level browsing context</a>
              is <a>no longer open</a>, return <a>error</a>
              with <a>error code</a> <a>no such window.</a></li>

          <li><p><a>Handle any user prompts</a>. If this results in
              an <a>error</a>, return that error.</li>

          <li><p>Let <var>actions by tick</var> be the result
          of <a>trying</a> to <a>extract an action chain</a> with
          argument <var>parameters</var>.</li>

          <li><p><a>Dispatch actions</a> with argument <var>actions by
          tick</var>. If this results in an <a>error</a> return that
          error.</li>

          <li><p>Return <a>success</a> with data null.</li>
        </ol>
      </section> <!-- Remote End Steps -->
  </section> <!-- Perform Actions -->

  <section><!-- Releasing Actions -->
  <h2>Releasing Actions</h2>
  <table class="simple jsoncommand">
    <tr>
      <th>HTTP Method</th>
      <th>Path Template</th>
    </tr>
    <tr>
      <td>DELETE</td>
      <td>/session/{<var>session id</var>}/actions</td>
    </tr>
  </table>

    <p>The <dfn>Release Actions</dfn> <a>command</a> is used to
    release all the keys and pointer buttons that are currently
    depressed. This causes events to be fired as if the state was
    released by an explicit series of actions. It also clears all the
    internal state of the virtual devices.

    <p>The <a>remote end steps</a> are:
      <ol>

        <li><p>Let <var>undo actions</var> be equal to the <a>current
              session</a>'s <a>input cancel list</a> in reverse
              order.</li>

        <li><p><a>Dispatch tick actions</a> with arguments <var>undo
              actions</var> and duration 0.</li>

        <li><p>Let the <a>current session</a>'s <a>input cancel actions</a> be
            an empty <a>List</a>.</li>

        <li><p>Let the <a>current session</a>'s <a>input state</a> be
            an empty map.</li>

        <li><p>Return <a>success</a> with data null.
      </ol>
    </section><!-- /Releasing Actions -->

</section><!-- /Actions -->

<section>
<h2>User Prompts</h2>

<section><!-- Introduction -->
  <h2>Introduction</h2>
<p><i>This section is non-normative</i>

<p>This chapter describes interaction with various types of <a>user prompts</a>.
 The common denominator for user prompts is that they are
 modal windows requiring users to interact with them
 before the <a>event loop</a> is <a>unpaused</a>
 and control is returned to the <a>current top-level browsing context</a>.

<p>By default <a>user prompts</a> are not handled automatically
 unless a <a>user prompt handler</a> has been defined.
 When a <a>user prompt</a> appears,
 it is the task of the subsequent <a>command</a> to handle it.
 If the subsequent requested <a>command</a> is not one listed in this chapter,
 an <a>unexpected alert open</a> <a>error</a> will be returned.

<p><a>User prompts</a> that are spawned
 from <a><code>beforeunload</code></a> event handlers,
 are <a>dismissed</a> implicitly upon <a data-lt=go>navigation</a>,
 regardless of the defined <a>user prompt handler</a>.

<p>The following <dfn>table of simple dialogues</dfn>
 enumerates all supported <a>simple dialogues</a>,
 along with the <a>commands</a> that are allowed to interact with it
 as a non-normative reference:

<table class=simple>
 <tr>
  <th>Definition
  <th>Dialogue
  <th>Interactions
 </tr>

 <tr>
  <td><dfn>Alert</dfn>
  <td><a>window.<code>alert</code></a>
  <td>
   <a>Accept Alert</a><br />
   <a>Dismiss Alert</a><br />
   <a>Get Alert Text</a>
 </tr>

 <tr>
  <td><dfn>Confirm</dfn>
  <td><a>window.<code>confirm</code></a>
  <td>
   <a>Dismiss Alert</a><br />
   <a>Accept Alert</a><br />
   <a>Get Alert Text</a>
 </tr>

 <tr>
  <td><dfn>Prompt</dfn>
  <td><a>window.<code>prompt</code></a>
  <td>
   <a>Dismiss Alert</a><br />
   <a>Accept Alert</a><br />
   <a>Get Alert Text</a><br />
   <a>Send Alert Text</a>
 </tr>
</table>
</section> <!-- Introduction -->

<p>The <dfn>current user prompt</dfn> is said to be the active <a>user prompt</a>,
 which can be one of the entries on the <a>table of simple dialogues</a>,
 the <a>window.<code>print</code></a> dialogue,
 or a dialogue spawned by <a><code>showModalDialog()</code></a>
 should this be supported by the user agent.

<p>To <dfn data-lt="dismiss|dismissed|dismisses">dismiss</dfn>
 the <a>current user prompt</a>,
 do so as if the user would click the <b>Cancel</b> or <b>OK</b> button,
 whichever is present, in that order.

<p>To <dfn data-lt="accepting|accepted|accepts">accept</dfn> the <a>current user prompt</a>,
 do so as if the user would click the <b>OK</b> button.

<p>A <dfn>user prompt handler</dfn> is an <a>enumerated attribute</a>
 defining what action the <a>remote end</a> must take
 when a <a>user prompt</a> is encountered.
 The following table lists the keywords and states for the attribute:

<table class=simple>
 <tr>
  <th>Keyword
  <th>State
  <th>Description
 </tr>

 <tr>
  <td>"<code>dismiss</code>"
  <td><dfn>Dismiss state</dfn>
  <td>All <a>simple dialogues</a> encountered should be <a>dismissed</a>.
 </tr>

 <tr>
  <td>"<code>accept</code>"
  <td><dfn>Accept state</dfn>
  <td>All <a>simple dialogues</a> encountered should be <a>accepted</a>.
 </tr>
</table>

<p>In order to <dfn>handle any user prompts</dfn>
 a <a>remote end</a> must take the following steps:

<ol>
 <li><p>If there is no <a>current user prompt</a>,
  abort these steps and return <a>success</a>.

 <li><p>Match on the <a>user prompt handler</a>:

  <dl class=switch>
   <dt><a>dismiss state</a>
   <dd><p><a>Dismiss</a> the <a>current user prompt</a>.

   <dt><a>accept state</a>
   <dd><p><a>Accept</a> the <a>current user prompt</a>.

   <dt><a>missing value default state</a>
   <dt>not in the <a>table of simple dialogues</a>
   <dd><p>Return <a>error</a> with <a>error code</a>
    <a>unexpected alert open</a>.
  </dl>

 <li><p>Return <a>success</a>.
</ol>

<section>
<h3>Dismiss Alert</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/alert/dismiss</td>
 </tr>
</table>

<p>The <dfn>Dismiss Alert</dfn> <a>command</a>
 <a>dismisses</a> a <a>simple dialogue</a>
 if <a data-lt="current user prompt">present</a>.
 A request to <a>dismiss</a> an <a>alert</a> <a>user prompt</a>,
 which may not necessarily have a dismiss button,
 has the same effect as <a>accepting</a> it.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p>If there is no <a>current user prompt</a>,
  return <a>error</a> with <a>error code</a> <a>no such alert</a>.

 <li><p><a>Dismiss</a> the <a>current user prompt</a>.

 <li><p>Return <a>success</a> with data null.
</ol>
</section>

<section>
<h3>Accept Alert</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/alert/accept</td>
 </tr>
</table>

<p>The <dfn>Accept Alert</dfn> <a>command</a>
 <a>accepts</a> a <a>simple dialogue</a>
 if <a data-lt="current user prompt">present</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p>If there is no <a>current user prompt</a>,
  return <a>error</a> with <a>error code</a> <a>no such alert</a>.

 <li><p><a>Accept</a> the <a>current user prompt</a>.

 <li><p>Return <a>success</a> with data null.
</ol>
</section>

<section>
<h3>Get Alert Text</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/alert/text</td>
 </tr>
</table>

<p>The <dfn>Get Alert Text</dfn> <a>command</a>
 returns the message of the <a>current user prompt</a>.
 If there is no <a>current user prompt</a>, it returns with null.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p>If there is no <a>current user prompt</a>,
  return <a>error</a> with <a>error code</a> <a>no such alert</a>.

 <li><p>Let <var>message</var> be the text message
  associated with the <a>current user prompt</a>,
  or otherwise be null.

 <li><p>Let <var>body</var> be a JSON Object with the
  "<code>value</code>" property set to <var>message</var>.

 <li><p>Return <a>success</a> with data <var>body</var>.
</ol>
</section>

<section>
<h3>Send Alert Text</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>POST</td>
  <td>/session/{<var>session id</var>}/alert/text</td>
 </tr>
</table>

<p>The <dfn>Send Alert Text</dfn> <a>command</a>
 sets the text field prompt to a given value,
 and only makes sense on <a>window.<code>prompt</code></a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p>If there is no <a>current user prompt</a>,
  return <a>error</a> with <a>error code</a> <a>no such alert</a>.

 <li><p>Match on <a>current user prompt</a>:

  <dl class=switch>
   <dt><a>alert</a>
   <dt><a>confirm</a>
   <dd><p>Return <a>error</a> with
    <a>error code</a> <a>element not interactable</a>.

   <dt><a>prompt</a>
   <dd><p>Do nothing.

   <dt>Otherwise
   <dd><p>Return <a>error</a> with
    <a>error code</a> <a>unsupported operation</a>.
  </dl>

 <li><p>Let <var>character array</var> be the result of
  <a>getting a property</a> <code>value</code>
  from the <var>parameters</var> argument.

 <li><p>Let <var>text</var> be the result of
  joining together each element in <var>character array</var> to a string.

 <li><p>Set the <a>current user prompt</a>’s text field value
  to the value of <var>text</var>.

 <li><p>Return <a>success</a> with data null.
</ol>
</section> <!-- /Send Alert Text -->
</section> <!-- /User Prompts -->

<section>
<h2>Screen Capture</h2>

<p>Screenshots are a mechanism for providing
 additional visual diagnostic information.
 They work by dumping a snapshot of the <a>initial viewport</a>’s
 framebuffer as a lossless PNG image.
 It is returned to the <a>local end</a> as a Base64 encoded string.

<p>WebDriver provides the <a>Take Screenshot</a> <a>command</a>
 to capture the <a>top-level browsing context</a>’s <a>initial viewport</a>,
 and a <a>command</a> <a>Take Element Screenshot</a>
 for doing the same with the visible region of an <a>element</a>’s
 <a>bounding rectangle</a> after it has been <a>scrolled into view</a>.

<p>In order to <dfn>draw a bounding box from the framebuffer</dfn>,
 given a <a>rectangle</a>:

<ol>
 <li><p>If either the <a>initial viewport</a>’s width or height
  is 0 <a>CSS reference pixels</a>,
  return <a>error</a> with <a>error code</a> <a>unable to capture screen</a>.

 <li><p>Let <var>paint width</var> be the <a>initial viewport</a>’s width –
  <a>min</a>(<a>rectangle x coordinate</a>,
  <a>rectangle x coordinate</a> + <a>rectangle width dimension</a>).

 <li><p>Let <var>paint height</var> be the <a>initial viewport</a>’s height –
  <a>min</a>(<a>rectangle y coordinate</a>,
  <a>rectangle y coordinate</a> + <a>rectangle height dimension</a>).

 <li><p>Let <var>canvas</var> be a new <a><code>canvas</code> element</a>,
  and set its <a data-lt="canvas width attribute">width</a>
  and <a data-lt="canvas height attribute">height</a>
  to <var>paint width</var> and <var>paint height</var>, respectively.

 <li><p>Let <var>context</var>, a <a>canvas context mode</a>,
  be the result of invoking the <a>2D context creation algorithm</a>
  given <var>canvas</var> as the target.

 <li><p>Complete implementation specific steps equivalent to
  drawing the region of the framebuffer
  specified by the following coordinates onto <var>context</var>:

  <dl>
   <dt>X coordinate
   <dd><a>rectangle x coordinate</a>

   <dt>Y coordinate
   <dd><a>rectangle y coordinate</a>

   <dt>Width
   <dd><var>paint width</var>

   <dt>Height
   <dd><var>paint height</var>
  </dl>

 <li><p>Return <a>success</a> with <var>canvas</var>.
</ol>

<p>To <dfn data-lt="encoding as base64">encode as Base64
 a <code>canvas</code> element</dfn>:

<ol>
 <li><p>If the <a><code>canvas</code> element</a>’s bitmap’s
  <a>origin-clean</a> flag is set to false,
  return <a>error</a> with <a>error code</a> <a>unable to capture screen</a>.

 <li><p>If the <a><code>canvas</code> element</a>’s bitmap
  has no pixels (i.e. either its horizontal dimension or vertical dimension is zero)
  then return <a>error</a> with <a>error code</a> <a>unable to capture screen</a>.

 <li><p>Let <var>file</var> be
  <a>a serialisation of the <code>canvas</code> element’s bitmap as a file</a>,
  using "<code>image/png</code>" as an argument.

 <li><p>Let <var>data url</var> be a <a><code>data:</code> URL</a>
  representing <var>file</var>. [[!RFC2397]]

 <li><p>Let <var>index</var> be the <a>index of</a> "<code>,</code>"
  in <var>data url</var>.

 <li><p>Let <var>encoded string</var> be a <a>substring</a>
  of <var>data url</var> using (<var>index</var> + 1) as the <i>start</i> argument.

 <li><p>Return <a>success</a> with data <var>encoded string</var>.
</ol>

<section>
<h3>Take Screenshot</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/screenshot</td>
 </tr>
</table>

<p>The <dfn>Take Screenshot</dfn> <a>command</a>
 takes a screenshot of the
 <a href=#>top-level browsing context</a>’s
 <a href=#>viewport</a>.

<p>The <a>remote end steps</a> are:

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li>Let <var>root rect</var> be the <a>current top-level browsing context</a>’s
  <a>document element</a>’s <a>rectangle</a>.

 <li><p>Let <var>screenshot result</var> be the result of calling
  <a>draw a bounding box from the framebuffer</a>,
  given <var>root rect</var> as an argument.

 <li><p>If <var>screenshot result</var> is an <a>error</a>,
  return <var>screenshot result</var>.

 <li><p>Let <var>canvas</var> be <var>screenshot result</var>’s data.

 <li><p>Let <var>encoding result</var> be the result of
  <a>encoding as Base64</a> the <var>canvas</var> element.

 <li><p>If <var>encoding result</var> is an <a>error</a>,
  return <var>encoding result</var>.

 <li><p>Let <var>encoded string</var> be <var>encoding result</var>’s data.

 <li><p>Let <var>body</var> be a JSON Object
  with the "<code>value</code>" property set to <var>encoded string</var>.

 <li><p>Return <a>success</a> with data null.
</ol>
</section> <!-- /Take Screenshot -->

<section>
<h3>Take Element Screenshot</h3>

<table class="simple jsoncommand">
 <tr>
  <th>HTTP Method</th>
  <th>Path Template</th>
 </tr>
 <tr>
  <td>GET</td>
  <td>/session/{<var>session id</var>}/element/{<var>element id</var>}/screenshot</td>
 </tr>
</table>

<p>The <dfn>Take Element Screenshot</dfn> <a>command</a>
 takes a screenshot of the visible region encompassed
 by the <a>bounding rectangle</a> of an <a>element</a>.
 If given a parameter argument <code>scroll</code>
 that evaluates to false,
 the <a>element</a> will not be <a>scrolled into view</a>.

<ol>
 <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
  return <a>error</a> with <a>error code</a> <a>no such window</a>.

 <li><p>Let <var>scroll</var> be true if it is <a>undefined</a>.

 <li><p>Let <var>element result</var> be the result of
  <a>getting a known element</a> by
  <a>UUID</a> reference parameter <var>element id</var>.

 <li><p>If <var>element result</var> is an <a>error</a>,
  return <var>element result</var>.

 <li><p>Let <var>element</var> be <var>element result</var>’s data.

 <li><p>Let <var>element rect</var> be <var>element</var>’s
  <a href=https://drafts.fxtf.org/geometry/#rectangle>rectangle</a>.

 <li><p>If asked to <var>scroll</var>,
  <a>scroll into view</a> the <var>element</var>.

 <li><p>Let <var>screenshot result</var> be the result of calling
  <a>draw a bounding box from the framebuffer</a>,
  given <var>element rect</var> as an argument.

 <li><p>If <var>screenshot result</var> is an <a>error</a>,
  return <var>screenshot result</var>.

 <li><p>Let <var>canvas</var> be <var>screenshot result</var>’s data.

 <li><p>Let <var>encoding result</var> be the result of
  <a>encoding as Base64</a> the <var>canvas</var> element.

 <li><p>If <var>encoding result</var> is an <a>error</a>,
  return <var>encoding result</var>.

 <li><p>Let <var>encoded string</var> be <var>encoding result</var>’s data.

 <li><p>Let <var>body</var> be a JSON Object
  with the "<code>value</code>" property set to <var>encoded string</var>.

 <li><p>Return <a>success</a> with data <var>body</var>.
</ol>
</section> <!-- /Take Element Screenshot -->
</section> <!-- /Screen Capture -->

<section class=appendix>
<h2>Privacy</h2>

<p>It is advisable that <a>remote ends</a>
 create a new profile when <a data-lt="new session">creating a new session</a>.
 This prevents potentially sensitive session data
 from being accessible to new <a>sessions</a>,
 ensuring both privacy
 and preventing state from bleeding through to the next session.
</section>

<section class=appendix>
<h2>Security</h2>

<p>A user agent can rely on a command-line flag or a configuration
 option to test whether to enable WebDriver, or alternatively make the
 user agent initiate or confirm the connection through a privileged
 content document or control widget, in case the user agent does not
 directly implement the HTTP endpoints.

<p>To prevent arbitrary machines from connecting and
 creating <a>sessions</a>, it is suggested that only connections from
 loopback devices are allowed by default.

<p>The <a>remote end</a> can include a configuration option to limit
 the accepted IP range allowed to connect and make requests.  The
 default setting for this might be to limit connections to the IPv4
 localhost CIDR range <code>127.0.0.0/8</code> and the IPv6 localhost
 address <code>::1</code>. [[!RFC4632]]
</section>

<section class=appendix>
<h2>Element Displayedness</h2>

<p>Although WebDriver does not define a primitive
 to ascertain the visibility of an <a>element</a> in the <a>viewport</a>,
 we acknowledge that it is an important feature for many users.
 Here we include a recommended approach
 which will give a simplified approximation of an <a>element</a>’s visibility,
 but please note that it relies only on tree-traversal,
 and only covers a subset of visibility checks.

<p>The visibility of an <a>element</a> is guided
 by what is perceptually visible to the human eye.
 In this context, an <a>element</a>'s displayedness
 does not relate to the <a><code>visibility</code></a>
 or <a><code>display</code></a> style properties.

<p>The approach recommended to implementors
 to ascertain an <a>element</a>'s visibility
 is based on crude approximations about its nature and relationship in the tree.
 An <a>element</a> is in general to be considered visible
 if any part of it is drawn on the canvas within the bounderies of the viewport.

<p>When asked to
 <dfn data-lt="normalize style pixel values to floating point|normalized style pixel float value">normalize style pixel values to floating point</dfn>
 for a value <var>s</var> of the type string:

<ol>
 <li><p>Let <var>trimmed string</var> be a substring of <var>s</var>
  where the suffix "<code>px</code>" is removed.

 <li><p>Let <var>pixels</var> be the result of parsing
  <var>trimmed string</var> as a float.

 <li><p>If <var>pixels</var> is not a valid float
  or the previous operation did not succeed, return <code>0.0</code>.

 <li><p>Round off <var>pixels</var> using a ceiling function
  so that it has no more than four decimals.

 <li><p>Return <var>pixels</var>.
</ol>

<p class=note>To <a>normalize style pixel values to floating point</a>
 is almost equivalent to calling <a>parseFloat</a>
 from [[!ECMA-262]] with the exception that
 non-valid float return values are returned as <code>0.0</code>.

<p class=issue>This algorithm is <em>not</em> the same
 as the one used by Selenium.
 To provide backwards compatibility,
 we should change it to be an accurate description
 of what Selenium does.

<p>The <dfn data-lt="element displayed|element displayedness|not displayed">element displayed</dfn> algorithm
 is a boolean state where true signifies that the element is displayed
 and false signifies that the element is not displayed.
 To compute the state on <var>element</var>:

<ol>
 <li><p>If the attribute <code>hidden</code> is set, return false.

 <li><p>If the computed value of the <code>display</code> style
  property is "none", return false.

    <li><p class=issue>Not really sure what this means, needs review:

     <p>If it has a [[!CSS3-2D-TRANSFORMS]] or [[!CSS3-3D-TRANSFORMS]]
      style property that gives a negative X or Y coordinates to the canvas, return false.

 <li><p>If <var>element</var> is the document's root element,
  that is <code>document.documentElement</code>:

  <ol>
   <li><p>If the computed value of the <code>background-color</code>
    property is "transparent", run these substeps:

    <ol>
     <li><p>If <var>element</var> is an HTML <code>HTML</code>
      element [[!HTML]], and the computed value of the
      <code>background-color</code> style property of the first
      <code>body</code> element descendant of the element in
      <a>tree order</a>, relative to that element, is also "transparent",
      return false.

      Otherwise return true.
    </ol>
  </ol>

 <li><p>If <var>element</var> is an <code>option</code>
  or <code>optgroup</code> element,
  and <var>element</var>'s parent node is a <code>select</code> element:

  <ol>
   <li><p>Apply the <a>element displayed</a> algorithm
    on <var>element</var>'s parent node.

   <li><p>If the return value is false, abort these steps and return that value.
  </ol>

 <li><p>If <var>element</var> is a <code>map</code> element:

  <ol>
   <li><p>Let <var>any images visible</var> be a boolean
    initially set to false.

   <li><p>For each <code>img</code> element, <var>image element</var>,
    in the document with a <code>name</code> attribute matching
    the value of <var>element</var>'s <code>usemap</code>
    attribute, run these substeps:

    <ol>
     <li><p>Run the <a>element displayed</a> algorithm on <var>image element</var>
      and set <var>any images visible</var> to <var>any images visible</var> bitwise OR its return value.
    </ol>

   <li><p>If <var>any images visible</var> is true,
    abort these steps and return its value.
 </ol>

 <li><p>If <var>element</var> is an <code>area</code> element:

  <ol>
   <li><p>For each ancestral element <var>parent</var>,
    in <a>tree order</a>:

   <ol>
    <li><p>If <var>parent</var> is a <code>map</code> element,
     apply the <a>element displayed</a> algorithm on it.

    <li><p>If the return value is false,
     abort these steps and return that value.

    <li><p>Otherwise apply step 7.1 on <var>parent</var>.
   </ol>
  </ol>

 <li><p>If <var>element</var> is a [[!DOM]] <a>text node</a>,
  return true.

 <li><p>If it has equal to or more than one direct descendant elements:

  <ol>
   <li><p>Let <var>visible children</var> be a boolean initially set to false.

   <li><p>For each direct descendant element <var>child</var>:

   <ol>
    <li><p>Let <var>rectangle</var> be <var>child</var>’s <a>bounding rectangle</a>.

    <li><p>If the value of the <code>height</code> property of <var>rectangle</var> is
     greater than zero <a>CSS reference pixels</a>,
     and the value of the <code>width</code> property of <var>rectangle</var>
     is greater than zero <a>CSS reference pixels</a>:

     <ol>
      <li><p>Set <var>visible children</var> to <var>visible children</var> bitwise OR true.
     </ol>
   </ol>
  </ol>

 <li><p>For each ancestral element <var>parent</var>, in <a>tree order</a>:

  <ol>
   <li><p>Apply the <a>element displayed</a> algorithm to <var>parent</var>.

   <li><p>If the return value is false, abort these steps and return that value.

   <li><p>If <var>parent</var> is a block element box and the
    computed values of either <code>overflow-x</code>
    or <code>overflow-y</code> is "hidden":

   <ol>
     <li><p>Let <var>parent dimensions</var> be the <a>rectangle</a>
     that is the first element of the <a><code>DOMRect</code></a>
     <a>sequence</a> returned by calling <a>getClientRects</a> on <var>parent</var>.

    <li><p>Let <var>element dimensions</var> be the <a>rectangle</a>
     that is the first element of the <code>DOMRect</code>
     <a>sequence</a> returned by calling <a>getClientRects</a> on <var>element</var>.

    <li><p>Let <var>parent style</var> be the computed style of <var>parent</var>.

    <li><p>Return false if any the following conditions evaluate to false:

    <ul>
     <li><p><var>element dimension</var>'s <code>top</code>
      is less than (<var>parent dimension</var>'s <code>bottom</code>
      − the <a>normalized style pixel float value</a>
      of <var>parent style</var>'s <code>borderBottomWidth</code>).

     <li><p><var>element dimension</var>'s <code>bottom</code>
      is less than (<var>parent dimension</var>'s <code>top</code>
      − the <a>normalized style pixel float value</a>
      of <var>parent style</var>'s <code>borderTopWidth</code>).

     <li><p><var>element dimension</var>'s <code>left</code>
      is less than (<var>parent dimension</var>'s <code>right</code>
      − the <a>normalized style pixel float value</a>
      of <var>parent style</var>'s <code>borderRightWidth</code> casted as a float).

     <li><p><var>element dimension</var>'s <code>right</code>
      is less than (<var>parent dimension</var>'s <code>left</code>
      − the <a>normalized style pixel float value</a>
      of <var>parent style</var>'s <code>borderLeftWidth</code> casted as a float).
   </ul>

   <li><p>Run step 10 on the parent elements of <var>parent</var>, if any.
  </ol>
 </ol>

 <li><p>Return true.
</ol>
</section> <!-- /Element Displayedness -->

<section class=appendix>
<h2>Acknowledgements</h2>

<p>Many thanks to Robin Berjon for making our lives so much easier with his cool tool.
 Thanks to Jason Leyba, Malcolm Rowe, Ross Patterson, Andrey Botalov, and Berge Schwebs Bjørlo for proof reading
 and suggesting areas for improvement.
 Thanks to Jason Leyba, Eran Messeri, Daniel Wagner-Hall, Malini Das, Luke Inman-Semerau,
 Andreas Tolfsen, James Graham, and John Jansen for contributing sections to this document.
 Also thanks to the following people for their contribution of patches and test cases:

 <ul>
  <li>Philippe Le Hegaret
 </ul>
</section>
