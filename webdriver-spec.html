<!DOCTYPE html>
<html data-bug-blocked=20860
      data-bug-product="Browser Test/Tools WG"
      data-bug-component=WebDriver>
  <head>
    <meta charset="utf-8">
    <title>WebDriver</title>

    <style>
    /* --- WEB IDL --- */
pre.IDL {
    border-top: 1px solid #90b8de;
    border-bottom: 1px solid #90b8de;
    padding:    1em;
    line-height:    120%;
}

pre.IDL::before {
    content:    "WebIDL";
    display:    block;
    width:      150px;
    background: #90b8de;
    color:  #fff;
    font-family:    initial;
    padding:    3px;
    font-weight:    bold;
    margin: -1em 0 1em -1em;
}

code a:visited, code a:link {
  color:  #ff4500;
}

     #respec-ui { top: 80px !important }
    </style>

    <!--
      === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can check them
      out in the same tree and use relative links so that they'll work offline,
     -->
    <script src='respec-w3c-common.js' class='remove' async></script>
    <script class='remove'>
      var respecConfig = {
          specStatus:           "ED",

          shortName:            "webdriver",

          // publishDate:  "2009-08-06",

          // copyrightStart: "2005"

          // previousPublishDate:  "1977-03-15",

          // previousMaturity:  "WD",

          edDraftURI:           "https://w3c.github.io/webdriver/webdriver-spec.html",

          // lcEnd: "2009-08-05",

          editors:  [
              { name: "Simon Stewart", url: "http://www.rocketpoweredjetpants.com/",
                company: "Facebook", companyURL: "http://www.facebook.com/"
              },
              { name: "David Burns", url: "http://www.theautomatedtester.co.uk/",
                company: "Mozilla", companyURL: "http://www.mozilla.org/" },
          ],

          otherLinks: [{
            key: "Raising issues with the specification",
            data: [{
                    value: "W3 Bug Tracker",
                    href: "https://www.w3.org/Bugs/Public/enter_bug.cgi?comment=&blocked=20860&short_desc=[WebDriver%20Spec]%3A%20&product=Browser%20Test%2FTools%20WG&component=WebDriver"
                  }]
          }],

          wg:           "Browser Testing and Tools Working Group",

          wgURI:        "http://www.w3.org/testing/browser/",

          wgPublicList: "public-browser-tools-testing",

          wgPatentURI:  "https://www.w3.org/2004/01/pp-impl/49799/status",

          noIDLSorting: true,
      };
    </script>
    <script src=bug-assist.js></script>
  </head>
  <body>

<section id=abstract>
<p>This specification defines the WebDriver API,
 a platform and language-neutral interface and associated wire protocol
 that allows programs or scripts to introspect into,
 and control the behaviour of, a web browser.
 The WebDriver API is primarily intended to allow developers to write tests
 that automate a browser from a separate controlling process,
 but may also be implemented in such a way as to allow in-browser scripts to control a &mdash;
 possibly separate &mdash; browser.

<p>The WebDriver API is defined by a wire protocol
 and a set of interfaces to discover and manipulate DOM elements on a page,
 and to control the behaviour of the containing browser.

<p>This specification also includes a normative reference serialisation (to JSON over HTTP)
 of the interface's invocations and responses that are to be used
 by browser vendors to ensure interoperability.
</section>

<section id=sotd>
<p>If you wish to make comments regarding this document,
 please email feedback to <a href=mailto:public-browser-tools-testing@w3.org>public-browser-tools-testing@w3.org</a>.
 All feedback is welcome, and the editors will read and consider all feedback.

<p>This specification is intended for implementors of the WebDriver API.
 It is not intended as light bed time reading.
 This specification is still under active development and may not be stable.
 Any implementors who are not actively participating in the preparation of this specification
 may find unexpected changes occurring.
 It is suggested that any implementors join the WG for this specification.
 Despite not being stable,
 it should be noted that this specification is strongly based on an existing open source project &mdash;
 <a href=https://github.com/SeleniumHQ/selenium>Selenium WebDriver</a> &mdash;
 and the existing implementations of the API defined within that project.
</section>
<section>
<h3>Conformance</h3>

<p>All diagrams, examples, and notes in this specification are non-normative,
 as are all sections explicitly marked non-normative.
 Everything else in this specification is normative.

<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHOULD”,
 “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
 in the normative parts of this document are to be interpreted as described in [[!RFC2119]].
 The key word "OPTIONALLY" in the normative parts of this document
 is to be interpreted with the same normative meaning as “MAY” and “OPTIONAL”.

<p>Conformance requirements phrased as algorithms
 or specific steps may be implemented in any manner,
 so long as the end result is equivalent.
</section>

<section>
<h3>Terminology</h3>

<p>The terminology most used in this specification is from
 HTML, DOM, and CSS. [[!HTML]] [[!DOM4]] [[!CSS21]]

<p>In equations, all numbers are integers,
 subtraction is represented by “−”, and bitwise OR by “|”.
 The characters “(” and “)” are used to provide logical grouping in these contexts.

<p>This specification defines three broad conformance classes:

<dl>
 <dt><dfn>Local End</dfn>
 <dd>This represents the client side of the protocol,
  which is usually in the form of language-specific libraries
  providing an API on top of the WebDriver protocol.
  This specification does not place any restrictions on the details of those libraries
  above the level of the wire protocol.
  <!-- TODO: define the requirements on the local end somewhere -->

 <dt><dfn>Remote End</dfn>
 <dd>This is the server side of the protocol,
  which is usually implemented by a web browser or similar user agent.
  Defining the behaviour of the remote end in response to the WebDriver protocol
  forms the largest part of this specification.

 <dt><dfn>Intermediary Node</dfn>
 <dd>Intermediary nodes are those that act as proxies,
  implementing both the client and server sides of the protocol.
  Intermediary nodes must be black-box indistinguishable from a <a>remote end</a>
  from the point of view of <a>local end</a>
  and so are bound by the requirements on a <a>remote end</a> in terms of the wire protocol.
  However they are not expected to implement <a>commands</a> directly.
</dl>
</section>
<section>
  <h2>The WebDriver Protocol</h2>
  <section>
    <h3>Introduction</h3>
    <p>TODO</p>
  </section>
  <section>
    <h3>Algorithms</h3>
    <p>Various parts of this specification are written in terms of step-by-step algorithms. The details of these algorithms do not have any normative significance; implementations are free to adopt any implementation strategy that produces equivalent output to the specification. In particular algorithms in this document are optimised for readability rather than performance.</p>
    <p>Where algorithms that return values are fallible, they are written in terms of returning either <dfn>success</dfn> or <dfn>error</dfn>. A <a>success</a> value has an associated <var>data</var> field which encapsulates the value returned, whereas an <a>error</a> response has an associated <a>error code</a>.</p>
  </section>

  <section>
    <h3>Commands</h3>
    <p>The WebDriver protocol is organised into commands. Each HTTP request with a method and template defined in this specification represents a single command and therefore each command produces a single HTTP response. In response to a command, a <a>remote end</a> will run a series of actions against the remote browser.</p>
    <p>Each command defined in this specification has an associated list of <dfn>remote end steps</dfn>. This provides the sequence of actions that a remote end takes when it recieves a particular command.</p>
  </section>

  <section>
    <h3>Processing Model</h3>
    <p>The <a>remote end</a> acts as a HTTP server reading requests from the client and writing responses, typically over TCP socket. For the purposes of this specification we model the data transmission between a particular <a>local end</a> and <a>remote end</a> with a <dfn>connection</dfn> to which the <a>remote end</a> may <dfn>write bytes</dfn> and <dfn>read bytes</dfn>. However the exact details of how this <a>connection</a> works and how it is established are out of scope.</p>

    <p>After such a <a>connection</a> has been established, a remote end MUST run the following steps:</p>

    <ol>
      <!-- Should mention what happens if it can't be decoded as HTTP -->
      <!-- Note: the way that fetch is used here isn't quite right because it doesn't
           specify how to construct a request from network data, or serialize a response. -->

      <li><p><a>Read bytes</a> from the connection until a complete HTTP request can be constructed from the data. Let <var>request</var> be a <a href="https://fetch.spec.whatwg.org/#concept-request" class="externalRef">request</a> object constructed from the received data, according to the requirements of [[!RFC7230]].</p></li>

      <li><p>Let <var>request match</var> be the result of the algorithm to <a>match a request</a> with <var>request</var>'s <a href="https://fetch.spec.whatwg.org/#concept-request-method" class="externalRef">method</a> and <a href="https://fetch.spec.whatwg.org/#concept-request-url" class="externalRef">url</a> as arguments.</p></li>

      <li><p>If <var>request match</var> is of type <a>error</a>, <a>send an error</a> with <var>request match</var>'s <a>error code</a> and jump to step 1.</p>

        <p>Otherwise, let <var>command</var>, <var>session id</var> and <var>element id</var> be <var>request match</var>'s data.</p></li>

      <li><p>If <var>command</var> is not <a>new session</a>:</p>
        <ol>
          <li><p>If <var>session id</var> is not equal to the <a title="session id">id</a> of any session in the <a>list of active sessions</a>, <a>send an error</a> with <a>error code</a> <a>invalid session id</a>, then jump to step 1 in this overall algorithm.</p>

          <p>Otherwise, let the <a>current session</a> be the session with <a title="session id">id</a> <var>session id</var>.</p>
          </li>
        </ol>
      </li>

      <li><p>If <var>request</var>'s <a href="https://fetch.spec.whatwg.org/#concept-request-method" class="externalRef">method</a> is POST:</p>
        <ol>

          <li><p>Let <var>parse result</var> be the result of <a>parsing as JSON</a> with <var>request</var>'s <a href="https://fetch.spec.whatwg.org/#concept-request-body" class="externalRef">body</a> as the argument.</p></li>

          <li><p>If <var>parse result</a> is an <a>error</a> or if it is a <a>success</a> but its associated data is not an Object object, <a>send an error</a> with status <a>error code</a> <a>invalid argument</a> and jump back to step 1 in this overall algorithm.</p>
             <p>Otherwise, let <var>parameters</var> be<var>parse result</var>'s data.</p>
          </li>
        </ol>

        <p>Otherwise, let <var>parameters</var> be null</p>
      </li>

      <li><p>Let <var>response data</var> be a <a>command response</a> object obtained by running the <a>remote end steps</a> for <var>command</var> with arguments <var>element id</var> and <var>parameters</var>.</p></li>

      <li><p>If <var>response data</var> is an <a>error</a>, <a>send an error</a> with <a>error code</a> equal to <var>response data</var>'s <a>error code</a>.</p>

        <p>Otherwise <a>send a response</a> with status 200 and <var>response data</var>'s data.</p></li>

      <li><p>Jump to step 1.</p></li>
    </ol>

    <p>When required to <dfn>send an error</dfn>, with <var>error code</var>, a remote end must run the following steps:</p>

    <ol>
      <li><p>Let <var>http status</var> and <var>name</var> be the <a>error response data</a> for <var>error code</var>.</p></li>
      <li><p>Let <var>data</var> be a <a>new JSON Object</a>.</p>

      <li><p>Let <var>message</var> be an implementation-defined string containing a human-readable description of the reason for the error.</p></li>

      <li><p>Let <var>stacktrace</var> be an implementation-defined string containing a stack trace report of the active stack frames at the time when the error occurred.</p></li>

        <!-- TODO: really need a better way of constructing JSON literals -->
      <li><p><a>Set the properties</a> of <var>data</var> with values ("error", <var>name</var>), ("message", <var>message</var>).</p></li>

      <li><a>Send a response</a> with <var>status</var> and <var>data</var> as arguments.</li>

    </ol>

    <p>When required to <dfn>send a response</dfn>, with arguments <var>status</var> and <var>data</var>, a remote end must run the following steps:</p>

    <ol>
      <li><p>Let <var>response</var> be a new <a href="https://fetch.spec.whatwg.org/#concept-response" class="externalRef">response</a>.</p></li>

      <li><p>Set <var>response</var>'s <a href="https://fetch.spec.whatwg.org/#concept-response-status" class="externalRef">status</a> to <var>status</var>, and <a href="https://fetch.spec.whatwg.org/#concept-response-status-message" class="externalRef">status message</a> to the string corresponding to the description of <var>status</var> in the <a href="http://www.iana.org/assignments/http-status-codes/http-status-codes.xhtml" class="externalRef">status code registry</a>.</p></li>
      <li><p>If <var>data</var> is not null, let <var>response</var>'s <a href="https://fetch.spec.whatwg.org/#concept-response-body" class="externalRef">body</a> be the result of <a>serializing as JSON</a> with <var>data</var> as the argument.</p></li>

      <li><p>Let <var>response bytes</var> be the byte sequence resulting from serializing <var>response</var> according to the rules in [[!RFC7230]].</p></li>

      <li><p><a title="write bytes">Write</a> <var>response bytes</var> to the <a>connection</a></p></li>

    </ol>

  </section>

  <section>
    <h3>Routing Requests</h3>

    <p><dfn>Request routing</dfn> is the process of going from a HTTP request to the series of steps needed to implement the <a>command</a> represented by that request.</p>

    <p>A <a>remote end</a> has an associated <dfn>URL prefix</dfn>, which is used as a prefix on all WebDriver-defined URLs on that remote end. This must either be the empty string, or an <a href="https://url.spec.whatwg.org/#concept-absolute-path-relative-url" class="externalRef">absolute path relative url</a>.</p>

    <aside class="note">
      <p>For example a remote end wishing to run alongside other services on <code>example.com</code> might set its <a>url prefix</a> to <code>/wd</code> so that a <a>new session</a> command would be invoked by sending a POST request to <code>/wd/session</code> rather than <code>/session</code>.</p>
    </aside>

    <p>In order to <dfn>match a request</dfn> given a <var>method</var> and <var>url</var>, the following steps must be taken:</p>

    <ol>
      <li><p>Let <var>endpoints</var> be a list containing each row in the <a>table of endpoints</a>.</p></li>

   <li><p>Remove each entry in <var>endpoints</var> for which the concatenation of the <a>url prefix</a> and the production in the "url" column does not match <a>url</a> according to the rules in [[!URI-Template]].</p></li>

      <li><p>If there are no entries in <var>endpoints</var>, return an <a>error</a> with code <a>unknown command</a>.</p></li>

      <li><p>Remove each entry in <var>endpoints</var> for which the "method" column is not an exact case-sensitive match for <var>method</var>.</p></li>

      <li><p>If there are no entries in <var>endpoints</var>, return an <a>error</a> with code <a>unknown method</a>.</p></li>

      <li><p>There is now exactly one entry in <var>endpoints</var>; let <var>entry</var> be this entry.</p></li>


      <!-- TODO: Check that URI-templates is being used in the right way here -->

      <li><p>If the match in step 2 populated a template variable called "sessionId", let <var>session id</var> be the value it was populated with. Otherwise let <var>session id</var> be null.</p></li>

      <li><p>If the match in step 2 populated a template variable called "elementId", let <var>element id</var> be the value it was populated with. Otherwise let <var>element id</var> be null.</p></li>

      <li><p>If the match in step 2 populated a
        template variable called "name", let <var>name</var> be the value it was populated with. Otherwise let <var>name</var> be null.</p></li>

      <li><p>Let <var>command</var> be the command represented by the "command" column of <var>entry</var>.</p></li>

      <li><p>Return <a>success</a> with data <var>session id</var>, <var>element id</var> and <var>command</var>.</li>

    </ol>

  </section>

  <section>
    <h3>List of Endpoints</h3>
    <p>The following <dfn>table of endpoints</dfn> lists the method,
     URL, and command for each WebDriver command.

    <table class=simple>
      <tr>
        <th>Method</th>
        <th>URL</th>
        <th>Command</th>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session</td>
        <td><a>New Session</a></td>
      </tr>
      <tr>
        <td>DELETE</td>
        <td>/session/{sessionId}</td>
        <td><a>Delete Session</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/url</td>
        <td><a>Get</a></td>
      </tr>
      <tr>
        <td>GET</td>
        <td>/session/{sessionId}/url</td>
        <td><a>Get Current Url</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/back</td>
        <td><a>Go Back</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/forward</td>
        <td><a>Go Forward</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/refresh</td>
        <td><a>Refresh</a></td>
      </tr>
      <tr>
        <td>GET</td>
        <td>/session/{sessionId}/title</td>
        <td><a>Get Title</a></td>
      </tr>
      <tr>
        <td>GET</td>
        <td>/session/{sessionId}/window_handle</td>
        <td><a>Get Window Handle</a></td>
      </tr>
      <tr>
        <td>GET</td>
        <td>/session/{sessionId}/window_handles</td>
        <td><a>Get Window Handles</a></td>
      </tr>
      <tr>
        <td>DELETE</td>
        <td>/session/{sessionId}/window_handle</td>
        <td><a>Close</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/window/size</td>
        <td><a>Set Window Size</a></td>
      </tr>
      <tr>
        <td>GET</td>
        <td>/session/{sessionId}/window/size</td>
        <td><a>Get Window Size</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/window/maximize</td>
        <td><a>Maximize Window</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/window</td>
        <td><a>Switch To Window</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/frame</td>
        <td><a>Switch To Frame</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/frame/parent</td>
        <td><a>Switch To Parent Frame</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/element</td>
        <td><a>Find Element</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/elements</td>
        <td><a>Find Elements</a></td>
      </tr>
      <tr>
        <td>GET</td>
        <td>/session/{sessionId}/element/{elementId}/displayed</td>
        <td><a>Is Element Displayed</a></td>
      </tr>
      <tr>
        <td>GET</td>
        <td>/session/{sessionId}/element/{elementId}/selected</td>
        <td><a>Is Element Selected</a></td>
      </tr>
      <tr>
        <td>GET</td>
        <td>/session/{sessionId}/element/{elementId}/attribute/{name}</td>
        <td><a>Get Element Attribute</a></td>
      </tr>
      <tr>
        <td>GET</td>
        <td>/session/{sessionId}/element/{elementId}/css/{propertyName}</td>
        <td><a>Get Element CSS Value</a></td>
      </tr>
      <tr>
        <td>GET</td>
        <td>/session/{sessionId}/element/{elementId}/text</td>
        <td><a>Get Element Text</a></td>
      </tr>
      <tr>
        <td>GET</td>
        <td>/session/{sessionId}/element/{elementId}/name</td>
        <td><a>Get Element Tag Name</a></td>
      </tr>
      <tr>
        <td>GET</td>
        <td>/session/{sessionId}/element/{elementId}/rect</td>
        <td><a>Get Element Rect</a></td>
      </tr>
      <tr>
        <td>GET</td>
        <td>/session/{sessionId}/element/{elementId}/enabled</td>
        <td><a>Is Element Enabled</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/execute</td>
        <td><a>Execute Script</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/execute_async</td>
        <td><a>Execute Async Script</a></td>
      </tr>
      <tr>
        <td>GET</td>
        <td>/session/{sessionId}/cookie/{name}</td>
        <td><a>Get Cookie</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/cookie</td>
        <td><a>Add Cookie</a></td>
      </tr>
      <tr>
        <td>DELETE</td>
        <td>/session/{sessionId}/cookie/{name}</td>
        <td><a>Delete Cookie</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/timeouts</td>
        <td><a>Set Timeouts</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/actions</td>
        <td><a>Actions</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/element/{elementId}/click</td>
        <td><a>Element Click</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/element/{elementId}/tap</td>
        <td><a>Element Tap</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/element/{elementId}/clear</td>
        <td><a>Element Clear</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/element/{elementId}/sendKeys</td>
        <td><a>Element Send Keys</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/dismiss_alert</td>
        <td><a>Dismiss Alert</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/accept_alert</td>
        <td><a>Accept Alert</a></td>
      </tr>
      <tr>
        <td>GET</td>
        <td>/session/{sessionId}/alert_text</td>
        <td><a>Get Alert Text</a></td>
      </tr>
      <tr>
        <td>POST</td>
        <td>/session/{sessionId}/alert_text</td>
        <td><a>Send Alert Text</a></td>
      </tr>
      <tr>
        <td>GET</td>
        <td>/session/{sessionId}/screenshot</td>
        <td><a>Take Screenshot</a></td>
      </tr>
    </table>
  </section>

  <section>
    <h3>Handling Errors</h3>
    <p>Errors are represented in the WebDriver protocol with a HTTP response with a HTTP status in the 4xx or 5xx range and a JSON body containing details of the error. This JSON body has two fields; <code>error</code>, containing a string indicating the error type and <code>error</code> containing an implementation-defined string containing a human readable description of the kind of error that occured.</p>

    <aside class="example">
      <p>A <code>DELETE</code> request to <code>/session/1234</code>, where <code>1234</code> is not the id of a <a title="current active session">currently active session</a> would return a HTTP <code>404</code> response with a body of the form:</p>
        <pre class="highlight">
{
  "status": "invalid session id",
  "error": "No active session with id 1234"
}</pre>
    </aside>

    <p>The following table lists each <dfn>error code</dfn>, its associated HTTP status, JSON status value, and gives a non-normative description of the error. The <dfn>error response data</dfn> for a particular <a>error code</a> is the values of the <i>HTTP Status</i> and <i>JSON Status</i> columns for the row corresponding to that <a>error code</a>.</p>

    <table class="simple">
      <tr>
        <th>Error Code</th>
        <th>HTTP Status</th>
        <th>JSON Status</th>
        <th>Description</th>
      </tr>
      <tr>
        <td><dfn>element not selectable</dfn></td>
        <td>400</td>
        <td><code>element not selectable</code></td>
        <td>An attempt was made to select an element that cannot be selected.</td>
      </tr>
      <tr>
        <td><dfn>element not visible</dfn></td>
        <td>400</td>
        <td><code>element not visible</code></td>
        <td>An element command could not be completed because the element is not visible on the page.</td>
      </tr>
      <tr>
        <td><dfn>invalid argument</dfn></td>
        <td>400</td>
        <td><code>invalid argument</code></td>
        <td>The arguments passed to a command are either invalid or malformed.</td>
      </tr>
      <tr>
        <td><dfn>invalid cookie domain</dfn></td>
        <td>400</td>
        <td><code>invalid cookie domain</code></td>
        <td>An illegal attempt was made to set a cookie under a different domain than the current page.</td>
      </tr>
      <tr>
        <td><dfn>invalid element coordinates</dfn></td>
        <td>400</td>
        <td><code>invalid element coordinates</code></td>
        <td>The coordinates provided to an interactions operation are invalid.</td>
      </tr>
      <tr>
        <td><dfn>invalid element state</dfn></td>
        <td>400</td>
        <td><code>invalid element state</code></td>
        <td>An element command could not be completed
         because the element is in an invalid state
         (e.g. attempting to click an element that is no longer attached
         to the <a href=http://www.w3.org/TR/dom/#interface-document>Document</a>).</td>
      </tr>
      <tr>
        <td><dfn>invalid selector</dfn></td>
        <td>400</td>
        <td><code>invalid selector</code></td>
        <td>Argument was an invalid selector.</td>
      </tr>
      <tr>
        <td><dfn>invalid session id</dfn></td>
        <td>404</td>
        <td><code>invalid session id</code></td>
        <td>The session with the session ID does not exist.
         This could be either from the session being quit
         or the session ID passed in is not currently active.</td>
      </tr>
      <tr>
        <td><dfn>javascript error</dfn></td>
        <td>500</td>
        <td><code>javascript error</code></td>
        <td>An error occurred while executing JavaScript supplied by the user.</td>
      </tr>
      <tr>
        <td><dfn>move target out of bounds</dfn></td>
        <td>500</td>
        <td><code>move target out of bounds</code></td>
        <td>The target for mouse interaction is not in the browser's viewport and cannot be brought into that viewport.</td>
      </tr>
      <tr>
        <td><dfn>no such alert</dfn></td>
        <td>400</td>
        <td><code>no such alert</code></td>
        <td>An attempt was made to operate on a modal dialog when one was not open.</td>
      </tr>
      <tr>
        <td><dfn>no such element</dfn></td>
        <td>404</td>
        <td><code>no such element</code></td>
        <td>An element could not be located on the page using the given search parameters.</td>
      </tr>
      <tr>
        <td><dfn>no such frame</dfn></td>
        <td>400</td>
        <td><code>no such frame</code></td>
        <td>A request to switch to a frame could not be satisfied because the frame could not be found.</td>
      </tr>
      <tr>
        <td><dfn>no such window</dfn></td>
        <td>400</td>
        <td><code>no such window</code></td>
        <td>A request to switch to a different window could not be satisfied because the window could not be found.</td>
      </tr>
      <tr>
        <td><dfn>script timeout</dfn></td>
        <td>408</td>
        <td><code>script timeout</code></td>
        <td>A script did not complete before its timeout expired.</td>
      </tr>
      <tr>
        <td><dfn>session not created</dfn></td>
        <td>500</td>
        <td><code>session not created</code></td>
        <td>A new session could not be created.</td>
      </tr>
      <tr>
        <td><dfn>stale element reference</dfn></td>
        <td>400</td>
        <td><code>stale element reference</code></td>
        <td>An element command failed because the referenced element
         is no longer attached to the
         <a href=http://www.w3.org/TR/dom/#interface-document>Document</a>.</td>
      </tr>
      <tr>
        <td><dfn>timeout</dfn></td>
        <td>408</td>
        <td><code>timeout</code></td>
        <td>An operation did not complete before its timeout expired.</td>
      </tr>
      <tr>
        <td><dfn>unable to set cookie</dfn></td>
        <td>500</td>
        <td><code>unable to set cookie</code></td>
        <td>A request to set a cookie's value could not be satisfied.</td>
      </tr>
      <tr>
        <td><dfn>unexpected alert open</dfn></td>
        <td>500</td>
        <td><code>unexpected alert open</code></td>
        <td>A modal dialog was open, blocking this operation.</td>
      </tr>
      <tr>
        <td><dfn>unknown command</dfn></td>
        <td>404</td>
        <td><code>unknown command</code></td>
        <td>A command could not be executed because the remote end is not aware of it.</td>
      </tr>
      <tr>
        <td><dfn>unknown error</dfn></td>
        <td>500</td>
        <td><code>unknown error</code></td>
        <td>An unknown error occurred in the remote end while processing the command.</td>
      </tr>
      <tr>
        <td><dfn>unknown method</dfn></td>
        <td>405</td>
        <td><code>unknown method</code></td>
        <td>The requested command matched a known URL but did not match an method for that URL.</td>
      </tr>
      <tr>
        <td><dfn>unsupported operation</dfn></td>
        <td>500</td>
        <td><code>unsupported operation</code></td>
        <td>Indicates that a command that should have executed properly cannot be supported for some reason.</td>
      </tr>
    </table>
  </section>

  <section>
    <h2>Handling of Status Codes at the Local End</h2>

    <p>Status codes are returned from the <a href="#remote-end">remote end</a> to the <a href="#local-end">local end</a>. The <a href="#local-end">local end</a> SHOULD convert these into a form appropriate for the implementation language. For example, in C the status codes might be converted to constant integer values, whereas in Java various exceptions could be thrown.</p>

    <p>Implementations of the <a href="#local-end">local end</a> written in languages that support exceptions SHOULD make use of an exception hierarchy rooted on a <code>WebDriverException</code> (or similarly named base exception class). Where references to <code>WebDriverException</code> are made in this specification, we are referring to this local end conversion of status codes to local end exceptions.</p>

    <p class="note">The reason for this is to allow users of the local end to easily handle the all expected failure modes of a local WebDriver implementation by catching the <code>WebDriverException</code>.</p>

     <p class="note">It is strongly recommended that the <code>WebDriverException</code> contain as much diagnostic information as possible, including version numbers and details about the remote end. This is because experience suggests that when reporting errors from tests using WebDriver, users will simply cut-and-paste a stack trace of an exception. Adding this information to the exception makes the task of debugging problems considerably easier.</p>
  </section>

</section>
<!-- Section removed as it was describing specific local end implementations --><section>

<h2>Sessions</h2>

<p><em>Non-normative summary:</em>
 A session is equivalent to a single instantiation of a particular user agent,
 including all its child browsers.
 WebDriver gives each session a unique <a>session ID</a>
 that can be used to differentiate one session from another,
 allowing multiple user agents to be controlled on the same machine if needed,
 and allowing sessions to be routed via a multiplexer
 (known as an <a>intermediary node</a>).

<p class=note>This requires the <a>remote end</a> to maintain global state of
 <a rel="list of active sessions">current active sessions</a>,
 as well as the <a>current session</a> that only lasts for the duration of that session.

<p>A WebDriver <dfn>session</dfn> represents
 the connection between a local end and a specific remote end.
 A remote end that is not an <a>intermediary node</a>
 must have at most one <a>active session</a> at a given time.
<!-- Is this actually a requirement? -->

<!-- TODO(jgraham):
 Need to explain that there must be a relationship
 between the current session and the browser state.
-->

<p>The <a>session</a> is set up at the invocation of
 a <a href=#newsession>new session</a>,
 and torn down at some later point;
 either explicitly by invoking <a href=#>quit</a>,
 or implicitly when <a href=#close>close</a> is called at the last remaining
 <a href=http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context>top level browsing context</a>.

<p>A <a>remote end</a> has an associated <dfn>list of active sessions</dfn>,
 which is a list of all <a rel="session">sessions</a> that are currently started.

<p>A <a>remote end</a> has an associated <a>current session</a>
 that is the <a rel="active session">session that is active</a>
 for the duration of a <a>command</a>.

<p>A <a>remote end</a> has an associated
 <dfn>maximum active sessions</dfn> (an integer)
 that defines the number of current <a rel="active session">active sessions</a>
 that are supported.
 This may be "unlimited" for <a rel="intermediary node">intermediary nodes</a>,
 but must be exactly one for a <a>final remote end</a>.
<!-- TODO(ato):
 "final remote end" isn't great terminology,
 but I mean the ultimate, non-intermediary driver implementation.
-->

<p>A <a>session</a> has an associated <dfn>session ID</dfn>
 (a <a>UUID</a>) used to uniquely identify this session.  Unless
 stated otherwise it is null.

<p>A <a>session</a> has an associated <dfn>current browsing
 context</dfn>, which is the browsing context against which commands
 will run.</p>

<p>A <a>session</a> has an associated
 <dfn>current top level browsing context</dfn>,
 which is the <a>current browsing context</a> if it itself is a
 <a href=http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context>top-level browsing context</a>,
 or the top-level browsing context for which
 the <a>current browsing context</a> is an <a href="https://html.spec.whatwg.org/#ancestor-browsing-context">ancestor browsing context</a>.

<p>The top-level browsing context is said to be <dfn>no longer open</dfn>
 if it has been <a href=https://html.spec.whatwg.org/#a-browsing-context-is-discarded>discarded</a>.

<!-- TODO(ato): https://www.w3.org/Bugs/Public/show_bug.cgi?id=28005 -->
<p>A <a>session</a> has an associated <dfn>script timeout</dfn>
 that specifies a time to wait for scripts to run.
 Unless stated otherwise it is 30,000 milliseconds (30 seconds).

<!-- TODO(ato): https://www.w3.org/Bugs/Public/show_bug.cgi?id=28004 -->
<p>A <a>session</a> has an associated <dfn>page load timeout</dfn>
 that specifies a time to wait for the page loading to complete.
 Unless stated otherwise it is 300,000 milliseconds (five minutes).

<p>A <a>session</a> has an associated <dfn>implicit wait timeout</dfn>
 that specifies a time to wait for the <a>implicit element location strategy</a>
 when locating elements using <a href=#findelement>find element</a>
 and <a href=#findelements>find elements</a>.
 Unless stated otherwise it is zero milliseconds.

<p>A <a>session</a> has an associated <dfn>page loading strategy</dfn>,
 which is one of <i>none</i>, <i>normal</i>, and <i>eager</i>.
 Unless stated otherwise, it is <i>normal</i>.

<p><em>Non-normative:</em>
 A <a>session</a> is started when <a href=#newsession>new session</a> is invoked.
 It is an error to send any commands before starting a session,
 or to continue to send commands after the session has been.
 Maintaining session continuity between requests to the <a>remote end</a>
 requires passing a <a>session ID</a>.

  <section>
    <h3>newSession()</h3>
    <p><table class="simple jsoncommand">
      <tr>
        <th>HTTP Method</th>
        <th>Path Template</th>
        <th>Notes</th>
      </tr>
      <tr>
        <td>POST</td>
        <td id='post-session'>/session</td>
        <td></td>
      </tr>
    </table>
    <p>The process for successfully creating a session MUST be:</p>
    <ol>
      <li>The local end creates a new <a>Capabilities</a> instance describing the desired capabilities
      for the session. The <a>Capabilities</a> object MUST be defined but MAY be empty.</li>
      <li>The local end MUST populate <var>parameters</var> with an object containing an
      entry named "desiredCapabilities" with the value set to the <a>Capabilities</a> instance from the previous step. An optional
      "requiredCapabilities" entry MAY also be created and populated with a <a>Capabilities</a> instance. The "sessionId" fields
      SHOULD be left empty.</li>
      <li>The remote end MUST examine the "requiredCapabilities" parameter if specified, SHOULD examine the "desiredCapabilities" parameter, and MUST create a new session matching as many of the <a>Capabilities</a> as
      possible.
      How the new session is created depends on the implementation of this specification.
        <ul>
          <li>If any of the "requiredCapabilities" cannot be fulfilled by the new session, the remote end MUST quit the session and return the
            <code><a href="#status-session-not-created">session not created</a></code> error code. The <var>sessionId</var> MUST be left as the default value unless one was set in the initial request, in which case that value MUST be used. The error message SHOULD list all unmet required capabilities though only a single required capability MUST be given.</li>
          <li>If a capability is listed in both the requiredCapabilities and desiredCapabilities, the value in the requiredCapabilities MUST be used.</li>
          </ul>
      </li>
      <li>The session MUST be assigned a <code><a href="#sessionid">sessionId</a></code> which MUST be unique for each session (a UUID SHOULD be used). Generating the sessionId
      MAY occur before the session is created. If the <code>parameters</code> object had the "sessionId" key with a value, this MAY be
      discarded in favour of the freshly generated sessionId. Because of this, it is
      recommended that sessionId generation be done on the remote end. If the sessionId has already been used, a Response MUST be sent with the status
      code set to <code><a href="#status-session-not-created">session not created</a></code> and the value being an explanation that the sessionId has previously been used.</li>
      <li>The remote end MUST then return the session id, with the following fields MUST be set to:
      <ul>
        <li>"sessionId": the <code>sessionId</code> associated with this session.</li>
        <li name="create-session-value">"value": a <a>Capabilities</a> instance. The keys of this <a>Capabilities</a> instance MUST be the strings given in each of the supported <a>Capabilities</a> as defined in the relevant sections of this specification. Supported functionality MUST be included in this <a>Capabilities</a> instance, while unsupported functionality MAY be omitted.</li>
        <li>"status": the <code><a href="#status-success">success</a></code> error code.</li>
      </ul></li>
    </ol>

    <p>As stated, when returning the <a href="#create-session-value">value of the Response, the remote end MUST include the capability names and values of all supported <a>Capabilities</a> from this specification. They MAY also include any additional capability names and values of supported <a>Capabilities</a> implemented independently of this specification. Local ends MAY choose to ignore this additional information. <a href="#intermediate-node">Intermediate nodes</a> between the local and remote ends MAY interpret the <a>Capabilities</a> being returned.</p>

    <p>If the <code>browserName</code> is given as a desired capability and omitted from the required capabilities, and the returned <code>browserName</code> value does not match the requested one, local ends SHOULD issue a warning to the user. How this warning is issued is undefined, but one implementation could be a log message. In this particular case, local ends MAY chose to change the <code>Response</code>'s status code to <code><a href="#status-session-not-created">session not created</a></code>, and modify the value to explain the cause, including the value originally returned as the <code>browserName</code> capability. If this is done, the local end MUST ensure that the remote end quits the session.</p>

    <section>
      <h3>Capability Names</h3>
      <p>The following keys SHOULD be used in the <a>Capabilities</a> instances. They all default to the null string.</p>
      <dl>
        <dt><span id="capability-browserName">browserName</span></dt>
        <dd>The name of the desired browser as a string.</dd>
        <dt><span id="capability-browserVersion">browserVersion</span></dt>
        <dd>The version number of the browser, given as a string.</dd>
        <dt><span id="capability-platformName">platformName</span></dt>
        <dd>The OS that the browser is running on, matching any of the platform names given below.</dd>
        <dt><span id="capability-platformVersion">platformVersion</span></dt>
        <dd>The version of the OS that the browser is running on as a string.</dd>
      </dl>

      <section>
        <h3>Platform Names</h3>
        <p>The following platform names are defined and MUST be used, case sensitively, for the "platformName" unless the actual platform being used is not given in this list:</p>
        <ul>
          <li>android</li>
          <li>ios</li>
          <li>linux</li>
          <li>mac</li>
          <li>unix</li>
          <li>windows</li>
        </ul>
        <p>In addition "any" MAY be used to indicate the underlying OS is either unknown or does not matter.</p>

        <p>Implementors MAY add additional platform names. Until these are standardized, these MUST follow the conventions outlined in <a href="#extending-the-protocol">extending the protocol</a> section with the exception that the vendor prefix SHOULD omit the leading "-" character.<p>

        <p class="note">For example, Mozilla's Firefox OS could be described as either "-MOZ-FIREFOXOS". The latter makes it easier for local ends to specify an enum of supported platforms and is therefore recommended in this case.</p>

        <!-- TODO: Add section on comparing platforms -->

      </section>
    </section>
    <section>
      <h3>Error Handling</h3>
      <p>The following status codes MUST be returned by the "newSession" command:</p>
      <dl>
        <dt><code><a href="#status-success">success</a></code></dt>
        <dd>The session was successfully created. The "value" field of the <code>Response</code> MUST contain a <a>Capabilities</a> object describing the session.</dd>
        <dt><code><a href="#status-timeout">timeout</a></code></dt>
        <dd>The new session could not be created within the time allowed for command execution on the remote end. This
        time MAY be infinite (in which case this status won't be seen). The "value" field of the Response SHOULD contain a string explaining that a timeout has
        occurred, but it MAY be left as the null value or filled with the empty string.</dd>
        <dt><code><a href="#status-unknown-error">unknown error</a></code></dt>
        <dd>An unhandled error of some sort has occurred. The "value" field of the Response SHOULD contain a more detailed
        description of the error as a string.</dd>
      </dl>
    </section>
    <section>
      <h3>Remote End Matching of Capabilities</h3>
      <p>This section is non-normative.</p>
      <p>The suggested order for comparing keys in the <a>Capabilities</a> instance when creating a session is:</p>
      <ol>
        <li>browserName</li>
        <li>browserVersion</li>
        <li>platformName</li>
        <li>platformVersion</li>
      </ol>
      <p>For all comparisons, if the key is missing (as determined by a call to Capability.has() returning "false"), that particular criteria shall not factor into the
      comparison.</p>
    </section>
  </section>
  <section>
    <h3>Removing a Session</h3>
    <p><table class="simple jsoncommand">
      <tr>
        <th>HTTP Method</th>
        <th>Path Template</th>
        <th>Notes</th>
      </tr>
      <tr>
        <td>DELETE</td>
        <td id='delete-session'>/session/{sessionId}</td>
        <td></td>
      </tr>
    </table>
    <p>When removing the session the User Agent MUST do the following
      <ol>
        <li>If the <a href='#sessionid'>sessionId</a> does not exist an <code><a href="#status-unsupported-operation">unsupported operation</a></code> will be returned.</li>
        <li>close all <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> that have the <a href='#sessionid'>sessionId</a> associated with it.</li>
        <li>set <a href='#widl-WebDriver-sessionId'><code>sessionId</code></a> to null.
      </ol>
  </section>
</section>
<section>
  <h2>Navigation</h2>
  <section>
    <h3>Introduction</h3>
    <p>Almost all usages of the WebDriver API begin by navigating to a particular URL. This section not only describes the commands used for navigation, but also describes when commands must be processed.</p>
  </section>

  <section>
    <h3 id="page-load-strategies">The Page Load Strategy</h3>

    <p><a>Local ends</a> may choose at what point during the page load cycle the remote end returns a response to navigation commands by requesting a particular <dfn>page load strategy</dfn> when creating a <a>new session</a>. The available page load strategies are:

    <dl>
      <dt><dfn>normal</dfn></dt>
      <dd><p>The response is sent when the <code>document.readyState</code> of the frame currently handling commands equals <code>complete</code>.</p>

      <dt><dfn>eager</dfn></dt>
      <dd><p>The response is sent when the <code>document.readyState</code> of frame currently handling reaches <code>interactive</code> or <code>complete</code>.</p>

      <dt><dfn>none</dfn></dd>
      <dd><p>The response is sent immediately after initiating the navigation.</p>
    </dl>

    <!-- Todo: most of this should be elsewhere -->
    <p>All WebDriver implementations MUST support the <a>normal</a> and <a>eager</a> modes and SHOULD support the <a>none</a> mode. If no page loading strategy is chosen, then <a>normal</a> MUST be the default.
    In addition, implementors MAY add additional page loading strategies.</p>
  </section>

<section>
<h3>Get</h3>

<table class="simple jsoncommand">
  <tr>
    <th>HTTP Method</th>
    <th>Path Template</th>
    <th>Notes</th>
  </tr>
  <tr>
    <td>POST</td>
    <td id=post-url>/session/{sessionId}/url</td>
    <td></td>
  </tr>
</table>

<p>The <dfn>get</dfn> command is used
 to cause the browser to navigate to a new location.
 From a user's point of view,
 it is as if they have entered the "url" into the URL bar.</p>

<aside class=example>
 <p>To navigate the current
  <a href=http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context>top-level browsing context</a>
  of the session with ID <i>1</i> to <code>http://example.com/</code>,
  the local end would send a POST to <i>/session/1/url</i> with the body:

 <pre class=highlight>{"url": "http://example.com/"}</pre>
</aside>

<p>The <a>remote end steps</a> for the <a>get</a> command are:

<ol>
 <li><p>If the <a>current top level browsing context</a> is <a>no longer open</a>,
  return an error with code <a>no such window</a>.

 <li><p>Let <var>url</var> be the result of <a>getting a property</a> named "url"
  from the <var>parameters</var> argument.

 <li><p>If <var>url</var> is undefined,
  return an <a>error</a> with code <a>invalid argument</a>.

 <li><p><a>Navigate</a> the <a>current top level browsing context</a>'s to <var>url</var>.
  If this navigation results in a HTTP 401 response,
  the <a>remote end</a> must proceed with the steps below,
  irrespective of how the authentication challenge is handled.

 <li><p>If the <a>current session</a>'s <a>page load strategy</a> is <a>none</a>
  jump to the next step in this overall set of steps.
  Otherwise:

  <ol>
   <li><p>Let <var>readiness target</var> be <code>"interactive"</code>
    if the <a>current session</a>'s <a>page load strategy is <a>eager</a>,
    or <code>"complete"</code> if it is <a>normal</a>.

   <li><p>Wait for the <a>current document readiness</a> to reach <var>readiness target</var>,
    or for the <a>current session</a>'s <a>load timeout</a> milliseconds to pass,
    whichever occurs sooner.

   <li><p>If the previous step completed by the <a>load timeout</a> being reached,
    and the browser is not currently displaying an alert,
    <!-- perhaps? Not sure if this is what the spec is trying to say -->
    return an <a>error</a> with code <a>timeout</a>.
  </ol>

 <li><p>Return <a>success</a> with data null.
</ol>

<!-- TODO: Figure out if next paragraph is actually required -->
<!--li>When a page contains a META tag with the "http-equiv" attribute set to "refresh", a response MUST be returned if the timeout is greater than 1 second and the other criteria for determining whether a page is loaded are met. When the refresh period is 1 second or less and the page loading strategy is "normal" or "conservative" implementations MUST wait for the refresh to complete before responding.</li-->

</section> <!-- /Get -->

      <section>
        <h3>getCurrentUrl</h3>

        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>GET</td>
            <td id='get-url'>/session/{sessionId}/url</td>
            <td></td>
          </tr>
        </table>
        <p>The <dfn>getCurrentUrl</dfn> command returns the url of the <a>current top level browsing context</a>
        <p>The <a>remote end steps</a> for the <a>getCurrentUrl</a> command are:</p>
        <ol>
          <li><p>If the <a>current top level browsing context</a> is <a>no longer open</a>, return an error with code <a>no such window</a>.</p></li>
          <li><p>Let <var>url</var> be the <a href="https://url.spec.whatwg.org/#concept-url-serializer">serialization</a> of the <a>current top level browsing context</a>'s <a href="https://html.spec.whatwg.org/#active-document">active document</a>'s <a href="https://dom.spec.whatwg.org/#concept-document-url">url</a>.</p></li>
          <li><p>Let <var>data</var> be a <a>new JSON Object</a>.</p>
          <li><p><a>Set the properties</a> of <var>data</var> with values ("value", <var>url</var>)</p></li>
          <li><p>Return <a>success</a> with data <var>data</var></p></li>
      </section>
      <!-- goBack() -->
      <section>
        <h3>goBack()</h3>

        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>POST</td>
            <td id='post-back'>/session/{sessionId}/back</td>
            <td></td>
          </tr>
        </table>
        <p>The "goBack" command is equivalent to a user hitting the "back" button in their browser, and MUST behave as a <a href="http://www.w3.org/TR/html/browsers.html#traverse-the-history-by-a-delta">traversal of the browser history by a delta of -1</a> (as defined in [[!html51]]). If a user calls "<code>goBack</code>" when there are no further pages in the browser's history stack, then this call MUST be a no-op.
        </p>
        <p> If the page takes too long <a href="#timeouts">as specified by the timeouts</a> a <code><a href="#status-timeout">timeout</a></code> error MUST be raised. If the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> currently receiving commands is no longer open a <code><a href="#no-such-window">no such window</a></code> error MUST be raised.
      </section>
      <section>
        <h3>goForward()</h3>

        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>POST</td>
            <td id='post-forward'>/session/{sessionId}/forward</td>
            <td></td>
          </tr>
        </table>
        <p>The "goForward" command is equivalent to a user hitting the "forward" button in their browser, and MUST behave as a <a href="http://www.w3.org/TR/html/browsers.html#traverse-the-history-by-a-delta">traversal of the browser history by a delta of +1</a> (as defined in [[!html51]]). If a user calls "<code>goForward</code>" when there are no further pages in the browser's history stack, then this call MUST be a no-op.
        <p> If the page takes too long <a href="#timeouts">as specified by the timeouts</a> a <code><a href="#status-timeout">timeout</a></code> error MUST be raised. If the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> currently receiving commands is no longer open a <code><a href="#no-such-window">no such window</a></code> error MUST be raised.
      </section>
      <section>
       <!-- refresh() -->
        <h3>refresh()</h3>

        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>POST</td>
            <td id='post-refresh'>/session/{sessionId}/refresh</td>
            <td></td>
          </tr>
        </table>
        <p>"refresh" emulates the user hitting the "refresh" or "reload" button in their browser, causing the current page to be reloaded.</p>
        <p> If the page takes too long <a href="#timeouts">as specified by the timeouts</a> a <code><a href="#status-timeout">timeout</a></code> error MUST be raised. If the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> currently receiving commands is no longer open a <code><a href="#no-such-window">no such window</a></code> error MUST be raised.
      </section>
      <section>
        <!-- getTitle() -->
        <h3>getTitle()</h3>

        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>POST</td>
            <td id='get-title'>/session/{sessionId}/title</td>
            <td></td>
          </tr>
        </table>
        <p>
          The "getTitle" command MUST return the contents of the <code>&lt;title&gt;</code> element like it would for <code>document.title</code>. In the case of a <a href='http://www.w3.org/TR/html5/browsers.html#nested-browsing-context'>Nested Browsing Context</a> WebDriver MUST return the title of the [[html51]] <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsering context</a>.

          <p> If the page takes too long <a href="#timeouts">as specified by the timeouts</a> a <code><a href="#status-timeout">timeout</a></code> error MUST be raised. If the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> currently receiving commands is no longer open a <code><a href="#no-such-window">no such window</a></code> error MUST be raised.
        </p>
      </section>
  </section>

    <section>
      <h2>Invalid SSL Certificates</h2>

      <table class="simple">
        <tr><td>Capability Name</td><td>Type</td></tr>
        <tr><td><span id="capability-securessl">secureSsl</span></td><td>boolean</td></tr>
      </table>

      <p>WebDriver implementations MUST support users accessing sites served via HTTPS. Access to those sites using self-signed or invalid certificates, and where the certificate does not match the serving domain MUST be the same as if the HTTPS was configured properly.</p>

      <p class="note">The reason for this is that implementations of this spec are often used for testing. It's a sorry fact that many QA engineers and testers are asked to verify that apps work on sites that have insecure HTTPS configurations</p>


      <p>The exception to requirement is if the <a>Capabilities</a> used to initialize has the WebDriver session had the capability <code>secureSsl</code> set to true. In this case, implementations MAY choose to make accessing a site with bad HTTPS configurations cause a <code>WebDriverException</code> to be thrown. Remote end implementations MUST return an <code><a href="#status-unknown-error">unknown error</a></code> status in this case. If this is the case, the <a>Capabilities</a> describing the session MUST also set the <code>secureSsl</code> capability to "true".</p>
    </section>
    <section>
      <h3>Detecting When to Handle Commands</h3>

      <p>Commands MUST only be processed when the <span id="page-loading-strategies">page loading strategy</span> being used indicates that page loading is complete.</p>

      <p>Commands SHOULD be handled in a synchronous fashion. Requests should be received and then a response sent when the Command has completed.</p>
    </section>
  </section>
</section>
<section>
  <h2>Controlling Windows</h2>

  <section>
    <h2>Definitions</h2>

    <p>Within this specification, a window equates to [[!html51]]'s <a href="http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context">top level browsing context</a>. Put another way, within this spec browser tabs are counted as separate windows.</p>

    <p><strong>TODO: define "frame"</strong></p>

    <p>A <dfn id='window-handle'>Window Handow</dfn> is an opaque string that MUST uniquely identify the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> and MUST NOT be "current". This MAY be a UUID.
  </section>

  <section>
    <h2>Window Handles</h2>
    <section>
      <h3>getWindowHandle()</h3>
      <p>
        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>GET</td>
            <td id='get-window_handle'>/session/{sessionId}/window_handle</td>
            <td></td>
          </tr>
        </table>
        <p>Each <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> has a <a href='#window-handle'>window handle</a>. The "getWindowHandle" command can be used to obtain the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> handle for the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> that commands are currently acting upon.</p>

    </section>
  </section>

  <section>
    <h2 name="iterating-over-windows">Iterating Over <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a></h2>
    <section>
      <h3>getWindowHandles()</h3>

      <p>
        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>GET</td>
            <td id='get-window_handles'>/session/{sessionId}/window_handles</td>
            <td></td>
          </tr>
        </table>
        <p>This array of returned strings MUST contain a handle for every <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> associated with the browser session and no others. For each returned <a href='#window-handle'>window handle</a> the javascript expression "window.top.closed" (or equivalent) MUST evaluate to false at the time the command is being executed.</p>

    <p>The ordering of the sequence is not defined, but MAY be determined by iterating over each OS Window and returning the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> items within that OS window before iterating over the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing contexts</a> of the next OS window. For example, in the diagram below, the <a href='#window-handle'>window handle</a> should be returned as the handles for: win1tab1, win1tab2, win2.</p>

    <img src="example-windows.png" alt="Two top level windows. The first window has two tabs, lablled win1tab1 and win1tab2. The second window has only one tab labelled win2"/>

    <p class="note">This implies that the correct way to determine whether or not a particular interaction with the browser opens a new window is done by obtaining the set of <a href='#window-handle'>window handle</a> before the interaction is performed and comparing with the set after the action is performed.</p>
    </section>
  </section>

  <section>
    <h2>Closing Windows</h2>
    <section>
      <h3>close()</h3>
        <p>
          <table class="simple jsoncommand">
            <tr>
              <th>HTTP Method</th>
              <th>Path Template</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>DELETE</td>
              <td id='delete-window_handle'>/session/{sessionId}/window_handle</td>
              <td></td>
            </tr>
          </table>

        <p>The close command closes the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> that Commands are currently being sent to. If this means that a call to get the list of <a href='#window-handle'>window handle</a>s would return an empty list, then this close command MUST  <a href='removing-a-session'>remove the session</a>.</p>

        <p>Once the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> has closed, future commands MUST return a status code of <code><a href="#status-no-such-window">no such window</a></code> until a new <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> is selected for receiving commands.</p>

    </section>
  </section>

  <section>
    <h2>Resizing and Positioning Windows</h2>
    <p>All commands MUST be handled by the OS window that ultimately owns the current context.</p>
    <dl class='idl' title='dictionary WindowSize'>
      <dt>double height</dt>
      <dd>The height of the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> in <a href='http://www.w3.org/TR/css3-values/#absolute-lengths'>CSS reference pixels</a></dd>.
      <dt>double width</dt>
      <dd>The width of the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> in <a href='http://www.w3.org/TR/css3-values/#absolute-lengths'>CSS reference pixels</a></dd>.
    </dl>
    <section>
      <!-- setWindowSize() -->
      <h3>setWindowSize()</h3>
        <p>
          <table class="simple jsoncommand">
            <tr>
              <th>HTTP Method</th>
              <th>Path Template</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>POST</td>
              <td id='post-window_handle-size'>/session/{sessionId}/window/size</td>
              <td></td>
            </tr>
          </table>
        <p>
        Resizes the OS window currently receiving commands to have the <code>height</code> and <code>width</code> passed in as parameters.
        <p>If a request is made to resize a OS window to a size which cannot be performed (e.g. the browser has a minimum, or fixed OS window size, or the operating system does not support resizing windows at all as is the case in many phone OSs), an <code><a href="#status-unsupported-operation">unsupported operation</a></code> status code MUST be returned.</p>
        <p>After <code>setWindowSize</code>, the browser window MUST NOT be in the maximised state.</p>
        <dl class='parameters'>
          <dt>unsigned double width</dt>
          <dd>The "width" value refer to the javascript <code>window.outerwidth</code> property. If the User Agent does not support this property, it represents the width of the whole OS window including window chrome and window resizing borders/handles.</li></dd>
          <dt>unsigned double height</dt>
          <dd>The "height" value refer to the javascript <code>window.outerheight</code> property. If the User Agent does not support this property, it represents the width of the whole OS window including window chrome and window resizing borders/handles.</li></dd>

      </section>
      <section>
      <!-- getWindowSize() -->
      <h3>getWindowSize()</h3>
        <p>
          <table class="simple jsoncommand">
            <tr>
              <th>HTTP Method</th>
              <th>Path Template</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>GET</td>
              <td id='get-window_handle-size'>/session/{sessionId}/window/size</td>
              <td></td>
            </tr>
          </table>
        <p>
          A command named "getWindowSize()":
        <ol>
          <li>Create a <a>WindowSize</a> dictionary containing the <code><a href='#widl-WindowSize-height'>height</a></code> and <code><a href='#widl-WindowSize-width'>width</a></code> keys.
          <li>Populate <code><a href='#widl-WindowSize-width'>width</a></code> with the value of <code>window.outerwidth</code> property of the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> currently receiving commands in <a href='http://www.w3.org/TR/css3-values/#absolute-lengths'>CSS reference pixels</a>. If the User Agent does not support this property, it represents the width of the whole OS window including window chrome and window resizing borders/handles.</li>
          <li>Populate <code><a href='#widl-WindowSize-height'>height</a></code> with the value of <code>window.outerheight</code> property of the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> currently receiving commands in <a href='http://www.w3.org/TR/css3-values/#absolute-lengths'>CSS reference pixels</a>. If the User Agent does not support this property, it represents the width of the whole OS window including window chrome and window resizing borders/handles.</li>
          <li>Return <a>WindowSize</a></li>
        </ol>
      </section>

      <section>
      <!-- maximizeWindow() -->
      <h3>maximizeWindow()</h3>
        <p>
          <table class="simple jsoncommand">
            <tr>
              <th>HTTP Method</th>
              <th>Path Template</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>POST</td>
              <td id='get-window_handle-maximize'>/session/{sessionId}/window/maximize</td>
              <td></td>
            </tr>
          </table>
        <p>After  <code>maximizeWindow</code>, the OS window currently receving commands MUST be left as if the maximise button had been pressed if, and only if, the window manager of the OS supports this concept; it is not sufficient to leave the window "restored", but with the full screen dimensions.</p>
        <p>If a request is made to resize a window to a size which cannot be performed (e.g. the browser has a minimum, or fixed window size, or the operating system does not support resizing windows at all as is the case in many phone OSs), an <code><a href="#status-unsupported-operation">unsupported operation</a></code> status code MUST be returned.</p>
      </section>
      <section>
      <!-- fullscreenWindow -->
      <h3>fullscreenWindow()</h3>
        <p>After <code>fullscreenWindow</code>, the OS window currently receiving commands MUST be in full-screen mode. For those operating systems that support the concept, this MUST be equivalent to if the user requested the OS window be full screen.</p>

        <p>If the User Agent or OS does not support switching to full-screen mode, an <code><a href="#status-unsupported-operation">unsupported operation</a></code> status code MUST be returned.</p>
    </section>
  </section>
</section>
<section>
  <h2>Context of Commands</h2>

  <p>Web applications can be composed of multiple <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> and/or frames. For a normal user, the context in which an operation is performed is obvious: it's the window or frame that currently has OS focus and which has just received user input. The WebDriver API does not follow this convention. There is an expectation that many browsers using the WebDriver API may be used at the same time on the same machine. This section describes how WebDriver tracks which window or frame is currently the context in which commands are being executed.</p>

  <section>
    <h2>Default Content</h2>

    <p>WebDriver's <dfn id="default-content">default content</dfn> is [[!html51]]'s <a href="http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context">top level browsing context</a> that is currently receiving WebDriver commands.</p>

    <p>When a WebDriver instance is started and a single OS window is opened, the <a href="#default-content">default content</a> of that OS window is automatically selected for receiving further commands. If more than one OS window or multiple <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing contexts</a> are opened when the session starts, then the user MUST first select which <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> to act upon using the <code>switchToWindow</code> command. Until the user selects a <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a>, all commands must return a status code of <code><a href="#status-no-such-window">no such window</a></code>.</p>

  </section>

  <section>
    <h2>Switching Windows</h2>

    <section>
      <h3>switchToWindow()</h3>
        <dl class='parameters'>
          <dt>DOMString handle</dt>
          <dd>The identifier used for a <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a></dd>
        </dl>
        <p>
          <table class="simple jsoncommand">
            <tr>
              <th>HTTP Method</th>
              <th>Path Template</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>POST</td>
              <td id='post-window'>/session/{sessionId}/window</td>
              <td></td>
            </tr>
          </table>
          <p>
        <p>The "switchToWindow" command is used to select which <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> MUST be used as the context for processing commands. In order to determine which <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> should be used for accepting commands, the "switchToWindow" command MUST iterate over all <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> comparing the window handle.

        <p>If no <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing contexts</a> match, then a "<code><a href="#status-no-such-window">no such window</a></code>" status code MUST be returned, otherwise the "<a href="#default-content">default content</a>" of the first match will be selected for accepting commands.</p>

    </section>
  </section>

  <section>
    <h2>Switching Frames</h2>
    <section>
      <h3>switchToFrame()</h3>
        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>POST</td>
            <td id='post-frame'>/session/{sessionId}/frame</td>
            <td></td>
          </tr>
        </table>
        <dl class='parameters'>
          <dt><a>WebElement</a> or unsigned short? id</dt>
          <dd>The identifier used for a frame.</dd>
        </dl>
        <p>The "switchToFrame" command is used to select which frame which is a child of the<a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> MUST be used as the context for handling future commands. All frame switching is taken from the current context from which commands are currently being handled. The "<code>id</code>" parameter can be an unsigned short or a <a>WebElement</a>. WebDriver implementations MUST determine which frame to select using the following algorithm:

        <ol>
          <li>If the "id" is a unsigned short the current context is set to the equivalent of the JS expression "window.frames[id]" where "id" is the number and "window" is the Document window represented by the current context.</li>
          <li>If the "id" is null, the current context is set to the <a href='#default-content'>default content</a>.</li>
          <li>If the "id" represents a <a>WebElement</a>, and the corresponding <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a> represents a FRAME or an IFRAME, and the <a>WebElement</a> is part of the current context, the "window" property of that <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a> becomes the current context.</li>
        </ol>

        <p>In all cases if no match is made a "<code><a href="#status-no-such-frame">no such frame</a></code>" status code MUST be returned.</p>

        <p>If the indicated frame exists, frame switching MUST succeed even if doing so would violate the normal security constraints in place within the Javascript sandbox.</p>
      </section>
      <section>
      <h3>switchToParentFrame()</h3>

        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>POST</td>
            <td id='post-frame-parent'>/session/{sessionId}/frame/parent</td>
            <td></td>
          </tr>
        </table>
        <p>The "switchToParentFrame" command MUST set the context of future commands to the <code>window.parent</code>. If the current context is the [[!html51]]'s <a href="http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context">top level browsing context</a>, the context remains unchanged.</p>
      </section>
    </section>
  </section>
</section>
<section>
  <!-- TODO(simon): identify a better location for this -->
  <h2>Running Without Window Focus</h2>
  <p>All browsers must comply with the <a
    href="http://www.w3.org/TR/html5/editing.html#focus">focus</a> section of
  the [[!html51]] spec. In particular, the requirement that the active element within a top-level browsing
  context be independent of whether or not the top-level browsing context itself
  has system focus MUST be followed.</p>

  <p class="note">This requirement is put in place to allow efficient machine
  utilization when using the WebDriver API to control several browsers
  independently on the same desktop</p>
</section>
<section>
  <h2>Elements</h2>
  <p class="note">Conformance tests for this section can be found in the <a href="https://github.com/w3c/web-platform-tests/tree/master/webdriver/">webdriver module</a> under the "element_location" folder.</p>
  <p>One of the key abstractions of the WebDriver API is the concept of a
  <a>WebElement</a>. A <dfn>WebElement</dfn> represents an
  <a href="http://www.w3.org/TR/2012/WD-dom-20120105/#interface-element">Element</a> as defined in the
  [[!DOM4]] specification. When communicating between the remote end and the local end this SHOULD be a UUID.
  Because the WebDriver API is designed to allow users to interact with apps as if
  they were actual users, the capabilities offered by the
  <a>WebElement</a> interface are somewhat different from those offered by the
  <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a> interface.</p>

  <p id='webelement-unique-identifier'>Each <a>WebElement</a> instance must have a unique identifier, which is distinct from the value
  of the <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a> "id" property. The identifier for every WebElement representing the same
  underlying <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a> MUST be the same. The identifiers used to refer to different
  underlying <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a>s MUST be unique within the session over the entire duration of the session.
  </p>

  <div class="note">
    <p>This requirement around <a>WebElement</a> identifiers allows for efficient equality
    checks when the WebDriver API is being used out of process.</p>
  </div>


  <section>
    <h2>Finding Elements in a document</h2>
    <p>When the <a href='#findelement'>findElement()</a> or <a href='#findelements'>findElements()</a> WebDriver Command is called the
      following must be <var>parameters</var> after the local end has made a request to the remote end:</p>
    <ol>
      <li>let <var>using</var> contain the <a href='#element-location-strategies'>Element Location Strategy</a>.
        If it is not a valid stategy:
        <ul>
          <li>Set the HTTP Response status code to 500</li>
          <li>Let <var>status</var> be equal to <code><a href='#status-invalid-selector'>Invalid Selector</a></code></li>
          <li>Let <var>value</var> to a stating that the strategy is invalid. It may return a list of valid search strategies.</li>
        </ul>
      </li>
      <li>let <var>value</var> contain a string that will be passed to the <a href='#element-location-strategies'>Element Location Strategy</a> call.
        If <var>value</var> is an empty string or null:
        <ul>
          <li>Set the HTTP Response status code to 500</li>
          <li>Let <var>status</var> be equal to <a href='#status-invalid-selector'>Invalid Selector</a></li>
          <li>Let <var>value</var> to a stating that the strategy is invalid. It may return a list of valid search strategies.</li>
        </ul>
      </li>
      <li>Call the relevant <a href='#element-location-strategies'>Element Location Strategy</a> and return what is described in
        <a href='#findelement'>findElement()</a> or <a href='#findelements'>findElements()</a> WebDriver Command described below.</li>
    </ol>
    <section>
    <h3>findElements()</h3>
      <p>When there is a need to find multiple elements on a document that we can return to the local end we use the following algorithm:
        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>POST</td>
            <td id='post-elements'>/session/{sessionId}/elements</td>
            <td></td>
          </tr>
        </table>
        <ol>
          <li>Let <var>result</var> be equal to an empty list</li>
          <li>Let <var>queryResult</var> be a NodeList returned from <a href='#element-location-strategies'>Element Location Strategy</a></li>
          <li>Repeat for every value in <var>queryResult</var> if not an empty set else return <var>result</var>
              <ol>
                <li>Let <var>id</var> be the <a href='#webelement-unique-identifier'>unique identifier</a> for the DOMElement.</li>
                <li>Append <code>{"element-6066-11e4-a52e-4f735466cecf": <var>id</var>}</code> to <var>result</var></li>
              </ol>
          </li>
          <li>return <var>result</var>. The object returned will look like the following:
            <pre>
              {
                "value": [{"element-6066-11e4-a52e-4f735466cecf": id}, {"element-6066-11e4-a52e-4f735466cecf": id}]
              }
            </pre>
          </li>
        </ol>
      </p>
      <p>
        When there is a need to search from an element to find the next <a>WebElement</a>s we use the following algorithm:
        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>POST</td>
            <td id='post-elements-from-element'>/session/{sessionId}/element/{ELEMENT}/elements</td>
            <td></td>
          </tr>
        </table>
        <ol>
          <li>Let <var>result</var> be equal to an empty list.</li>
          <li>Let <var><a href="#uri-template-element">element</a></var> be the start node for the query in the <a href='#element-location-strategies'>Element Location Strategy</a></li>
          <li>Let <var>queryResult</var> be a NodeList returned from <a href='#element-location-strategies'>Element Location Strategy</a></li>
          <li>Repeat for every value in <var>queryResult</var> if not an empty set else return <var>result</var>
              <ol>
                <li>Let <var>id</var> be the <a href='#webelement-unique-identifier'>unique identifier</a> for the DOMElement.</li>
                <li>Append <code>{"element-6066-11e4-a52e-4f735466cecf": <var>id</var>}</code> to <var>result</var></li>
              </ol>
          </li>
          <li>return <var>result</var>. The object returned will look like the following:
            <pre>
              {
                "value": [{"element-6066-11e4-a52e-4f735466cecf": id}, {"element-6066-11e4-a52e-4f735466cecf": id}]
              }
            </pre></li>
        </ol>
      </p>
    </section>
    <section>
    <h3>findElement()</h3>
      <p>
        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>POST</td>
            <td id='post-element'>/session/{sessionId}/element</td>
            <td></td>
          </tr>
        </table>
        <ol>
          <li>Let <var>id</var> be an identifier for a DOMElement returned from <a href='#element-location-strategies'>Element Location Strategy</a>.
            If a NodeList is returned, the first element in the NodeList MUST be used.
            <p>If <var>id</var> is empty:
              <ul>
                <li>Let the HTTP response status code be 501</li>
                <li>let <var>status</var> contain the error <code><a href="#status-no-such-element">no such element</a></code></li>
                <li>let <var>value</var> contain the details of the search contained in <var>using</var> and <var>value</var> above.</li>
              </ul>
            </p>
            <p>If an error is returned from <a href='#element-location-strategies'>Element Location Strategy</a> do the following.(todo describe how the error is returned)
              <ul>
                <li>Let the HTTP response status code be 501</li>
                <li>let <var>status</var> contain the error <code><a href="#status-invalid-selector">invalid selector</a></code></li>
                <li>let <var>value</var> contain the details of the search contained in <var>using</var> and <var>value</var> above.</li>
              </ul>
            </p>
          </li>
          <li>Let <var>result</var> be equal to <code>{"element-6066-11e4-a52e-4f735466cecf": <var>id</var>}</code></li>
          <li>return <var>result</var>. The object returned will look like the following:
            <pre>
              {
                "value": {"element-6066-11e4-a52e-4f735466cecf": id}
              }
            </pre>
          </li>
        </ol>
      </p>
      <p>
        When searching from an element from another element the following algorithm should be used:
        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>POST</td>
            <td id='post-element-from-element'>/session/{sessionId}/element/{ELEMENT}/element</td>
            <td></td>
          </tr>
        </table>
        <ol>
          <li>Let <var><a href="#uri-template-element">element</a></var> be the start node for the query in the <a href='#element-location-strategies'>Element Location Strategy</a></li>
          <li>Let <var>id</var> be a <a href='#webelement-unique-identifier'>unique identifier</a> for the DOMElement returned from <a href='#element-location-strategies'>Element Location Strategy</a>.
            If a NodeList is returned, the first DOMElement in the NodeList MUST be used.
            <p>If <var>id</var> is empty:
              <ul>
                <li>Let the HTTP response status code be 501</li>
                <li>let <var>status</var> contain the error <code><a href="#status-no-such-element">no such element</a></code></li>
                <li>let <var>value</var> contain the details of the search contained in <var>using</var> and <var>value</var> above.</li>
              </ul>
            </p>
            <p>If an error is returned from <a href='#element-location-strategies'>Element Location Strategy</a> do the following.(todo describe how the error is returned)
              <ul>
                <li>Let the HTTP response status code be 501</li>
                <li>let <var>status</var> contain the error <code><a href="#status-invalid-selector">invalid selector</a></code></li>
                <li>let <var>value</var> contain the details of the search contained in <var>using</var> and <var>value</var> above.</li>
              </ul>
            </p>
          </li>
          <li>Let <var>result</var> be equal to <code>{"element-6066-11e4-a52e-4f735466cecf": <var>id</var>}</code></li>
          <li>return <var>result</var>. The object returned will look like the following:
            <pre>
              {
                "value": {"element-6066-11e4-a52e-4f735466cecf": id}
              }
            </pre>
          </li>
        </ol>
      </p>
    </section>
    <section>
      <h3>getActiveElement()</h3>
        <p>To get the currently active element on the document do the following algorithm:
          <table class="simple jsoncommand">
            <tr>
              <th>HTTP Method</th>
              <th>Path Template</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>POST</td>
              <td id='post-active-elements'>/session/{sessionId}/element/active</td>
              <td></td>
            </tr>
          </table>
          <ol>
            <li>Let <var>element</var> be a DOMElement that is returned from calling <code>document.activeElement</code></li>
            <li>Let <var>id</var> be the <a href='#webelement-unique-identifier'>unique identifier</a> for the DOMElement which represents <var>element</var>. If <var>element</var> does not have a <a href='#webelement-unique-identifier'>unique identifier</a> then one should be generated and stored.</li>
            <li>Let <var>result</var> be equal to <code>{"element-6066-11e4-a52e-4f735466cecf": <var>id</var>}</code></li>
            <li>return <var>result</var>. The object returned will look like the following:
            <pre>
              {
                "value": {"element-6066-11e4-a52e-4f735466cecf": id}
              }
            </pre></li>
          </ol>
        </p>
    </section>
  </section>

  <section>
    <h2 id="element-location-strategies">Element Location Strategies</h2>

    <p>All element location strategies MUST return elements in the order in which they appear in the current document.</p>
    <section>
      <h2>CSS Selectors</h2>
      <p>Strategy name: css selector</p>
      <p>If a browser supports the
      <a href="http://dev.w3.org/2006/webapi/selectors-api/">CSS Selectors API</a> ([[!SELECTORS-API]]) it MUST support locating elements by
      CSS Selector. If the browser does not support the browser CSS Selector spec it MAY choose to implement locating
      by this mechanism. If the browser can support locating elements by CSS Selector, it MUST set the "cssSelector" capability to boolean true when responding to the <a href="#newsession">newSession()</a>. Elements MUST be returned in the same order as if "<code>querySelectorAll</code>" had been called with the <code>Locator</code>'s <code>value</code>. Compound selectors are allowed.</p>
      </section>
      <section>
    </section>
    <section>
      <h2>ECMAScript</h2>
      <p>Finding elements by ecmascript is covered in the <a href="#ecmascript">ecmascript part of this spec</a>.</p>
    </section>
    <section>
      <h2>Link Text</h2>
      <p>Strategy name: link text</p>
      <p>This strategy MUST be supported by all WebDriver implementations. </p>
      <p>This strategy MUST return all <a href="http://www.w3.org/TR/html5/text-level-semantics.html#the-a-element">"a"</a> elements with visible text exactly and case sensitively equal to the term being searched for.</p>
      <div class="note">
	    <p>This is equivalent to:</p>
	    <pre>
		  elements = driver.find_elements(by = By.TAG_NAME, value = "a")
		  result = []
		  for element in elements:
		    text = element.text
		    if text == search_term:
		      result.append(element)
		</pre>
		<p>Where "search_term" is the link text being searched for, and "result" contains the list of elements to return.</p>
	  </div>
    </section>
    <section>
      <h2>Partial Link Text</h2>
      <p>Strategy name: partial link text</p>
      <p>This strategy MUST be supported by all WebDriver implementations.</p>
      <p>This strategy is very similar to <a href="#link-text">link text</a>, but rather than matching the entire string, only a subset needs to match. That is, this MUST return all <a href="http://www.w3.org/TR/html5/text-level-semantics.html#the-a-element">"a"</a> elements with visible text that partially or completely and case sensitively matches the term being searched for.</p>
      <div class="note">
	    <p>This is equivalent to:</p>
	    <pre>
		  elements = driver.find_elements(by = By.TAG_NAME, value = "a")
		  result = []
		  for element in elements:
		    text = element.text
		    if text.search(seach_term) != -1:
		      result.append(element)
		</pre>
		<p>Where "search_term" is the link text being searched for, and "result" contains the list of elements to return.</p>
	  </div>
    </section>
    <section>
      <h2>XPath</h2>
      <p>Strategy name: xpath</p>
      <p>All WebDriver implementations MUST support finding elements by XPath 1.0 [[!XPATH]] with the <a href="http://dev.w3.org/html5/spec/Overview.html#interactions-with-xpath-and-xslt">edits from section 3.3</a> of the [[!html51]] specification made. If no native support is present in the browser, a pure JS implementation MAY be used. When called, the returned values MUST be equivalent of calling "<a href="http://www.w3.org/TR/DOM-Level-3-XPath/xpath.html#XPathEvaluator-evaluate">evaluate</a>" function from [[DOM-LEVEL-3-XPATH]] with the result type set to "<a href="http://www.w3.org/TR/DOM-Level-3-XPath/xpath.html#XPathResult-ORDERED-NODE-SNAPSHOT-TYPE">ORDERED_NODE_SNAPSHOT_TYPE</a> (7).</p>
    </section>
  </section>

  <section>
   <h2 id=element-displayedness>Element Displayedness</h2>

   <p>The visibility of a <a href=http://w3c.github.io/dom/#element>Document element</a>
    is guided by what is perceptually visible to the human eye.
    An element's displayedness does in this context thus not relate
    in any way to the
    <code><a href=http://dev.w3.org/csswg/css-box/#visibility>visibility</a></code>
    or <code><a href=http://dev.w3.org/csswg/css-box/#display0>display</a></code>
    style properties [[!CSS3BOX]].

   <p>The approach used by WebDriver to ascertain an element's
    visibility is based on crude approximations about the element's
    nature and relationship in the tree.  An element is in general
    to be considered visible if any part of it is drawn on the
    canvas within the bounderies of the viewport.

   <p>When asked to <dfn>normalize style pixel values to floating
    point</dfn> for a value <var>s</var> of the type string:

   <ol>
    <li>Let <var>trimmed string</var> be a substring of <var>s</var>
     where the suffix "px" is removed.

    <li>Let <var>pixels</var> be the result of parsing
     <var>trimmed string</var> as a float.

    <li>If <var>pixels</var> is not a valid float
     or the previous operation did not succeed, return 0.0.

    <li>Round off <var>pixels</var> using <code>ceil</code>
     so that it has no more than four decimals.

    <li>Return <var>pixels</var>.
   </ol>

   <p class=note>To <a>normalize style pixel values to floating point</a>
    is almost equivalent to calling
    <code><a href=http://www.ecma-international.org/ecma-262/5.1/#sec-15.1.2.3>parseFloat</a></code>
    from [[!ECMA-262]] with the exception that
    non-valid float return values are returned as 0.0.

   <p>The <dfn>element displayed</dfn> algorithm is
    a boolean state where true signifies that the element is displayed
    and false not displayed.
    To compute the state on <var>element</var>:

   <ol>
    <li>If the attribute <code>hidden</code> is set, return false.

    <li>If the computed value of the <code>display</code> style
     property is "none", return false.

    <!-- TODO(ato): Not really sure what this means, needs review: -->
    <li>If it has a [[!CSS3-2D-TRANSFORMS]] or [[!CSS3-3D-TRANSFORMS]]
     style property that gives a negative X or Y coordinates to the canvas, return false.

    <li>If <var>element</var> is the document's root element,
     that is <code>document.documentElement</code>:

     <ol>
      <li>If the computed value of the <code>background-color</code>
       property is "transparent", run these substeps:

       <ol>
        <li>If <var>element</var> is an HTML <code>HTML</code>
         element [[!html51]], and the computed value of the
         <code>background-color</code> style property of the first
         <code>BODY</code> element descendant of the element in
         <a href=http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html#tree-order>tree
         order</a>, relative to that element, is also "transparent",
         return false.

        <li>Otherwise return true.
       </ol>
     </ol>

    <li>If <var>element</var> is an <code>option</code>
     or <code>optgroup</code> element,
     and <var>element</var>'s parent node is a <code>select</code> element:

     <ol>
      <li>Apply the <a>element displayed</a> algorithm on <var>element</var>'s parent node.
      <li>If the return value is false, abort these steps and return that value.
     </ol>

    <li>If <var>element</var> is a <code>map</code> element,
     run these substeps:

     <ol>
      <li>Let <var>any images visible</var> be a boolean initially
       set to false.

      <li>For each <code>img</code> element, <var>image element</var>
       in the document with a <code>name</code> attribute matching
       the value of <var>element</var>'s <code>usemap</code>
       attribute, run these substeps:

       <ol>
        <li>Run the <a>element displayed</a> algorithm on
         <var>image element</var> and set <var>any images visible</var>
         to <var>any images visible</var> bitwise OR its return value.
       </ol>

      <li>If <var>any images visible</var> is true, abort these
       steps and return its value.
    </ol>

    <li>If <var>element</var> is an <code>area</code> element:

     <ol>
      <li>For each ancestral element <var>parent</var>,
       in <a href=http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html#tree-order>tree order</a>,
       run the following substeps:

      <ol>
       <li>If <var>parent</var> is a <code>map</code> element,
        apply the <a>element displayed</a> algorithm on it.

       <li>If the return value is false, abort these steps and
        return that value.

       <li>Otherwise apply step 7.1 on <var>parent</var>.
      </ol>
     </ol>

    <li>If <var>element</var> is a [[!DOM4]] <a
     href=http://www.w3.org/TR/2012/WD-dom-20120105/#interface-text>
     text node</a>, return true.

    <li>If it has equal to or more than one direct descendant elements:

     <ol>
      <li>Let <var>visible children</var> be a boolean initially set to false.

     <li>For each direct descendant element <var>child</var>,

      run the following substeps:

      <ol>
       <li>Let <var>rectangle</var> be the <a
        href=http://dev.w3.org/fxtf/geometry/Overview.html#dom-domrect-domrect>DOMRect</a>
        returned by calling <code>getBoundingClientRect</code>
        on <var>child</var>.

       <li>If the value of the <code>height</code> property of
       <var>rectangle</var> is
        greater than zero CSS pixels, and the value of the
        <code>width</code> property of <var>rectangle</var>
        is greater than zero CSS pixels:

        <ol>
         <li>Set <var>visible children</var> to <var>visible children</var> bitwise OR true.
        </ol>
      </ol>
     </ol>

    <li>For each ancestral element <var>parent</var>,
     in <a href=http://www.whatwg.org/spec/web-apps/current-work/multipage/infrastructure.html#tree-order>tree order</a>,
     run the following substeps:

     <ol>
      <li>Apply the <a>element displayed</a> algorithm to <var>parent</var>.

      <li>If the return value is false, abort these steps and return that value.

      <li>If <var>parent</var> is a block element box and the
       computed values of either <code>overflow-x</code>
       or <code>overflow-y</code> is "hidden":

      <ol>
       <li>Let <var>parent dimensions</var> be the <code>DOMRect</code>
        that is the first element of the <code>DOMRectList</code>
        array returned by calling
        <code><a href=http://www.w3.org/TR/cssom-view/#dom-range-getclientrects>getClientRects</a></code>
        on <var>parent</var>.

       <li>Let <var>element dimensions</var> be the <code>DOMRect</code>
        that is the first element of the <code>DOMRectList</code>
        array returned by calling
        <code><a href=http://www.w3.org/TR/cssom-view/#dom-range-getclientrects>getClientRects</a></code>
        on <var>element</var>.

       <li>Let <var>parent style</var> be the computed style of <var>parent</var>.

       <li>Return false if any the following conditions evaluate to false:

       <ul>
        <li><var>element dimension</var>'s <code>top</code>
         is less than (<var>parent dimension</var>'s <code>bottom</code>
         − the <a title="normalize style pixel values to floating point">normalized style pixel float value</a>
         of <var>parent style</var>'s <code>borderBottomWidth</code>).

        <li><var>element dimension</var>'s <code>bottom</code>
         is less than (<var>parent dimension</var>'s <code>top</code>
         − the <a title="normalize style pixel values to floating point">normalized style pixel float value</a>
         of <var>parent style</var>'s <code>borderTopWidth</code>).

        <li><var>element dimension</var>'s <code>left</code>
         is less than (<var>parent dimension</var>'s <code>right</code>
         − the <a title="normalize style pixel values to floating point">normalized style pixel float value</a>
         of <var>parent style</var>'s <code>borderRightWidth</code> casted as a float).

        <li><var>element dimension</var>'s <code>right</code>
         is less than (<var>parent dimension</var>'s <code>left</code>
         − the <a title="normalize style pixel values to floating point">normalized style pixel float value</a>
         of <var>parent style</var>'s <code>borderLeftWidth</code> casted as a float).
      </ul>

      <li>Run step 10 on the parent elements of <var>parent</var>, if any.
     </ol>
    </ol>

    <li>Return true.
   </ol>
  </section>
</section>
<section>
  <h2>Element State</h2>
    <section>
      <h2>Reading current element state from the document</h2>
      <p class="note">Conformance tests for this section can be found in the <a href="https://github.com/w3c/web-platform-tests/tree/master/webdriver/">webdriver module</a> under the "element_state" folder.</p>

          <p>When we are returning an <a>ElementRect</a> to the local end it will need to be serialised</p>
          <dl class='idl' title='dictionary ElementRect'>
            <dt>double x</dt>
            <dd>The x coordinate for the top left of the element</dd>
            <dt>double y</dt>
            <dd>The y coordinate for the top left of the element</dd>
            <dt>double height</dt>
            <dd>Height of the element in <a href='http://www.w3.org/TR/css3-values/#absolute-lengths'>CSS reference pixels</a></dd>
            <dt>double width</dt>
            <dd>Width of the element in <a href='http://www.w3.org/TR/css3-values/#absolute-lengths'>CSS reference pixels</a></dd>
          </dl>
    <section>
      <!-- isDisplayed() -->
      <h3>isDisplayed()</h3>

      <table class="simple jsoncommand">
        <tr>
          <th>HTTP Method</th>
          <th>Path Template</th>
          <th>Notes</th>
        </tr>
        <tr>
          <td>GET</td>
          <td id='get-id-displayed'>/session/{sessionId}/element/{element}/displayed</td>
          <td></td>
        </tr>
      </table>

      <p>The command is used to determine the
       <a rel="element displayed">element displayedness</a> of
       the <a href=http://w3c.github.io/dom/#element>Document element</a>
       connected with the <a>web element</a> reference given by
       the <code>element</code> fragment in the path.

      <p>The response is composed using the following algorithm:

      <ol>
       <li>Let <var>response</var> be an initially empty
        <a>response</a>.

       <li>Let <var>visible</var> be a boolean initially set to
        false.

       <li>Let <var>element</var> be an initially undefined
        <a href="http://w3c.github.io/dom/#element">Document element</a>.

       <li>Let <var>element reference</var> be a string with the
        value of the <code>element</code> fragment from the path.

       <li>If <var>element reference</var> is null or has a
        length equal to 0, set <var>response</var>'s
        <a href=#response-status>status</a> to
        the <a>invalid argument</a> status and return <var>response</var>.

       <li>If the <a>default content</a>'s <a
        href=http.//www.w3.org/TR/html5/browser.html#top-level-browsing-context>top
        level browsing context</a> is no longer open, set
        <var>response</var>'s <a href=#response-status>status</a>
        to the <a>no such window</a> status</a> and return
        <var>response</var>.

       <li>Set <var>element</var> be the <a
        href=http://w3c.github.io/dom/#element>Document element</a>
        found after applying the <a>web element lookup</a> algorithm
        to the <a>element reference map</a>.
 
       <li>If <var>element</var> is null
        or <var>element</var> does not represent a
        <a href=http://w3c.github.io/dom/#element>Document element</a>,
        set <var>response</var>'s <a href=#response-status>status</a>
        to the <a>no such element</a> status
        and return <var>response</var>.

       <li>If <var>element</var> represents
        <a href=http://w3c.github.io/dom/#element>Document element</a>
        that is no longer attached to the document's node tree,
        set <var>response</var>'s <a href=#response-status>status</a>
        to the <a>stale element reference</a> status and return
        <var>response</var>.

       <li>Apply the <a>element displayed</a> algorithm to
        <var>element</var> and set <var>visible</var> to its
        return value.</li>

       <li>Set <var>response</var>'s
        <a href=#response-status>status</a> to <a>success</a>
        and its <a href="#response-value">value</a> to <var>visible</var>.

       <li>Return <var>response</var>.
      </ol>
    </section>

      <section>
        <!-- isSelected -->
        <h3>isSelected()</h3>
        <p>
          <table class="simple jsoncommand">
            <tr>
              <th>HTTP Method</th>
              <th>Path Template</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>GET</td>
              <td id='get-id-selected'>/session/{sessionId}/element/{ELEMENT}/selected</td>
              <td></td>
            </tr>
          </table>

          <p>The remote end MUST determine whether a <code>WebElement</code> is selected using the following algorithm:
          <ol>
            <li id="is_selectable">If the item is not "<code title='selectable'>selectable</code>", the WebElement is not selected. A <dfn id="selectable" title="selectable">selectable</dfn> element is either an OPTION element or an INPUT element of type "<a href="http://www.w3.org/TR/html5/forms.html#checkbox-state-(type=checkbox)">checkbox</a>" or "<a href="http://www.w3.org/TR/html5/forms.html#radio-button-state-(type=radio)">radio</a>".</li>
            <li>If the Document node represented by the WebElement is an OPTION element, the "<a href="http://www.w3.org/TR/html5/forms.html#concept-option-selectedness">selectedness</a>" of the element, as defined in [[!html51]] determines whether the element is selected.</li>
            <li>Otherwise, the value of the Document node's "<a href="http://www.w3.org/TR/html5/forms.html#attr-input-checked">checked</a>" property determines whether the element is selected. This MUST reflect the element's "<a href="http://www.w3.org/TR/html5/forms.html#concept-fe-checked">checkedness</a>" as defined in [[!html51]].</li>
          </ol>
          <p>If <code><a href='widl-WebElement-ELEMENT'>ELEMENT</a></code> does not represent a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a>, or it represents a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a> that is no longer attached to the document's <a href='http://w3c.github.io/dom/#concept-node-tree'>node tree</a>, then the WebDriver implementation MUST immediately abort the command and return a <code title="stale-element-reference"><a href="#status-stale-element-reference">stale element reference</a></code> error. If the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> currently receiving commands is no longer open a <code><a href="#no-such-window">no such window</a></code> error MUST be raised.
      </section>
      <section>
        <!-- getElementAttribute() -->
        <h3>getElementAttribute()</h3>
        <p>
          <table class="simple jsoncommand">
            <tr>
              <th>HTTP Method</th>
              <th>Path Template</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>GET</td>
              <td id='get-id-attribute'>/session/{sessionId}/element/{ELEMENT}/attribute/{name}</td>
              <td></td>
            </tr>
          </table>
          <div class="note">
          <p>Although the [[!html51]] spec is very clear about the difference between the properties and attributes of a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a>, users are frequently confused between the two. Because of thisend point which covers the case of returning either of the value of a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a> property or attribute. If a user wishes to refer specifically to an attribute or a property, they should evaluate Javascript in order to be unambiguous.</p>

          <p>The end result of this algorithm are values that can be passed to other commands within this specification. Notably, this means that URLs that are returned can be passed to <a href="#widl-WebDriver-get-void-DOMString-url">get</a> and the expected URL will be navigated to.</p>
          </div>

          <p>To determine the <var>value</var> of the response, the following steps must be taken where <var>name</var> is the <code>name</code> property on the <code>parameters</code> dictionary in Command, and <var>element</var> is the <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a> modeled by the <code>ELEMENT</code> parameter.:
          <ol>
            <li>Initially set <var>result</var> to null.
            <li>Handle special-cases:
              <ol>
                <li>If "<var>name</var>" case insensitively matches "<code>style</code>", then store the value of the computed value of the <code>style</code> property of <var>element</var>, <a href="http://dev.w3.org/csswg/cssom/#serialize-a-css-rule">serialized as defined</a> in the [[!CSSOM-VIEW]] spec, as <var>result</var>. Notably, CSS property names must be cased as specified in in section 6.5.1 of the [[!CSSOM-VIEW]] spec. In addition, color property values must be standardized to <a href='http://www.w3.org/TR/css3-color/#rgba-color'>RGBA color format</a> as described in [[!css3-color]]. If a user agent does not support RGBA then it MUST return a value as 1 for opacity.</li>

                <li>If "<var>name</var>" case insensitively matches "selected" or "checked", and the element is <a href="#is_selectable">selectable</a>:
                  <ol>
                    <li>If the element supports neither a <a href="http://www.w3.org/TR/html51/forms.html#concept-option-selectedness">selectedness</a> or <a href="http://www.w3.org/TR/html51/forms.html#concept-fe-checked">checkedness</a> check, then store null as <var>result</var>.</li>
                    <li>For an <code>option</code> element, store the element's <a href="http://www.w3.org/TR/html51/forms.html#concept-option-selectedness">selectedness</a> as <var>result</var>.</li>
                    <li>In all other cases, store the element's <a href="http://www.w3.org/TR/html51/forms.html#concept-fe-checked">checkedness</a> as <var>result</var>.</li>
                  </ol>
                </li>
                <li>If any of the above steps have been executed, go to the <a href="#attribute-result-coercion">result coercion</a> step of this algorithm.
              </ol>
            </li>

            <li>Obtain the property indexed by "<var>name</var>" from the element and store this as <var>result</var>. If <var>name</var> case insensitively matches "class" set <var>result</var> to be <var>element</var>'s <code>className</code> property. Similarly, if <var>name</var> case insensitively matches "readonly", set <var>result</var> to be the <var>element</var>'s <code>readOnly</code> property.</li>

            <li>If <var>result</var> is null or undefined, or if it is an object, set the value of <var>result</var> to be the <code>value</code> of the Attr node obtained by calling <code>getAttributeNode</code> on <var>element</var> iff that Attr is <code>specified</code>. That is, <var>result</var> is the equivalent of executing the following Ecmascript: <code>var attr = element.getAttributeNode(name); var result = (attr &amp;&amp; attr.specified) ? attr.value : null;</code></li>

            <li name="attribute-result-coercion">Coerce the return value to a DOMString:
              <ol>
                <li>If <var>result</var> is a boolean value, use the value "true" if <var>result</var> is true, or null otherwise.</li>
                <li>if <var>result</var> is null or undefined, set <var>result</var> to be null.</li>
                <li>In all other cases, coerce <var>result</var> to a DOMString.</li>
              </ol>
            </li>
          </ol>
          <dl class='parameters'>
            <dt>DOMString name</dt>
            <dd>The name of the property or attribute to return.</dd>
          </dl>
          <p>If the <code><a href='widl-WebElement-ELEMENT'>ELEMENT</a></code> does not represent a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a>, or it represents a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a> that is no longer attached to the document's <a href='http://w3c.github.io/dom/#concept-node-tree'>node tree</a>, then the WebDriver implementation MUST immediately abort the command and return a <code title="stale-element-reference"><a href="#status-stale-element-reference">stale element reference</a></code> error. If the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> currently receiving commands is no longer open a <code><a href="#no-such-window">no such window</a></code> error MUST be raised.
      </section>
      <section>
        <!-- getCssValue() -->
        <h3>getCssValue()</h3>
        <p>
          <table class="simple jsoncommand">
            <tr>
              <th>HTTP Method</th>
              <th>Path Template</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>GET</td>
              <td id='get-id-css-property'>/session/{sessionId}/element/{ELEMENT}/css/{propertyName}</td>
              <td></td>
            </tr>
          </table>
          <p>The "getCssValue" command will return a <code>DOMString</code> of the value of the property passed. It MUST return the value of <a href="http://dev.w3.org/csswg/cssom/#dom-cssstyledeclaration-getpropertyvalue"><code>getPropertyValue(propertyName)</code></a> returned from calling <a href='http://dev.w3.org/csswg/cssom/#dom-window-getcomputedstyle'><code>window.getComputedStyle(element)</code></a>. Color property values MUST be standardized to <a href='http://www.w3.org/TR/css3-color/#rgba-color'>RGBA color format</a> as described in [[!css3-color]]. If a user agent does not support RGBA then it MUST return a value as 1 for opacity. If the property is not present then return an empty string.
          <dl class='parameters'>
            <dt>DOMString propertyName</dt>
            <dd>The name of the property whose value will be returned</dd>
          </dl>
          <p>If the <code><a href='widl-WebElement-ELEMENT'>ELEMENT</a></code> does not represent a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a>, or it represents a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a> that is no longer attached to the document's <a href='http://w3c.github.io/dom/#concept-node-tree'>node tree</a>, then the WebDriver implementation MUST immediately abort the command and return a <code title="stale-element-reference"><a href="#status-stale-element-reference">stale element reference</a></code> error. If the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> currently receiving commands is no longer open a <code><a href="#no-such-window">no such window</a></code> error MUST be raised.
      </section>
      <section>
        <!-- getElementText() -->
        <h3>getElementText()</h3>
          <p>
            <table class="simple jsoncommand">
              <tr>
                <th>HTTP Method</th>
                <th>Path Template</th>
                <th>Notes</th>
              </tr>
              <tr>
                <td>GET</td>
                <td id='get-id-text'>/session/{sessionId}/element/{ELEMENT}/text</td>
                <td></td>
              </tr>
            </table>
            <p>The following definitions are used in this section:
          <dl>
              <dt id="text.whitespace">Whitespace</dt>
              <dd>Any text that matches the ECMAScript regular expression class <code>\s</code>.

              <dt id="text.whitespace-nbsp">Whitespace excluding non-breaking spaces</dt>
              <dd>Any text that matches the ECMAScript regular expression <code>[^\S\xa0]</code>

              <dt id="text.blocklevel">Block level element</dt>
              <dd>A block-level element is one which is not a table cell, and whose effective CSS display style is not in the set ['inline', 'inline-block', 'inline-table', 'none', 'table-cell', 'table-column', 'table-column-group']</dd>

              <dt id="text.horizontal">Horizontal whitespace characters</dt>
              <dd>Horizontal whitespace characters are defined by the ECMAScript regular expression <code>[\x20\t\u2028\u2029]</code>.</dd>
             </dl>

         <p>The expected return value is roughly what a text-only browser would display. The algorithm for determining this text is as follows:</p>

         <p>Let <code>lines</code> equal an empty array. Then:
         <ol>
            <li>if the element is in the <code>head</code> element of the document, return an empty string otherwise carry on with the algorithm below.</li>
             <li><span id="text.1">For</span> each descendent of node, at time of execution, in order:
                 <ol>
                     <li>Get whitespace, text-transform, and then, if descendent is:
                         <ul>
                             <li>a node which is not <a href="#determining-if-displayed">displayed</a>, do nothing</li>
                             <li>a [[!DOM4]] <a href="http://www.w3.org/TR/2012/WD-dom-20120105/#interface-text">text node</a> let <code>text</code> equal the <code>nodeValue</code> property of descendent. Then:
                                 <ol>
                                     <li>Remove any zero-width spaces (\u200b, \u200e, \u200f), form feeds (\f) or vertical tab feeds (\v) from <code>text</code>.</li>
                                     <li>Canonicalize any recognized single newline sequence in <code>text</code> to a single newline (greedily matching <code>(\r\n|\r|\n)</code> to a single \n)</li>
                                     <li>If the parent's effective CSS whitespace style is 'normal' or 'nowrap' replace each newline (\n) in <code>text</code> with a single space character (\x20). If the parent's effective CSS whitespace style is 'pre' or 'pre-wrap' replace each <a href="#text.horizontal">horizontal whitespace character</a> with a non-breaking space character (\xa0). Otherwise replace each sequence of <a href="#text.horizontal">horizontal whitespace characters</a> except non-breaking spaces (\xa0) with a single space character</li>
                                     <li>Apply the parent's effective CSS text-transform style as per the <a href="http://www.w3.org/TR/CSS21/text.html#propdef-text-transform">CSS 2.1 specification</a> ([[!CSS21]])</li>
                                     <li>If <code>last(lines)</code> ends with a space character and <code>text</code> starts with a space character, trim the first character of <code>text</code>.</li>
                                     <li>Append <code>text</code> to <code>last(lines)</code> in-place</li>
                                 </ol>
                             </li>
                             <li>an element which is <a href="#determining-if-displayed">displayed</a>. If the element is a:
                                 <ul>
                                     <li>BR element: Push '' to <code>lines</code> and continue</li>
                                     <li><a href="#text.blocklevel">Block-level</a> element and if <code>last(lines)</code> is not '', push '' to <code>lines</code>.</li>
                                 </ul>
                             And then recurse depth-first to <a href="#text.1">step 1</a> at the beginning of the algorithm with descendent set to the current element</li>
                             <li>If element is a TD element, or the effective CSS display style is 'table-cell', and last(lines) is not '', and <code>last(lines)</code> does not end with whitespace append a single space character to <code>last(lines)</code> [Note: Most innerText implementations append a \t here]</li>
                             <li>If element is a block-level element: push '' to <code>lines</code></li>
                         </ul>
                     </li>
                 </ol>
             </li>
             <li>The string MUST then have the white space normalised as defined in the [[!XPATH]] <a href="http://www.w3.org/TR/xpath/#function-normalize-space">normalize-space function</a> which is then returned.</li>
         </ol>
         <p>If the <code><a href='widl-WebElement-ELEMENT'>ELEMENT</a></code> does not represent a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a>, or it represents a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a> that is no longer attached to the document's <a href='http://w3c.github.io/dom/#concept-node-tree'>node tree</a>, then the WebDriver implementation MUST immediately abort the command and return a <code title="stale-element-reference"><a href="#status-stale-element-reference">stale element reference</a></code> error. If the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> currently receiving commands is no longer open a <code><a href="#no-such-window">no such window</a></code> error MUST be raised.
       </section>
       <section>
        <!-- getElementTagName() -->
        <h3>getElementTagName()</h3>
        <p>
           <table class="simple jsoncommand">
             <tr>
               <th>HTTP Method</th>
               <th>Path Template</th>
               <th>Notes</th>
             </tr>
             <tr>
               <td>GET</td>
               <td id='get-id-displayed'>/session/{sessionId}/element/{ELEMENT}/name</td>
               <td></td>
             </tr>
           </table>
           <p>The "getElementTagName" command will return a <code>DOMString</code>
            that is the <a href='http://www.w3.org/TR/DOM-Level-3-Core/glossary.html#dt-qualifiedname'>
            qualified name</a> of the element.
          <p>If the <code><a href='widl-WebElement-ELEMENT'>ELEMENT</a></code> does not represent a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a>, or it represents a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a> that is no longer attached to the document's <a href='http://w3c.github.io/dom/#concept-node-tree'>node tree</a>, then the WebDriver implementation MUST immediately abort the command and return a <code title="stale-element-reference"><a href="#status-stale-element-reference">stale element reference</a></code> error. If the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> currently receiving commands is no longer open a <code><a href="#no-such-window">no such window</a></code> error MUST be raised.
       </section>
       <section>
        <h3>ElementRect getElementRect()</h3>
        <p>
         <table class="simple jsoncommand">
           <tr>
             <th>HTTP Method</th>
             <th>Path Template</th>
             <th>Notes</th>
           </tr>
           <tr>
             <td>GET</td>
             <td id='get-id-rect'>/session/{sessionId}/element/{ELEMENT}/rect</td>
             <td></td>
           </tr>
         </table>

        <p>The "getElementRect" command MUST return the <a>ElementRect</a> with:
          <ul>
            <li><code><a href='#widl-ElementRect-x'>x</a></code> and <code><a href='#widl-ElementRect-y'>y</a></code> represent the top left coordinates of the <a>WebElement</a> relative to top left corner of the document.
            <li><code><a href='#widl-ElementRect-height'>height</a></code> and the <code><a href='#widl-ElementRect-width'>width</a></code> will contain the height and the width of the
        <a href='http://dev.w3.org/fxtf/geometry/#dom-domrect'>DOMRect</a>
        of the <a>WebElement</a>.
          </ul>
         <p>The point (0, 0) refers to the top left corner of the document.
          <p>If the <code><a href='widl-WebElement-ELEMENT'>ELEMENT</a></code> does not represent a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a>, or it represents a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a> that is no longer attached to the document <a href='http://w3c.github.io/dom/#concept-node-tree'>node tree</a>, then the WebDriver implementation MUST immediately abort the command and return a <code title="stale-element-reference"><a href="#status-stale-element-reference">stale element reference</a></code> error. If the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> currently receiving commands is no longer open a <code><a href="#no-such-window">no such window</a></code> error MUST be raised.
      </section>
      <section>
        <h3>isEnabled()</h3>
        <p>
           <table class="simple jsoncommand">
             <tr>
               <th>HTTP Method</th>
               <th>Path Template</th>
               <th>Notes</th>
             </tr>
             <tr>
               <td>GET</td>
               <td id='get-id-enabled'>/session/{sessionId}/element/{ELEMENT}/enabled</td>
               <td></td>
             </tr>
           </table>
        <p>The "isEnabled" command MUST return false if all the following criteria are met otherwise return true:
          <ul>
            <li>A form control is <a href='http://www.w3.org/html/wg/drafts/html/master/forms.html#concept-fe-disabled'>disabled</a>
            as described in [[!html51]].</li>
            <li>A <a>WebElement</a> has a <code>disabled</code> <a href="http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#boolean-attribute">boolean attribute</a> as described in <a href='http://www.w3.org/html/wg/drafts/html/master/disabled-elements.html#disabled-elements'>disabled elements</a> of [[!html51]]</li>
          </ul>

        <p>If the <code><a href='widl-WebElement-ELEMENT'>ELEMENT</a></code> does not represent a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a>, or it represents a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a> that is no longer attached to the document <a href='http://w3c.github.io/dom/#concept-node-tree'>node tree</a>, then the WebDriver implementation MUST immediately abort the command and return a <code title="stale-element-reference"><a href="#status-stale-element-reference">stale element reference</a></code> error. If the <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsing context</a> currently receiving commands is no longer open a <code><a href="#no-such-window">no such window</a></code> error MUST be raised.
      </section>
    </section>
  </section>
</section>
<section>
  <h2>Executing Javascript</h2>
  <div class="note">
    <p>Open questions: What happens if a user's JS triggers a modal dialog?
      Blocking seems like a reasonable idea, but there is an assumption that
      WebDriver is not threadsafe.

      What happens to unhandled JS errors? Caused by a user's JS? Caused by JS
      on a page? How does a user of the API obtain the list of errors? Is that
      list cleared upon read?
    </div>
    <p class="note">Conformance tests for this section can be found in the <a href="https://github.com/w3c/web-platform-tests/tree/master/webdriver/">webdriver module</a> under the "ecmascript" folder.</p>

    <section>
      <h2>Javascript Command Parameters</h2>

      <p>When calling <a href="#sync-js-execution">Synchronous JavaScript Execution</a> or calling <a href="async-js-execution">Asynchronous JavaScript Execution</a> we need to extract
        the following from <var><a href="#post-payload">payload body</a></var> into <dfn>JavaScript Command Parameters</dfn>:</p>

        <ul>
          <li>let <var>script</var> be the JavaScript to execute, in the form of a Function body.</li>
          <li>let <var>args</var> be an array that are used as the parameters to the function defined by <var>script</var>.
            The <var>args</var> can contain the numbers, booleans, a WebElement, objects or arrays</li>
        </ul>
    </section>

    <p>When executing Javascript, it MUST be possible to reference the <code>args</code> parameter using the function's <code>arguments</code> object. The arguments MUST be in the same order as defined in <code>args</code>. Each WebDriver implementation MUST preprocess the values in <code>args</code> using the following algorithm:

      <p id="JS-args-preprocess">For each index, <code>index</code> in <code>args</code>, if <code>args[index]</code> is...
        <ol>
          <li>a long, boolean, DOMString, or <code>null</code>, then let <code>args[index] = args[index]</code>.</li>
          <li>a sequence, then recursively apply this algorithm to <code>args[index]</code> and assign the result to <code>args[index]</code>.</li>
          <li>an object, then recursively apply this algorithm to each value in <code>args[index]</code> and assign the result to <code>args[index]</code>.</li>
          <li>a <a href="#elements">WebElement</a>, then:
            <ol>
              <li>If <code><a href='widl-WebElement-ELEMENT'>ELEMENT</a></code> does not represent a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a>, or it represents a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a> that is no longer attached to the document's tree, then the WebDriver implementation MUST immediately abort the command and return a <code title="stale-element-reference"><a href="#status-stale-element-reference">stale element reference</a></code> error.</li>
              <li>Otherwise, let <code>args[index]</code> be the underlying <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a>.</li>
            </ol>
          </li>
          <li>Otherwise WebDriver implementations MAY throw an <code><a href="#status-unknown-error">unknown error</a></code> indicating the index of the unhandled parameter but SHOULD attempt to convert the value into a <code>object</code>.</li>
        </ol>
        <section>
          <h2 id="sync-js-execution">Synchronous Javascript Execution</h2>
          <section>
            <!-- executeScript() -->
            <h3>executeScript()</h3>
            <dd>
              <dl class='parameters'>
                <dt> DOMString script</dt>
                <dd>The script to execute.</dd>
                <dt>sequence&lt;Argument>? args</dt>
                <dd>The script arguments.</dd>
              </dl>
              <p>
                <table class="simple jsoncommand">
                  <tr>
                    <th>HTTP Method</th>
                    <th>Path Template</th>
                    <th>Notes</th>
                  </tr>
                  <tr>
                    <td>POST</td>
                    <td id='post-execute_script'>/session/{sessionId}/execute</td>
                    <td></td>
                  </tr>
                </table>
                <p>
              <p>When executing JavaScript, the WebDriver implementations MUST use the following algorithm:
                <ol>
                  <li>Let <code>window</code> be the <a href="http://www.w3.org/TR/Window/">Window</a> object for WebDriver's current <a href="#where-commands-are-handled">command context</a>.
                  <li>Let <code>script</code> be the DOMString from the command's <code>script</code> parameter.
                  <li>Let <code>fn</code> be the Function object created by executing <code>new Function(script);</code>
                  <li>Let <code>args</code> be the sequence created by the pre-processing algorithm defined <a href="#JS-args-preprocess">above</a>.
                  <li>Invoke <code>fn.apply(window, args);</code>
                  <li>If the previous step errors then:
                  <ol>
                    <li>Let <code>error</code> be the thrown value.
                    <li>Set the response <a href="href=#response-status">status</a> to <code><a href="#status-javascript-error">javascript error</a></code>.
                    <li>Set the response <a href="#response-value">value</a> to a <code>object</code>, <code>dict</code>.
                    <li>If <code>error</code> is an Error, then set a "message" entry in <code>dict</code> whose value is the DOMString defined by <code>error.message</code>.
                    <li>Otherwise, set a "message" entry in <code>dict</code> whose value is the DOMString representation of <code>error</code>.
                  </ol>
                  <li>Otherwise:
                  <ol>
                    <li>Let <code>result</code> be the value returned by the function in step #5.
                    <li>Set the command's response <a href='#response-status'>status</a> to <code><a href="#status-success">success</a></code>.
                    <li>Let <code>value</code> be the result of the following algorithm:
                  <ol>
                    <li>If <code>result</code> is:
                    <ol>
                      <li><code>undefined</code> or <code>null</code>, return <code> null</code>.
                      <li>a long, boolean, or DOMString, return <code>result</code>.
                      <li>a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a>, then return the corresponding WebElement for that <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a>.
                      <!-- Should there be a recursion limit? -->
                      <li>a <code>Sequence &lt;Node&gt; nodes</code>, then return the result of recursively applying this algorithm to <code>result</code>.
                      <!-- Should there be a limit? -->
                      <li>an object, then return the <code>object</code> created by recursively applying this algorithm to each property in <code>result</code>.
                    </ol>
                  </ol>
                  <li>Set the response <a href="#response-value">value</a> to <code>value</code>.</li>
                </ol>
                <li>Return the response.</li>
              </ol>
            </section>
        </section>
        <section>
          <h2>Asynchronous Javascript Execution</h2>
          <section>
            <h3 id="async-js-execution">executeAsyncScript()</h3>

              <dl class='parameters'>
                <dt> DOMString script</dt>
                <dd>The script to execute.</dd>
                <dt>sequence&lt;Argument>? args</dt>
                <dd>The script arguments.</dd>
              </dl>
              <p>
                <table class="simple jsoncommand">
                  <tr>
                    <th>HTTP Method</th>
                    <th>Path Template</th>
                    <th>Notes</th>
                  </tr>
                  <tr>
                    <td>POST</td>
                    <td id='post-execute_async'>/session/{sessionId}/execute_async</td>
                    <td></td>
                  </tr>
                </table>
                <p>
              <p>When executing asynchronous JavaScript, the WebDriver implementation MUST use the following algorithm:
                <ol>
                  <li>Let <code>timeout</code> be the value of the last "script" <a href="#timeouts">timeout command</a>, or 0 if no such commands have been received.</li>
                  <li>Let <code>window</code> be the <a href="http://www.w3.org/TR/Window/">Window</a> object for WebDriver's current <a href="#where-commands-are-handled">command context</a>.</li>
                  <li>Let <code>script</code> be the DOMString from the command's <code>script</code> parameter.</li>
                  <li>Let <code>fn</code> be the Function object created by executing <code>new Function(script);</code></li>
                  <li>Let <code>args</code> be the sequence created by the pre-processing algorithm defined <a href="#JS-args-preprocess">above</a>.</li>
                  <li>Let <code>callback</code> be a Function object pushed to the end of <code>args</code>.</li>
                  <li>Register a one-shot timer on <code>window</code> set to fire <code>timeout</code> milliseconds in the future.</li>
                  <li>Invoke <code>fn.apply(window, args);</code></li>
                  <li>If the previous step errors then:
                    <ol>
                      <li>Let <code>error</code> be the thrown value.</li>
                      <li>Set the response <a href='#response-status'>status</a> to <code><a href="#status-javascript-error">javascript error</a></code>.</li>
                      <li>Set the response <a href="#response-value">value</a> to a <code>object</code>, <code>dict</code>.</li>
                      <li>If <code>error</code> is an Error, then set a "message" entry in <code>dict</code> whose value is the DOMString defined by <code>error.message</code>.</li>
                      <li>Otherwise, set a "message" entry in <code>dict</code> whose value is the DOMString representation of <code>error</code>.</li>
                    </ol>
                  </li>
                  <li>Otherwise, the WebDriver implementation MUST wait for one of the following to occur:
                    <ol>
                      <li>if the one-shot timer that was set on the <code>window</code> fires
                        , the WebDriver implementation MUST immediately set the response <a href='#response-status'>status</a>
                        to <code><a href='#status-timeout'>timeout</a></code> and return.</li>
                        <li>if the <code>window</code> fires an <code>unload</code> event, the WebDriver implementation MUST immediately set the response <a href='#response-status'>status</a> to JavascriptError and return with the error message set to "Javascript execution context no longer exists.".</li>
                        <li>if the <code>callback</code> function is invoked, then:
                          <ol>
                            <li>Let <code>result</code> be the first argument passed to <code>callback</code>.</li>
                            <li>Set the command's response <a href='#response-status'>status</a> to Success.</li>
                            <li>Let <code>value</code> be the result of the following algorithm:
                              <ol>
                                <li>If <code>result</code> is:
                                  <ol>
                                    <li><code>undefined</code> or <code>null</code>, return <code> null</code>.</li>
                                    <li>a long, boolean, or DOMString, return <code>result</code>.</li>
                                    <li>a <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a>, then return the corresponding WebElement for that <a href='http://w3c.github.io/dom/#element'>Document <code>element</code></a>.</li>
                                    <!-- Should there be a recursion limit? -->
                                    <li>a <code>Sequence &lt;Node> Nodes</code>, then return the result by recursively applying this algorithm to <code>result</code>. WebDriver implementations SHOULD limit the recursion depth.</li>
                                    <!-- Should there be a limit? -->
                                    <li>an object, then return the <code>object</code> created by recursively applying this algorithm to each property in <code>result</code>.</li>
                                  </ol>
                                </li>
                              </ol>
                            </li>
                            <li>Set the command's response <a href="#response-value">value</a> to <code>value</code>.</li>
                          </ol>
                        </li>
                        <li>Return the response.</li>
                      </ol>
                    </li>
                  </ol>
                </section>
        </section>
        <section>
          <h2>Reporting Errors</h2>
          <p></p>
        </section>
</section>
<section>
  <h2>Cookies</h2>

  <p>This section describes the interaction with
  <a href='http://www.w3.org/TR/html5/dom.html#dom-document-cookie'>cookies</a>
  as described in the HTML Specification ([[!html51]]). When retrieving
  and setting a cookie it MUST be in the format of a <code>Cookie</code>.</p>
  <p class="note">Conformance tests for this section can be found in the <a href="https://github.com/w3c/web-platform-tests/tree/master/webdriver/">webdriver module</a> under the "cookies" folder.</p>
  <section>
    <h2>Cookie</h2>
    <p>When returning Cookie objects, the server SHOULD include all optional fields it is capable of providing the information for.</p>
    <section>
      <!-- getCookie() -->
      <h3>getCookie</h3>
        <p>
          <table class="simple jsoncommand">
            <tr>
              <th>HTTP Method</th>
              <th>Path Template</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>GET</td>
              <td id='GET-cookie-name'>/session/{sessionId}/cookie/{name}</td>
              <td></td>
            </tr>
          </table>
          <p>The <a>remote end steps</a> for the <dfn>Get Cookie</dfn> command are:</p>
          <ol>
            <li><p>If the <a>current browsing context</a> is <a>no longer open</a>, return an error with code <a>no such window</a>.</p></li>
            <li><p>Let <var>name</var> be equal to "name" from <a>match a request</a>.</p></li>
            <li><p>Let <var>result</var> be an empty JSON list.</p></li>
            <li><p>Let <var>cookies</var> be a list of all cookies [[!RFC6265]] in the cookie store associated with <a href="https://html.spec.whatwg.org/#active-document">active document</a> <a href="https://dom.spec.whatwg.org/#concept-document-url">address</a>.</p></li>
            <li><p>Let <var>length</var> be the length of <var>cookies</var>.</p></li>
            <li><p>Let <var>k</var> be 0</p></li>
            <li><p>While <var>k</var> &lt; <var>length</var>:</p>
              <ol>
                <li><p>Let <var>cookie</var> be the value in <var>cookies</var> at index <var>k</var>.</p></li>
                <li><p>If <var>name</var> is undefined:</p>
                  <ol>
                    <li><p>Append a <a>serialized cookie</a> to <var>result</var>.</p></li>
                  </ol>
                </li>
                <li><p>If <var>name</var> is defined and is equal to <var>cookie-name</var> as defined in [[!RFC6265]]:</p>
                  <ol>
                    <li><p>Append a <a>serialized cookie</a> to <var>result</var>.</p></li>
                  </ol>
                </li>
                <li><p>Increase the value of <var>k</var> by 1.</p></li>
              </ol>
            </li>
            <li><p>Return <a>success</a> with data <var>result.</var></p></li>
          </ol>
          <p>A <dfn>serialized cookie</dfn> is created with the following algorithm:</p>
          <p>
            <ol>
              <li><p>Let <var>serialized cookie</var> be an empty map.</p></li>
              <ul>
                <li><p>Add an entry whose key is <var>name</var> and value is <var>cookie-name</var> as defined in [[!RFC6265]]</p></li>
                <li><p>Add an entry whose key is <var>value</var> and value is <var>cookie-value</var> as defined in [[!RFC6265]]</p></li>
                <li><p>If cookie's attribute-list contains an attribute with attribute-name of Path,
                  let <var>path</var> be the attribute-value of the last attribute in the cookie-attribute-list
                   with an attribute-name of "Path". Otherwise let <var>path</var> be null</p>
                  <p>Add an entry to <var>serialized cookie</var> with key "path" and value <var>path</var></p></li>
                <li><p>If cookie's attribute-list contains an attribute with attribute-name of Domain,
                  let <var>domain</var> be the attribute-value of the last attribute in the cookie-attribute-list
                  with an attribute-name of "Domain". Otherwise let <var>domain</var> be null</p>
                  <p>Add an entry to <var>serialized cookie</var> with key "domain" and value <var>domain</var></p></li>
                <li><p>If cookie's attribute-list contains an attribute with attribute-name of Secure,
                  let <var>secure</var> be the attribute-value of the last attribute in the cookie-attribute-list
                  with an attribute-name of "Secure". Otherwise let <var>secure</var> be null</p>
                  <p>Add an entry to <var>serialized cookie</var> with key "secure" and value <var>secure</var></p></li>
                <li><p>If cookie's attribute-list contains an attribute with attribute-name of Expires,
                  let <var>expiry</var> be the attribute-value of the last attribute in the cookie-attribute-list
                   with an attribute-name of "Expires" specified in milliseconds since midnight, January 1, 1970 UTC
                    using the format described in [[!RFC1123]]. Otherwise let <var>expiry</var> be null</p>
              </ul>
              <li>Return <var>serialized cookie</var></li>
            </ol>
          </p>
      </section>
      <section>
      <h3>addCookie</h3>
        <p>
          <table class="simple jsoncommand">
            <tr>
              <th>HTTP Method</th>
              <th>Path Template</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>POST</td>
              <td id='post-cookie'>/session/{sessionId}/cookie</td>
              <td></td>
            </tr>
          </table>
          <p>The <a>remote end steps</a> for the <dfn>Add Cookie</dfn> command are:</p>
          <ol>
            <li><p>If the <a>current browsing context</a> is <a>no longer open</a>,
                return an error with code <a>no such window</a>.</p></li>
            <li><p>Let <var>cookie</var> be the result of <a>getting a property</a>
              named "cookie" from the <var>parameters</var> argument. If <var>cookie</var>
              is not a map then return an error <a>unable to set cookie</a>.</p></li>
            <li><p>If the <code>Document</code> is a <a href='http://www.w3.org/html/wg/drafts/html/master/single-page.html#cookie-averse-document-object'>
              cookie-averse <code>Document</code> object</a> then return an error with code
              <a>invalid cookie domain</a>.</p></li>
            <li><p>Set the value is <var>cookie-name</var>, as defined in [[!RFC6265]], to the value of entry with key <var>name</var>.
              If <var>name</var>is undefined return error <a>unable to set cookie</a></p></li>
            <li><p>Set the value is <var>cookie-value</var>, as defined in [[!RFC6265]], to the value of entry with key <var>value</var>.
                If <var>value</var>is undefined return error <a>unable to set cookie</a></p></li>
            <li><p>If <var>cookie</var> has an entry with key <var>path</var> set attribute-value of the last attribute in the cookie-attribute-list
             with an attribute-name of "Path".</p></li>
            <li><p>If <var>cookie</var> has an entry with key <var>domain</var> set attribute-value of the last attribute in the cookie-attribute-list
              with an attribute-name of "Domain".</p></li>
            <li><p>If <var>cookie</var> has an entry with key <var>secure</var> set attribute-value of the last attribute in the cookie-attribute-list
                with an attribute-name of "Secure".</p></li>
            <li><p>If <var>cookie</var> has an entry with key <var>expiry</var> set attribute-value of the last attribute in the cookie-attribute-list
                  with an attribute-name of "Expires".</p></li>
            <li><p>Store the contents <var>cookie</var> in the user agent cookie manager
              following the steps described in <a href='http://tools.ietf.org/html/rfc6265#section-5.3'>Storage Model</a>
              in [[!RFC6265]]. If there is an error during this step return an error
              with code <a>unable to set cookie</a>.</p></li>
            <li><p>Return <a>success</a> with data null</p></li>
          </ol>
    </section>
    <section>
      <h3>deleteCookie</h3>
      <p>
        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>DELETE</td>
            <td id='delete-cookie'>/session/{sessionId}/cookie/{name}</td>
            <td></td>
          </tr>
        </table>
      </p>
      <p>The <a>remote end steps</a> for the <dfn>Delete Cookie</dfn> command are:</p>
      <ol>
        <li><p>If the <a>current browsing context</a> is <a>no longer open</a>, return an error with code <a>no such window</a>.</p></li>
        <li><p>Let <var>name</var> be equal to "name" from <a>match a request</a>.</p></li>
        <li><p>Let <var>cookies</var> be a list of all cookies [[!RFC6265]] in the cookie store associated with <a href="https://html.spec.whatwg.org/#active-document">active document</a> <a href="https://dom.spec.whatwg.org/#concept-document-url">address</a>.</p></li>
        <li><p>Let <var>length</var> be the length of <var>cookies</var>.</p></li>
        <li><p>Let <var>k</var> be 0</p></li>
        <li><p>While <var>k</var> &lt; <var>length</var>:</p>
          <ol>
            <li><p>Let <var>cookie</var> be the value in <var>cookies</var> at index <var>k</var>.</p></li>
            <li><p>If <var>name</var> is undefined:</p>
              <ol>
                <li><p>Add an attribute to the attribute-list with attribute-name of Expires
                  and set the value in the past.</p></li>
              </ol>
            <li><p>If <var>name</var> is defined and is equal to <var>cookie-name</var>:</p>
              <ol>
                <li><p>Add an attribute to the attribute-list with attribute-name of Expires
                  and set the value in the past.</p></li>
              </ol>
          </ol>
        <li><p>Return <a>success</a> with data null</p></li>
      </ol>
    </section>
  </section>
</section>
<section>
  <h2 id="timeouts">Timeouts</h2>
  <p>This section describes how timeouts and implicit waits are handled within WebDriver</p>
  <section>
    <h2>Setting Timeouts</h2>
    <p>The "timeouts" command is used to set the value of a timeout that a command can execute
     for.</p>
      <section>
       <h3>setTimeouts()</h3>
        <p>
          <table class="simple jsoncommand">
            <tr>
              <th>HTTP Method</th>
              <th>Path Template</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>POST</td>
              <td id='post-timeouts'>/session/{sessionId}/timeouts</td>
              <td></td>
            </tr>
          </table>
        <p>
        <ul>
          <li>implicit - Set the amount of time the driver should wait when searching for elements. When searching for a single element, the driver should poll the page until an element is found or the timeout expires, whichever occurs first. When searching for multiple elements, the driver should poll the page until at least one element is found or the timeout expires, at which point it should return an empty list.<br>
          If this command is never sent, the driver MUST default to an implicit wait of 0ms.</li>
          <li>page load - Set the amount of time the driver should wait before returning when the <a href="#page-load-strategies-1">page load stratgey</a> is not "<code>none</code>". If this limit is exceeded, the <code>get()</code> command MUST return a "<code><a href="#status-timeout">timeout</a></code>" response status.</li>
          <li>script - Set the amount of time the driver should wait after calling <a href='#widl-JavaScriptExecutor-executeAsyncScript-Argument-DOMString-script-sequence-Argument--args'><code>executeAsyncScript</code></a> for the callback to have executed before returning a <code><a href="#status-timeout">timeout</a></code> Response.</li>
        </ul>
        The parameters will have the following keys in the object:
        <ul>
          <li>Let <var>type</var> contain the type of timeout for specified operations. Valid values are: "implicit", "page load", "script". If invalid values are passed in:
            <ul>
              <li>Set the HTTP Response status code to 500</li>
              <li>Let <var>status</var> be equal to <a href='#status-invalid-selector'>Invalid Selector</a></li>
              <li>Let <var>value</var> to a stating that the strategy is invalid. It may return a list of valid search strategies.</li>
            </ul>
          </li>
          <li>let <var>ms</var> contain the amount of time, in milliseconds, that time-limited commands are permitted to run.</li>
        </ul>
    </section>
  </section>
</section>
<section>
  <h2>Interactions</h2>
  <br>
  The WebDriver API offers two ways of interacting with elements,
  either with a set of low-level "do as I say" actions, or a
  high-level "do as I mean" set of actions. The former are offered to
  allow precise emulation of user input. The latter are offered as a
  convenience to cover the common case, and can conceivably be
  implemented on top of the lower level primitive operations.
  <br>
  Interactions can be used to emulate single input actions as well as
  multiple, simultaneous actions.
  <br>
  <h3>Terms:</h3>
  <br>
  <b>(NOTE: these are by no means the final terms, I needed them to make the prose easier to follow)</b>
  <br>
  <br>
  <dfn>low-level action:</dfn> The smallest operation an input source can do. These are used to build chains of actions. Example: keyDown
  <br>
  <dfn>action chain:</dfn> A chain of low-level actions
  <br>
  <dfn>input source:</dfn> The source from which the inputs will originate. MUST support 'keyboard', 'mouse' and 'touch'
  <br>
  <b>source:</b> The object currently acting on the source. For example, in a 'touch' environment, if two fingers are acting on a touchscreen, you will have two sources of input.
  <br>
  <section>
    <h2 id="interactable">Interactable elements</h2>
    <p>User actions that operate on an element require the element to be interactable. The following conditions must be met for the element to be considered interactable:
    <ul>
      <li>The element MUST be displayed, as defined in <a href="#determining-if-displayed">section 10.1</a>.</li>
      <li>The element MUST NOT be disabled. "Disabled" is defined as:
      <ul>
        <li>If the current document is being processed as an HTML document, the element MUST be considered disabled if it does not support
        the <a href="http://www.w3.org/TR/html401/interact/forms.html#adef-disabled">disabled</a>
        attribute (according to the [[!html51]] spec), or if the
        disabled attribute is set in the case where that attribute is present.</li>
      </ul>
      </li>
    </ul>
    </section>

    <section>
      <h2>Low-Level Actions</h2>
      <br>
      The low level actions provide a mechanism for precisely stating how a user can interact with the browser.
      This is achieved by sending a chain of low-level commands to a single endpoint.
      For example, if you wish to automate a drag and drop action in a browser, you would chain
      the pointerDown, pointerMove, pointerUp and release commands together.
      <br>
      <br>
      The remote end will receive the action chain, execute them, and will return a response to the local end once the entire
      action sequence has been dispatched.
      <br>
      <br>
      The set of actions available to you is depending on the input source. For example, on a keyboard
      you want to have a keyDown action to simulate pressing a specific key on the keyboard, but this
      is not a valid action on a touchscreen, where we care about pointer actions relative to coordinates or webelements.
      <br>
      <p class='note'>
        <a href='http://www.w3.org/TR/DOM-Level-3-Events/#glossary-activation-trigger'>Activation triggers</a> generated by the WebDriver API User SHOULD be indistinguishable from those generated by a real user
        interacting with the browser. In particular, the dispatched events will have the <a href='http://dom.spec.whatwg.org/#dom-event-istrusted'>isTrusted</a> attribute set to true. The most robust way to dispatch these events is by creating them in the browser implementation itself. Sending OS-specific input messages to the browser's window has the disadvantage that the browser being automated may not be properly isolated from a user accidentally modifying input source state; use of an OS-level accessibility API has the disadvantage that the browser's window must be focused, and as a result, multiple tests cannot run in parallel.
      </p>
      <br>
      <section>
        <h2 id="actions-endpoint">Actions Endpoint</h2>
        <section>
          <h2>Sending an Action</h2>
          <table class="simple jsoncommand">
            <tr>
            <th>HTTP Method</th>
              <th>Path Template</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>POST</td>
              <td id='post-actions'>/session/{sessionId}/actions</td>
              <td></td>
            </tr>
          </table>
          <br>
          The 'actions' endpoint expects a list of objects as input. Each object in this list MUST contain the fellowing members:
          <br>
          <br>
          <b>Source</b>
          <br>
          <br>
          The "source" member will hold a string value to represent the input source. Implementations MUST support "keyboard", "mouse", and "touch" (<b>TODO: use symbols?</b>), and can be extended for any other input source.
          <br>
          <br>
          <b>id</b>
          <br>
          <br>
          This is a locally-assigned unique identifier. It will be used by the remote end to differentiate dispatched actions. For example, if you have a "touch" action with id "1" to represent one finger actively pressed on a screen, then you can dispatch another "touch" action with id "2" to represent a second finger on a screen, acting simultaneously.
          <br>
          <br>
          <b>actions</b>
          <br>
          <br>
          This holds a list of objects, where each object represents a low-level command. The list order dictates the order in which each command will be dispatched. Each command MUST have a 'name' member, whose value will hold the name of the command. More information on each command is in the action <a href="#action-commands">commands</a> section.
          <br>
          <br>
          So the structure will look as follows:
          <pre>
            [
              {
                "source": "string",
                "id": "string",
                "actions": [
                          { "name": "string: name of action primitive",
                            ... parameters to action commands...
                          },
                ]
              }
            ]
          </pre>
          <br>
          A list of dictionary objects are used so that we may use this same endpoint for <a href="#parallel-actions">parallel actions</a>.
          <br>
          There is one endpoint for all input source's action chains.
        </section>
        <section>
          <h2>Releasing all actions</h2>
          <table class="simple jsoncommand">
            <tr>
            <th>HTTP Method</th>
              <th>Path Template</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>DELETE</td>
              <td id='delete-actions'>/session/{sessionId}/actions</td>
              <td></td>
            </tr>
          </table>
          <br>
          <br>
          Use this command to clear all actions that are currently being performed. ALL actions currently being performed MUST be cancelled via pointerCancel if it is a "mouse" or "touch" source or via keyUp if it is a "keyboard" source.
          <br>
          <br>
          <b>NOTE: 'release' as a single command was removed since 'keyUp' and 'pointerUp'/'pointerCancel' exist and 'release' conflates them</b>
        </section>
        <section>
          <h2 id="action-commands">Actions</h2>
          This section describes the objects that are part of the "actions" member of the JSON structure sent to the "actions" endpoint.
          <section>
            <h2>General Actions</h2>
            All input sources MUST implement the following action:
            <br>
            <br>
            <b>pause</b>
            <br>
            <br>
            The "pause" action MUST (<b>TODO: or "may", since we can default to 0 on remote end?</b>) take in a parameter named "duration" which will be the time to wait either in milliseconds or using a symbol. This action is used to indicate a period of time to wait between actions, and will also be used to indicate a period of inaction in <a href="#parallel-actions">parallel action chains</a>.
            <br>
            <br>
            If you wish to use a system specific wait period, please use the following symbols:
              <ul>
                <li><b>"CONTEXT"</b> - wait for contextmenu</li>
                <li><b>"CHAINED_EVENT"</b> - wait period to join related events. For example, this should be used to join events for doubleclicking.</li>
              </ul>
              <br>
              The remote end is responsible for translating these symbols to the platform specific periods.

          </section>
          <section>
            <h2>Keyboard Actions</h2>
            The following are actions that must be implemented for the "keyboard" input source. Their names will be used as the value to the "name" member of the data sent to the 'actions' endpoint. Each actions parameters are additional members to the object that "name" is a member of.
            <br>
            <br>
            <b>keyDown</b>
            <br>
            <br>
            The "keyDown" requires a parameter named "code" whose value will be one of the codes from the <a href="#character-types">character types</a> table. This action will send a "keyDown" event, with the specified key as a target.
            <br>
            <br>
            <b>keyUp</b>
            <br>
            <br>
            The "keyUp" requires a parameter named "code" whose value will be one of the codes from the <a href="#character-types">character types</a> table. This action will send a "keyUp" event, with the specified key as a target.
            <br>
          </section>
          <section>
            <h2>Pointer Actions</h2>
            The following are actions that must be implemented for both "mouse" and "touch" input sources. Any future pointer-based source must implement these actions.
            <br>
            <b>NOTE: conflating mouse and touch causes the pointerMove/pointerDown to events to be confusing and lacks verisimilitude:</b> If you want to tap at element1, then that would mean 'put finger down on element1, remove finger from element1', for a tap, we have to decide if we want to send 'pointerMove, pointerDown, pointerUp' or 'pointerDown, pointerUp'. The latter matches the touch events sent (touchStart,touchEnd), and makes sense for touchscreens because there is no active button state (http://www.w3.org/TR/pointerevents/#glossary) until you dispatch a touchstart. sending a JSON structure with pointerMove, pointerDown, pointerUp for something that gets mapped to touchstart/touchend feels inelegant. We can enforce the following instead:
            if the "source" is mouse, then pointerMove,pointerDown,pointerUp  is sent over the wire
            if the "source" is touch, then pointerDown,pointerUp is sent over the wire.
            if the "source" is anything else (stylus, or other), it will be defined later.

            The ramifications of this proposal would be that pointerDown must accept the parameters that pointerMove does (ie: ELEMENT, etc.).
            <br>
            <br>
            <br>
            <b>pointerMove</b>
            <br>
            <br>
            The "pointerMove" action is used to move the pointer to a specific location on a page. In "mouse" sources, this would dispatch a "mouseMove" event. In "touch" sources, then if there is an active pointerDown action, this will generate a "touchmove" or "pointermove" event. For "touch" sources, pointerMove must not be called before pointerDown, since pointer sources only have move events once they are active on the screen.
            <br>
            When sending a "pointerMove", one of the following parameter sets MUST be used:
            <ul>
              <li><b>"ELEMENT"</b> - "ELEMENT" will hold a WebElement's id, and this will dispatch the event to the center of that element, unless the following set of parameters is also included:</li>
              <ul>
                <li><b>"x"</b> - Integer, the x-coordinate relative to the top-left corner of the target WebElement. If this is not specifed, the midpoint of the width is used</li>
                <li><b>"y"</b> - Integer, the y-coordinate relative to the top-left corner of the target WebElement. If this is not specifed, the midpoint of the height is used</li>
              </ul>
              <ul>
                <li><b>"x" and "y"</b> - Integers, the coordinates relative to the top-left corner of the <b>TODO: viewport, or top-left of root document?</b>.
              </ul>
            </ul>
            <br>
            <br>
            <b>pointerDown</b>
            <br>
            <br>
            The "pointerDown" action is used to start an interaction on the page. In "mouse" sources, this would mean "mouseDown", in "touch" sources, this would mean "touchstart" or "pointerdown".
            <br>
            <br>
            For "touch" sources, the following parameters must be passed:
            <ul>
              <li><b>"ELEMENT"</b> - "ELEMENT" will hold a WebElement's id, and this will dispatch the event to the center of that element, unless the following optional set of parameters is also included:</li>
              <ul>
                <li><b>"x"</b> - Integer, the x-coordinate relative to the top-left corner of the target WebElement. If this is not specifed, the midpoint of the width is used</li>
                <li><b>"y"</b> - Integer, the y-coordinate relative to the top-left corner of the target WebElement. If this is not specifed, the midpoint of the height is used</li>
              </ul>
            </ul>
            <br>
            <br>
            For "mouse" sources, the following parameter must be passed:
            <ul>
              <li><b>"BUTTON"</b> - "BUTTON" will hold a value describing which mouse button should be depressed.<b>TODO: link to button chart</b></li>
            </ul>
            <br>
            <br>
            <b>pointerUp</b>
            <br>
            <br>
            The "pointerUp" action is used to start an interaction on the page. In "mouse" sources, this would mean "mouseUp", in "touch" sources, this would mean dispatching an event like "touchend" or "pointerup".
            <br>
            <br>
            Takes no parameters
            <br>
            <br>
            <b>pointerCancel</b>
            <br>
            <br>
            The "pointerMove" action is used to cancel an active pointer on the page. In "mouse" sources, this would mean "mouseUp", in "touch" sources, it implies cancelling the current action if possible by dispatching an event like "touchcancel" or "pointercancel".
          </section>
          <section>
            <h2 id='parallel-actions'>Parallel Actions</h2>
            Parallel actions are those that have more than one action acting simultaneously on the browser. An example of this is using multiple fingers to operate on a tablet screen at the same time.
            <br>
            <br>
            Dispatching a parallel action also uses the <a href="#actions-endpoint">actions endpoint</a>. In order to send a parallel action, append multiple dictionaries to the list of dictionary objects. Each dictionary will hold all the actions from one input source. The list of actions each dictionary contains will be executed together in ticks, by stepping through each input source's action list in order and executing each step simultaneously.
            <br>
            <br>
            The best way to understand this is through an example. Imagine we have two fingers acting on a touchscreen. One finger will press down on element1 at the same moment that another finger presses down on element2. Once these actions are done, the first finger will wait 5 seconds while the other finger moves to element3. Then both fingers release from the touchscreen.
            <br>
            <br>
            To execute these actions, we must send the "actions" endpoint two dictionary objects in the JSON list of dictionaries, one fore each finger. We must use the "id" key of each object to uniquely identify each finger. The "actions" key will hold all the actions the input source will take.
            <br>
            <br>
            The JSON for this set of actions is as follows:
            <pre>
              [
                {
                  "source": "touch",
                  "id": "1",
                  "actions": [
                            { "name": "pointerDown",
                              "ELEMENT": "element1"
                            },
                            { "name": "pause",
                              "duration": 0
                            },
                            { "name": "pointerUp"
                            }
                  ]
                },
                {
                  "source": "touch",
                  "id": "2",
                  "actions": [
                            { "name": "pointerDown",
                              "ELEMENT": "element2"
                            },
                            { "name": "pointerMove",
                              "ELEMENT": "element3"
                            },
                            { "name": "pointerUp"
                            }
                  ]
                }
              ]
            </pre>
            <br>
            <br>
            When the remote end receives this, it will look at each input source's action lists. It will dispatch the first action of each source together, then the second actions together, and lastly, the final actions together.
            <br>
            <br>
            The diagram below displays when each action gets executed. "Source 1" is the first finger, and "source 2" is the second.
            <br>
            <img src="svgs/note1actions.svg">
            <br>
            <br>
            There is no limit to the number of input sources, and there is no restriction regarding the length of each input's action list. Meaning, there is no requirement that all action lists have to be the same length. It is possible for one input source's action list may have more actions than another. As an example, imagine having two fingers on a touchscreen. The first finger will press on element1 while the second presses on element2, then the first will release the touchscreen while the second finger moves to element3, and finally the second finger releases from the touchscreen. In this case, the action list for the first finger contains 2 actions (pointerDown, pointerUp), and the action list for the second finger contains 3 (pointerDown, pointerMove, pointerUp). In this case, the JSON will look like this:
            <pre>
              [
                {
                  "source": "touch",
                  "id": "1",
                  "actions": [
                            { "name": "pointerDown",
                              "ELEMENT": "element1"
                            },
                            { "name": "pointerUp"
                            }
                  ]
                },
                {
                  "source": "touch",
                  "id": "2",
                  "actions": [
                            { "name": "pointerDown",
                              "ELEMENT": "element2"
                            },
                            { "name": "pointerMove",
                              "ELEMENT": "element3"
                            },
                            { "name": "pointerUp"
                            }
                  ]
                }
              ]
            </pre>
            And the execution of each action will be done as follows:
            <br>
            <img src="svgs/note4actions.svg">
            <br>
            <br>
            Specific timing for the actions can also be expressed. The "pause" action can be used to either a) indicate a specific amount of time an input source must wait, or b) can be used to signify that the current input source must wait until all other actions in the tick are completed. For the former case, the current tick being executed must wait for the longest pause to complete. For example, in this diagram:
            <br>
            <br>
            <img src="svgs/note2actions.svg">
            <br>
            <br>
            The remote end will dispatch the pointerDown actions in the first tick. In the second tick, since source 1 declares a pause of 5 seconds, the remote end will dispatch the pointerUp event for source 2, and will wait 5 seconds before moving on to executing the third tick.
            <br>
            <br>
            In the event that one tick contains multiple pause durations, the remote end will wait the maximum duration before moving on to executing the next tick.
            <br>
            <br>
            As noted before, "pause" can be used to signify inaction during a tick. If "pause" is declared without a time period, then the input source will not have any actions executed in the containing tick. As an example:
            <br>
            <br>
            <img src="svgs/note3actions.svg">
            <br>
            <br>
            During tick 2, source 1 will have its pointerMove action dispatched, while source 2 will do nothing.
         </section>
      </section> <!-- low-level wire protocol commands -->

    <section>
      <h2>High Level Commands</h2>
        <p>These higher level commands SHOULD be built on top of the low level commands, and implement a user friendly way of interacting with a page in a way that models common user expectations.

        <section>
          <h2 id='high-level-click'>Clicking</a></h2>
          <section>
            <!-- click() -->
            <h3>click()</h3>
            <table class="simple jsoncommand">
              <tr>
                <th>HTTP Method</th>
                <th>Path Template</th>
                <th>Notes</th>
              </tr>
              <tr>
                <td>POST</td>
                <td id='post-element-click'>/session/{sessionId}/element/{id}/click</td>
                <td></td>
              </tr>
            </table>
            <p>Click in the middle of the <a>WebElement</a> instance. The middle of the element is defined as the middle of the box returned by
            calling <code><a
              href="http://www.w3.org/TR/cssom-view/#the-getclientrects()-and-getboundingclientrect()-methods">getBoundingClientRect</a></code>
            on the underlying document Element, according to the [[!CSSOM-VIEW]] spec. If
            the element is outside the <a
              href="http://www.w3.org/TR/CSS21/visuren.html#viewport">viewport</a>
            (according to the [[!CSS21]] spec), the implementation SHOULD bring the
            element into view first. The implementation MAY invoke <code>scrollIntoView</code> on
            the underlying document Element. The element MUST be <a
              href="#determining-if-displayed">displayed</a>. See the note below for when the element is obscured by another element.
            Exceptions:
            <ul>
              <li>Links (A elements): Clicking happens in the middle of the first
                <a href="#determining-if-displayed">displayed</a> bounding client rectangle. This is to overcome overflowing links where the middle of the bounding client rectangle does not actually fall on a clickable part of the link.</li>
              <li>SELECT elements without the &quot;multiple&quot; attribute set.
                Clicking on the select element SHOULD open the drop down menu. The next
                click, on any element, MUST close this menu.</li>
              <li>Clicking directly on an OPTION element (without clicking on the
                parent SELECT element previously) MUST open a selection menu, as if the
                SELECT option was clicked first, then click on the OPTION before finally
                closing the SELECT element's menu. The SELECT menu MUST be closed
                once the action is complete.</li>
            </ul>
            <p>The possible errors for this command:
            <ul>
              <li><code><a href="#status-stale-element-reference">stale element reference</a></code> if the given element is no longer in the <a href="http://dom.spec.whatwg.org/#in-a-document">document</a>.</li>
              <li><code><a href="#status-element-not-visible">element not visible</a></code> if the element is hidden and thus cannot be interacted with.</li>
              <li><code><a href="#status-move-target-out-of-bounds">move target out of bounds</a></code> if the element cannot be scrolled into view.</li>
            </ul>
            <p>This command MUST use either the mouse or touch mechanisms for
              emulating the user input. In the case where the browser being automated
              supports only mouse input or both mouse and touch input, the low-level
              mouse mechanisms MUST be used. If the browser only supports touch input,
              the low level touch inputs MUST be used.</p>
            </dd>
          </dl>
          <p class="note">As the goal is to emulate users as closely as possible, the
            implementation SHOULD NOT allow clicking on elements that are obscured by
            other elements. If the implementation forbids clicking on obscured elements,
            an <code><a href="#status-element-not-visible">element not visible</a></code> response MUST be returned and this SHOULD have an
            explantory message explaining the reason. The implementation SHOULD try to
            scroll the element into view, but in case it is fully obscured, it SHOULD
            NOT be clickable.<!--TODO: add details of interactable'--></p>
          </section>
        </section>
        <section>
          <h2>Touch</h2>
          <p>This section defines the low level commands used when manipulating touch-enabled devices. These are the building blocks of touch interaction chains.</p>
          <!--<p>NOTE: would like to add pressure/tilt, but that isn't in Touch Events (http://www.w3.org/TR/touch-events/), will have to wait for Pointer Event adoption</p>-->
          <table class="simple">
            <tr><td>Capability Name</td><td>Type</td></tr>
            <tr><td><span id="capability-touchEnabled">touchEnabled</span></td><td>boolean</td></tr>
          </table>
          <br>
          <br>
          <section>
            <!-- Tap -->
            <h3>void tap ()</h3>
            <table class="simple jsoncommand">
              <tr>
                <th>HTTP Method</th>
                <th>Path Template</th>
                <th>Notes</th>
              </tr>
              <tr>
                <td>POST</td>
                <td id='post-element-tap'>/session/{sessionId}/element/{id}/tap</td>
                <td></td>
              </tr>
            </table>
            <p>Tap in the middle of the <a>WebElement</a>. The middle of the element is defined as the middle of the box returned by
              calling <code><a
                href="http://www.w3.org/TR/cssom-view/#the-getclientrects()-and-getboundingclientrect()-methods">getBoundingClientRect</a></code>
              on the underlying document Element, according to the [[!CSSOM-VIEW]] spec. If
              the element is outside the <a
                href="http://www.w3.org/TR/CSS21/visuren.html#viewport">viewport</a>
              (according to the [[!CSS21]] spec), the implementation SHOULD bring the
              element into view first. The implementation MAY invoke <code>scrollIntoView</code> on
              the underlying document Element.
              Exceptions:
              <ul>
                <li>Links (A elements): Clicking happens in the middle of the first
                  <a href="#determining-if-displayed">displayed</a> bounding client rectangle. This is to overcome overflowing links where the middle of the bounding client rectangle does not actually fall on a clickable part of the link.</li>
                <li>SELECT elements without the &quot;multiple&quot; attribute set.
                  Clicking on the select element SHOULD open the drop down menu. The next
                  click, on any element, MUST close this menu.</li>
                <li>Clicking directly on an OPTION element (without clicking on the
                  parent SELECT element previously) MUST open a selection menu, as if the
                  SELECT option was clicked first, then click on the OPTION before finally
                  closing the SELECT element's menu. The SELECT menu MUST be closed
                  once the action is complete.</li>
              </ul>
              <p>The possible errors for this command:
              <ul>
                <li><code><a href="#status-stale-element-reference">stale element reference</a></code> if the given element is no longer in the <a href="http://dom.spec.whatwg.org/#in-a-document">document</a>.</li>
                <li><code><a href="#status-move-target-out-of-bounds">move target out of bounds</a></code> if the element cannot be scrolled into view.</li>
              </ul>
            </section>
        </section>
      <section>
        <h2 id='typing_keys'>Typing keys</h2>
        <p>A requirement for key-based interaction with an element is that it is
          <a href="#interactable">interactable</a>. Typing into an element is permitted if one of the following conditions is met:
            <ul>
              <li>The element is <a href="http://dev.w3.org/html5/spec/editing.html#focus">focusable</a> as defined in the editing section of the [[!html51]] spec.</li>
              <li>The element is allowed to be the <code><a href='http://www.w3.org/html/wg/drafts/html/master/editing.html#dom-document-activeelement'>activeElement</a></code>. In
              addition to focusable elements, this allows typing to the <code>BODY</code> element.</li>
              <li>In an HTML document, the element is <a href="http://dev.w3.org/html5/spec/editing.html#attr-contenteditable">editable</a> as a result of having its <code>contentEditable</code> attribute set or the containing document is in <code>designMode</code>.</li>
              <li>The underlying browser implementation would allow keyboard input to
              directed to the element (eg. an HTML document with a DIV marked as being
              contentEditable)</li>
            </ul>
        <p>Prior to any keyboard interaction, an attempt to shift focus to the
        element MUST be attempted if the element does not currently have the focus. This is the case if one of the following
        holds:
        <ul>
          <li>The element is not already the document's <code><a href='http://www.w3.org/html/wg/drafts/html/master/editing.html#dom-document-activeelement'>activeElement</a></code>.</li>
          <li>The owner document of the element to be interacted with is not the focused document.</li>
        </ul>
        <p>In case focusing is needed, the implementation MUST follow the <a href="http://dev.w3.org/html5/spec/editing.html#focus-management"><b>focusing steps</b></a> as described in the focus management section of the [[!html51]] spec. The focus MUST NOT leave the element at the end of the interaction, other than as a result of the interaction itself (i.e. when the tab key is sent).
        </p>
        <section>
          <h3>clear()</h3>
          <p>Clear a TEXTAREA or text INPUT element's value.
            <table class="simple jsoncommand">
              <tr>
                <th>HTTP Method</th>
                <th>Path Template</th>
                <th>Notes</th>
              </tr>
              <tr>
                <td>POST</td>
                <td id='post-element-clear'>/session/{sessionId}/element/{id}/clear</td>
                <td></td>
              </tr>
            </table>
          </p>
        </section>
        <section>
          <!-- sendKeys() -->
          <h3>sendKeys()</h3>
          <p>
            <table class="simple jsoncommand">
              <tr>
                <th>HTTP Method</th>
                <th>Path Template</th>
                <th>Notes</th>
              </tr>
              <tr>
                <td>POST</td>
                <td id='post-element-value'>/session/{sessionId}/element/{id}/value</td>
                <td></td>
              </tr>
            </table>
            <p> Let <var>value</var> be an array of characters that will be typed into a <a>WebElement</a>

            <p>Sends a sequence of keyboard events representing the keys in the value parameter.
            <p>Caret positioning: If focusing was needed, after following the focusing steps, the caret MUST be positioned at the end of the text currently in the element. At the end of the interaction, the caret MUST be positioned at the end of the typed text sequence, unless the keys sent position it otherwise (e.g. using the LEFT key).</p>
            <p>There are four different types of keys that are emulated:
            <ul>
              <li>Character literals - lower-case symbols.</li>
              <li>Uppercase letters and symbols requiring the SHIFT key for typing.</li>
              <li>Modifier keys</li>
              <li>Special keys</li>
            </ul>
            The rest of this section details the values used to represent the different keys, as well as the expected behaviour for each key type.
        </section>
        <p>When emulating user input, the implementation MUST generate
        the same sequence of events that would have been produced if a real user was
        sitting in front of the keyboard and typing the sequence of characters. In
        cases where there is more than one way to type this sequence, the
        implementation MUST choose one of the valid ways. For example, typing <code>AB</code> may be achieved by:
        <ul>
          <li>Holding down the Shift key</li>
          <li>Pressing the letter 'a'</li>
          <li>Pressing the letter 'b'</li>
          <li>Releasing the Shift key</li>
        </ul>
        Alternatively, it can be achieved by:
        <ul>
          <li>Holding down the Shift key</li>
          <li>Pressing the letter 'a'</li>
          <li>Releasing the Shift key</li>
          <li>Holding down the Shift key</li>
          <li>Pressing the letter 'b'</li>
          <li>Releasing the Shift key</li>
        </ul>
        <p>Or by simply turning on the CAPS LOCK first.</p>
        <p>
        The implementation MAY use the following algorithm to generate the events.
        If the implementation is using a different algorithm, it MUST adhere to the
        requirements listed below.
        <p>For each key, <var>key</var> in <var>value</var>, do
        <ol>
          <li>If <var>key</var> is a lower-case symbol:
          <ol>
            <li>If the Shift key is not pressed:
              <ol>
                <li>Generate a sequence of <code>keydown</code>, <code>keypress</code> and <code>keyup</code> events with
                <var>key</var> as
                the character to emulate</li>
              </ol>
            </li>
            <li>else (The Shift key is pressed)
              <ol>
                <li>let <var>uppercaseKey</var> be the upper-case character matching
                <var>key</var></li>
                <li>Generate a sequence of <code>keydown</code>, <code>keypress</code> and <code>keyup</code> events with
                <var>uppercaseKey</var> as the character to emulate</li>
              </ol>
            </li>
          </ol>
        </li>
        <li>Else if <var>key</var> is an upper-case symbol:
          <ol>
            <li>If the Shift key is not pressed:
            <ol>
              <li>Generate a <code>keydown</code> event of the Shift key.
              <li>Generate a sequence of <code>keydown</code>, <code>keypress</code> and <code>keyup</code> events with
              <var>key</var> as
              the character to emulate</li>
              <li>Generate a <code>keyup</code> event of the Shift key.
            </ol>
          </li>
          <li>else (The Shift key is pressed)
            <ol>
              <li>Generate a sequence of <code>keydown</code>, <code>keypress</code> and <code>keyup</code> events with
              <var>key</var> as the character to emulate</li>
            </ol>
          </li>
        </ol>
      </li>
      <li>Else if <var>key</var> represents a modifier key:
        <ol>
          <li>let <var>modifier</var> be the modifier key represented by
          <var>key</var></li>
          <li>If <var>modifier</var> is currently held down:
        <ol>
      <li>Generate a <code>keyup</code> event of <var>modifier</var></li>
    </ol>
  </li>
  <li>Else:
    <ol>
      <li>Generate a <code>keydown</code> event of <var>modifier</var></li>
    </ol>
  </li>
  <li>Maintain this key state and use it to modify the input until it is pressed again.</li>
</ol>
      </li>
      <li>Else if <var>key</var> represents the NULL key:
      <ol>
        <li>Generate <code>keyup</code> events of all modifier keys currently held
        down.</li>
        <li>All modifier keys are now assumed to be released.</li>
      </ol>
      </li>
      <li>Else if <var>key</var> represents a special key:
      <ol>
        <li>Translate <var>key</var> to the special key it represents</li>
        <li>Generate a sequence of <code>keydown</code>, <code>keypress</code> and <code>keyup</code> events for the special key.</li>
      </ol>
      </li>
    </ol>
    <p>Once keyboard input is complete, an implicit <var>NULL</var> key is sent unless the
    final character is the <var>NULL</var> key.</p>
    <p> <!-- Pseudo-code --></p>
    <p>Any implementation MUST comply with these requirements:
    <ul>
      <li>For uppercase letters and symbols that require the Shift key to be
      pressed, there are two options:
      <ul>
        <li>A single Shift <code>keydown</code> event is generated before the entire
        sequence of uppercase letters.</li>
        <li>Before each such letter or symbol, a Shift <code>keydown</code> event is
        generated. After each letter or symbol, a Shift <code>keyup</code> event is
        generated.</li>
      </ul></li>
      <li>A user-specified Shift press implies capitalization of all following
      characters.</li>
      <li>If a user-specified Shift press precedes uppercase letters and
      symbols, a second Shift <code>keydown</code> event MUST NOT be generated. In that
      case, a Shift <code>keyup</code> event MUST NOT be generated implicitly by the
      implementation.</li>
      <li>The <var>NULL</var> key releases all currently held down modifier keys.</li>
      <li>The state of all modifier keys must be reset at the end of each
      <code>sendKeys</code> call and the appropriate <code>keyup</code> events
      generated</li>
    </ul>
    <p> <!-- Algorithm paragraph --></p>
    <h3 id="character-types">Character types</h3>
    <p>The <var>value</var> parameter contains a mix of printable
    characters and pressable keys that aren't text. Pressable keys that aren't
    text are stored in the Unicode PUA (Private Use Area) code points,
    0xE000-0xF8FF. The following table describes the mapping between PUA and
    key:
    <table class="simple">
      <tr>
        <th>Key</th>
        <th>Code</th>
        <th>Type</th>
      </tr>
      <tr><td>NULL</td><td>\uE000</td><td>NULL</td></tr>
      <tr><td>CANCEL</td><td>\uE001</td><td>Special key</td></tr>
      <tr><td>HELP</td><td>\uE002</td><td>Special key</td></tr>
      <tr><td>BACK_SPACE</td><td>\uE003</td><td>Special key</td></tr>
      <tr><td>TAB</td><td>\uE004</td><td>Special key</td></tr>
      <tr><td>CLEAR</td><td>\uE005</td><td>Special key</td></tr>
      <tr><td>RETURN</td><td>\uE006</td><td>Special key</td></tr>
      <tr><td>ENTER</td><td>\uE007</td><td>Special key</td></tr>
      <tr><td>SHIFT</td><td>\uE008</td><td>Modifier</td></tr>
      <tr><td>CONTROL</td><td>\uE009</td><td>Modifier</td></tr>
      <tr><td>ALT</td><td>\uE00A</td><td>Modifier</td></tr>
      <tr><td>PAUSE</td><td>\uE00B</td><td>Special key</td></tr>
      <tr><td>ESCAPE</td><td>\uE00C</td><td>Special key</td></tr>
      <tr><td>SPACE</td><td>\uE00D</td><td>Special key</td></tr>
      <tr><td>PAGE_UP</td><td>\uE00E</td><td>Special key</td></tr>
      <tr><td>PAGE_DOWN</td><td>\uE00F</td><td>Special key</td></tr>
      <tr><td>END</td><td>\uE010</td><td>Special key</td></tr>
      <tr><td>HOME</td><td>\uE011</td><td>Special key</td></tr>
      <tr><td>ARROW_LEFT</td><td>\uE012</td><td>Special key</td></tr>
      <tr><td>ARROW_UP</td><td>\uE013</td><td>Special key</td></tr>
      <tr><td>ARROW_RIGHT</td><td>\uE014</td><td>Special key</td></tr>
      <tr><td>ARROW_DOWN</td><td>\uE015</td><td>Special key</td></tr>
      <tr><td>INSERT</td><td>\uE016</td><td>Special key</td></tr>
      <tr><td>DELETE</td><td>\uE017</td><td>Special key</td></tr>
      <tr><td>SEMICOLON</td><td>\uE018</td><td>Special key</td></tr>
      <tr><td>EQUALS</td><td>\uE019</td><td>Special key</td></tr>
      <tr><td>NUMPAD0</td><td>\uE01A</td><td>Special key</td></tr>
      <tr><td>NUMPAD1</td><td>\uE01B</td><td>Special key</td></tr>
      <tr><td>NUMPAD2</td><td>\uE01C</td><td>Special key</td></tr>
      <tr><td>NUMPAD3</td><td>\uE01D</td><td>Special key</td></tr>
      <tr><td>NUMPAD4</td><td>\uE01E</td><td>Special key</td></tr>
      <tr><td>NUMPAD5</td><td>\uE01F</td><td>Special key</td></tr>
      <tr><td>NUMPAD6</td><td>\uE020</td><td>Special key</td></tr>
      <tr><td>NUMPAD7</td><td>\uE021</td><td>Special key</td></tr>
      <tr><td>NUMPAD8</td><td>\uE022</td><td>Special key</td></tr>
      <tr><td>NUMPAD9</td><td>\uE023</td><td>Special key</td></tr>
      <tr><td>MULTIPLY</td><td>\uE024</td><td>Special key</td></tr>
      <tr><td>ADD</td><td>\uE025</td><td>Special key</td></tr>
      <tr><td>SEPARATOR</td><td>\uE026</td><td>Special key</td></tr>
      <tr><td>SUBTRACT</td><td>\uE027</td><td>Special key</td></tr>
      <tr><td>DECIMAL</td><td>\uE028</td><td>Special key</td></tr>
      <tr><td>DIVIDE</td><td>\uE029</td><td>Special key</td></tr>
      <tr><td>F1</td><td>\uE031</td><td>Special key</td></tr>
      <tr><td>F2</td><td>\uE032</td><td>Special key</td></tr>
      <tr><td>F3</td><td>\uE033</td><td>Special key</td></tr>
      <tr><td>F4</td><td>\uE034</td><td>Special key</td></tr>
      <tr><td>F5</td><td>\uE035</td><td>Special key</td></tr>
      <tr><td>F6</td><td>\uE036</td><td>Special key</td></tr>
      <tr><td>F7</td><td>\uE037</td><td>Special key</td></tr>
      <tr><td>F8</td><td>\uE038</td><td>Special key</td></tr>
      <tr><td>F9</td><td>\uE039</td><td>Special key</td></tr>
      <tr><td>F10</td><td>\uE03A</td><td>Special key</td></tr>
      <tr><td>F11</td><td>\uE03B</td><td>Special key</td></tr>
      <tr><td>F12</td><td>\uE03C</td><td>Special key</td></tr>
      <tr><td>META</td><td>\uE03D</td><td>Special key</td></tr>
      <tr><td>COMMAND</td><td>\uE03D</td><td>Special key</td></tr>
      <tr><td>ZENKAKU_HANKAKU</td><td>\uE040</td><td>Special key</td></tr>
    </table>
    <p>The keys considered upper-case symbols are either defined by the current keyboard locale or are derived from the US 104 keys Microsoft Windows keyboard layout, which are:
    <ul>
      <li>A - Z</li>
      <li>!$^*()+{}:?|~@#%_\" &amp; &lt; &gt;</li>
    </ul>
    <p>When the user input is emulated natively (see note below), the implementation SHOULD use the current keyboard locale to determine which symbols are upper case. In all other cases, the implementation MUST use the US 104 key Microsoft Windows keyboard layout to determine those symbols.</p>
    <p>The state of the physical keyboard MUST NOT affect emulated user input.</p>
    <h3>Internationalized input</h3>
    <p>Non-latin symbols: TBD</p>
    <p>Complex scripts using Input Method Editor (IME): TBD</p>
  </section> <!-- sendkeys end -->
    </section> <!-- typing -->
  </section>
  </section>
    </section> <!-- high-level APIs -->
</section>
<section>
  <h2>Modals</h2>
    This section describes how modal dialogs should be handled using the WebDriver API.
    <p class="note">Conformance tests for this section can be found in the <a href="https://github.com/w3c/web-platform-tests/tree/master/webdriver/">webdriver module</a> under the "modals" folder.</p>
    <section>
      <h2>window.alert, window.prompt and window.confirm</h2>
      <p>When the remote end is has a modal dialog such as those produced from <code>window.alert</code>,
      <code>window.prompt</code> and <code>window.confirm</code> it should allow the interrogation of the
      dialogues as using the following interface.</p>
      <section>
        <!-- dismiss() -->
        <h3>dismiss()</h3>
          <p>
            <table class="simple jsoncommand">
              <tr>
                <th>HTTP Method</th>
                <th>Path Template</th>
                <th>Notes</th>
              </tr>
              <tr>
                <td>POST</td>
                <td id='post-alert-dismiss'>/session/{sessionId}/dismiss_alert</td>
                <td></td>
              </tr>
            </table>
          <p>
          This will dismiss the modal. If the modal is an alert, this MUST be
          equivalent to calling <code>accept()</code> on the dialog. If no alert
           is present a <code><a href="#status-no-such-alert">no such alert error</a>
         </code> MUST be raised.
      </section>
      <section>
        <!-- accept() -->
        <h3>accept()</h3>
          <p>
            <table class="simple jsoncommand">
              <tr>
                <th>HTTP Method</th>
                <th>Path Template</th>
                <th>Notes</th>
              </tr>
              <tr>
                <td>POST</td>
                <td id='post-alert-accept'>/session/{sessionId}/accept_alert</td>
                <td></td>
              </tr>
            </table>
          <p>
          This will accept the modal. If the modal is from a <code>window.prompt</code>
         it is the equivalent of clicking the OK button. If no modal is present then a
          <code><a href="#status-no-such-alert">no such alert error</a></code>
           MUST be raised.
      </section>
      <section>
        <!-- getText() -->
        <h3>getText()</h3>
          <p>
            <table class="simple jsoncommand">
              <tr>
                <th>HTTP Method</th>
                <th>Path Template</th>
                <th>Notes</th>
              </tr>
              <tr>
                <td>GET</td>
                <td id='get-alert-text'>/session/{sessionId}/alert_text</td>
                <td></td>
              </tr>
            </table>
          <p>
          This will return the message shown in the modal. If no modal is present then a <code><a href="#status-no-such-alert">
          no such alert error</a></code> MUST be raised.
      </section>
      <section>
        <!-- sendKeys() -->
        <h3>sendKeys()</h3>
          <p>
            <table class="simple jsoncommand">
              <tr>
                <th>HTTP Method</th>
                <th>Path Template</th>
                <th>Notes</th>
              </tr>
              <tr>
                <td>POST</td>
                <td id='post-alert-text'>/session/{sessionId}/alert_text</td>
                <td></td>
              </tr>
            </table>
          <p>
          This MUST act in the same manner as in
          <a href='#widl-WebElement-sendKeys-void-stringArray-keysToSend'>sendKeys</a> to an element.
          If the modal has no means for text input it should throw a <code><a href='#status-element-not-visible'>
          Element not visible error</a></code>. If no modal is present then a <a href="#status-no-such-alert">
          no such alert error</a></code> MUST be raised.
          <p> Let <var>value</var> be an array of characters that will be typed into a <a>WebElement</a>. If the modal has no means of acceptiing text input
             it MUST raise a <code><a href='#status-element-not-visible'>element not visible error</a></code>
      <p>If a modal dialog is created from a <code>onbeforeunload</code> event the remote end MUST handle the
        dialog by either using <code>accept</code> or <code>dismiss</code>. These calls should either come from
        the local end or should be handled as an unexpected modal dialog as described below.
      <p>The remote end SHOULD have a mechanism to allow unexpected modal dialogs to be closed
      to prevent the remote end from becoming unusable. The default for this should be dismiss.
      The local end SHOULD allow a capability to be set that allows the default value to be
      overridden with accept. The local end SHOULD also allow setting the default behaviour
      to wait for a command to handle the modal. If the next command does not interact with the modal
      it MUST return a <code><a href='#status-unexpected-alert-open'>Unexpected alert open</a></code> error to
      the local end.
      </section>
    </section>
    <section>
      <h2>Modal dialogs</h2>
      <p>If a browser supports Modal dialogs, as created by <code>document.showModalDialog()</code>,
        it MUST support handling of Modal dialogs via the WebDriver API. Modal dialogs can then be
        <a href='#iterating-over-windows'>iterated</a> over in the same approach as normal windows.</p>
      <p>If <code><a href='#widl-WebDriver-close-void'>close()</a></code> is called on a parent window and it has modal
      dialogs open then the remote end SHOULD iterate over modal dialogs closing them
      before it closes the remaining windows so that it does not block the
      future commands to the remote end</p>
    </section>
</section>
<section>
  <h2>Screenshots</h2>
  <p>Screenshots are a powerful mechanism for providing information to users of WebDriver, particularly once a particular WebDriver instance has been disposed of. In different circumstances, users want different types of screenshot. Note that the WebDriver spec does not provide a mechanism for taking a screenshot of the entire screen.</p>

  <p>In all cases, screenshots MUST be returned as lossless PNG images encoded using Base64. Local ends MUST provide the user with access to the PNG images without requiring the user to decode the Base64. This access MUST be via at least one of a binary blob or a file.</p>

  <p>All commands within this section are implemented using the "TakesScreenshot" interface:</p>

  <section>
    <h3>takeScreenshot()</h3>
      <p>
        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>GET</td>
            <td id='get-screenshot'>/session/{sessionId}/screenshot</td>
            <td></td>
          </tr>
        </table>
      <p>
      Take a screenshot and return a lossless PNG encoded using Base64. If
      <code>element</code> is not populated or is <code>null</code> then the User Agent MUST return the screenshot of the current state of the document at the top level browsing context.
      <p>The possible errors for this command:
      <ul>
        <li><code><a href="#unknown-error">unknown error</a></code> if the if the screenshot cannot be taken.</li>
      </ul>
      <p>Leaving below until <a href='https://www.w3.org/Bugs/Public/show_bug.cgi?id=27920'>Bug 27920</a> has a consensus</p>
      <dl class='parameters'>
        <dt>optional WebElement? element</dt>
        <dd>The <a>WebElement</a> on which to operate. If <code>element</code> is not populated or is <code>null</code>
          then the User Agent MUST return the screenshot of the current state of the document at the top level browsing context.</dd>
      </dl>
    </dd>
  </section>

  <section>
    <h2>Current Top Level Browsing Context</h2>
    <table class="simple">
      <tr><th>Capability Name</th><th>Type</th></tr>
      <tr><td><span id="capability-takesScreenshot">takesScreenshot</span></td><td>boolean</td></tr>
    </table>

    <p>If this capability is supported, local end MUST add the <code>TakesScreenshot</code> interface to the <code>WebDriver</code> interface.</p>

    <p>This command will take a screenshot of the return the screenshot of the current state of the document at the top level browsing context. Implementations of the remote end SHOULD capture the entire document, even if this would require a user to scroll the browser window. That is, the returned PNG SHOULD have the same width and height as returned by a call to <code>getSize</code> of the BODY element and MUST contain all visible content on the page, and this SHOULD be done without resizing the browser window. If the remote end is unable to capture the entire Document, then the part of the Document currently displayed in UI of the browser MUST be captured without additional chrome such as scrollbars and browser chrome.</p>

    <div class="note">
      <p>One way to think of capturing the entire Document is that the user has an infinitely large monitor and has resized the window to allow all content to be visible. One of those monitors would be very cool.</p>
    </div>

    <p>Nested frames MUST be sized as if the user has resized the window to the dimensions of the PNG being returned. This often means that not all potentially visible content within the nested frames is captured.</p>

    <p>Remote ends MUST NOT attempt to track changes in window size as the screenshot is being taken. In particular this means that in the case of a page that makes use of "infinite scrolling" (where an AJAX call is used to populate additional content as the user scrolls down) or in some other way resizes content as the window size is changed only the content that was originally contained in the Document when the command is executed will be captured.</p>
  </section>
  <section>
    <h2>Element</h2>
      <table class="simple">
        <tr><th>Capability Name</th><th>Type</th></tr>
        <tr><td><span id="capability-takesElementScreenshot">takesElementScreenshot</span></td><td>boolean</td></tr>
      </table>

  	<p>If this capability is supported, local end MUST add the <code>TakesScreenshot</code> interface to the <code>WebElement</code> interface.</p>
    <table class="simple jsoncommand">
      <tr>
        <th>HTTP Method</th>
        <th>Path Template</th>
        <th>Notes</th>
      </tr>
      <tr>
        <td>GET</td>
        <td id='get-screenshot'>/session/{sessionId}/screenshot/{ELEMENT}</td>
        <td></td>
      </tr>
    </table>
    <p>
      <ul>
        <li>Let <var>element</var> be the value from <var><a href="#uri-template-element">element</a></var> from the URI-Template</li>
        <li>Let <var>screenshot</var> be a be a Base64 encoded, lossless PNG representation of area bounded by the clientBoundingRect of the DOMElement.
          <ol>
            <li>If the element is not in the current viewport, the DOMElement must be scrolled into view.</li>
            <li><If the <code>WebElement</code> represents a FRAME or IFRAME element, this is equivalent of taking a screenshot of the frame's BODY elemen</li>
          </ol>
        </li>
        <li>Return <var>screenshot</var> to the local end.</li>
      </ul>
  </section>
</section>
<section>
  <h2>Handling non-HTML Content</h2>
  <p>Non-HTML content MUST be treated in the same manner as HTML if the Non-HTML if the browser
    creates a Document object for the content of the document. If a Document Object is not created then
    how it handled SHOULD be non-normative</p>

  <section>
    <h2>XML</h2>
    <p>This section describes XML documents as described in [[XML10]]. For XHTML documents the remote end should treat them as HTML documents
    and not have the caveats, below, applied.</p>
      <p>Since Browsers create a Document object for XML pages it is expected that we can interogate
      them as a normal HTML document however the following differences should be noted:</p>
      <ul>
        <li>Visibility Checks MAY be skipped since XML nodes can not be hidden and <code>isDisplayed</code> MUST return true<li>
        <li>Getting computed styles of elements MUST return an empty string</li>
        <li>Position and Size of element MUST return null for elements in the map returned</li>
        <li>Attempts to clear the node MUST return an <code><a href='#status-unsupported-operation'>unsupported operation</a></code> </li>
        <li>Attempts to send keys to a node MUST return an exception <code><a href='#status-unsupported-operation'>unsupported operation</a></code></li>
        <li><code>isEnabled</code> MUST return false</li>
        <li><code>isSelected</code> MUST return false</li>
      </ul>
  </section>
  <section>
    <h2>SVG</h2>
    <p>This section described SVG documents in a browser as described by [[SVG2]].
    Since browsers create a Document tree for SVG documents it is expected that WebDriver
    can interrogate the Document as a normal HTML document.
    </p>
  </section>

  <section>
    <h2>Working with Accessibility APIs</h2>

    <p>Many accessibility APIs represent the UI as a series of nested nodes. It is possible to map these nodes to <code>WebElement</code> instances. In order to function properly, it is likely that additional element locating strategies will be required.</p>

    <p class="note">This is one way in which it might be possible to test mobile applications that marry a native wrapper around a series of HTML views.</p>
  </section>
</section>
  <section>
    <h2>Extending the Protocol</h2>
    <p></p>
    <section>
      <h3>Vendor-specific Extensions</h3>
      <p>The WebDriver protocol is designed to allow extension to meet vendor-specific needs, such as interacting with the chrome of a browser. Vendor-specific extensions are implemented by appending a prefix to the command name. This should be of the form:</p>
      <pre>
        '-' + vendor prefix + '-' + command name
      </pre>
      <p>For example: "<code>-o-open-bookmark</code>" or "<code>-moz-install-extension</code>".</p>
      <p>It is guaranteed that no command name in this or future versions of the WebDriver specification will be prefixed with a leading dash.</p>

      <div class="note">
        It is suggested that vendors use the same vendor identifier as in [[!CSS21]] (notably, section <a href="http://www.w3.org/TR/CSS21/syndata.html#vendor-keywords">4.1.2.2</a>)
      </div>
    </section>
    <section>
      <h3>Extending the JSON/HTTP Protocol</h3>
      <p>This section is non-normative.</p>
      <p>The wire protocol (see <a href="#mapping-to-http-and-json">Appendix</a> below) makes use of URLs to distinguish command names. When extending the protocol by adding new URLs, vendors should use their vendor prefix without additional characters to prevent any potential clashes with other implementations. This leads to URLs of the form: <code>http://host:port/session/somekey/<b>moz</b>/extension</code>.
    </section>
  </section>

<section class='appendix'>
  <h2>Capabilities</h2>

  <p>This section is non-normative.</p>

  <p>Capabilities are used by WebDriver implementations to enumerate the parts of this specification that they support. They are also used when establishing a new session to descrive the required or desired capabilities. This appendix collects the capabilities mentioned in this spec into one place.</p>

<ul>
<li><a href="#capability-browserName">browserName</a></li>
<li><a href="#capability-browserVersion">browserVersion</a></li>
<li><a href="#capability-platformName">platformName</a></li>
<li><a href="#capability-platformVersion">platformVersion</a></li>
<li><a href="#capability-securessl">secureSsl</a></li>
<li><a href="#capability-takesElementScreenshot">takesElementScreenshot</a></li>
<li><a href="#capability-takesScreenshot">takesScreenshot</a></li>
<li><a href="#capability-touchEnabled">touchEnabled</a></li>
</ul>
</section><section class='appendix'>
  <h2>Command Format</h2>
  <p>This is essentially the content at the start of the json wire protocol</p>
  <ul>  </ul>
</section><section class='appendix'>
  <h2>Thread Safety</h2>

  <p>There is no requirement for local or remote implementations to be thread safe. Local ends SHOULD support serialized access from multiple threads.</p>
</section><section class='appendix'>
  <h2>Security and Privacy</h2>
  <p>The following section is non-normative.</p>
  <section>
    <h3>Privacy</h3>
    <p>The local end SHOULD create a new profile when creating a new session.
      If a new profile can be created it MUST NOT copy the profile in use and
      MUST create a fresh profile. By creating a new profile the user agent will
       prevent any unexpected behaviour when the remote end is accessing content.</p>
  </section>
  <section>
    <h3>Security</h3>
    <p>The remote end SHOULD have a specific command line argument when starting
      the browser up if it is connecting to a browser
      (e.g. firefox.exe --webdriver ) and SHOULD have user agent configuration
       preference that is tested when the user agent starts up
    <p>When the remote end starts up, it MUST include a flag or setting to limit
      the IP addesses allowed to connect and create sessions. 
      The default value for this setting SHOULD limit connections to be from
      <code>127.0.0.1</code> IPV4 address or <code>::1</code> IPV6 address.
      This will prevent arbitrary machines from connecting and creating WebDriver
      sessions unless specifically configured to allow them, while still supporting
      use-cases where the local end runs on a different machine from the remote end.</p>
    <div class='note'>
      <p>Some devices will require the device to be placed into a 'developer' mode.
      This allows unix sockets to be forwarded on to the device while the device is
      connected to a host. An example of this is if the local end needed to go through
       a remote debugger protocol.</p>
    </div>
    <p>If any of these fail then a
    <code><a href="#status-session-not-created">session not created</a></code>
    error MUST be thrown when the local end tries to create a new session.
  </section>
  <section>
    <h3>Fingerprinting</h3>
    <p>The following will allow web sites to know that the user interacting
    with the content is not a real user. This can be used to prevent denial
    of service attacks.
    <p>When the user agent creates a new session it MUST add a read only property
    to <code>window.navigator.webdriver</code>. The value should be set to
    <code>true</code> when WebDriver has an active session. When WebDriver does not have
    an active session then the value is equal to <code>false</code> or the property is removed.
  </section>
</section>
    <section class='appendix'>
      <h2>Acknowledgements</h2>
      <p>
        Many thanks to Robin Berjon for making our lives so much
        easier with his cool tool. Thanks to Jason Leyba, Malcolm Rowe,
        Ross Patterson and Andrey Botalov for proof reading and suggesting areas for
        improvement. Thanks to Jason Leyba, Eran Messeri, Daniel
        Wagner-Hall, Malini Das, Luke Inman-Semerau, Andreas Tolfsen and James Graham
        for contributing sections to this document. Also
        thanks to the following people for their contribution of
        patches and test cases:
        <ul>
         <li>Philippe Le Hegaret</li>
        </ul>
      </p>
      </section>

      <div style="display: none">
        <p>These links are only here until we have fixed ReSpec.js to avoid
        creating anchors to things that don't exist.</p>
        <ul>
          <li id="idl-def-void">idl-def-void</li>
          <li id="idl-def-stringbooleannumber">idl-def-stringbooleannumber</li>
          <li id="idl-def-boolean">idl-def-boolean</li>
          <li id="idl-def-number">idl-def-number</li>
          <li id="idl-def-object">idl-def-object</li>
          <li id="idl-def-DOMString">idl-def-DOMString</li>
          <li id="idl-def-dictionary">idl-def-dictionary</li>
          <li id="idl-def-integer">idl-def-integer</li>
          <li id="idl-def-string">idl-def-string</li>
          <li id="idl-def-Argument">idl-def-Argument</li>
        </ul>
      </div>
  </body>
</html>
