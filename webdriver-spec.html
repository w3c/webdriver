<!DOCTYPE html>
<html>
  <head>
    <title>WebDriver</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <style type="text/css">
    /* --- WEB IDL --- */
pre.IDL {
    border-top: 1px solid #90b8de;
    border-bottom: 1px solid #90b8de;
    padding:    1em;
    line-height:    120%;
}

pre.IDL::before {
    content:    "WebIDL";
    display:    block;
    width:      150px;
    background: #90b8de;
    color:  #fff;
    font-family:    initial;
    padding:    3px;
    font-weight:    bold;
    margin: -1em 0 1em -1em;
}

code a:visited, code a:link {
  color:  #ff4500;
}
    </style>

    <!--
      === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can check them
      out in the same tree and use relative links so that they'll work offline,
     -->
    <script src='respec-w3c-common.js' class='remove' async></script>
    <script class='remove'>
      var respecConfig = {
          specStatus:           "ED",

          shortName:            "webdriver",

          // publishDate:  "2009-08-06",

          // copyrightStart: "2005"

          // previousPublishDate:  "1977-03-15",

          // previousMaturity:  "WD",

          edDraftURI:           "http://dvcs.w3.org/hg/webdriver/raw-file/default/webdriver-spec.html",

          // lcEnd: "2009-08-05",

          editors:  [
              { name: "Simon Stewart", url: "http://www.rocketpoweredjetpants.com/",
                company: "Facebook", companyURL: "http://www.facebook.com/"
              },
              { name: "David Burns", url: "http://www.theautomatedtester.co.uk/",
                company: "Mozilla", companyURL: "http://www.mozilla.org/" },
          ],

          otherLinks: [{
            key: "Raising issues with the specification",
            data: [{
                    value: "W3 Bug Tracker",
                    href: "https://www.w3.org/Bugs/Public/enter_bug.cgi?comment=&blocked=20860&short_desc=[WebDriver%20Spec]%3A%20&product=Browser%20Test%2FTools%20WG&component=WebDriver"
                  }]
          }],

          wg:           "Browser Testing and Tools Working Group",

          wgURI:        "http://www.w3.org/testing/browser/",

          wgPublicList: "public-browser-tools-testing",

          wgPatentURI:  "https://www.w3.org/2004/01/pp-impl/49799/status",
      };
    </script>
  </head>
  <body>

<section id="abstract">
<p>This specification defines the WebDriver API, a platform and language-neutral interface and associated wire protocol that allows programs or scripts to introspect into, and control the behaviour of, a web browser. The WebDriver API is primarily intended to allow developers to write tests that automate a browser from a separate controlling process, but may also be implemented in such a way as to allow in-browser scripts to control a &mdash; possibly separate &mdash; browser.</p>

<p>The WebDriver API is defined by a wire protocol and a set of interfaces to discover and manipulate DOM elements on a page, and to control the behaviour of the containing browser.</p>

<p>This specification also includes a normative reference serialisation (to JSON over HTTP) of the interface's invocations and responses that are to be used by browser vendors to ensure interoperability.</p>
</section>

<section id="sotd">
<p>If you wish to make comments regarding this document, please email feedback to <a href="mailto:public-browser-tools-testing@w3.org">public-browser-tools-testing@w3.org</a>. All feedback is welcome, and the editors will read and consider all feedback.</p>

<p>This specification is still under active development and may not be stable. Any implementors who are not actively participating in the preparation of this specification may find unexpected changes occurring. It is suggested that any implementors join the WG for this specification. Despite not being stable, it should be noted that this specification is strongly based on an existing Open Source project &mdash; <a href="http://selenium.googlecode.com/">Selenium WebDriver</a> &mdash; and the existing implementations of the API defined within that project.</p>
</section>
<section>
  <h2>Introduction</h2>
  <p>The WebDriver API aims to provide a synchronous API that can be used for a variety of use cases, though
  it is primarily designed to support automated testing of web apps.</p>
  <section>
    <h3>Intended Audience</h3>
    <p>This specification is intended for implementors of the WebDriver API. It is not intended as light bed
    time reading.</p>
  </section>
  <section>
    <h3>Relationship of WebDriver API and Existing Specifications</h3>
    <p>Where possible and appropriate, the WebDriver API references existing specifications. For example, the
    list of boolean attributes for elements is drawn from the
    <a href="http://dev.w3.org/html5/spec/Overview.html">HTML specification</a>. When references are made, this
    specification will link to the relevant sections.</p>
  </section>

  <section>
    <h3>Naming the Two Sides of the API</h3>

    <p>The WebDriver API can be thought of as a client/server process. However, implementation details can mean that this terminology becomes confusing. For this reason, the two sides of the API are called the "local" and the "remote" ends.</p>
    <dl>
      <dt><dfn id="local-end">Local</dfn></dt>
      <dd>The user-facing API. <code><a href="#command-1">Command</a></code> objects are sent and <code><a href="#response">Response</a></code> objects are
      consumed by the local end of the WebDriver API. It can be thought of as
      being "local" to the user of the API.</dd>

      <dt><dfn id="remote-end">Remote</dfn></dt>
      <dd>The implementation of the user-facing API. <code><a href="#command-1">Command</a></code> objects are
      consumed and <code><a href="#response">Response</a></code> objects are sent by the remote end of the WebDriver
      API. The implementation of the remote end may be on a machine remote from
      the user of the local end.</dd>

    </dl>

    <p>There is no requirement that the local and remote ends be in different processes. The IDLs given in this specification SHOULD be used as the basis for any conforming local end implementation.</p>
  </section>

  <section>
    <h3>Conformance Requirements</h3>

    <p>All diagrams, examples, and notes in this specification are non-normative, as are all sections explicitly marked non-normative. Everything else in this specification is normative.</p>

    <p>The key words "MUST", "MUST NOT", "REQUIRED", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in the normative parts of this document are to be interpreted as described in [[!RFC2119]]. The key word "OPTIONALLY" in the normative parts of this document is to be interpreted with the same normative meaning as "MAY" and "OPTIONAL".</p>

    <p>Conformance requirements phrased as algorithms or specific steps may be implemented in any manner, so long as the end result is equivalent.</p>

    <p>The IDL fragments in this specification must be interpreted as required for conforming IDL fragments, as described in the Web IDL specification [[!WEBIDL]].</p>

    <section>
      <h3>Conformance Classes</h3>

      <p>This specification describes the conformance criteria for both local (relevant to creating bindings for languages) and remote end implementations (relevant to browser vendors and server implementors). A final conformance class &mdash; <dfn id="intermediate-node">intermediate node</dfn> &mdash; is also specified. These represent those nodes situated between the local and remote ends.</p>
    </section>
  </section>
</section>
<section>
  <h2>Commands and Responses</h2>
  <p>The communication between the remote and local ends is performed via Command and Response objects. How these are encoded and transmitted between the remote and local ends is left undefined.</p>

  <section>
    <h3>Command</h3>

<pre class="IDL">interface <dfn id="command" title="command">Command</dfn> {
  attribute DOMString? <code><a href="#command-name">name</a></code>;
  attribute object <code><a href="#command-parameters">parameters</a></code>;
  attribute DOMString? <code><a href="#sessionid">sessionId</a></code>;
};
</pre>

    <p>A command represents a call to a remote end to the <a href="#sessions">session</a> identified by the <code><a href="#sessionid">sessionId</a></code> attribute. By default, the <code><a href="#sessionid">sessionId</a></code> is null. The only time the null value is a valid <code><a href="#sessionid">sessionId</a></code> is before a call to <code><a href="#creating-a-session">newSession</a></code>. The name of the command to execute is held in the <dfn id="command-name" title="command-name">name</dfn>, and this MUST be handled case-sensitively. It defaults to the null value. The <dfn id="command-parameters" title="command-parameters">parameters</dfn> attribute is a map of named parameters to objects representing the value of the parameter. The default value is an empty array and this field MUST NOT be null.</p>

  </section>
  <section>
    <h3>Response</h3>

<pre class="IDL">interface <dfn id="response" title="response">Response</dfn> {
  readonly attribute DOMString <code><a href="#sessionid">sessionId</a></code>;
  readonly attribute DOMString <code><a href="#response-status">status</a></code>;
  readonly attribute object? <code><a href="#response-value">value</a></code>;
};
</pre>

    <p>A Response represents the value returned from the remote end of the WebDriver API after executing a Command from the session identified by the <code><a href="#sessionid">sessionId</a></code> attribute. The default value for the <code><a href="#sessionid">sessionId</a></code> MUST be the <code><a href="#sessionid">sessionId</a></code> used in the <a>command</a></code> that this is a response to, unless the <a>command</a>'s <code><a href="#sessionid">sessionId</a></code> was the null value, in which case a unique <code><a href="#sessionid">sessionId</a></code> MUST be assigned (see <code><a href="#creating-a-session">newSession</a></code> for how this is achieved).</p>

    <p>Each Response has a <code><dfn id="response-status" title="response-status">status</dfn></code> that indicates the success or failure of the method. Anything other than "<code><a href="#status-success">success</a></code>" indicates a failure. Each command lists the status strings it can return in the section of this specification in which it is defined, but the normative list of expected statuses is given below in the <a href="#status-codes">Status Codes</a> section. This list MAY be extended by implementors of the specification, provided they follow the guidelines about <a href="#extending-the-protocol">extending the protocol</a>.</p>

    <p>The meat of the <code><a href="#response">Response</a></code> is in the <code><dfn id="response-value" title="response-value">value</dfn></code> attribute. It's type is determined by the <a>command</a></code> that has been executed. In this specification, each command definition will make clear what the expected return type is. The default value is the null value. In the case where the status indicates failure, the value is commonly the error text explaining the cause of the problem.</p>

    <p class="note">In the case where a failure is indicated and the language used for implementing the local end supports throwing exceptions, the value is often used as the exception's message.</p>

    <p>There is no requirement that implementations of <a>command</a> and <code><a href="#response">Response</a></code> exhibit any behaviour: they MAY be simple data structures. Reading of values MUST be idempotent, and writing any particular value MUST NOT cause any other values on the <a>command</a> or <code><a href="#response">Response</a></code> to change.</p>
  </section>

  <section>
    <h3>Processing Additional Fields on Commands and Responses</h3>

    <p>Any <a>command</a> or <code><a href="#response">Response</a></code> MAY contain additional fields than those listed above. The content of fields MUST be maintained, unaltered by any <a href="#intermediate-node">intermediate nodes</a>. There is no requirement to maintain the ordering of fields.</p>

    <div class="note">
      <p>This requirement exists to allow for extension of the protocol, and to allow implementors to decorate Commands and Responses with additional information, perhaps giving context to a series of messages or providing security information.</p>
    </div>
  </section>

  <section>
    <h3>Status Codes</h3>
    <p>The WebDriver API indicates the success or failure of a command invocation via <code><a href="#response-status">Response.status</a></code>. The following values are used and have the following meanings.</p>

    <table class="simple">
      <tr>
        <th>Status Code</th>
        <th>Detail</th>
      </tr>
      <tr>
        <td><dfn id="status-element-not-selectable">element not selectable</dfn></td>
        <td>An attempt was made to select an element that cannot be selected.</td>
      </tr>
      <tr>
        <td><dfn id="status-element-not-visible">element not visible</dfn></td>
        <td>An element command could not be completed because the element is not visible on the page.</td>
      </tr>
      <tr>
        <td><dfn id="status-ime-engine-activation-failed">ime engine activation failed</dfn></td>
        <td>An IME engine could not be started.</td>
      </tr>
      <tr>
        <td><dfn id="status-ime-not-available">ime not available</dfn></td>
        <td>IME was not available.</td>
      </tr>
      <tr>
        <td><dfn id="status-invalid-argument">invalid argument</dfn></td>
        <td>The arguments passed to a command are either invalid or malformed.</td>
      </tr>
      <tr>
        <td><dfn id="status-invalid-cookie-domain">invalid cookie domain</dfn></td>
        <td>An illegal attempt was made to set a cookie under a different domain than the current page.</td>
      </tr>
      <tr>
        <td><dfn id="status-invalid-element-coordinates">invalid element coordinates</dfn></td>
        <td>The coordinates provided to an interactions operation are invalid.</td>
      </tr>
      <tr>
        <td><dfn id="status-invalid-element-state">invalid element state</dfn></td>
        <td>An element command could not be completed because the element is in an invalid state (e.g. attempting to click an element that is no longer attached to the Document).</td>
      </tr>
      <tr>
        <td><dfn id="status-invalid-selector">invalid selector</dfn></td>
        <td>Argument was an invalid selector (e.g. XPath/CSS).</td>
      </tr>
      <tr>
        <td><dfn id="status-invalid-sessionid">invalid sessionid</dfn></td>
        <td>The session with the session id does not exist. This could be either from the session being quit
         or the session id passed in is not currently active.</td>
      </tr>
      <tr>
        <td><dfn id="status-javascript-error">javascript error</dfn></td>
        <td>An error occurred while executing user supplied JavaScript.</td>
      </tr>
      <tr>
        <td><dfn id="status-move-target-out-of-bounds">move target out of bounds</dfn></td>
        <td>The target for mouse interaction is not in the browser's viewport and cannot be brought into that viewport.</td>
      </tr>
      <tr>
        <td><dfn id="status-no-such-alert">no such alert</dfn></td>
        <td>An attempt was made to operate on a modal dialog when one was not open.</td>
      </tr>
      <tr>
        <td><dfn id="status-no-such-element">no such element</dfn></td>
        <td>An element could not be located on the page using the given search parameters.</td>
      </tr>
      <tr>
        <td><dfn id="status-no-such-frame">no such frame</dfn></td>
        <td>A request to switch to a frame could not be satisfied because the frame could not be found.</td>
      </tr>
      <tr>
        <td><dfn id="status-no-such-window">no such window</dfn></td>
        <td>A request to switch to a different window could not be satisfied because the window could not be found.</td>
      </tr>
      <tr>
        <td><dfn id="status-script-timeout">script timeout</dfn></td>
        <td>A script did not complete before its timeout expired.</td>
      </tr>
      <tr>
        <td><dfn id="status-session-not-created">session not created</dfn></td>
        <td>A new session could not be created.</td>
      </tr>
      <tr>
        <td><dfn id="status-stale-element-reference">stale element reference</dfn></td>
        <td>An element command failed because the referenced element is no longer attached to the Document.</td>
      </tr>
      <tr>
        <td><dfn id="status-success">success</dfn></td>
        <td>The command executed successfully.</td>
      </tr>
      <tr>
        <td><dfn id="status-timeout">timeout</dfn></td>
        <td>An operation did not complete before its timeout expired.</td>
      </tr>
      <tr>
        <td><dfn id="status-unable-to-set-cookie">unable to set cookie</dfn></td>
        <td>A request to set a cookie's value could not be satisfied.</td>
      </tr>
      <tr>
        <td><dfn id="status-unexpected-alert-open">unexpected alert open</dfn></td>
        <td>A modal dialog was open, blocking this operation.</td>
      </tr>
      <tr>
        <td><dfn id="status-unknown-command">unknown command</dfn></td>
        <td>A command could not be executed because the remote end is not aware of it.</td>
      </tr>
      <tr>
        <td><dfn id="status-unknown-error">unknown error</dfn></td>
        <td>An unknown error occurred in the remote end while processing the command.</td>
      </tr>
      <tr>
        <td><dfn id="status-unsupported-operation">unsupported operation</dfn></td>
        <td>Indicates that a command that should have executed properly cannot be supported for some reason.</td>
      </tr>
    </table>
    </section>

    <section>
    <h2>Handling of Status Codes at the Local End</h2>

    <p>Status codes are returned from the <a href="#remote-end">remote end</a> to the <a href="#local-end">local end</a>. The <a href="#local-end">local end</a> SHOULD convert these into a form appropriate for the implementation language. For example, in C the status codes might be converted to constant integer values, whereas in Java various exceptions could be thrown.</p>

    <p>Implementations of the <a href="#local-end">local end</a> written in languages that support exceptions SHOULD make use of an exception hierarchy rooted on a <code>WebDriverException</code> (or similarly named base exception class). Where references to <code>WebDriverException</code> are made in this specification, we are referring to this local end conversion of status codes to local end exceptions.</p>

    <p class="note">The reason for this is to allow users of the local end to easily handle the all expected failure modes of a local WebDriver implementation by catching the <code>WebDriverException</code>.</p>

     <p class="note">It is strongly recommended that the <code>WebDriverException</code> contain as much diagnostic information as possible, including version numbers and details about the remote end. This is because experience suggests that when reporting errors from tests using WebDriver, users will simply cut-and-paste a stack trace of an exception. Adding this information to the exception makes the task of debugging problems considerably easier.</p>
  </section>

<section>
<h3>The JSON Wire Protocol</h3>

<p>Although the encoding and transport mechanism is left undefined in this specification, implementors of the remote end MUST provide an implementation suitable for acting as the server-side of the JSON and HTTP protocol (the "JSON Wire Protocol") defined in this specification and summarized non-normatively in <a href="#mapping-to-http-and-json">Appendix G</a>. This MAY take the form of a standalone executable that translates the JSON over HTTP protocol to the encoding and transport mechanism used by the remote end.</p>

<p>When describing the URL to use for each <code>Command</code> this specification will use URI paths encoded using the scheme described in [[!URI-TEMPLATE]]. The following substitutions are commonly made:</p>

<dl>
  <dt>{sessionId}</dt>
  <dd>The <code>sessionId</code> of the selected session.</dd>

  <dt>{id}</dt>
  <dd>The <code>id</code> of the <code>WebElement</code> instance being referred to</dd>
</dl>

<p>The URLs given in this specification MUST have the same path prefix. Implementations are free to redirect those as necessary.</p>

<p class="note">The reason for doing this is to reduce the complexity of local-end implementations. They need only append the path to a base URL in order to create a working implementation.</p>

<section>
<h3>JSON Encoding of Commands</h3>

A <code>Command</code> instance MUST be encoded using UTF-8 and MUST be mapped to the following JSON structure:

<!-- TODO: Is there an approved standard way of unambiguously defining JSON structures? That the W3C allows us to use in specs -->
<pre>
  {
    "sessionId" : "string value",
    "name" : "string value",
    "parameters" : {}
  }
</pre>

<p>The "<code>parameters</code>" fields depends on the "<code>name</code>" of the <code>Command</code>, and will be documented by the definition of each <code>Command</code> in this specification.

<h3>JSON Encoding of Responses</h3>

<p>A <code>Response</code> instance MUST be encoded using UTF-8 and MUST be mapped to the following JSON structure:

<pre>
  {
    "sessionId" : "string value",
    "status": "string value",
    "value" : {}
  }
</pre>

<p>The value of the "<code>value</code>" field will be defined beside each <code>Command</code> in this specification.

</section>

</section>

</section>
<section>
  <h2>Browser Capabilities</h2>
  <p>Different browsers support different levels of various specifications. For example, some support SVG or the [[!SELECTORS-API]], but only browsers that implement [[WEBSTORAGE]] will support <a href="http://www.w3.org/TR/2009/WD-webstorage-20090910/#the-localstorage-attribute">LocalStorage</a>. The WebDriver API provides a mechanism to query the supported capabilities of a browser. Each broad area of functionality within the WebDriver API has an associated capability string. Whether a particular capability MUST or MAY be supported &mdash; as well as fallback mechanisms for handling those cases where a capability is not supported &mdash; is discussed where the capability string is defined.</p>

  <section>
    <h3>Capabilities</h3>
    <dl class="idl" title="interface Capabilities">
      <dt>readonly attribute dictionary capabilities</dt>
      <dd>The underlying collection of capabilities, represented as a dictionary mapping strings to values which may be
      of type <code>boolean</code>, <code>numerical</code> or <code>DOMString</code>. The default value is an empty dictionary.</dd>
      <dt>boolean has(DOMString capabilityName)</dt>
      <dd>Queries the underlying <code>capabilities</code> to see whether the
      value is set. This MUST return true if the capabilities contain a key with
      the given <code>capabilityName</code> and the value of that key is defined.
      If the value is a boolean, this function MUST return that boolean value. If
      the value is <code>null</code>, an empty string or a 0 then this method MUST return
      false.</dd>
      <dt>(DOMString or boolean or long)? get(DOMString capabilityName)</dt>
      <dd>Get the value of the key matching capabilityName in the underlying <code>capabilities</code> or <code>null</code> if no value is  defined.</dd>
    </dl>
    <p>A <code>Capabilities</code> instance MUST be immutable.

    <p class="note">The "has" method is designed to provide a quick boolean check on whether or not a particular capability is set and can be used in an "if" statement in many languages. The "get" method returns the exact value. In the case of boolean values, this will be the same result as if "truthy" values are used (that is: <code>get('falseValue')</code> and <code>get('unsetValue')</code> are both false).</p>
  </section>
</section>
<section>
  <h2>Sessions</h2>
  <p>Non-normative summary: A session is equivalent to a single instantiation of a particular browser, including all
  child windows. The WebDriver API gives each session a unique ID stored as an opaque string that can be used to differentiate one
  session from another, allowing multiple browsers to be controlled on the same machine if needed, and allowing
  sessions to be routed via a multiplexer. This ID is sent with every <code><a>Command</a></code> and returned with every
  <code><a>Response</a></code> and is stored on the <dfn id="sessionid" title="sessionid">sessionId</dfn> field.</p>
  <section>
    <h3>Creating a Session</h3>
    <p>The process for successfully creating a session MUST be:</p>
    <ol>
      <li>The local end creates a new <a>Capabilities</a> instance describing the desired capabilities
      for the session. The <a>Capabilities</a> object MUST be defined but MAY be empty.</li>
      <li>The local end MUST create a new <a>Command</a> with the "name" being "newSession" and the "parameters" containing an
      entry named "desiredCapabilities" with the value set to the <a>Capabilities</a> instance from the previous step. An optional
      "requiredCapabilities" entry MAY also be created and populated with a <a>Capabilities</a> instance. The "sessionId" fields
      SHOULD be left empty.</li>
      <li>The <a>Command</a> is transmitted to the remote end.</li>
      <li>The remote end MUST examine the "requiredCapabilities" parameter if specified, SHOULD examine the "desiredCapabilities" parameter, and MUST create a new session matching as many of the <a>Capabilities</a> as
      possible.
      How the new session is created depends on the implementation of this specification.
        <ul>
          <li>If any of the "requiredCapabilities" cannot be fulfilled by the new session, the remote end MUST quit the session and return the
            <code><a href="#status-session-not-created">session not created</a></code> error code. The sessionId of the <a>Response</a> object MUST be left as the default value unless the <a>Command</a> had the sessionId set, in which case that value MUST be used. The error message SHOULD list all unmet required capabilities though only a single required capability MUST be given.</li>
          <li>If a capability is listed in both the requiredCapabilities and desiredCapabilities, the value in the requiredCapabilities MUST be used.</li>
          </ul>
      </li>
      <li>The session MUST be assigned a <code><a href="#sessionid">sessionId</a></code> which MUST be unique for each session (a UUID SHOULD be used). Generating the sessionId
      MAY occur before the session is created. If the <a>Command</a> object had the "sessionId" field set, this MAY be
      discarded in favour of the freshly generated sessionId. Because of this, it is
      recommended that sessionId generation be done on the remote end. If the sessionId has already been used, a <a>Response</a> MUST be sent with the status
      code set to <code><a href="#status-session-not-created">session not created</a></code> and the value being an explanation that the sessionId has previously been used.</li>
      <li>The remote end MUST create a new <code><a>Response</a></code> object, with the following fields MUST be set to:
      <ul>
        <li>"sessionId": the <code>sessionId</code> associated with this session.</li>
        <li name="create-session-value">"value": a <a>Capabilities</a> instance. The keys of this <a>Capabilities</a> instance MUST be the strings given in each of the supported <a>Capabilities</a> as defined in the relevant sections of this specification. Supported functionality MUST be included in this <a>Capabilities</a> instance, while unsupported functionality MAY be omitted.</li>
        <li>"status": the <code><a href="#status-success">success</a></code> error code.</li>
      </ul></li>
      <li>The <a>Response</a> is returned to the local end.</li>
    </ol>
    <p>There is no requirement for the local end to validate that some or all of the fields sent on the <a>Capabilities</a> associated with the <a>Command</a> match those returned in the <a>Response</a>.</p>

    <p>As stated, when returning the <a href="#create-session-value">value of the <a>Response</a>, the remote end MUST include the capability names and values of all supported <a>Capabilities</a> from this specification. They MAY also include any additional capability names and values of supported <a>Capabilities</a> implemented independently of this specification. Local ends MAY choose to ignore this additional information. <a href="#intermediate-node">Intermediate nodes</a> between the local and remote ends MAY interpret the <a>Capabilities</a> being returned.</p>

    <p>If the <code>browserName</code> is given as a desired capability and omitted from the required capabilities, and the returned <code>browserName</code> value does not match the requested one, local ends SHOULD issue a warning to the user. How this warning is issued is undefined, but one implementation could be a log message. In this particular case, local ends MAY chose to change the <code><a>Response</a></code>'s status code to <code><a href="#status-session-not-created">session not created</a></code>, and modify the value to explain the cause, including the value originally returned as the <code>browserName</code> capability. If this is done, the local end MUST ensure that the remote end quits the session.</p>

    <section>
      <h3>Capability Names</h3>
      <p>The following keys SHOULD be used in the <a>Capabilities</a> instances. They all default to the null string.</p>
      <dl>
        <dt><span id="capability-browserName">browserName</span></dt>
        <dd>The name of the desired browser as a string.</dd>
        <dt><span id="capability-browserVersion">browserVersion</span></dt>
        <dd>The version number of the browser, given as a string.</dd>
        <dt><span id="capability-platformName">platformName</span></dt>
        <dd>The OS that the browser is running on, matching any of the platform names given below.</dd>
        <dt><span id="capability-platformVersion">platformVersion</span></dt>
        <dd>The version of the OS that the browser is running on as a string.</dd>
      </dl>

      <section>
        <h3>Platform Names</h3>
        <p>The following platform names are defined and MUST be used, case sensitively, for the "platformName" unless the actual platform being used is not given in this list:</p>
        <ul>
          <li>android</li>
          <li>ios</li>
          <li>linux</li>
          <li>mac</li>
          <li>unix</li>
          <li>windows</li>
        </ul>
        <p>In addition "any" MAY be used to indicate the underlying OS is either unknown or does not matter.</p>

        <p>Implementors MAY add additional platform names. Until these are standardized, these MUST follow the conventions outlined in <a href="#extending-the-protocol">extending the protocol</a> section with the exception that the vendor prefix SHOULD omit the leading "-" character.<p>

        <p class="note">For example, Mozilla's Firefox OS could be described as either "-MOZ-FIREFOXOS" or "MOZ-FIREFOX". The latter makes it easier for local ends to specify an enum of supported platforms and is therefore recommended in this case.</p>

        <!-- TODO: Add section on comparing platforms -->

      </section>
    </section>
    <section>
      <h3>Error Handling</h3>
      <p>The following status codes MUST be returned by the "newSession" command:</p>
      <dl>
        <dt><code><a href="#status-success">success</a></code></dt>
        <dd>The session was successfully created. The "value" field of the <code><a>Response</a></code> MUST contain a <a>Capabilities</a> object describing the session.</dd>
        <dt><code><a href="#status-timeout">timeout</a></code></dt>
        <dd>The new session could not be created within the time allowed for command execution on the remote end. This
        time MAY be infinite (in which case this status won't be seen). The "value" field of the <a>Response</a> SHOULD contain a string explaining that a timeout has
        occurred, but it MAY be left as the null value or filled with the empty string.</dd>
        <dt><code><a href="#status-unknown-error">unknown error</a></code></dt>
        <dd>An unhandled error of some sort has occurred. The "value" field of the <a>Response</a> SHOULD contain a more detailed
        description of the error as a string.</dd>
      </dl>
    </section>
    <section>
      <h3>Remote End Matching of Capabilities</h3>
      <p>This section is non-normative.</p>
      <p>The suggested order for comparing keys in the <a>Capabilities</a> instance when creating a session is:</p>
      <ol>
        <li>browserName</li>
        <li>browserVersion</li>
        <li>platformName</li>
        <li>platformVersion</li>
      </ol>
      <p>For all comparisons, if the key is missing (as determined by a call to Capability.has() returning "false"), that particular criteria shall not factor into the
      comparison.</p>
    </section>
  </section>
</section>
<section>
  <h2>Navigation</h2>
  <p>Almost all usages of the WebDriver API begin by navigating to a particular URL. This section not only describes the commands used for navigation, but also describes when commands must be processed.</p>

  <p>All WebDriver implementations MUST support navigating between different HTTP domains and between HTTPS and HTTP domains if the underlying browser supports this.</p>

  <section>
    <h2 id="page-load-strategies">Page Load Strategies</h2>

    <table class="simple">
      <tr><td>Capability Name</td><td>Type</td></tr>
      <tr><td><span id="capability-pageLoadingStrategy">pageLoadingStrategy</span></td><td>DOMString</td></tr>
    </table>

    <p>It is possible to request a particular strategy be used for detecting when the next command should be processed by a remote end implementation by modifying the page load strategy that is used. The following are the expected values that MAY be used when creating a new session:</p>

    <dl title='partial interface WebDriver' class='idl'>
      <dt>const DOMString CONSERVATIVE = 'conservative'</dt>
      <dd>The remote end MUST wait until all frames and iframes in the window currently being used to process commands
      that contain an HTML document are at <a href="http://dev.w3.org/html5/spec/single-page.html#current-document-readiness">document.readyState</a> equals 'complete' and there are no outstanding HTTP requests, other than those caused by XMLHttpRequests. If a frame or iframe does not contain an HTML document, the remote end SHOULD wait until all HTTP traffic to that frame is complete. Put in non-normative terms, this implies that the <code>onload</code> event has fired on every frame.</dd>

      <dt>const DOMString NORMAL = 'normal'</dt>
      <dd>The remote end MUST wait until the "<code>document.readyState</code>" of the frame currently handling commands equals "<code>complete</code>", or there are no more outstanding network requests other than XMLHttpRequests.</dd>

      <dt>const DOMString EAGER = 'eager'</dt>
      <dd>The remote end MUST wait until the "<code>document.readyState</code>" of frame currently handling equals "<code>interactive</code>" or "<code>complete</code>", or there are no more outstanding network requests.</dd>
      <dt>const DOMString NONE = 'none'</dt>
      <dd>The remote end does not do any checks to see if a page load is currently active.</dd>
    </dl>

    <p>All WebDriver implementations MUST support the <code>normal</code> and <code>eager</code> modes and SHOULD support the <code>conservative</code> and <code>none</code> modes. If no page loading strategy is chosen, then <code>normal</code> MUST be the default.
    In addition, implementors MAY add additional page loading strategies.</p>
  </section>

  <section>
    <h2>Navigation Commands</h2>

    <p class="note">Conformance tests for this section can be found in the <a href="https://github.com/w3c/web-platform-tests/tree/master/webdriver/">webdriver module</a> under the "navigation" folder.</p>

    <dl class='idl' title='partial interface WebDriver'>
      <!-- get() -->
      <dt>void get()</dt>
      <dd>
        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>POST</td>
            <td>/session/{sessionId}/url</td>
            <td></td>
          </tr>
        </table>
        <p>The "get" command is used to cause the browser to navigate to a new location, and is named after the HTTP verb. From a user's point of view, this is as if they have entered the "url" into the URL bar. When the command returns is based on the <a href="#page-load-strategies">page load strategy</a> that the user has selected with the following exceptions when the strategy is not "none":

        <ul>
          <li>HTTP redirects MUST be automatically followed without responding to the command.</li>
          <li>When a page contains a META tag with the "http-equiv" attribute set to "refresh", a response MUST be returned if the timeout is greater than 1 second and the other criteria for determining whether a page is loaded are met. When the refresh period is 1 second or less and the page loading strategy is "normal" or "conservative" implementations MUST wait for the refresh to complete before responding.</li>
          <li>If any modal dialog box, such as those opened by on <code>window.onbeforeunload</code> or <code>window.alert</code>, is opened at any point in the page load, a response MUST be sent.</li>
          <li>If a 401 response is seen by the browser, a response MUST be sent. That is, if BASIC, DIGEST, NTLM or similar authentication is required, the page load is assumed to be complete. This does not include FORM-based authentication.</li>
        </ul>
        <dl class='parameters'>
          <dt>DOMString url</dt>
          <dd>URL that the browser will navigate to</dd>
        </dl>
      </dd>

      <!-- getCurrentUrl() -->
      <dt>DOMString getCurrentUrl()</dt>
      <dd>
        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>GET</td>
            <td>/session/{sessionId}/url</td>
            <td></td>
          </tr>
        </table>
        <p>WebDriver implementations MUST allow the users to be able to get the
          current URL. In the case of a <a href='http://www.w3.org/TR/html5/browsers.html#nested-browsing-context'>Nested Browsing Context</a> WebDriver should return the [[html51]] <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsering context</a>.
          The returned value should be the equivalent to returning <code>document.location.href</code> for the [[html51]] <a href='http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context'>top level browsering context</a>.
        <p>If the window currently receiving commands is no longer open a <code><a href="#no-such-window">no such window</a></code> MUST be raised.
      </dd>

      <!-- goBack() -->
      <dt>void goBack()</dt>
      <dd>
        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>POST</td>
            <td>/session/{sessionId}/back</td>
            <td></td>
          </tr>
        </table>
        <p>The "goBack" command is equivalent to a user hitting the "back" button in their browser, and MUST behave as a <a href="http://www.w3.org/TR/html/browsers.html#traverse-the-history-by-a-delta">traversal of the browser history by a delta of -1</a> (as defined in [[!html51]]). If a user calls "<code>goBack</code>" when there are no further pages in the browser's history stack, then this call MUST be a no-op.
        </p>
        <p> If the page takes too long <a href="#timeouts">as specified by the timeouts</a> a <code><a href="#status-timeout">timeout</a></code> MUST be raised. If the window currently receiving commands is no longer open a <code><a href="#no-such-window">no such window</a></code> MUST be raised.
      </dd>
      <dt>void goForward()</dt>
      <dd>
        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>POST</td>
            <td>/session/{sessionId}/forward</td>
            <td></td>
          </tr>
        </table>
        <p>The "goForward" command is equivalent to a user hitting the "forward" button in their browser, and MUST behave as a <a href="http://www.w3.org/TR/html/browsers.html#traverse-the-history-by-a-delta">traversal of the browser history by a delta of +1</a> (as defined in [[!html51]]). If a user calls "<code>goForward</code>" when there are no further pages in the browser's history stack, then this call MUST be a no-op.
        <p> If the page takes too long <a href="#timeouts">as specified by the timeouts</a> a <code><a href="#status-timeout">timeout</a></code> MUST be raised. If the window currently receiving commands is no longer open a <code><a href="#no-such-window">no such window</a></code> MUST be raised
      </dd>

      <!-- refresh() -->
      <dt>void refresh()</dt>
      <dd>
        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>POST</td>
            <td>/session/{sessionId}/refresh</td>
            <td></td>
          </tr>
        </table>
        <p>"refresh" emulates the user hitting the "refresh" or "reload" button in their browser, causing the current page to be reloaded.</p>
        <p> If the page takes too long <a href="#timeouts">as specified by the timeouts</a> a <code><a href="#status-timeout">timeout</a></code> MUST be raised. If the window currently receiving commands is no longer open a <code><a href="#no-such-window">no such window</a></code> MUST be raised.
      </dd>
    </dl>

    <section>
      <h2>Invalid SSL Certificates</h2>

      <table class="simple">
        <tr><td>Capability Name</td><td>Type</td></tr>
        <tr><td><span id="capability-securessl">secureSsl</span></td><td>boolean</td></tr>
      </table>

      <p>WebDriver implementations MUST support users accessing sites served via HTTPS. Access to those sites using self-signed or invalid certificates, and where the certificate does not match the serving domain MUST be the same as if the HTTPS was configured properly.</p>

      <p class="note">The reason for this is that implementations of this spec are often used for testing. It's a sorry fact that many QA engineers and testers are asked to verify that apps work on sites that have insecure HTTPS configurations</p>


      <p>The exception to requirement is if the <a>Capabilities</a> used to initialize has the WebDriver session had the capability <code>secureSsl</code> set to true. In this case, implementations MAY choose to make accessing a site with bad HTTPS configurations cause a <code>WebDriverException</code> to be thrown. Remote end implementations MUST return an <code><a href="#status-unknown-error">unknown error</a></code> status in this case. If this is the case, the <a>Capabilities</a> describing the session MUST also set the <code>secureSsl</code> capability to "true".</p>
    </section>

  </section>

  <section>
    <h3>Detecting When to Handle Commands</h3>

    <p><a>Command</a>s MUST only be processed when the <span id="page-loading-strategies">page loading strategy</span> being used indicates that page loading is complete.</p>

    <p>If a remote end receives a new <a>Command</a> for a session while still waiting to finish an existing <a>Command</a> for that session it MAY choose to queue the command for execution as soon as possible, it MAY throw a <code>WebDriverException</code> or it MAY leave the remote end in an inconsistent state. Because of this, local ends SHOULD NOT attempt to send a new <a>Command</a> to a session until the previous <a>Command</a> has returned.</p>
  </section>
</section>
<section>
  <h2>Controlling Windows</h2>

  <section>
    <h2>Defining "window" and "frame"</h2>

    <p>Within this specification, a window equates to [[!html51]]'s <a href="http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context">top level browsing context</a>. Put another way, within this spec browser tabs are counted as separate windows.</p>

    <p><strong>TODO: define "frame"</strong></p>
  </section>

  <section>
    <h2>Window Handles</h2>
    <dl class='idl' title='partial interface WebDriver'>
      <dt>DOMString getWindowHandle()</dt>
      <dd>
        <p>Each window has a "window handle" associated with it. This is an opaque string which MUST uniquely identify the window within the session and MUST NOT be "current". This MAY be a UUID. The "getWindowHandle" command can be used to obtain the window handle for the window that commands are currently acting upon.</p>
      </dd>
    </dl>
  </section>

  <section>
    <h2 name="iterating-over-windows">Iterating Over Windows</h2>
    <dl class='idl' title='partial interface WebDriver'>
      <dt>sequence&lt;DOMString> getWindowHandles()</dt>
      <dd> <p>This array of returned strings MUST contain a handle for every window associated with the browser session and no others. For each returned window handle the javascript expression "window.top.closed" (or equivalent) MUST evaluate to false at the time the command is being executed.</p>

    <p>The ordering of the array elements is not defined, but MAY be determined by iterating over each top level browser window and returning the tabs within that window before iterating over the tabs of the next top level browser window. For example, in the diagram below, the window handles should be returned as the handles for: win1tab1, win1tab2, win2.</p>

    <img src="example-windows.png" alt="Two top level windows. The first window has two tabs, lablled win1tab1 and win1tab2. The second window has only one tab labelled win2"/>

    <p class="note">This implies that the correct way to determine whether or not a particular interaction with the browser opens a new window is done by obtaining the set of window handles before the interaction is performed and comparing with the set after the action is performed.</p></dd>
    </dl>
  </section>

  <section>
    <h2>Closing Windows</h2>
    <dl class='idl' title='partial interface WebDriver'>
      <dt>void close()</dt>
      <dd>
        <p>The close command closes the window that <a>Command</a>s are currently being sent to. If this means that a call to get the list of window handles would return an empty list, then this close command MUST be the equivalent of calling "quit". That is, if the final window of a session is closed, then the session quits.</p>

        <p>Once the window has closed, future commands MUST return a status code of <code><a href="#status-no-such-window">no such window</a></code> until a new window is selected for receiving commands.</p>
      </dd>
    </dl>
  </section>

  <section>
    <h2>Resizing and Positioning Windows</h2>
    <p>All commands MUST be handled by the window that ultimately owns the current context.</p>
    <dl class='idl' title='dictionary WindowSize'>
      <dt>double height</dt>
      <dd>The height of the window in pixels</dd>
      <dt>double width</dt>
      <dd>The width of the window in pixels</dd>
    </dl>
    <dl class='idl' title='partial interface WebDriver'>
      <!-- setWindowSize() -->
      <dt>void setWindowSize()</dt>
      <dd>Resizes the Browser window currently in focus to have the <code>height</code> and <code>width</code> passed in as parameters.
        <p>If a request is made to resize a window to a size which cannot be performed (e.g. the browser has a minimum, or fixed window size, or the operating system does not support resizing windows at all as is the case in many phone OSs), an <code><a href="#status-unsupported-operation">unsupported operation</a></code> status code MUST be returned.</p>
        <p>After <code>setWindowSize</code>, the browser window MUST NOT be in the maximised state.</p>
        <dl class='parameters'>
          <dt>unsigned double width</dt>
          <dd>The "width" value refer to the javascript <code>window.outerwidth</code> property. For those browsers that do not support these properties, these represent the width of the whole browser window including window chrome and window resizing borders/handles.</dd>
          <dt>unsigned double height</dt>
          <dd>The "height" value refer to the javascript <code>window.outerheight</code> property. For those browsers that do not support these properties, these represent the height of the whole browser window including window chrome and window resizing borders/handles.</dd>
        </dl>
      </dd>

      <!-- getWindowSize() -->
      <dt>WindowSize getWindowSize()</dt>
      <dd>Return a <a>WindowSize</a> object containing the <a href='#widl-WindowSize-height'>height</a> and <a href='#widl-WindowSize-width'>width</a> of the browser window currently in focus in pixels</dd>

      <!-- maximizeWindow() -->
      <dt>void maximizeWindow()</dt>
      <dd>
        <p>After  <code>maximizeWindow</code>, the browser window currently in focus MUST be left as if the maximise button had been pressed if, and only if, the window manager of the OS supports this concept; it is not sufficient to leave the window "restored", but with the full screen dimensions.</p>
        <p>If a request is made to resize a window to a size which cannot be performed (e.g. the browser has a minimum, or fixed window size, or the operating system does not support resizing windows at all as is the case in many phone OSs), an <code><a href="#status-unsupported-operation">unsupported operation</a></code> status code MUST be returned.</p>
      </dd>

      <!-- fullscreenWindow -->
      <dt>void fullscreenWindow()</dt>
      <dd>
        <p>After <code>fullscreenWindow</code>, the browser window currently in focus MUST be in full-screen mode. For those operating systems that support the concept, this MUST be equivalent to if the user requested the window be full screen. If the OS does not support the concept of full-screen, then this command is a synonym for "<code>maximizeWindow</code>".

        <p>If a request is made to resize a window to a size which cannot be performed (e.g. the browser has a minimum, or fixed window size, or the operating system does not support resizing windows at all as is the case in many phone OSs), an <code><a href="#status-unsupported-operation">unsupported operation</a></code> status code MUST be returned.</p>
      </dd>
    </dl>
  </section>

  <section>
    <h2>Scaling the Content of Windows</h2>

    <p>TODO</p>
  </section>

</section>
<section>
  <h2>Where Commands Are Handled</h2>

  <p>Web applications can be composed of multiple windows and/or frames. For a normal user, the context in which an operation is performed is obvious: it's the window or frame that currently has OS focus and which has just received user input. The WebDriver API does not follow this convention. There is an expectation that many browsers using the WebDriver API may be used at the same time on the same machine. This section describes how WebDriver tracks which window or frame is currently the context in which commands are being executed.</p>

  <section>
    <h2>Default Content</h2>

    <p>WebDriver's <dfn id="default-content">default content</dfn> is [[!html51]]'s <a href="http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context">top level browsing context</a> for the window that is currently receiving WebDriver commands.</p>

    <p>When a WebDriver instance is started and a single browser window is opened, the <a href="#default-content">default content</a> of that window is automatically selected for receiving further commands. If more than one window is opened when the session starts, then the user MUST first select which window to act upon using the <code>switchToWindow</code> command. Until the user selects a window, all commands must return a status code of <code><a href="#status-no-such-window">no such window</a></code>.</p>

  </section>

  <section>
    <h2>Switching Windows</h2>

    <dl class='idl' title='partial interface WebDriver'>
      <dt>void switchToWindow()</dt>
      <dd>
        <dl class='parameters'>
          <dt>DOMString name</dt>
          <dd>The identifier used for a window</dd>
        </dl>
        <p>The "switchToWindow" command is used to select which window MUST be used as the context for processing commands. In order to determine which window should be used for accepting commands, the "switchToWindow" command MUST iterate over all windows. For each window, the following MUST be compared &mdash; in this order &mdash; with the "name" parameter:

        <ol>
          <li>A window handle, obtained from "getWindowHandles" or "getWindowHandle".</li>
          <li>The window name, as defined when the window was opened (the value of "window.name")</li>
        </ol>

        <p>If no windows match, then a "<code><a href="#status-no-such-window">no such window</a></code>" status code MUST be returned, otherwise the "<a href="#default-content">default content</a>" of the first window to match will be selected for accepting commands.</p>
      </dd>
    </dl>
  </section>

  <section>
    <h2>Switching Frames</h2>
    <dl class='idl' title='partial interface WebDriver'>
      <dt>void switchToFrame()</dt>
      <dd>
        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>POST</td>
            <td>/session/{sessionId}/frame</td>
            <td></td>
          </tr>
        </table>
        <dl class='parameters'>
          <dt><a>WebElement</a> or unsigned short? id</dt>
          <dd>The identifier used for a frame.</dd>
        </dl>
        <p>The "switchToFrame" command is used to select which frame within a window MUST be used as the context for handling future commands. All frame switching is taken from the current context from which commands are currently being handled. The "<code>id</code>" parameter can be an unsigned short or a <a>WebElement</a>. WebDriver implementations MUST determine which frame to select using the following algorithm:

        <ol>
          <li>If the "id" is a unsigned short the current context is set to the equivalent of the JS expression "window.frames[id]" where "id" is the number and "window" is the Document window represented by the current context.</li>
          <li>If the "id" is null, the current context is set to the <a href='#default-content'>default content</a>.</li>
          <li>If the "id" represents a <a>WebElement</a>, and the corresponding Document element represents a FRAME or an IFRAME, and the <a>WebElement</a> is part of the current context, the "window" property of that Document element becomes the current context.</li>
        </ol>

        <p>In all cases if no match is made a "<code><a href="#status-no-such-frame">no such frame</a></code>" status code MUST be returned.</p>

        <p>If the indicated frame exists, frame switching MUST succeed even if doing so would violate the normal security constraints in place within the Javascript sandbox.</p></dd>
      <dt>void switchToParentFrame()</dt>
      <dd>
        <table class="simple jsoncommand">
          <tr>
            <th>HTTP Method</th>
            <th>Path Template</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>POST</td>
            <td>/session/{sessionId}/frame/parent</td>
            <td></td>
          </tr>
        </table>
        <p>The "switchToParentFrame" command MUST set the context of future commands to the <code>window.parent</code>. If the current context is the [[!html51]]'s <a href="http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context">top level browsing context</a>, the context remains unchanged.</p>
      </dd>
    </dl>
  </section>
</section>
<section>
  <!-- TODO(simon): identify a better location for this -->
  <h2>Running Without Window Focus</h2>
  <p>All browsers must comply with the <a
    href="http://www.w3.org/TR/html5/editing.html#focus">focus</a> section of
  the [[!html51]] spec. In particular, the requirement that the active element within a top-level browsing
  context be independent of whether or not the top-level browsing context itself
  has system focus MUST be followed.</p>

  <p class="note">This requirement is put in place to allow efficient machine
  utilization when using the WebDriver API to control several browsers
  independently on the same desktop</p>
</section>
<section>
  <h2>Elements</h2>
  <p class="note">Conformance tests for this section can be found in the <a href="https://github.com/w3c/web-platform-tests/tree/master/webdriver/">webdriver module</a> under the "element_location" folder.</p>
  <p>One of the key abstractions of the WebDriver API is the
  <a>WebElement</a> interface. Each instance of this interface represents an
  <a href="http://www.w3.org/TR/2012/WD-dom-20120105/#interface-element">Element</a> as defined in the
  [[!DOM4]] specification. Because the WebDriver API is designed to allow users to interact with apps as if
  they were actual users, the capabilities offered by the
  <code>WebElement</code> interface are somewhat different from those offered by the Document Element interface.</p>

  <p>Each WebElement instance must have an ID, which is distinct from the value
  of the Document Element's "id" property. The ID for every WebElement representing the same
  underlying Document Element MUST be the same. The IDs used to refer to different
  underlying Document Elements MUST be unique within the session over the entire duration of the session.</p>

  <div class="note">
    <p>This requirement around WebElement IDs allows for efficient equality
    checks when the WebDriver API is being used out of process.</p>
  </div>

  <dl class="idl" title="interface WebElement">
    <dt>readonly attribute DOMString id</dt>
    <dd>The WebDriver ID of this particular element. This SHOULD be a UUID.</dd>
  </dl>

  <p>This section of the specification covers finding elements. Later sections deal with querying and interacting with
  these located elements. The primary interface used by the WebDriver API for locating elements is the
  <a>SearchContext</a>.</p>
  <section>

    <p>The primary grouping of <a>WebElement</a> instances is a <code>sequence</code> of <a>WebElement</a> instances</p>

    <p>A reference to an WebElement is obtained via a SearchContext. The key
    interfaces are:</p>
  </section>
  <section>
    <dl class="idl" title="interface Locator">
      <dt>readonly attribute DOMString strategy</dt>
      <dd>The name of the strategy that should be used to locate elements. The default value is the null value</dd>
      <dt>readonly attribute DOMString value</dt>
      <dd>The value to pass to the element finding strategy. The default value is the null value.</dd>
    </dl>
  </section>
  <section>
    <dl class="idl" title="interface SearchContext">
      <dt>WebElement[] findElements(in Locator locator)</dt>
      <dd></dd>
      <dt>WebElement findElement(in Locator locator)</dt>
      <dd></dd>
    </dl>
  </section>

  <section>
    <h2>Element Location Strategies</h2>

    <p>All element location strategies MUST return elements in the order in which they appear in the current document.</p>
    <section>
    <h2>CSS Selectors</h2>
      <p>Strategy name: css selector</p>
      <p>If a browser supports the
      <a href="http://dev.w3.org/2006/webapi/selectors-api/">CSS Selectors API</a> ([[!SELECTORS-API]]) it MUST support locating elements by
      CSS Selector. If the browser does not support the browser CSS Selector spec it MAY choose to implement locating
      by this mechanism. If the browser can support locating elements by CSS Selector, it MUST set the "cssSelector" capability to boolean true when responding to the <a href="#creating-a-session">"newSession" command</a>. Elements MUST be returned in the same order as if "<code>querySelectorAll</code>" had been called with the <code>Locator</code>'s <code>value</code>. Compound selectors are allowed.</p>
    </section>
    <section>
      <h2>ECMAScript</h2>
      <p>Finding elements by ecmascript is covered in the <a href="#ecmascript">ecmascript part of this spec</a>.</p>
    </section>
    <section>
      <h2>Element ID</h2>
      <p>Strategy name: id</p>
      <p>This strategy MUST be supported by all WebDriver implementations.</p>
      <p>The HTML specification ([[!html51]]) states that <a
        href="http://www.w3.org/TR/html5/dom.html#the-id-attribute">element
        IDs must be unique within their home subtree</a>. Sadly, this uniqueness
      requirement is not always met. Consequently, this strategy is equally
      valid for finding a single element or groups of elements. In the case of
      finding a single WebElement, this MUST be functionally identical to a call
      to "<a href="http://www.w3.org/TR/2012/WD-dom-20120105/#dom-document-getelementbyid">document.getElementById()</a>"
      from the [[!DOM4]]. When finding multiple
      elements, this is equivalent to an CSS query of "<code>#value</code>" where "value" is the ID being searched for with all "'" characters being properly escaped..</p>
    </section>
    <section>
      <h2>Link Text</h2>
      <p>Strategy name: link text</p>
      <p>This strategy MUST be supported by all WebDriver implementations. </p>
      <p>This strategy MUST return all <a href="http://www.w3.org/TR/html5/text-level-semantics.html#the-a-element">"a"</a> elements with visible text exactly and case sensitively equal to the term being searched for.</p>
      <div class="note">
	    <p>This is equivalent to:</p>
	    <pre>
		  elements = driver.find_elements(by = By.TAG_NAME, value = "a")
		  result = []
		  for element in elements:
		    text = element.text
		    if text == search_term:
		      result.append(element)
		</pre>
		<p>Where "search_term" is the link text being searched for, and "result" contains the list of elements to return.</p>
	  </div>
    </section>
    <section>
      <h2>Partial Link Text</h2>
      <p>Strategy name: partial link text</p>
      <p>This strategy MUST be supported by all WebDriver implementations.</p>
      <p>This strategy is very similar to <a href="#link-text">link text</a>, but rather than matching the entire string, only a subset needs to match. That is, this MUST return all <a href="http://www.w3.org/TR/html5/text-level-semantics.html#the-a-element">"a"</a> elements with visible text that partially or completely and case sensitively matches the term being searched for.</p>
      <div class="note">
	    <p>This is equivalent to:</p>
	    <pre>
		  elements = driver.find_elements(by = By.TAG_NAME, value = "a")
		  result = []
		  for element in elements:
		    text = element.text
		    if text.search(seach_term) != -1:
		      result.append(element)
		</pre>
		<p>Where "search_term" is the link text being searched for, and "result" contains the list of elements to return.</p>
	  </div>
    </section>
    <section>
      <h2>XPath</h2>
      <p>Strategy name: xpath</p>
      <p>All WebDriver implementations MUST support finding elements by XPath 1.0 [[!XPATH]] with the <a href="http://dev.w3.org/html5/spec/Overview.html#interactions-with-xpath-and-xslt">edits from section 3.3</a> of the [[!html51]] specification made. If no native support is present in the browser, a pure JS implementation MAY be used. When called, the returned values MUST be equivalent of calling "<a href="http://www.w3.org/TR/DOM-Level-3-XPath/xpath.html#XPathEvaluator-evaluate">evaluate</a>" function from [[DOM-LEVEL-3-XPATH]] with the result type set to "<a href="http://www.w3.org/TR/DOM-Level-3-XPath/xpath.html#XPathResult-ORDERED-NODE-SNAPSHOT-TYPE">ORDERED_NODE_SNAPSHOT_TYPE</a> (7).</p>
    </section>
  </section>
</section>
<section>
<h2>Reading Element State</h2>
<p class="note">Conformance tests for this section can be found in the <a href="https://github.com/w3c/web-platform-tests/tree/master/webdriver/">webdriver module</a> under the "element_state" folder.</p>
  <section>
    <h2 id='determining-if-displayed'>Determining if an element is displayed</h2>
      <p>The following steps MUST be used to determine if an element is displayed to a user.</p>
      <ul>
        <li>The BODY element MUST be displayed irrespective of any CSS style</li>
        <li>Any INPUT elements of "type=hidden" MUST NOT be displayed.</li>
        <li>Any NOSCRIPT elements MUST NOT be displayed.</li>
        <li>OPTIONs and OPTGROUP elements MUST be displayed if and only if the enclosing select element is displayed.</li>
        <li>MAP elements are displayed if and only if the image it uses is displayed. Areas within
          a map are displayed if the enclosing MAP is displayed.</li>
        <li>If element is a [[!DOM4]] <a href="http://www.w3.org/TR/2012/WD-dom-20120105/#interface-text">
          text node</a> then it MUST be displayed.</li>
        <li>The element MUST NOT be displayed if there is a [[!css3-2d-transforms]] or [[!css3-3d-transforms]]
          property that gives a negative x or y to the canvas. The User Agent MUST NOT allow negative scrolling.</li>
        <li>The element MUST NOT be displayed if that element, or any of its ancestors,
          has a <a href='http://www.w3.org/TR/html5/editing.html#the-hidden-attribute'>hidden attribute</a>
          or has <code>display:none</code> in its computed CSS style.</li>
        <li>If element or at least one of its descendents have both
          <a href='http://dev.w3.org/fxtf/geometry/Overview.html#dom-domrect-domrect'>DOMRect</a>
          height and a <a href='http://dev.w3.org/fxtf/geometry/Overview.html#dom-domrect-domrect'>DOMRect</a>
          width greater than 0px, as returned by <code>element.<a href='http://dev.w3.org/csswg/cssom-view/#dom-element-getboundingclientrect'>getBoundingClientRect()</a>
          </code>then it MUST be displayed.</li>
        <li>The element MUST NOT be displayed if any ancestor of the element  has a fixed size, and has the CSS style with one of the following <code>overflow:hidden</code>, <code>overflow-x:hidden</code> or <code>overflow-y:hidden</code>, and the element's location as determined by <code><a href="http://www.w3.org/TR/cssom-view/#dom-range-getclientrects">getClientRects</a></code> is not within the fixed size of the parent.</li>
      </ul>

    <p class="note">
      Essentially, this attempts to model whether or not a user of the browser could possibly find a way to view the <code>WebElement</code> without resizing the browser window.
    </p>
    <div class="note">
      <p>
      The common usage pattern for <code>isDisplayed</code> is typically something similar to (in python):</p>
      <pre>
        element = driver.find_element(by = TAG_NAME, value= = "button")
        if element.is_displayed():
            element.click()
        else
            # So other deep magic of the unseen ages.
      </pre>
  </div>
    <dl class='idl' title='partial interface WebElement'>
      <dt>boolean isDisplayed()</dt>
      <dd>If <code>isDisplayed</code> returns true, then the element MUST also be
        <a href="#interactable-elements">interactable</a> should it meet the other criteria for being interactable. If any part of the BODY can be brought into the current viewport, this MUST return true.
        <div class="note">
          <p>This implies that <code>isDisplayed</code> MUST return true if the centre of the element could be brought into the viewport. The exception to this would be the BODY element, which is generally assumed to always be displayed by users of the WebDriver spec. It is possible to interact with elements which may not have the centre point brought into the viewport by using the <a href="#low-level-commands">low level commands</a>. This means that if any part of the element could be brought into the viewport by user action and its position could be used by low-level commands then a WebDriver implementation MAY return true.</p>
        </div>
        <dl class='parameters'>
          <dt>DOMString id</dt>
          <dd>The ID of the WebElement. If the element is no longer attached to the document then a
            <code><a href="#status-stale-element-reference">stale element reference</a></code>
            MUST be raised.</dd>
        </dl>
      </dd>
    </dl>
  </section>

  <section>
    <h2>Determining Whether a WebElement Is Selected</h2>
    <dl class='idl' title='partial interface WebElement'>
      <dt>boolean isSelected()</dt>
      <dd><p>The remote end MUST determine whether a <code>WebElement</code> is selected using the following algorithm:
        <ol>
          <li id="is_selectable">If the item is not "<code title="selectable">selectable</code>", the WebElement is not selected. A <dfn id="selectable" title="selectable">selectable</dfn> element is either an OPTION element or an INPUT element of type "<a href="http://www.w3.org/TR/html5/forms.html#checkbox-state-(type=checkbox)">checkbox</a>" or "<a href="http://www.w3.org/TR/html5/forms.html#radio-button-state-(type=radio)">radio</a>".</li>
          <li>If the Document node represented by the WebElement is an OPTION element, the "<a href="http://www.w3.org/TR/html5/forms.html#concept-option-selectedness">selectedness</a>" of the element, as defined in [[!html51]] determines whether the element is selected.</li>
          <li>Otherwise, the value of the Document node's "<a href="http://www.w3.org/TR/html5/forms.html#attr-input-checked">checked</a>" property determines whether the element is selected. This MUST reflect the element's "<a href="http://www.w3.org/TR/html5/forms.html#concept-fe-checked">checkedness</a>" as defined in [[!html51]].</li>
        </ol>
        <dl class='parameters'>
          <dt>DOMString id</dt>
          <dd>The ID of the WebElement. If the element is no longer attached to the document then a
            <code><a href="#status-stale-element-reference">stale element reference</a></code>
            MUST be raised.</dd>
        </dl>
      </dd>
    </dl>
  </section>

  <section>
    <h2 name="attributes-and-properties">Reading Attributes and Properties</h2>
    <p>Although the [[!html51]] spec is very clear about the difference between the properties and attributes of a Document element, users are frequently confused between the two. Because of this, the WebDriver API offers a single command ("getElementAttribute") which covers the case of returning either of the value of a Document element's property or attribute. If a user wishes to refer specifically to an attribute or a property, they should evaluate Javascript in order to be unambiguous.</p>
    <dl class='idl' title='partial interface WebElement'>
      <dt>DOMString getElementAttribute()</dt>
      <dd>
        <p>The algorithm to implement this MUST be (where <code>name</code> refers to the <code>name</code> parameter of the <code>getElementAttribute</code> command):</p>

        <ol>
          <li>If <code>name</code> case insensitively matches "style", the value returned MUST be <a href="http://dev.w3.org/csswg/cssom/#serialize-a-css-rule">serialized as defined</a> in the [[!CSSOM-VIEW]] spec. Notably, css property names MUST be cased the same as specified in in section 6.5.1 of the [[!CSSOM-VIEW]] spec.
            <ul>
              <li>It SHOULD be equivalent to obtaining the "cssText" property, with the additional constraint that the same value MUST be returned after a round trip through "executeScript". That is, the following pseudo-code MUST be true (where "driver" is a WebDriver instance, and "element" is a WebElement):
<pre class="example highlight">
style = element.get_attribute('style');
self.driver.execute_script('arguments[0].style = arguments[1]', element, style);
var recovered = element.get_attribute('style');
assertEquals(style, recovered);
</pre>
              </li>
              <li>Color property values MUST be standardized to <a href='http://www.w3.org/TR/css3-color/#rgba-color'>RGBA color format</a> as described in [[!CSS3-COLOR]]. If a user agent does not support RGBA then it MUST return a value as 1 for opacity.</li>
            </ul>
          </li>
          <li>If the result of a Javascript call to "<code><a href="https://dvcs.w3.org/hg/domcore/raw-file/tip/Overview.html/#dom-element-hasattribute">hasAttribute(name)</a></code>" (as defined in [[!DOM4]]) returns true:
            <ol>
              <li>Store the result of the Javascript call to "<code><a href="https://dvcs.w3.org/hg/domcore/raw-file/tip/Overview.html/#dom-element-getattribute">getAttribute(name)</a></code>" in <code>result</code></li>
              <li>If the attribute <code>name</code> is defined as a <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/#boolean-attribute">boolean attribute</a>, the string 'true' MUST be returned if <code>result</code> is true, or null otherwise</li>
              <li>Otherwise, fall through to the <a href="#attribute-final-step">final step</a> in this algorithm.</li>
            </ol>
          </li>
          <li>If the element is an OPTION element and <code>name</code> case insensitively matches "value":
            <ol>
              <li>If a Javascript call to <code>hasAttribute(name)</code> returns true, then the result of a Javascript call to <code>getAttribute(name)</code> MUST be returned.</li>
              <li>Otherwise, the text content of the OPTION, as returned by a call to <code><a href="#widl-WebElement-getElementText-DOMString">getElementText</a></code>, MUST be returned.</li>
            </ol>
          </li>
          <li>If the element is <a href="#is_selectable">selectable</a> and <code>name</code> case insensitively matches "selected", and the element in an INPUT element of type "checkbox" or "radio", the string "true" MUST be returned if the element is <a href="http://www.w3.org/TR/html5/forms.html#concept-fe-checked">checked</a> or null otherwise.</li>
          <li>If the value is expected to be a URL, return the property named <code>name</code>, i.e. a fully resolved URL. A non-normative set of these properties is given below:
            <table class="simple">
              <tr>
                <th>Tag name</th>
                <th>"name" value</th>
              </tr>
              <tr>
                <td>A</td>
                <td>href</td>
              </tr>
              <tr>
                <td>IMG</td>
                <td>src</td>
              </tr>
            </table>
          </li>
          <li>If <code>name</code> is in the table below, and the above stages have not yielded a defined, non-null value, the value of the aliased attribute in the table MUST be used as the argument to a recursive call to <code>getElementAttribute</code> and the result returned. This is to allow for common mis-captitalizations:
            <table class="simple">
              <tr>
                <th>Original property name</th>
                <th>Aliased property name</th>
              </tr>
              <tr>
                <td>class</td>
                <td>className</td>
              </tr>
              <tr>
                <td>readonly</td>
                <td>readOnly</td>
              </tr>
            </table>
          </li>
          <li id="attribute-final-step">Finally, attempt the following steps in order, ceasing when one returns a value:
            <ol>
              <li>Attempt to determine the property of the element with the given <code>name</code>. If this is defined and is not an object, then the named property of the object coerced to a string MUST be returned.</li>
              <li> If a Javascript call to "<code>hasAttribute(name)</code>" returns "true", the result of a Javascript call to "<code>getAttribute(name)</code>" MUST be returned.</li>
              <li>The null value MUST be returned.</li>
            </ol>
          </li>
        </ol>
        <dl class='parameters'>
          <dt>DOMString id</dt>
          <dd>The ID of the WebElement on which to operate.</dd>
          <dt>DOMString name</dt>
          <dd>The name of the property or attribute to return.</dd>
        </dl>
      </dd>
    </dl>
  </section>
  <section>
   <h2>Rendering Text</h2>
   <p>All WebDriver implementations MUST support getting the <a
     href="#determining-if-displayed">displayed</a> text of a <code>WebElement</code>, with excess whitespace compressed.</p>

  <dl class='idl' title='partial interface WebElement'>
    <dt>DOMString getElementText()</dt>
    <dd> <p>The following definitions are used in this section:
    <dl>
        <dt id="text.whitespace">Whitespace</dt>
        <dd>Any text that matches the ECMAScript regular expression class <code>\s</code>.

        <dt id="text.whitespace-nbsp">Whitespace excluding non-breaking spaces</dt>
        <dd>Any text that matches the ECMAScript regular expression <code>[^\S\xa0]</code>

        <dt id="text.blocklevel">Block level element</dt>
        <dd>A block-level element is one which is not a table cell, and whose effective CSS display style is not in the set ['inline', 'inline-block', 'inline-table', 'none', 'table-cell', 'table-column', 'table-column-group']</dd>

        <dt id="text.horizontal">Horizontal whitespace characters</dt>
        <dd>Horizontal whitespace characters are defined by the ECMAScript regular expression <code>[\x20\t\u2028\u2029]</code>.</dd>
    </dl>

<p>The expected return value is roughly what a text-only browser would display. The algorithm for determining this text is as follows:</p>

<p>Let <code>lines</code> equal an empty array. Then:
<ol>
    <li>if the element is in the <code>head</code> element of the document, return an empty string otherwise carry on with the algorithm below.</li>
    <li><span id="text.1">For</span> each descendent of node, at time of execution, in order:
        <ol>
            <li>Get whitespace, text-transform, and then, if descendent is:
                <ul>
                    <li>a node which is not <a href="#determining-if-displayed">displayed</a>, do nothing</li>
                    <li>a [[!DOM4]] <a href="http://www.w3.org/TR/2012/WD-dom-20120105/#interface-text">text node</a> let <code>text</code> equal the <code>nodeValue</code> property of descendent. Then:
                        <ol>
                            <li>Remove any zero-width spaces (\u200b), form feeds (\f) or vertical tab feeds (\v) from <code>text</code>.</li>
                            <li>Canonicalize any recognized single newline sequence in <code>text</code> to a single newline (greedily matching <code>(\r\n|\r|\n)</code> to a single \n)</li>
                            <li>If the parent's effective CSS whitespace style is 'normal' or 'nowrap' replace each newline (\n) in <code>text</code> with a single space character (\x20). If the parent's effective CSS whitespace style is 'pre' or 'pre-wrap' replace each <a href="#text.horizontal">horizontal whitespace character</a> with a non-breaking space character (\xa0). Otherwise replace each sequence of <a href="#text.horizontal">horizontal whitespace characters</a> except non-breaking spaces (\xa0) with a single space character</li>
                            <li>Apply the parent's effective CSS text-transform style as per the <a href="http://www.w3.org/TR/CSS21/text.html#propdef-text-transform">CSS 2.1 specification</a> ([[!CSS21]])</li>
                            <li>If <code>last(lines)</code> ends with a space character and <code>text</code> starts with a space character, trim the first character of <code>text</code>.</li>
                            <li>Append <code>text</code> to <code>last(lines)</code> in-place</li>
                        </ol>
                    </li>
                    <li>an element which is <a href="#determining-if-displayed">displayed</a>. If the element is a:
                        <ul>
                            <li>BR element: Push '' to <code>lines</code> and continue</li>
                            <li><a href="#text.blocklevel">Block-level</a> element and if <code>last(lines)</code> is not '', push '' to <code>lines</code>.</li>
                        </ul>
                    And then recurse depth-first to <a href="#text.1">step 1</a> at the beginning of the algorithm with descendent set to the current element</li>
                    <li>If element is a TD element, or the effective CSS display style is 'table-cell', and last(lines) is not '', and <code>last(lines)</code> does not end with whitespace append a single space character to <code>last(lines)</code> [Note: Most innerText implementations append a \t here]</li>
                    <li>If element is a block-level element: push '' to <code>lines</code></li>
                </ul>
            </li>
        </ol>
    </li>
    <li>The string MUST then have the white space normalised as defined in the [[!XPATH]] <a href="http://www.w3.org/TR/xpath/#function-normalize-space">normalize-space function</a> which is then returned.</li>
</ol></dd>
  </dl>



</section>
</section>
<section>
  <h2>Executing Javascript</h2>
  <div class="note">
    <p>Open questions: What happens if a user's JS triggers a modal dialog?
      Blocking seems like a reasonable idea, but there is an assumption that
      WebDriver is not threadsafe.

      What happens to unhandled JS errors? Caused by a user's JS? Caused by JS
      on a page? How does a user of the API obtain the list of errors? Is that
      list cleared upon read?
    </div>
    <p class="note">Conformance tests for this section can be found in the <a href="https://github.com/w3c/web-platform-tests/tree/master/webdriver/">webdriver module</a> under the "ecmascript" folder.</p>

    <section>
      <h2>Javascript Command Parameters</h2>
      <div class='idl' title='typedef (long or boolean or DOMString or WebElement or Object or sequence<Argument>)? Argument'></div>

      <dl class="idl" title="interface JavascriptCommandParameters">
        <dt>readonly attribute DOMString script</dt>
        <dd>The JavaScript to execute, in the form of a Function body.</dd>

        <dt>readonly attribute sequence&lt;Argument> args</dt>
        <dd>The parameters to the function defined by <code>script</code>.</dd>
      </dl>
    </section>

    <p>When executing Javascript, it MUST be possible to reference the <code>args</code> parameter using the function's <code>arguments</code> object. The arguments MUST be in the same order as defined in <code>args</code>. Each WebDriver implementation MUST preprocess the values in <code>args</code> using the following algorithm:

      <p id="JS-args-preprocess">For each index, <code>index</code> in <code>args</code>, if <code>args[index]</code> is...
        <ol>
          <li>a long, boolean, DOMString, or <code>null</code>, then let <code>args[index] = args[index]</code>.</li>
          <li>a sequence, then recursively apply this algorithm to <code>args[index]</code> and assign the result to <code>args[index]</code>.</li>
          <li>an object, then recursively apply this algorithm to each value in <code>args[index]</code> and assign the result to <code>args[index]</code>.</li>
          <li>a <a href="#elements">WebElement</a>, then:
            <ol>
              <li>If the element's ID does not represent a Document Element, or it represents a Document Element that is no longer attached to the document's tree, then the WebDriver implementation MUST immediately abort the command and return a <code title="stale-element-reference"><a href="#status-stale-element-reference">stale element reference</a></code> error.</li>
              <li>Otherwise, let <code>args[index]</code> be the underlying Document Element.</li>
            </ol>
          </li>
          <li>Otherwise WebDriver implementations MAY throw an <code><a href="#status-unknown-error">unknown error</a></code> indicating the index of the unhandled parameter but SHOULD attempt to convert the value into a <code>object</code>.</li>
        </ol>
        <section>
          <h2>Synchronous Javascript Execution</h2>
          <dl class='idl' title='partial interface JavaScriptExecutor'>
            <dt>Argument? executeScript()</dt>
            <dd>
              <dl class='parameters'>
                <dt> DOMString script</dt>
                <dd>The script to execute.</dd>
                <dt>sequence&lt;Argument>? args</dt>
                <dd>The script arguments.</dd>
              </dl>
              <p>When executing JavaScript, the WebDriver implementations MUST use the following algorithm:
                <ol>
                  <li>Let <code>window</code> be the <a href="http://www.w3.org/TR/Window/">Window</a> object for WebDriver's current <a href="#where-commands-are-handled">command context</a>.
                  <li>Let <code>script</code> be the DOMString from the command's <code>script</code> parameter.
                  <li>Let <code>fn</code> be the Function object created by executing <code>new Function(script);</code>
                  <li>Let <code>args</code> be the sequence created by the pre-processing algorithm defined <a href="#JS-args-preprocess">above</a>.
                  <li>Invoke <code>fn.apply(window, args);</code>
                  <li>If the previous step errors then:
                  <ol>
                    <li>Let <code>error</code> be the thrown value.
                    <li>Set the <a>response</a> <a href="href=#response-status">status</a> to <code><a href="#status-javascript-error">javascript error</a></code>.
                    <li>Set the <a>response</a> <a href="#response-value">value</a> to a <code>object</code>, <code>dict</code>.
                    <li>If <code>error</code> is an Error, then set a "message" entry in <code>dict</code> whose value is the DOMString defined by <code>error.message</code>.
                    <li>Otherwise, set a "message" entry in <code>dict</code> whose value is the DOMString representation of <code>error</code>.
                  </ol>
                  <li>Otherwise:
                  <ol>
                    <li>Let <code>result</code> be the value returned by the function in step #5.
                    <li>Set the command's <a>response</a> <a href='#response-status'>status</a> to <code><a href="#status-success">success</a></code>.
                    <li>Let <code>value</code> be the result of the following algorithm:
                  <ol>
                    <li>If <code>result</code> is:
                    <ol>
                      <li><code>undefined</code> or <code>null</code>, return <code> null</code>.
                      <li>a long, boolean, or DOMString, return <code>result</code>.
                      <li>a Document Element, then return the corresponding WebElement for that Document Element.
                      <!-- Should there be a recursion limit? -->
                      <li>a <code>Sequence &lt;Node&gt; nodes</code>, then return the result of recursively applying this algorithm to <code>result</code>.
                      <!-- Should there be a limit? -->
                      <li>an object, then return the <code>object</code> created by recursively applying this algorithm to each property in <code>result</code>.
                    </ol>
                  </ol>
                  <li>Set the <a>response</a> <a href="#response-value">value</a> to <code>value</code>.</li>
                </ol>
                <li>Return the <a>response</a>.</li>
              </ol>
            </dd>
          </dl>
        </section>
        <section>
          <h2>Asynchronous Javascript Execution</h2>
          <dl class='idl' title='partial interface JavaScriptExecutor'>
            <dt>Argument? executeAsyncScript()</dt>
            <dd>
              <dl class='parameters'>
                <dt> DOMString script</dt>
                <dd>The script to execute.</dd>
                <dt>sequence&lt;Argument>? args</dt>
                <dd>The script arguments.</dd>
              </dl>
              <p>When executing asynchronous JavaScript, the WebDriver implementation MUST use the following algorithm:
                <ol>
                  <li>Let <code>timeout</code> be the value of the last "script" <a href="#timeouts">timeout command</a>, or 0 if no such commands have been received.</li>
                  <li>Let <code>window</code> be the <a href="http://www.w3.org/TR/Window/">Window</a> object for WebDriver's current <a href="#where-commands-are-handled">command context</a>.</li>
                  <li>Let <code>script</code> be the DOMString from the command's <code>script</code> parameter.</li>
                  <li>Let <code>fn</code> be the Function object created by executing <code>new Function(script);</code></li>
                  <li>Let <code>args</code> be the sequence created by the pre-processing algorithm defined <a href="#JS-args-preprocess">above</a>.</li>
                  <li>Let <code>callback</code> be a Function object pushed to the end of <code>args</code>.</li>
                  <li>Register a one-shot timer on <code>window</code> set to fire <code>timeout</code> milliseconds in the future.</li>
                  <li>Invoke <code>fn.apply(window, args);</code></li>
                  <li>If the previous step errors then:
                    <ol>
                      <li>Let <code>error</code> be the thrown value.</li>
                      <li>Set the <a>response</a> <a href='#response-status'>status</a> to <code><a href="#status-javascript-error">javascript error</a></code>.</li>
                      <li>Set the <a>response</a> <a href="#response-value">value</a> to a <code>object</code>, <code>dict</code>.</li>
                      <li>If <code>error</code> is an Error, then set a "message" entry in <code>dict</code> whose value is the DOMString defined by <code>error.message</code>.</li>
                      <li>Otherwise, set a "message" entry in <code>dict</code> whose value is the DOMString representation of <code>error</code>.</li>
                    </ol>
                  </li>
                  <li>Otherwise, the WebDriver implementation MUST wait for one of the following to occur:
                    <ol>
                      <li>if the one-shot timer that was set on the <code>window</code> fires
                        , the WebDriver implementation MUST immediately set the <a>response</a> <a href='#response-status'>status</a>
                        to <code><a href='#status-timeout'>timeout</a></code> and return.</li>
                        <li>if the <code>window</code> fires an <code>unload</code> event, the WebDriver implementation MUST immediately set the <a>response</a> <a href='#response-status'>status</a> to JavascriptError and return with the error message set to "Javascript execution context no longer exists.".</li>
                        <li>if the <code>callback</code> function is invoked, then:
                          <ol>
                            <li>Let <code>result</code> be the first argument passed to <code>callback</code>.</li>
                            <li>Set the command's <a>response</a> <a href='#response-status'>status</a> to Success.</li>
                            <li>Let <code>value</code> be the result of the following algorithm:
                              <ol>
                                <li>If <code>result</code> is:
                                  <ol>
                                    <li><code>undefined</code> or <code>null</code>, return <code> null</code>.</li>
                                    <li>a long, boolean, or DOMString, return <code>result</code>.</li>
                                    <li>a Document Element, then return the corresponding WebElement for that Document Element.</li>
                                    <!-- Should there be a recursion limit? -->
                                    <li>a <code>Sequence &lt;Node> Nodes</code>, then return the result by recursively applying this algorithm to <code>result</code>. WebDriver implementations SHOULD limit the recursion depth.</li>
                                    <!-- Should there be a limit? -->
                                    <li>an object, then return the <code>object</code> created by recursively applying this algorithm to each property in <code>result</code>.</li>
                                  </ol>
                                </li>
                              </ol>
                            </li>
                            <li>Set the command's <a>response</a> <a href="#response-value">value</a> to <code>value</code>.</li>
                          </ol>
                        </li>
                        <li>Return the <a>response</a>.</li>
                      </ol>
                    </li>
                  </ol>
                </dd>
              </dl>
        </section>
        <section>
          <h2>Reporting Errors</h2>
          <p></p>
        </section>
</section>
<section>
  <h2>Cookies</h2>

  <p>This section describes the interaction with
  <a href='http://www.w3.org/TR/html5/dom.html#dom-document-cookie'>cookies</a>
  as described in the HTML Specification ([[!html51]]). When retrieving
  and setting a cookie it MUST be in the format of a <code>Cookie</code>.</p>
  <p class="note">Conformance tests for this section can be found in the <a href="https://github.com/w3c/web-platform-tests/tree/master/webdriver/">webdriver module</a> under the "cookies" folder.</p>
  <section>
    <h2>Cookie</h2>
    <p>When returning Cookie objects, the server SHOULD include all optional fields it is capable of providing the information for.</p>
    <dl class="idl" title='dictionary Cookie'>
      <dt>DOMString name</dt>
      <dd>The name of the cookie. This MUST be set.</dd>
      <dt>DOMString value</dt>
      <dd>The cookie value. This MUST be set.</dd>
      <dt>DOMString path</dt>
      <dd>The cookie path. This SHOULD be set or MUST be the null value if unknown.</dd>
      <dt>DOMString domain</dt>
      <dd>The domain the cookie is visible to. This SHOULD be set or MUST be the null value if unknown.</dd>
      <dt>Date expiry</dt>
      <dd>When the cookie expires, specified in milliseconds since midnight, January 1, 1970 UTC. This SHOULD be set or MUST be null if unknown.</dd>
      <dt>Date maxAge</dt>
      <dd>The value of the Max-Age attribute to set the cookies expiration as an interval of seconds in the future</dd>
      <dt>boolean secure</dt>
      <dd>True if this represents a Secure cookie, false otherwise. If this attribute is missing, the local ends MUST interpret this as being false.</dd>
      <dt>boolean httpOnly</dt>
      <dd>True if this represents an HTTP-Only cookie, false otherwise. If this attribute is missing, local ends MUST interpret this as being false.</dd>
    </dl>
    <dl class="idl" title="interface Options">
      <dt>sequence&lt;Cookie> getCookie()</dt>
      <dd>Remote ends MUST return all cookies that are available in document.cookie via Javascript. In addition, remote ends SHOULD return any HTTP-Only cookies that are associated with the current page.
        Possible errors that can be returned:
        <ul>
          <li><code><a href="#status-invalid-cookie-domain">invalid cookie domain</a></code> - If the cookie's domain is not visible from the current page.<br />
        </ul>
        <dl class='parameters'>
          <dt>optional DOMString? name</dt>
          <dd>The name (e.g. <code>name=</code>) of the cookie that needs to be returned.</dd>
        </dl>
      </dd>
      <dt>void addCookie()</dt>
      <dd>Set a cookie. If the cookie path is not specified, it should be set to "/". Likewise, if the domain is omitted, it should default to the current page's domain.
        Possible errors that can be returned:
        <ul>
          <li><code><a href="#status-invalid-cookie-domain">invalid cookie domain</a></code> - If the cookie's domain is not visible from the current page.<br />
          <li><code><a href='#status-unable-to-set-cookie'>unable to set cookie</a></code> If attempting to set a cookie on a page that does not support cookies (e.g. pages with mime-type text/plain)
        </ul>
        <dl class='parameters'>
          <dt>Cookie cookie</dt>
          <dd>
            A <code>Cookie</code> defining the cookie to be added. If the cookie exists already on the page update it with the relevant details.
            If a cookie is to be deleted set the expiration date in the past.
          </dd>
        </dl>
    </dl>
  </section>
</section>
<section>
  <h2 id="timeouts">Timeouts</h2>
  <p>This section describes how timeouts and implicit waits are handled within WebDriver</p>
  <section>
    <p>The "timeouts" command is used to set the value of a timeout that a command can execute
     for.</p>
     <dl class='idl' title='partial interface Options'>
       <dt>void timeouts()</dt>
       <dd>
        <ul>
          <li>implicit - Set the amount of time the driver should wait when searching for elements. When searching for a single element, the driver should poll the page until an element is found or the timeout expires, whichever occurs first. When searching for multiple elements, the driver should poll the page until at least one element is found or the timeout expires, at which point it should return an empty list.<br>
          If this command is never sent, the driver MUST default to an implicit wait of 0ms.</li>
          <li>page load - Set the amount of time the driver should wait before returning when the <a href="#page-load-strategies-1">page load stratgey</a> is not "<code>none</code>". If this limit is exceeded, the <code>get()</code> command MUST return a "<code><a href="#status-timeout">timeout</a></code>" <a>response</a> status.</li>
          <li>script - Set the amount of time the driver should wait after calling <a href='#widl-JavaScriptExecutor-executeAsyncScript-Argument-DOMString-script-sequence-Argument--args'><code>executeAsyncScript</code></a> for the callback to have executed before returning a <code><a href="#status-timeout">timeout</a></code> <a>Response</a>.</li>
        </ul>
        <dl class='parameters'>
          <dt>DOMString type</dt>
          <dd>The type of operation to set the timeout for. Valid values are: "implicit", "page load", "script"</dd>
          <dt>unsigned short ms</dt>
          <dd>The amount of time, in milliseconds, that time-limited commands are permitted to run.</dd>
        </dl>
      </dd>
    </dl>
  </section>
</section>
<section>
  <h2>User Input</h2>
  <p>The WebDriver API offers two ways of interacting with elements,
    either with a set of low-level "do as I say" commands, or a
    high-level "do as I mean" set of commands. The former are offered to
    allow precise emulation of user input. The latter are offered as a
    convenience to cover the common case, and can conceivably be
    implemented on top of the lower level primitive operations.</p>

  <section>
    <h2 id="interactable">Interactable elements</h2>
    <p>Some user actions require the element to be interactable. The following conditions must be met for the element to be considered interactable:
    <ul>
      <li>The element MUST be displayed, as defined in <a href="#determining-if-displayed">section 10.1</a>.</li>
      <li>The element MUST NOT be disabled. "Disabled" is defined as:
      <ul>
        <li>If the current document is being processed as an HTML document, the element MUST be considered disabled if it does not support
        the <a href="http://www.w3.org/TR/html401/interact/forms.html#adef-disabled">disabled</a>
        attribute (according to the [[!html51]] spec), or if the
        disabled attribute is set in the case where that attribute is present.</li>
      </ul>
      </li>
    </ul>
    </section>

    <section>
      <h2>Low Level Commands</h2>
      <p>The low level commands provide a mechanism for precisely stating how a user can interact with the browser.

      <p><a href='http://www.w3.org/TR/DOM-Level-3-Events/#glossary-activation-trigger'>Activation triggers</a> generated by the WebDriver API User SHOULD be indistinguishable from those generated by a real user
        interacting with the browser.</p>
      <p class='note'>
        In particular, the dispatched events will have the <a href='http://dom.spec.whatwg.org/#dom-event-istrusted'>isTrusted</a> attribute set to true. The most robust way to dispatch these events is by creating them in the browser implementation itself. Sending OS-specific input messages to the browser's window has the disadvantage that the browser being automated may not be properly isolated from a user accidentally modifying input device state; use of an OS-level accessibility API has the disadvantage that the browser's window must be focused, and as a result, multiple tests cannot run in parallel.
      </p>

      <section>
        <h2>Actions</h2>
        <p>Actions are a way of executing a chain of low-level commands to emulate a user action.
          For example, if you wish to automate a drag and drop action in a browser, you would chain
          the clickAndHoldAction, moveMouseAction and buttonReleaseAction commands together. This
          implies chaining actions together to form a user action.
        <p>The remote side will receive the actions, and execute them, returning a response to the local end once the entire
          action sequence has been performed.  Actions will be
          created by chaining the low-level commands together on either a MouseAction or TouchAction
          object. Each action's sequence MUST be sent over to the remote end
          with one call with the entire sequence in the <a href="#command-1">Command</a> when the perform()
          method is called.
        <section>
          <h2>Mouse Interactions</h2>
          <p>
            <dl title="enum Button" class='idl'>
              <dt>LEFT</dt>
              <dd>The left button on a mouse</dd>
              <dt>MIDDLE</dt>
              <dd>The middle button on a mouse</dd>
              <dt>RIGHT</dt>
              <dd>The right button on a mouse</dd>
            </dl>
            <dl class="idl" title="interface MouseAction">
                <dt>void buttonDown()</dt>
                <dd>Click any mouse button (at the coordinates set by the last moveto command). Note that calling this command after calling buttondown and before calling button up (or any out-of-order interactions sequence) will yield undefined behaviour).
                  <p>
                  <p>The possible errors for this command:
                  <dl class='parameters'>
                    <dt>optional Button button</dt>
                    <dd>The button that will start the chain of events being fired. If no argument is passed in then the User Agent should default to <code>LEFT</code></dd>
                  </dl>
                </dd>
                <dt>void buttonUp()</dt>
                <dd>Releases the mouse button previously held (where the mouse is currently at). Must be called once for every buttondown command issued. See the note in click and buttondown about implications of out-of-order commands.
                  <dl class='parameters'>
                    <dt>optional Button button</dt>
                    <dd>The button that will start the chain of events being fired. If no argument is passed in then the User Agent should default to <code>LEFT</code></dd>
                  </dl>
                </dd>
                <dt>void click ()</dt>
                <dd>
                  Click any mouse button (at the coordinates set by the last moveto command). Note that calling this command after calling buttondown and before calling button up (or any out-of-order interactions sequence) will yield undefined behaviour).
                  <dl class='parameters'>
                    <dt>optional Button button</dt>
                    <dd>The button that will start the chain of events being fired. If no argument is passed in then the User Agent should default to <code>LEFT</code></dd>
                  </dl>
                </dd>
                <dt>void doubleClick ()</dt>
                <dd>Double-clicks at the current mouse coordinates (set by moveTo)</dd>
                <dt>void moveTo ()</dt>
                <dd>
                  Move the mouse by an offset of the specificed element. If no element is specified, the move is relative to the current mouse cursor. If an element is provided but no offset, the mouse will be moved to the center of the element. If the element is not visible, it will be scrolled into view.
                  <dl class='parameters'>
                    <dt>optional WebElement? id</dt>
                    <dd>The ID of the <a>WebElement</a> on which to operate.</dd>
                    <dt>optional long x</dt>
                    <dd>The x-coordinate offset to send the touch event, from the top-left coordinate of the given <a>WebElement</a>.</dd>
                    <dt>optional long y</dt>
                    <dd>The y-coordinate offset to send the touch event, from the top-left coordinate of the given <a>WebElement</a>.</dd>
                  </dl>
                </dd>
                <dt>void perform ()</dt>
                <dd>Perform should be implemented to allow for the execution of segmented Interactions, so one call to perform() will execute everything in the actions object, and provided that either <code>release()</code> or <code>mouseup()</code> have not been called, then the MouseAction or TouchAction object can still be used, so more actions can be added, and <code>perform()</code> can be called as many times as necessary. This enables you to use webdriver for other tasks during a gesture. For example, if you want to hold down an element, then wait for an element to appear, then mouse over onto the new element, you can use one MouseAction chain to start the mousedown event, call perform, then call findElement, then use the same MouseAction chain to add a mousemove event to the newly found element and another event to release the button, and then call perform.
                  <p class="note">
                    action_chain = MouseAction()<br>
                    action_chain.mouseDown(element1).perform()<br>
                    element2 = webdriver.findElement(some_locator)<br>
                    action_chain.mouseMove(element2).buttonRelease().perform()<br>
                  </p>
                </dd>
            </dl>
        </section>

        <section>
          <h2>Touch Gestures</h2>
          <p>By the nature of touch events, all touch events are dispatched using the target of the initial <a>WebElement</a> that receives the events. You cannot have more than one touch action active at one time with single Action chains. If multi-finger gestures are needed, use <a href='#multiactions'>MultiAction chains</a>.</p>
            <dl class="idl" title='interface TouchAction'>
                <!-- Press -->
                <dt>void press()</dt>
                <dd>Tap and hold in the middle of the <a>WebElement</a> or at coordinates (x, y) relative to the top-left corner of the target <a>WebElement</a>. The middle of the element is defined as the middle of the box returned by
                  calling <code><a
                    href="http://www.w3.org/TR/cssom-view/#the-getclientrects()-and-getboundingclientrect()-methods">getBoundingClientRect</a></code>
                  on the underlying document Element, according to the [[!CSSOM-VIEW]] spec. If
                  the element is outside the <a
                    href="http://www.w3.org/TR/CSS21/visuren.html#viewport">viewport</a>
                  (according to the [[!CSS21]] spec), the implementation SHOULD bring the
                  element into view first. The implementation MAY invoke <code>scrollIntoView</code> on
                  the underlying document Element.
                <br>
                <br>
                  The possible errors for this command:
                  <ul>
                    <li><code><a href="#status-stale-element-reference">stale element reference</a></code> if the given element is no longer in the <a href="http://dom.spec.whatwg.org/#in-a-document">document</a>.
                    <li><code><a href="#status-move-target-out-of-bounds">move target out of bounds</a></code> if the element cannot be scrolled into view.
                    <li><code><a href="#status-unsupported-operation">unsupported_operation</a></code> if press has already been called without a subsequent release call.
                  </ul>
                  <br>
                  <dl class='parameters'>
                    <dt>WebElement id</dt>
                    <dd>The ID of the <a>WebElement</a> on which to operate.</dd>
                    <dt>optional Long x</dt>
                    <dd>The x-coordinate offset to send the touch event, from the top-left coordinate of the given <a>WebElement</a>.</dd>
                    <dt>optional Long y</dt>
                    <dd>The y-coordinate offset to send the touch event, from the top-left coordinate of the given <a>WebElement</a>.</dd>
                  </dl>
                </dd>
                <!-- Release -->
                <dt>void release ()</dt>
                <dd>This is the equivalent of the user removing their finger from the touch screen. All the relevant events MUST fire when this happens. If there is another release() call then this should be ignored until either longPress() or press() is called again.
                </dd>
                <!-- Move -->
                <dt>void moveTo ()</dt>
                <dd>Drag the <a>WebElement</a> to another <a>WebElement</a> that has the id equal to what is passed in as an argument. The drag starts from the centre of the <a>WebElement</a>
                  <p class='note'>
                    In a chain where element1 is pressed, resulting in a <code>touchstart</code> event on coordinates (x1,y1), and is followed by MoveByOffset with coordinates (x2, y2), then the <code>touchmove</code> event will be dispatched at (x1+x2, y1+y2).
                  </p>
                  <br>
                  <br>
                    The possible errors for this command:
                    <ul>
                      <li><code><a href="#status-stale-element-reference">stale element reference</a></code> if the given element is no longer in the <a href="http://dom.spec.whatwg.org/#in-a-document">document</a>.
                      <li><code><a href="#status-move-target-out-of-bounds">move target out of bounds</a></code> if the element cannot be scrolled into view.
                    </ul>
                    <br>
                  <dl class="parameters">
                    <dt>WebElement id</dt>
                    <dd>The ID of the <a>WebElement</a> on which to operate.</dd>
                    <dt>optional Long x</dt>
                    <dd>The x-coordinate offset to send the touch event, from the top-left coordinate of the given <a>WebElement</a></dd>
                    <dt>optional Long y</dt>
                    <dd>The y-coordinate offset to send the touch event, from the top-left coordinate of the given <a>WebElement</a></dd>
                  </dl>
                </dd>
                <!-- Tap -->
                <dt>void tap ()</dt>
                <dd>Tap in the middle of the <a>WebElement</a> or at coordinates (x, y) relative to the top-left corner of the target <a>WebElement</a>. The middle of the element is defined as the middle of the box returned by
                  calling <code><a
                    href="http://www.w3.org/TR/cssom-view/#the-getclientrects()-and-getboundingclientrect()-methods">getBoundingClientRect</a></code>
                  on the underlying document Element, according to the [[!CSSOM-VIEW]] spec. If
                  the element is outside the <a
                    href="http://www.w3.org/TR/CSS21/visuren.html#viewport">viewport</a>
                  (according to the [[!CSS21]] spec), the implementation SHOULD bring the
                  element into view first. The implementation MAY invoke <code>scrollIntoView</code> on
                  the underlying document Element.
                  <p> If count is greater than one then the necessary events should be fired at the <a>WebElement</a>.
                  <p>The possible errors for this command:
                  <ul>
                    <li><code><a href="#status-stale-element-reference">stale element reference</a></code> if the given element is no longer in the <a href="http://dom.spec.whatwg.org/#in-a-document">document</a>.</li>
                    <li><code><a href="#status-move-target-out-of-bounds">move target out of bounds</a></code> if the element cannot be scrolled into view.</li>
                  </ul>
                  <p>
                  <dl class='parameters'>
                    <dt>WebElement id</dt>
                    <dd>The ID of the <a>WebElement</a> on which to operate.</dd>
                    <dt>optional Long x</dt>
                    <dd>The x-coordinate offset to send the touch event, from the top-left coordinate of the given <a>WebElement</a>.</dd>
                    <dt>optional Long y</dt>
                    <dd>The y-coordinate offset to send the touch event, from the top-left coordinate of the given <a>WebElement</a>.</dd>
                    <dt>UnsignedShort? count</dt>
                    <dd>The number of taps that will be performed before returning to the local end. If <code>count</code> is null or no argument is passed in then 1 tap MUST be executed.</dd>
                  </dl>
                </dd>
                <!-- Wait -->
                <dt>void wait ()</dt>
                <dd>Pause execution of action chain for the given number of milliseconds. Defaults to zero so that it can be used for synchronising actions. If <code>null</code> is passed into the method the User Agent MUST treat it as though it was zero.
                  <dl class="parameters">
                    <dt>optional long? ms</dt>
                    <dd>The time in milliseconds to wait before performing next action</dd>
                  </dl>
                </dd>
                <!-- Long Press -->
                <dt>void longPress ()</dt>
                <dd>Tap in the middle of the <a>WebElement</a> or at coordinates (x, y) relative to the top-left corner of the target <a>WebElement</a> and hold until the <code>contextmenu</code> event has fired. The middle of the element is defined as the middle of the box returned by
                  calling <code><a
                    href="http://www.w3.org/TR/cssom-view/#the-getclientrects()-and-getboundingclientrect()-methods">getBoundingClientRect</a></code>
                  on the underlying document Element, according to the [[!CSSOM-VIEW]] spec. If
                  the element is outside the <a
                    href="http://www.w3.org/TR/CSS21/visuren.html#viewport">viewport</a>
                  (according to the [[!CSS21]] spec), the implementation SHOULD bring the
                  element into view first. The implementation MAY invoke <code>scrollIntoView</code> on
                  the underlying document Element.
                  <br>
                  <br>
                    The possible errors for this command:
                    <ul>
                      <li><code><a href="#status-stale-element-reference">stale element reference</a></code> if the given element is no longer in the <a href="http://dom.spec.whatwg.org/#in-a-document">document</a>.
                      <li><code><a href="#status-move-target-out-of-bounds">move target out of bounds</a></code> if the element cannot be scrolled into view.
                      </ul>
                    <br>
                  <dl class='parameters'>
                    <dt>WebElement id</dt>
                    <dd>The ID of the <a>WebElement</a> on which to operate.</dd>
                    <dt>optional long x</dt>
                    <dd>The x-coordinate offset to send the touch event, from the top-left coordinate of the given <a>WebElement</a>.</dd>
                    <dt>optional long y</dt>
                    <dd>The y-coordinate offset to send the touch event, from the top-left coordinate of the given <a>WebElement</a>.</dd>
                  </dl>
                </dd>
                <!-- Cancel -->
                <dt>void cancel ()</dt>
                <dd>The User Agent MUST cancel the current touch action being executed.
                </dd>
                <!-- Perform -->
                <dt>void perform ()</dt>
                <dd>Perform should be implemented to allow for the execution of segmented Interactions, so one call to perform() will execute everything in the actions object, and provided that either <code>release()</code> or <code>mouseup()</code> have not been called, then the TouchAction object can still be used, so more actions can be added, and <code>perform()</code> can be called as many times as necessary. This enables you to use webdriver for other tasks during a gesture. For example, if you want to hold down an element, then wait for an element to appear, then mouse over onto the new element, you can use one TouchAction chain to start the mousedown event, call perform, then call findElement, then use the same TouchAction chain to add a mousemove event to the newly found element and another event to release the button, and then call perform.
                  <p class="note">
                    action_chain = TouchAction()<br>
                    action_chain.press().perform()<br>
                    element2 = webdriver.findElement(some_locator)<br>
                    action_chain.move_to(element2).release().perform()<br>
                  </p>
                </dd>
            </dl>
      </section>

       </section>
       <section>
         <h2 id='multiactions'>MultiActions</h2>
         <p>Automating gestures is different from automating mouse interactions since we can have any number of fingers simultaneously acting on the touch surface. A typical 'scroll' action requires two fingers, but it is possible that we may have multi-finger gestures, or in an extrapolated case, that more than one person will operate the same touch surface, say in the case of a competitive multiplayer game. These cases mean we must allow for any number of actions occuring simulateously. This demands a MultiAction. By having a TouchAction represent the gestures of one finger, we can perform multi-finger gestures by adding these single finger gestures together, using MultiAction:
         <dl class="idl" title="interface MultiAction">
             <dt>void add (TouchAction touchAction)</dt>
             <dd>The local end must add the <code>TouchAction</code> sequence to an array which can then be serialised when <code>perform()</code>
               is called.
               <br>
               <br>
               <dl class='parameters'>
                 <dt>TouchAction touchAction</dt>
                 <dd>A touchAction object that has been populated with the action sequence that the user would like to execute on the remote end</dd>
               </dl>
             </dd>
             <dt>void perform ()</dt>
             <dd> <p>MultiAction can take in as many TouchAction objects as needed, by using the add command. When perform is called, the remote end is responsible for executing the individual actions from each TouchAction in the right group, and in the correct order. Note, the "right group" is used to denote "in the same execution group", and is not meant to denote dispatching the events at exactly the same time. For example, to automate a gesture where one finger presses, holds and releases an element while another finger moves from one element to another:
             <p class="note">
               action1 = TouchAction()<br>
               action2 = TouchAction()<br>
               action1.press(element1).wait(5).release(element1)<br>
               action2.press(element2).move(element3).release(element3)<br>
               multi = MultiAction()<br>
               multi.add(action1).add(action2)<br>
               multi.perform()
             </p>
             In this example, the remote end will find the first actions in each action object, and will perform them as part of the same execution group. This means the first execution group will be <code>press(element1)</code> and <code>press(element2)</code>. After these events are dispatched, the remote end will will find the next execution group to perform. It will execute <code>wait(5)</code> and <code>move(element3)</code>. Then it will find the next execution group, in this case, it is just <code>release(element1)</code> and <code>release(element3)</code>. When there are no more actions to perform on any of the TouchAction objects, then perform() will return.
             <br>
             <br>
             MultiAction objects do not demand that all of its member TouchActions have the same number of actions. It is possible for one TouchAction object to have more actions than another. The perform function iterates over the actions in order, and it is possible to have only one action in an execution group like so:
             <p class="note">
               action = TouchAction()<br>
               action = TouchAction()<br>
               action.press(element1).wait(5).release(element1)<br>
               action.press(element2).release(element3)<br>
               multi = MultiAction()<br>
               multi.add(action1).add(action2)<br>
               multi.perform()
             </p>
             In this case, there will be three execution groups, the last one having only <code>release(element1)</code> in it.
             <br>
             <br>
             Note: In addition to the wait command being used to indicate how long to wait, if used without arguments, it is used to indicate that nothing should be done for one TouchAction during an execution group. For example:
             <p class="note">
               action1 = TouchAction()<br>
               action2 = TouchAction()<br>
               action1.press(element1).move(element2).release(element2)<br>
               action2.press(element3).wait().release(element3)<br>
               multi = MultiAction()<br>
               multi.add(action1).add(action2)<br>
               multi.perform()
             </p>
             Here <code>wait()</code> is used to indicate to the remote end that nothing should be done for action2 in the second execution group. So the second execution group will just be <code>move(element2)</code>, but the third group will be <code>release(element2)</code> and <code>release(element3)</code>
           </dd>
         </dl>
         </section>
      </section> <!-- low-level wire protocol commands -->

    <section>
      <h2>High Level Commands</h2>
        <p>These higher level commands SHOULD be built on top of the low level commands, and implement a user friendly way of interacting with a page in a way that models common user expectations.

        <section>
          <h2 id='high-level-click'>Clicking</a></h2>
          <dl class="idl" title="partial interface WebElement">
            <dt>void click()</dt>
            <dd>Click in the middle of the <a>WebElement</a> instance. The middle of the element is defined as the middle of the box returned by
            calling <code><a
              href="http://www.w3.org/TR/cssom-view/#the-getclientrects()-and-getboundingclientrect()-methods">getBoundingClientRect</a></code>
            on the underlying document Element, according to the [[!CSSOM-VIEW]] spec. If
            the element is outside the <a
              href="http://www.w3.org/TR/CSS21/visuren.html#viewport">viewport</a>
            (according to the [[!CSS21]] spec), the implementation SHOULD bring the
            element into view first. The implementation MAY invoke <code>scrollIntoView</code> on
            the underlying document Element. The element MUST be <a
              href="#determining-if-displayed">displayed</a>. See the note below for when the element is obscured by another element.
            Exceptions:
            <ul>
              <li>Links (A elements): Clicking happens in the middle of the first
                <a href="#determining-if-displayed">displayed</a> bounding client rectangle. This is to overcome overflowing links where the middle of the bounding client rectangle does not actually fall on a clickable part of the link.</li>
              <li>SELECT elements without the &quot;multiple&quot; attribute set.
                Clicking on the select element SHOULD open the drop down menu. The next
                click, on any element, MUST close this menu.</li>
              <li>Clicking directly on an OPTION element (without clicking on the
                parent SELECT element previously) MUST open a selection menu, as if the
                SELECT option was clicked first, then click on the OPTION before finally
                closing the SELECT element's menu. The SELECT menu MUST be closed
                once the action is complete.</li>
            </ul>
            <p>The possible errors for this command:
            <ul>
              <li><code><a href="#status-stale-element-reference">stale element reference</a></code> if the given element is no longer in the <a href="http://dom.spec.whatwg.org/#in-a-document">document</a>.</li>
              <li><code><a href="#status-element-not-visible">element not visible</a></code> if the element is hidden and thus cannot be interacted with.</li>
              <li><code><a href="#status-move-target-out-of-bounds">move target out of bounds</a></code> if the element cannot be scrolled into view.</li>
            </ul>
            <p>This command MUST use either the mouse or touch mechanisms for
              emulating the user input. In the case where the browser being automated
              supports only mouse input or both mouse and touch input, the low-level
              mouse mechanisms MUST be used. If the browser only supports touch input,
              the low level touch inputs MUST be used.</p>
            </dd>
          </dl>
          <p class="note">As the goal is to emulate users as closely as possible, the
            implementation SHOULD NOT allow clicking on elements that are obscured by
            other elements. If the implementation forbids clicking on obscured elements,
            an <code><a href="#status-element-not-visible">element not visible</a></code> response MUST be returned and this SHOULD have an
            explantory message explaining the reason. The implementation SHOULD try to
            scroll the element into view, but in case it is fully obscured, it SHOULD
            NOT be clickable.<!--TODO: add details of interactable'--></p>
        </section>
        <section>
          <h2>Touch</h2>
          <p>This section defines the low level commands used when manipulating touch-enabled devices. These are the building blocks of touch interaction chains.</p>
          <!--<p>NOTE: would like to add pressure/tilt, but that isn't in Touch Events (http://www.w3.org/TR/touch-events/), will have to wait for Pointer Event adoption</p>-->
          <table class="simple">
            <tr><td>Capability Name</td><td>Type</td></tr>
            <tr><td><span id="capability-touchEnabled">touchEnabled</span></td><td>boolean</td></tr>
          </table>
          <br>
          <br>
          <dl class='idl' title='partial interface WebElement'>
            <!-- Tap -->
            <dt>void tap ()</dt>
            <dd>Tap in the middle of the <a>WebElement</a>. The middle of the element is defined as the middle of the box returned by
              calling <code><a
                href="http://www.w3.org/TR/cssom-view/#the-getclientrects()-and-getboundingclientrect()-methods">getBoundingClientRect</a></code>
              on the underlying document Element, according to the [[!CSSOM-VIEW]] spec. If
              the element is outside the <a
                href="http://www.w3.org/TR/CSS21/visuren.html#viewport">viewport</a>
              (according to the [[!CSS21]] spec), the implementation SHOULD bring the
              element into view first. The implementation MAY invoke <code>scrollIntoView</code> on
              the underlying document Element.
              Exceptions:
              <ul>
                <li>Links (A elements): Clicking happens in the middle of the first
                  <a href="#determining-if-displayed">displayed</a> bounding client rectangle. This is to overcome overflowing links where the middle of the bounding client rectangle does not actually fall on a clickable part of the link.</li>
                <li>SELECT elements without the &quot;multiple&quot; attribute set.
                  Clicking on the select element SHOULD open the drop down menu. The next
                  click, on any element, MUST close this menu.</li>
                <li>Clicking directly on an OPTION element (without clicking on the
                  parent SELECT element previously) MUST open a selection menu, as if the
                  SELECT option was clicked first, then click on the OPTION before finally
                  closing the SELECT element's menu. The SELECT menu MUST be closed
                  once the action is complete.</li>
              </ul>
              <p>The possible errors for this command:
              <ul>
                <li><code><a href="#status-stale-element-reference">stale element reference</a></code> if the given element is no longer in the <a href="http://dom.spec.whatwg.org/#in-a-document">document</a>.</li>
                <li><code><a href="#status-move-target-out-of-bounds">move target out of bounds</a></code> if the element cannot be scrolled into view.</li>
              </ul>
            </dd>
          </dl>
        </section>
      <section>
        <h2 id='typing_keys'>Typing keys</h2>
        <p>A requirement for key-based interaction with an element is that it is
          <a href="#interactable">interactable</a>. Typing into an element is permitted if one of the following conditions is met:
            <ul>
              <li>The element is <a href="http://dev.w3.org/html5/spec/editing.html#focus">focusable</a> as defined in the editing section of the [[!html51]] spec.</li>
              <li>The element is allowed to be the <code><a href='http://www.w3.org/html/wg/drafts/html/master/editing.html#dom-document-activeelement'>activeElement</a></code>. In
              addition to focusable elements, this allows typing to the <code>BODY</code> element.</li>
              <li>In an HTML document, the element is <a href="http://dev.w3.org/html5/spec/editing.html#attr-contenteditable">editable</a> as a result of having its <code>contentEditable</code> attribute set or the containing document is in <code>designMode</code>.</li>
              <li>The underlying browser implementation would allow keyboard input to
              directed to the element (eg. an HTML document with a DIV marked as being
              contentEditable)</li>
            </ul>
        <p>Prior to any keyboard interaction, an attempt to shift focus to the
        element MUST be attempted if the element does not currently have the focus. This is the case if one of the following
        holds:
        <ul>
          <li>The element is not already the document's <code><a href='http://www.w3.org/html/wg/drafts/html/master/editing.html#dom-document-activeelement'>activeElement</a></code>.</li>
          <li>The owner document of the element to be interacted with is not the focused document.</li>
        </ul>
        <p>In case focusing is needed, the implementation MUST follow the <a href="http://dev.w3.org/html5/spec/editing.html#focus-management"><b>focusing steps</b></a> as described in the focus management section of the [[!html51]] spec. The focus MUST NOT leave the element at the end of the interaction, other than as a result of the interaction itself (i.e. when the tab key is sent).
        </p>
        <dl class="idl" title="partial interface WebElement">
          <dt>void clear()</dt>
          <dd>Clears the value of the element.</dd>
          <dt>void sendKeys(string[] keysToSend)</dt>
          <dd>Sends a sequence of keyboard events representing the keys in the keysToSend parameter.
            <p>Caret positioning: If focusing was needed, after following the focusing steps, the caret MUST be positioned at the end of the text currently in the element. At the end of the interaction, the caret MUST be positioned at the end of the typed text sequence, unless the keys sent position it otherwise (e.g. using the LEFT key).</p>
            <p>There are four different types of keys that are emulated:
            <ul>
              <li>Character literals - lower-case symbols.</li>
              <li>Uppercase letters and symbols requiring the SHIFT key for typing.</li>
              <li>Modifier keys</li>
              <li>Special keys</li>
            </ul>The rest of this section details the values used to represent the different keys, as well as the expected behaviour for each key type.</dd>
        </dl>
        <p>When emulating user input, the implementation MUST generate
        the same sequence of events that would have been produced if a real user was
        sitting in front of the keyboard and typing the sequence of characters. In
        cases where there is more than one way to type this sequence, the
        implementation MUST choose one of the valid ways. For example, typing <code>AB</code> may be achieved by:
        <ul>
          <li>Holding down the Shift key</li>
          <li>Pressing the letter 'a'</li>
          <li>Pressing the letter 'b'</li>
          <li>Releasing the Shift key</li>
        </ul>
        Alternatively, it can be achieved by:
        <ul>
          <li>Holding down the Shift key</li>
          <li>Pressing the letter 'a'</li>
          <li>Releasing the Shift key</li>
          <li>Holding down the Shift key</li>
          <li>Pressing the letter 'b'</li>
          <li>Releasing the Shift key</li>
        </ul>
        <p>Or by simply turning on the CAPS LOCK first.</p>
        <p>
        The implementation MAY use the following algorithm to generate the events.
        If the implementation is using a different algorithm, it MUST adhere to the
        requirements listed below.
        <p>For each key, <var>key</var> in <var>keysToSend</var>, do
        <ol>
          <li>If <var>key</var> is a lower-case symbol:
          <ol>
            <li>If the Shift key is not pressed:
              <ol>
                <li>Generate a sequence of <code>keydown</code>, <code>keypress</code> and <code>keyup</code> events with
                <var>key</var> as
                the character to emulate</li>
              </ol>
            </li>
            <li>else (The Shift key is pressed)
              <ol>
                <li>let <var>uppercaseKey</var> be the upper-case character matching
                <var>key</var></li>
                <li>Generate a sequence of <code>keydown</code>, <code>keypress</code> and <code>keyup</code> events with
                <var>uppercaseKey</var> as the character to emulate</li>
              </ol>
            </li>
          </ol>
        </li>
        <li>Else if <var>key</var> is an upper-case symbol:
          <ol>
            <li>If the Shift key is not pressed:
            <ol>
              <li>Generate a <code>keydown</code> event of the Shift key.
              <li>Generate a sequence of <code>keydown</code>, <code>keypress</code> and <code>keyup</code> events with
              <var>key</var> as
              the character to emulate</li>
              <li>Generate a <code>keyup</code> event of the Shift key.
            </ol>
          </li>
          <li>else (The Shift key is pressed)
            <ol>
              <li>Generate a sequence of <code>keydown</code>, <code>keypress</code> and <code>keyup</code> events with
              <var>key</var> as the character to emulate</li>
            </ol>
          </li>
        </ol>
      </li>
      <li>Else if <var>key</var> represents a modifier key:
        <ol>
          <li>let <var>modifier</var> be the modifier key represented by
          <var>key</var></li>
          <li>If <var>modifier</var> is currently held down:
        <ol>
      <li>Generate a <code>keyup</code> event of <var>modifier</var></li>
    </ol>
  </li>
  <li>Else:
    <ol>
      <li>Generate a <code>keydown</code> event of <var>modifier</var></li>
    </ol>
  </li>
  <li>Maintain this key state and use it to modify the input until it is pressed again.</li>
</ol>
      </li>
      <li>Else if <var>key</var> represents the NULL key:
      <ol>
        <li>Generate <code>keyup</code> events of all modifier keys currently held
        down.</li>
        <li>All modifier keys are now assumed to be released.</li>
      </ol>
      </li>
      <li>Else if <var>key</var> represents a special key:
      <ol>
        <li>Translate <var>key</var> to the special key it represents</li>
        <li>Generate a sequence of <code>keydown</code>, <code>keypress</code> and <code>keyup</code> events for the special key.</li>
      </ol>
      </li>
    </ol>
    <p>Once keyboard input is complete, an implicit <var>NULL</var> key is sent unless the
    final character is the <var>NULL</var> key.</p>
    <p> <!-- Pseudo-code --></p>
    <p>Any implementation MUST comply with these requirements:
    <ul>
      <li>For uppercase letters and symbols that require the Shift key to be
      pressed, there are two options:
      <ul>
        <li>A single Shift <code>keydown</code> event is generated before the entire
        sequence of uppercase letters.</li>
        <li>Before each such letter or symbol, a Shift <code>keydown</code> event is
        generated. After each letter or symbol, a Shift <code>keyup</code> event is
        generated.</li>
      </ul></li>
      <li>A user-specified Shift press implies capitalization of all following
      characters.</li>
      <li>If a user-specified Shift press precedes uppercase letters and
      symbols, a second Shift <code>keydown</code> event MUST NOT be generated. In that
      case, a Shift <code>keyup</code> event MUST NOT be generated implicitly by the
      implementation.</li>
      <li>The <var>NULL</var> key releases all currently held down modifier keys.</li>
      <li>The state of all modifier keys must be reset at the end of each
      <code>sendKeys</code> call and the appropriate <code>keyup</code> events
      generated</li>
    </ul>
    <p> <!-- Algorithm paragraph --></p>
    <h3>Character types</h3>
    <p>The <var>keysToSend</var> parameter contains a mix of printable
    characters and pressable keys that aren't text. Pressable keys that aren't
    text are stored in the Unicode PUA (Private Use Area) code points,
    0xE000-0xF8FF. The following table describes the mapping between PUA and
    key:
    <table class="simple">
      <tr>
        <th>Key</th>
        <th>Code</th>
        <th>Type</th>
      </tr>
      <tr><td>NULL</td><td>\uE000</td><td>NULL</td></tr>
      <tr><td>CANCEL</td><td>\uE001</td><td>Special key</td></tr>
      <tr><td>HELP</td><td>\uE002</td><td>Special key</td></tr>
      <tr><td>BACK_SPACE</td><td>\uE003</td><td>Special key</td></tr>
      <tr><td>TAB</td><td>\uE004</td><td>Special key</td></tr>
      <tr><td>CLEAR</td><td>\uE005</td><td>Special key</td></tr>
      <tr><td>RETURN</td><td>\uE006</td><td>Special key</td></tr>
      <tr><td>ENTER</td><td>\uE007</td><td>Special key</td></tr>
      <tr><td>SHIFT</td><td>\uE008</td><td>Modifier</td></tr>
      <tr><td>LEFT_SHIFT</td><td>\uE008</td><td>Modifier</td></tr>
      <tr><td>CONTROL</td><td>\uE009</td><td>Modifier</td></tr>
      <tr><td>LEFT_CONTROL</td><td>\uE009</td><td>Modifier</td></tr>
      <tr><td>ALT</td><td>\uE00A</td><td>Modifier</td></tr>
      <tr><td>LEFT_ALT</td><td>\uE00A</td><td>Modifier</td></tr>
      <tr><td>PAUSE</td><td>\uE00B</td><td>Special key</td></tr>
      <tr><td>ESCAPE</td><td>\uE00C</td><td>Special key</td></tr>
      <tr><td>SPACE</td><td>\uE00D</td><td>Special key</td></tr>
      <tr><td>PAGE_UP</td><td>\uE00E</td><td>Special key</td></tr>
      <tr><td>PAGE_DOWN</td><td>\uE00F</td><td>Special key</td></tr>
      <tr><td>END</td><td>\uE010</td><td>Special key</td></tr>
      <tr><td>HOME</td><td>\uE011</td><td>Special key</td></tr>
      <tr><td>LEFT</td><td>\uE012</td><td>Special key</td></tr>
      <tr><td>ARROW_LEFT</td><td>\uE012</td><td>Special key</td></tr>
      <tr><td>UP</td><td>\uE013</td><td>Special key</td></tr>
      <tr><td>ARROW_UP</td><td>\uE013</td><td>Special key</td></tr>
      <tr><td>RIGHT</td><td>\uE014</td><td>Special key</td></tr>
      <tr><td>ARROW_RIGHT</td><td>\uE014</td><td>Special key</td></tr>
      <tr><td>DOWN</td><td>\uE015</td><td>Special key</td></tr>
      <tr><td>ARROW_DOWN</td><td>\uE015</td><td>Special key</td></tr>
      <tr><td>INSERT</td><td>\uE016</td><td>Special key</td></tr>
      <tr><td>DELETE</td><td>\uE017</td><td>Special key</td></tr>
      <tr><td>SEMICOLON</td><td>\uE018</td><td>Special key</td></tr>
      <tr><td>EQUALS</td><td>\uE019</td><td>Special key</td></tr>
      <tr><td>NUMPAD0</td><td>\uE01A</td><td>Special key</td></tr>
      <tr><td>NUMPAD1</td><td>\uE01B</td><td>Special key</td></tr>
      <tr><td>NUMPAD2</td><td>\uE01C</td><td>Special key</td></tr>
      <tr><td>NUMPAD3</td><td>\uE01D</td><td>Special key</td></tr>
      <tr><td>NUMPAD4</td><td>\uE01E</td><td>Special key</td></tr>
      <tr><td>NUMPAD5</td><td>\uE01F</td><td>Special key</td></tr>
      <tr><td>NUMPAD6</td><td>\uE020</td><td>Special key</td></tr>
      <tr><td>NUMPAD7</td><td>\uE021</td><td>Special key</td></tr>
      <tr><td>NUMPAD8</td><td>\uE022</td><td>Special key</td></tr>
      <tr><td>NUMPAD9</td><td>\uE023</td><td>Special key</td></tr>
      <tr><td>MULTIPLY</td><td>\uE024</td><td>Special key</td></tr>
      <tr><td>ADD</td><td>\uE025</td><td>Special key</td></tr>
      <tr><td>SEPARATOR</td><td>\uE026</td><td>Special key</td></tr>
      <tr><td>SUBTRACT</td><td>\uE027</td><td>Special key</td></tr>
      <tr><td>DECIMAL</td><td>\uE028</td><td>Special key</td></tr>
      <tr><td>DIVIDE</td><td>\uE029</td><td>Special key</td></tr>
      <tr><td>F1</td><td>\uE031</td><td>Special key</td></tr>
      <tr><td>F2</td><td>\uE032</td><td>Special key</td></tr>
      <tr><td>F3</td><td>\uE033</td><td>Special key</td></tr>
      <tr><td>F4</td><td>\uE034</td><td>Special key</td></tr>
      <tr><td>F5</td><td>\uE035</td><td>Special key</td></tr>
      <tr><td>F6</td><td>\uE036</td><td>Special key</td></tr>
      <tr><td>F7</td><td>\uE037</td><td>Special key</td></tr>
      <tr><td>F8</td><td>\uE038</td><td>Special key</td></tr>
      <tr><td>F9</td><td>\uE039</td><td>Special key</td></tr>
      <tr><td>F10</td><td>\uE03A</td><td>Special key</td></tr>
      <tr><td>F11</td><td>\uE03B</td><td>Special key</td></tr>
      <tr><td>F12</td><td>\uE03C</td><td>Special key</td></tr>
      <tr><td>META</td><td>\uE03D</td><td>Special key</td></tr>
      <tr><td>COMMAND</td><td>\uE03D</td><td>Special key</td></tr>
      <tr><td>ZENKAKU_HANKAKU</td><td>\uE040</td><td>Special key</td></tr>
    </table>
    <p>The keys considered upper-case symbols are either defined by the current keyboard locale or are derived from the US 104 keys Windows keyboard layout, which are:
    <ul>
      <li>A - Z</li>
      <li>!$^*()+{}:?|~@#%_\" &amp; &lt; &gt;</li>
    </ul>
    <p>When the user input is emulated natively (see note below), the implementation SHOULD use the current keyboard locale to determine which symbols are upper case. In all other cases, the implementation MUST use the US 104 key Windows keyboard layout to determine those symbols.</p>
    <p>The state of the physical keyboard MUST NOT affect emulated user input.</p>
    <h3>Internationalized input</h3>
    <p>Non-latin symbols: TBD</p>
    <p>Complex scripts using Input Method Editor (IME): TBD</p>
    </section> <!-- typing -->
    </section> <!-- high-level APIs -->
</section>
<section>
  <h2>Modals</h2>
    This section describes how modal dialogs should be handled using the WebDriver API.
    <p class="note">Conformance tests for this section can be found in the <a href="https://github.com/w3c/web-platform-tests/tree/master/webdriver/">webdriver module</a> under the "modals" folder.</p>
    <section>
      <h2>window.alert, window.prompt and window.confirm</h2>
      <p>When the remote end is has a modal dialog such as those produced from <code>window.alert</code>,
      <code>window.prompt</code> and <code>window.confirm</code> it should allow the interrogation of the
      dialogues as using the following interface.</p>
      <dl class="idl" title="interface Alerts">
        <dt>void dismiss()</dt>
        <dd>This will dismiss the modal. If the modal is an alert, this MUST be
          equivalent to calling <code>accept()</code> on the dialog. If no alert
           is present a <code><a href="#status-no-such-alert">no such alert error</a>
         </code> MUST be raised.</dd>
        <dt>void accept()</dt>
        <dd>This will accept the modal. If the modal is from a <code>window.prompt</code>
         it is the equivalent of clicking the OK button. If no modal is present then a
          <code><a href="#status-no-such-alert">no such alert error</a></code>
           MUST be raised.</dd>
        <dt>DOMString getText()</dt>
        <dd>This will return the text that is currently in the modal.</dd>
        <dt>void sendKeys()</dt>
        <dd>This MUST act in the same manner as in
          <a href='#widl-WebElement-sendKeys-void-stringArray-keysToSend'>sendKeys</a> to an element.
          If the modal has no means for text input it should throw a <code><a href='#status-element-not-visible'>
          Element not visible error</a></code>. If no modal is present then a <a href="#status-no-such-alert">
          no such alert error</a></code> MUST be raised.
          <dl class='parameters'>
            <dt>DOMString keysToSend</dt>
            <dd>Keys to send to the modal. If the modal has no means of acceptiing text input
             it MUST raise a <code><a href='#status-element-not-visible'>element not visible error</a></code></dd>
          </dl>
        </dd>
      </dl>
      <p>If a modal dialog is created from a <code>onbeforeunload</code> event the remote end MUST handle the
        dialog by either using <code>accept</code> or <code>dismiss</code>. These calls should either come from
        the local end or should be handled as an unexpected modal dialog as described below.
      <p>The remote end SHOULD have a mechanism to allow unexpected modal dialogs to be closed
      to prevent the remote end from becoming unusable. The default for this should be dismiss.
      The local end SHOULD allow a capability to be set that allows the default value to be
      overridden with accept. The local end SHOULD also allow setting the default behaviour
      to wait for a command to handle the modal. If the next command does not interact with the modal
      it MUST return a <code><a href='#status-unexpected-alert-open'>Unexpected alert open</a></code> error to
      the local end.
    </section>
    <section>
      <h2>Modal Windows</h2>
      <p>If a browser supports Modal Windows, as created by <code>document.showModalDialog()</code>,
        it MUST support handling of Modal Windows via the WebDriver API. Model Windows can then be
        <a href='#iterating-over-windows'>iterated</a> over in the same approach as normal windows.</p>
      <p>If <code>close()</code> is called from the local end to the parent window that has modal
      windows open then the remote end SHOULD iterate over modal dialogs closing them
      before it closes the remaining windows so that it does not block the
      future commands to the remote end</p>
    </section>
</section>
<section>
  <h2>Screenshots</h2>
  <p>Screenshots are a powerful mechanism for providing information to users of WebDriver, particularly once a particular WebDriver instance has been disposed of. In different circumstances, users want different types of screenshot. Note that the WebDriver spec does not provide a mechanism for taking a screenshot of the entire screen.</p>

  <p>In all cases, screenshots MUST be returned as lossless PNG images encoded using Base64. Local ends MUST provide the user with access to the PNG images without requiring the user to decode the Base64. This access MUST be via at least one of a binary blob or a file.</p>

  <p>All commands within this section are implemented using the "TakesScreenshot" interface:</p>

  <dl class="idl" title="interface TakesScreenshot">
    <dt>DOMString takeScreenshot()</dt>
    <dd>Take a screenshot as determined by the CommandName and return a lossless PNG encoded using Base64.
      <p>The possible errors for this command:
      <ul>
        <li><code><a href="#unknown-error">unknown error</a></code> if the if the screenshot cannot be taken.</li>
      </ul>
      <dl class='parameters'>
        <dt>optional WebElement? element</dt>
        <dd>The ID of the WebElement on which to operate. If this argument is not populated or <code>null</code></dd>
      </dl>
    </dd>
  </dl>

  <section>
    <h2>Current Window</h2>
    <table class="simple">
      <tr><th>Capability Name</th><th>Type</th></tr>
      <tr><td><span id="capability-takesScreenshot">takesScreenshot</span></td><td>boolean</td></tr>
    </table>

    <p>If this capability is supported, local end MUST add the <code>TakesScreenshot</code> interface to the <code>WebDriver</code> interface.</p>

    <p>This command will take a screenshot of the current window. Implementations of the remote end SHOULD capture the entire Document, even if this would require a user to scroll the browser window. That is, the returned PNG SHOULD have the same width and height as returned by a call to <code>getSize</code> of the BODY element and MUST contain all visible content on the page, and this SHOULD be done without resizing the browser window. If the remote end is unable to capture the entire Document, then the part of the Document currently displayed in UI of the browser MUST be captured without additional chrome such as scrollbars and browser chrome.</p>

    <div class="note">
      <p>One way to think of capturing the entire Document is that the user has an infinitely large monitor and has resized the window to allow all content to be visible. One of those monitors would be very cool.</p>
    </div>

    <p>Nested frames MUST be sized as if the user has resized the window to the dimensions of the PNG being returned. This often means that not all potentially visible content within the nested frames is captured.</p>

    <p>Remote ends MUST NOT attempt to track changes in window size as the screenshot is being taken. In particular this means that in the case of a page that makes use of "infinite scrolling" (where an AJAX call is used to populate additional content as the user scrolls down) or in some other way resizes content as the window size is changed only the content that was originally contained in the Document when the command is executed will be captured.</p>
  </section>
  <section>
    <h2>Element</h2>
      <table class="simple">
        <tr><th>Capability Name</th><th>Type</th></tr>
        <tr><td><span id="capability-takeElementScreenshot">takeElementScreenshot</span></td><td>boolean</td></tr>
      </table>

  	<p>If this capability is supported, local end MUST add the <code>TakesScreenshot</code> interface to the <code>WebElement</code> interface.</p>
    <p>Remote ends SHOULD take a screenshot of the area bounded by the clientBoundingRect of the Document element represented by the <code>WebElement</code>, returning it as a Base64 encoded, lossless PNG. Local ends MUST make the PNG available directly to the user as at least one of a binary blob or a file. If the remote end cannot capture the entire clientBoundingRect, they MUST scroll as much of the element into the current browser viewport as possible and capture the maximum visible area without additional browser chrome.</p>
    <p>If the <code>WebElement</code> represents a FRAME or IFRAME element, this is equivalent of taking a screenshot of the frame's BODY element.</p>
  </section>
</section>
<section>
  <h2>Handling non-HTML Content</h2>
  <p>Non-HTML content MUST be treated in the same manner as HTML if the Non-HTML if the browser
    creates a Document object for the content of the document. If a Document Object is not created then
    how it handled SHOULD be non-normative</p>

  <section>
    <h2>XML</h2>
    <p>This section describes XML documents as described in [[XML10]]. For XHTML documents the remote end should treat them as HTML documents
    and not have the caveats, below, applied.</p>
      <p>Since Browsers create a Document object for XML pages it is expected that we can interogate
      them as a normal HTML document however the following differences should be noted:</p>
      <ul>
        <li>Visibility Checks MAY be skipped since XML nodes can not be hidden and <code>isDisplayed</code> MUST return true<li>
        <li>Getting computed styles of elements MUST return an empty string</li>
        <li>Position and Size of element MUST return null for elements in the map returned</li>
        <li>Attempts to clear the node MUST return an <code><a href='#status-unsupported-operation'>unsupported operation</a></code> </li>
        <li>Attempts to send keys to a node MUST return an exception <code><a href='#status-unsupported-operation'>unsupported operation</a></code></li>
        <li><code>isEnabled</code> MUST return false</li>
        <li><code>isSelected</code> MUST return false</li>
        <li><code>submit</code> MUST return an exception <code><a href='#status-unsupported-operation'>unsupported operation</a></code></li>
      </ul>
  </section>
  <section>
    <h2>SVG</h2>
    <p>This section described SVG documents in a browser as described by [[SVG2]].
    Since browsers create a Document tree for SVG documents it is expected that WebDriver
    can interrogate the Document as a normal HTML document.
    </p>
  </section>

  <section>
    <h2>Working with Accessibility APIs</h2>

    <p>Many accessibility APIs represent the UI as a series of nested nodes. It is possible to map these nodes to <code>WebElement</code> instances. In order to function properly, it is likely that additional element locating strategies will be required.</p>

    <p class="note">This is one way in which it might be possible to test mobile applications that marry a native wrapper around a series of HTML views.</p>
  </section>
</section>
  <section>
    <h2>Extending the Protocol</h2>
    <p></p>
    <section>
      <h3>Vendor-specific Extensions</h3>
      <p>The WebDriver protocol is designed to allow extension to meet vendor-specific needs, such as interacting with the chrome of a browser. Vendor-specific extensions are implemented by appending a prefix to the command name. This should be of the form:</p>
      <pre>
        '-' + vendor prefix + '-' + command name
      </pre>
      <p>For example: "<code>-o-open-bookmark</code>" or "<code>-moz-install-extension</code>".</p>
      <p>It is guaranteed that no command name in this or future versions of the WebDriver specification will be prefixed with a leading dash.</p>

      <div class="note">
        It is suggested that vendors use the same vendor identifier as in [[!CSS21]] (notably, section <a href="http://www.w3.org/TR/CSS21/syndata.html#vendor-keywords">4.1.2.2</a>)
      </div>
    </section>
    <section>
      <h3>Extending the JSON/HTTP Protocol</h3>
      <p>This section is non-normative.</p>
      <p>The wire protocol (see Appendix XXX) makes use of URLs to distinguish command names. When extending the protocol by adding new URLs, vendors should use their vendor prefix without additional characters to prevent any potential clashes with other implementations. This leads to URLs of the form: <code>http://host:port/session/somekey/<b>moz</b>/extension</code>.
    </section>
  </section>

<section class='appendix'>
  <h2>Command Summary</h2>

  <p>This is an exhaustive list of the commands listed in this specification.</p>
</section><section class='appendix'>
  <h2>Capabilities</h2>

  <p>This section is non-normative.</p>

  <p>Capabilities are used by WebDriver implementations to enumerate the parts of this specification that they support. They are also used when establishing a new session to descrive the required or desired capabilities. This appendix collects the capabilities mentioned in this spec into one place.</p>

<ul>
<li><a href="#capability-browserName">browserName</a></li>
<li><a href="#capability-browserVersion">browserVersion</a></li>
<li><a href="#capability-pageLoadingStrategy">pageLoadingStrategy</a></li>
<li><a href="#capability-platformName">platformName</a></li>
<li><a href="#capability-platformVersion">platformVersion</a></li>
<li><a href="#capability-securessl">secureSsl</a></li>
<li><a href="#capability-takeElementScreenshot">takeElementScreenshot</a></li>
<li><a href="#capability-takesScreenshot">takesScreenshot</a></li>
<li><a href="#capability-touchEnabled">touchEnabled</a></li>
</ul>
</section>    <section class='appendix'>
      <h2>Command Format</h2>
      <p>This is essentially the content at the start of the json wire protocol</p>
    </section>

    <section class='appendix'>
      <h2>Thread Safety</h2>

      <p>There is no requirement for local or remote implementations to be thread safe. Local ends SHOULD support serialized access from multiple threads.</p>
    </section>

    <section class='appendix'>
      <h2>Logging</h2>
      <p></p>
    </section>
    <section class='appendix'>
      <h2>Security and Privacy</h2>
      <p>The following section is non-normative.</p>
      <section>
        <h3>Privacy</h3>
        <p>The local end SHOULD create a new profile when creating a new session.
          If a new profile can be created it MUST NOT copy the profile in use and
          MUST create a fresh profile. By creating a new profile the user agent will
           prevent any unexpected behaviour when the remote end is accessing content.</p>
      </section>
      <section>
        <h3>Security</h3>
        <p>The remote end SHOULD have a specific command line argument when starting
          the browser up if it is connecting to a browser
          (e.g. firefox.exe --webdriver ) and SHOULD have user agent configuration
           preference that is tested when the user agent starts up
        <p>When the local end creates a new session the remote end MUST limit
        connections to <code>127.0.0.1</code> IPV4 address or <code>::1</code>
        IPV6 address. This will prevent new sessions being created without having
        a specific proxy installed on the remote end.</p>
        <div class='note'>
          <p>Some devices will require the device to be placed into a 'developer' mode.
          This allows unix sockets to be forwarded on to the device while the device is
          connected to a host. An example of this is if the local end needed to go through
           a remote debugger protocol.</p>
        </div>
        <p>If any of these fail then a
        <code><a href="#status-session-not-created">session not created</a></code>
        error MUST be thrown when the local end tries to create a new session.
      </section>
      <section>
        <h3>Fingerprinting</h3>
        <p>The following will allow web sites to know that the user interacting
        with the content is not a real user. This can be used to prevent denial
        of service attacks.
        <p>When the user agent creates a new session it MUST add a read only property
        to <code>window.navigator.webdriver</code>. The value should be set to
        <code>true</code> when WebDriver has an active session. When WebDriver does not have
        an active session then the value is equal to <code>false</code> or the property is removed.
      </section>
    </section>
    <section class='appendix'>
      <h2>Mapping to HTTP and JSON</h2>
      <p></p>
    </section>

    <section class='appendix'>
      <h2>Acknowledgements</h2>
      <p>
        Many thanks to Robin Berjon for making our lives so much
        easier with his cool tool. Thanks to Jason Leyba, Malcolm Rowe,
        Ross Patterson and Andrey Botalov for proof reading and suggesting areas for
        improvement. Thanks to Jason Leyba, Eran Messeri, Daniel
        Wagner-Hall, Malini Das and Luke Inman-Semerau for contributing sections to this document. Also
        thanks to the following people for their contribution of
        patches and test cases:
        <ul>
         <li>Philippe Le Hegaret</li>
        </ul>
      </p>
      </section>

      <div style="display: none">
        <p>These links are only here until we have fixed ReSpec.js to avoid
        creating anchors to things that don't exist.</p>
        <ul>
          <li id="idl-def-void">idl-def-void</li>
          <li id="idl-def-stringbooleannumber">idl-def-stringbooleannumber</li>
          <li id="idl-def-boolean">idl-def-boolean</li>
          <li id="idl-def-number">idl-def-number</li>
          <li id="idl-def-object">idl-def-object</li>
          <li id="idl-def-DOMString">idl-def-DOMString</li>
          <li id="idl-def-dictionary">idl-def-dictionary</li>
          <li id="idl-def-integer">idl-def-integer</li>
          <li id="idl-def-string">idl-def-string</li>
          <li id="idl-def-Argument">idl-def-Argument</li>
        </ul>
      </div>
  </body>
</html>
