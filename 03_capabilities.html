<section>
  <h2>Capabilities</h2>
  <p>
    Webdriver <dfn>capabilities</dfn> allow the <a>local end</a> to specify what
     features it requires the <a>remote end</a> to fulfil to be able to create a
      <a>new session</a>
  </p>
  <h3>Processing Capabilities</h3>
  <p>
    <p>The <a>remote end steps</a> to <dfn>process capabilities</dfn> are:</p>
    <ol>
      <li><p>Let <var>server capabilities</var> be a JSON Object with the following entries:<p></li>
        <ol>
          <li><p>Let "browserName" be an entry with value equal to the lowercase name of the user agent</p></li>
          <li><p>Let "browserVersion" be an entry with the value equal to the version of the user agent<p></li>
          <li><p>Let "platformName" be an entry with the value equal to the lowercase name of the platform.</p></li>
          <li><p>Let "platformVersion" be an entry with the value equal to the version of the platform</p></li>
          <li><p>Let "acceptSslCerts" be an entry with the value equal to true if it can handle
            <a href='#invalid-ssl-certificates'>Invalid SSL Certifications</a> else let it be equal to
            false.</p></li>
          <li><p>Let "takesScreenshot" be an entry with the value equal to true if it can capture
          a screenshot of the viewport described in <a>Take Screenshot</a>.</p></li>
          <li><p>Let "takesElementScreenshot" be an entry with the value equal to true if it can capture
          a screenshot of an element as described in <a>Take Screenshot</a>.</p></li>
        </ol>
        <li><p>Let <var>capabilities</var> be the result of <a>getting a property</a>
          named "capabilities" from the <var>parameters</var> argument.</p></li>
        <li><p>let <var>required capabilities</var> be the result of <a>getting a property</a>
          name "required capabilities" from <var>capabilities</var>.</p></li>
        <li><p>let <var>desired capabilities</var> be the result of <a>getting a property</a>
            name "desired capabilities" from <var>capabilities</var>.</p></li>
        <li><p>If <var>required capabilities</var> is undefined and
          <var>desired capabilities</var> is undefined, go to the last step of this algorithm.</p></li>
        <li><p>Let <var>length</var> be the length of <var>required capabilities</var>
            if <var>required capabilities</var> is defined else let it be 0.</p></li>
        <li><p>Let <var>k</var> be 0</p></li>
        <li><p>While <var>k</var> &lt; <var>length</var>:</p>
          <ol>
            <li><p>Let <var>capability</var> be the value in <var>required capabilities</var> at index <var>k</var>.</p></li>
            <li><p>If the name of the <var>capability</var> entry is in <var>desired capabilities</var>
              remove the entry from <var>desired capabilities</var>.</p>
            </li>
            <li>Increase <var>k</var> by 1.</li>
          </ol>
        </li>
        <li><p>Let <var>unmet capabilities</var> be equal to an empty JSON List.</p></li>
        <li>
          <p>Let <var>unprocessed capabilities</var> be a JSON List that contains <var>required
          capabilities</var> if defined and <var>desired capabilities</var> if defined.</p>
        </li>
        <li>
          <p>Let <var>j</var> be 0</p>
        </li>
        <li>
          <p>Let <var>capabilties length</var> be the length of <var>unprocessed capabilities</var>.</p>
        </li>
        <li>
          <p>While <var>j</var> &lt; <var>capabilities length</var>:
            <ol>
              <li>
                <p>
                  Let <var>caps</var> be the entry at index <var>j</var> in <var>unprocessed
                  capabilities</var>.
                </p>
              </li>
              <li>
                <p>Let <var>browser name</var> be the result of <a>getting a property</a>
                  named "browserName" from <var>caps</var>. If <var>browser name</var>
                  is undefined move to the next step. If <var>caps</var> equals <var>required
                  capabilities</var> do the following:</p>
                  <ol>
                    <li>
                      <p>
                        If <var>browser name</var> is defined
                        and is not equal to "browserName" from <var>server capabilities</var> append a string
                        containing the differences between <var>browser name</var> and "browserName"
                        in <var>server capabilities</var>.
                      </p>
                    </li>
                  </ol>
              </li>
              <li>
                <p>Let <var>browser version</var> be the result of <a>getting a property</a>
                  named "browserVersion" from <var>caps</var>. If <var>browser name</var>
                  is undefined move to the next step.
                  If <var>caps</var> equals <var>required capabilities</var> do the following:</p>
                  <ol>
                    <li>
                      <p>If <var>browser name</var> is defined
                        and is not equal to "browserVersion" from <var>server capabilities</var> append a string
                        containing the differences between <var>browser version</var> and "browserVersion"
                        in <var>server capabilities</var>.
                      </p>
                    </li>
                  </ol>
              </li>
              <li>
                <p>Let <var>platform name</var> be the result of <a>getting a property</a>
                  named "platformName" from <var>caps</var>. If <var>platform name</var>
                  is undefined move to the next step.
                  If <var>caps</var> equals <var>required capabilities</var> do the following:</p>
                  <ol>
                    <li>
                      <p>If <var>platform name</var> is defined
                        and is not equal to "platformName" from <var>server capabilities</var> append a string
                        containing the differences between <var>browser name</var> and "platformName"
                        in <var>server capabilities</var>.
                      </p>
                    </li>
                  </ol>
              </li>
              <li>
                <p>Let <var>platform version</var> be the result of <a>getting a property</a>
                  named "platformVersion" from <var>caps</var>. If <var>platform version</var>
                  is undefined move to the next step.
                  If <var>caps</var> equals <var>required capabilities</var> do the following:</p>
                  <ol>
                    <li>
                      <p>If <var>platform version</var> is defined
                      and is not equal to "platformVersion" from <var>server capabilities</var> append a string
                      containing the differences between <var>platform version</var> and "platformVersion"
                      in <var>server capabilities</var>.
                      </p>
                    </li>
                  </ol>
              </li>
              <li>
                <p>Let <var>proxy</var> be the result of <a>getting a property</a>
                named "proxy" from <var>caps</var>. If <var>proxy</var>
                is undefined move to the next step. If <var>proxy</var> is defined and not a map
                append a string saying that a map is required else call <a>setup proxy</a><!-- TODO (David) define setup proxy-->
                passing in <var>proxy</var>.
                If <var>caps</var> equals <var>required capabilities</var> do the following:</p>
                <ol>
                  <li>
                    <p>If any errors are returned from <a>setup proxy</a>
                    append to <var>unmet capabilities</var> else set the entry "proxy" in <var>server
                    capabilities</var> to the value in <var>proxy</var>.
                    </p>
                  </li>
                </ol>
              </li>
              <li>
                <p>Let <var>page load strategy</var> be the result of <a>getting a property</a>
                named "pageLoadStrategy" from <var>caps</var>. If <var>page load strategy</var>
                is undefined then set the entry "pageLoadStrategy" in <var>server capabilities</var> to <a>normal</a>.
                If <var>caps</var> equals <var>required capabilities</var> do the following:</p>
                <ol>
                  <li>
                    <p>If <var>page load strategy</var> is defined and not equal to <a>normal</a>, <a>eager</a> and <a>none</a>
                      then append a string saying that it contains an invalid value else set the entry
                      "pageLoadStrategy" in <var>server capabilities</var> to the value in <var>page load
                        strategy</var>.
                    </p>
                  </li>
                </ol>
                <p>
                If <var>caps</var> equals <var>desired capabilities</var>:
               </p>
               <ol>
                 <li>
                   <p>
                     If <var>page load strategy</var> is defined and not equal to <a>normal</a>, <a>eager</a> and <a>none</a>
                     then set the entry "pageLoadStrategy" in <var>server capabilities</var> to <a>normal</a>..
                   </p>
                 </li>
               </ol>
              </li>
            </ol>
          </p>
        </li>
        <li>
          <p>If the length of <var>unmet capabilities</var> is not equal to 0 return
           <a>session not created</a> with data <var>unmet capabilities</var>.</p>
        </li>
        <li><p>Return <var>server capabilities</var></p></li>
    </ol>
  </p>
</section>
