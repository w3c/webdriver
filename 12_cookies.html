<section>
  <h2>Cookies</h2>

  <p>This section describes the interaction with
  <a href='http://www.w3.org/TR/html5/dom.html#dom-document-cookie'>cookies</a>
  as described in the HTML Specification ([[!html51]]). When retrieving
  and setting a cookie it MUST be in the format of a <code>Cookie</code>.</p>
  <p class="note">Conformance tests for this section can be found in the <a href="https://github.com/w3c/web-platform-tests/tree/master/webdriver/">webdriver module</a> under the "cookies" folder.</p>
  <section>
    <h2>Cookie</h2>
    <p>When returning Cookie objects, the server SHOULD include all optional fields it is capable of providing the information for.</p>
    <section>
      <!-- getCookie() -->
      <h3>getCookie</h3>
        <p>
          <table class="simple jsoncommand">
            <tr>
              <th>HTTP Method</th>
              <th>Path Template</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>POST</td>
              <td id='post-cookie'>/session/{sessionId}/cookie</td>
              <td></td>
            </tr>
          </table>
          <p>The <a>remote end steps</a> for the <a>getCookie</a> command are:</p>
          <ol>
            <li><p>If the <a>current browsing context</a> is <a>no longer open</a>, return an error with code <a>no such window</a>.</p></li>
            <li><p>Let <var>name</var> be the result of <a>getting a property</a> named "name" from the <var>parameters</var> argument.</p></li>
            <li><p>Let <var>result</var> be an empty JSON List</p></li>
            <li><p>Let <var>cookies</var> be all cookies [[!RFC6265]] of the resource represented by the idenfied by <a href="https://dom.spec.whatwg.org/#concept-document-url"> the document's address</a></p></li>
            <li><p>Let <var>cookies</var> be the list of values to iterate over</p></li>
            <li><p>Let <var>len</var> be the length of <var>cookies</var>.</p></li>
            <li><p>Let <var>k</var> be 0</p></li>
            <li><p>While <var>k</var> < <var>len</var>: </p>
              <ol>
                <li><p>Let <var>cookie</var> be the value in <var>cookies</var> at index <var>k</var>.</p></li>
                <li><p>If <var>name</var> is undefined:</p>
                  <ol>
                    <li><p>Append a <a>serialised cookie</a> to <var>result</var>.</p></li>
                  </ol>
                </li>
                <li><p>if <var>name</var> is defined and is equal to <var>cookie-name</var>:</p>
                  <ol>
                    <li><p>Append a <a>serialised cookie</a> to <var>result</var>.</p></li>
                  </ol>
                </li>
                <li><p>Increase the value of <var>k</var> by 1</p></li>
              </ol>
            </li>
            <li><p>Return <a>success</a> with data <var>result</var></p></li>
          </ol>
          <p>A <dfn>serialised cookie</dfn> is created with the following algorithm:</p>
          <p>
            <ol>
              <li><p>Let <var>serialisedCookie</var> be an empty map.</p></li>
              <ul>
                <li><p>Add an entry whose key is <var>name</var> and value is <var>cookie-name</var> be  as defined in [[!RFC6265]]</p></li>
                <li><p>Add an entry whose key is <var>value</var> and value is <var>cookie-value</var> as defined in [[!RFC6265]]</p></li>
                <li><p>Add an entry whose key is <var>path</var> and value is <var>path attribute</var> from cookie-attribute-list if defined else it MUST be null.</p></li>
                <li><p>Add an entry whose key is <var>domain</var> and value is <var>Domain attribute</var> from cookie-attribute-list if defined else it MUST be null.</p></li>
                <li><p>Add an entry whose key is <var>secure</var> and value is <var>Secure attribute</var> from cookie-attribute-list if defined else it MUST be false.</p></li>
                <li><p>Add an entry whose key is <var>expiry</var> and value is <var>Expires attribute</var> from cookie-attribute-list where <var>Expires attribute</var>
                  is specified in milliseconds since midnight, January 1, 1970 UTC using the format described in [[!RFC1123]]. If <var>Expires attribute</var> is undefined it MUST be null.</p></li>
              </ul>
              <li>Return <var>serialisedCookie</var></li>
            </ol>
          </p>
      </section>
      <section>
      <h3>addCookie()</h3>
        <p>
          <table class="simple jsoncommand">
            <tr>
              <th>HTTP Method</th>
              <th>Path Template</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>POST</td>
              <td id='post-cookie'>/session/{sessionId}/cookie</td>
              <td></td>
            </tr>
          </table>
          <p>A command named "addCookie" MUST follow:
          <ol>
            <li>If the parameters object does not contain an element that can be coverted to
              <code><a>Cookie</a></code> return a <code><a href='#status-unable-to-set-cookie'>unable to set cookie</a></code> error.</li>
            <li>If the <code>Document</code> is a <a href='http://www.w3.org/html/wg/drafts/html/master/single-page.html#cookie-averse-document-object'>cookie-averse <code>Document</code> object</a> then return an
              <code><a href="#status-invalid-cookie-domain">invalid cookie domain</a></code> error.</li>
            <li>Set the <a>Cookie</a> in the user agent following the steps described in <a href='http://tools.ietf.org/html/rfc6265#section-5.3'>Storage Model</a> in [[!RFC6265]]. If there is an error during this step
              return a <code><a href='#status-unable-to-set-cookie'>unable to set cookie</a></code> error.</li>
          </ol>
        <dl class='parameters'>
          <dt>Cookie cookie</dt>
          <dd>
            A <code>Cookie</code> defining the cookie to be added. Store the <a>Cookie</a> in the user agent following the steps
            described in <a href='http://tools.ietf.org/html/rfc6265#section-5.3'>Storage Model</a> in [[!RFC6265]].
          </dd>
        </dl>
    </section>
  </section>
</section>
